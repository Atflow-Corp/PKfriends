import{j as e,F as s}from"./index-B1LVcJqF.js";import{r as t}from"./react-vendor-B8CcSR15.js";import{B as a}from"./button-DQcJw-BW.js";import{C as n,a as l,b as r,c as i,d as c}from"./card-T3q_QJuy.js";import{I as o}from"./input-waHpnmhz.js";import{L as m,S as d,d as h,e as x,f as u,g as j,A as f,h as p,i as g,j as N,k as b,l as v,n as w}from"./alert-dialog-HfFqSLfa.js";import{H as S}from"./Header-tvq93swz.js";import{s as y,S as C}from"./storage-GRehWpHF.js";import{g as z}from"./ui-vendor-C4VXqYRS.js";import"./index-CtqvmGU1.js";const k=({onBack:k,onComplete:A,initialPhoneNumber:R=""})=>{const[T,Z]=t.useState({name:"",phoneNumber:R,organization:"",medicalRole:""}),[F,O]=t.useState(!1),[I,J]=t.useState(!1),[$,B]=t.useState(!1);t.useEffect(()=>{R&&Z(e=>({...e,phoneNumber:R}))},[R]);const E=e=>{if(!e||""===e.trim())return null;const s=/[가-힣]/.test(e),t=/[a-zA-Z]/.test(e);if(/^[ㄱ-ㅎㅏ-ㅣ]+$/.test(e))return"완성된 한글만 입력 가능합니다. (자음/모음만 입력 불가)";if(s&&t)return"이름은 한글 또는 영문으로만 입력해 주세요. (혼용 불가)";if(s){if(e.length<2)return"한글 이름은 2자 이상 입력해 주세요.";if(e.length>10)return"한글 이름은 2~10자까지 입력 가능합니다.";if(/[\s0-9]/.test(e)||/[^가-힣]/.test(e))return"한글 이름은 한글만 입력 가능합니다. (띄어쓰기, 숫자, 특수문자 불가)"}if(t){if(e.length<2)return"영문 이름은 2자 이상 입력해 주세요.";if(e.length>50)return"영문 이름은 2~50자까지 입력 가능합니다.";if(/[0-9]/.test(e))return"영문 이름에는 숫자를 입력할 수 없습니다.";if(/[^a-zA-Z\s,\-]/.test(e))return"영문 이름은 영문, 띄어쓰기, comma(,), dash(-)만 입력 가능합니다."}return!s&&!t&&e.length>0?"이름은 한글 또는 영문으로 입력해 주세요.":null},H=(e,s)=>{if("name"===e){if($)return void Z(t=>({...t,[e]:s}));const t=T.name,a=((e,s)=>{if(""===e)return{value:"",shouldShowToast:!1};const t=/[가-힣]/.test(e),a=/[a-zA-Z]/.test(e),n=/[가-힣]/.test(s),l=/[a-zA-Z]/.test(s);if(t&&a&&(!n||!l))return{value:s,shouldShowToast:!0};let r=e,i=!1;if(t){if(/^[ㄱ-ㅎㅏ-ㅣ]+$/.test(e))return{value:s,shouldShowToast:!0};if(r=e.replace(/[^가-힣]/g,""),r=r.replace(/[ㄱ-ㅎㅏ-ㅣ]/g,""),r!==e&&(i=r!==s&&e!==s),r.length>10){const e=s.length<=10&&r.length>10;r=r.slice(0,10),i=i||e}}else if(a){if(/^[a-zA-Z\s,\-]*$/.test(e)||(r=e.replace(/[^a-zA-Z\s,\-]/g,""),i=r!==s&&e!==s),r.length>50){const e=s.length<=50&&r.length>50;r=r.slice(0,50),i=i||e}}else r="",i=e!==s;return{value:r,shouldShowToast:i}})(s,t);Z(s=>({...s,[e]:a.value}))}else Z(t=>({...t,[e]:s}))},L=()=>{const e=""!==T.name.trim()&&""!==T.phoneNumber.trim()&&""!==T.organization&&""!==T.medicalRole,s=E(T.name);return e&&!s};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-slate-100 dark:bg-slate-900",children:[e.jsx(S,{}),e.jsx("div",{className:"flex flex-1 items-center justify-center p-4",children:e.jsxs(n,{className:"w-full max-w-md",children:[e.jsxs(l,{className:"text-center",children:[e.jsx(r,{className:"text-2xl font-bold",children:"회원정보 입력"}),e.jsx(i,{children:"회원가입을 위한 정보를 입력해주세요"})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"name",className:"text-sm font-medium",children:["이름 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"name",type:"text",placeholder:"이름을 입력해주세요",value:T.name,onChange:e=>H("name",e.target.value),onCompositionStart:()=>{B(!0)},onCompositionEnd:e=>{B(!1),H("name",e.currentTarget.value)},maxLength:100}),E(T.name)&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:E(T.name)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"phoneNumber",className:"text-sm font-medium",children:["휴대폰 번호 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"phoneNumber",type:"tel",placeholder:T.phoneNumber?"":"로그인 시 입력한 번호가 자동으로 표시됩니다",value:T.phoneNumber,onChange:e=>H("phoneNumber",e.target.value),disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"휴대폰 번호 변경은 시스템관리자에게 문의해주세요."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"organization",className:"text-sm font-medium",children:["소속기관 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(d,{value:T.organization,onValueChange:e=>H("organization",e),children:[e.jsx(h,{children:e.jsx(x,{placeholder:"소속기관을 선택해주세요"})}),e.jsx(u,{children:["앳플로우"].map(s=>e.jsx(j,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"medicalRole",className:"text-sm font-medium",children:["의료진 구분 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(d,{value:T.medicalRole,onValueChange:e=>H("medicalRole",e),children:[e.jsx(h,{children:e.jsx(x,{placeholder:"의료진 구분을 선택해주세요"})}),e.jsx(u,{children:["의사","간호사","기타"].map(s=>e.jsx(j,{value:s,children:s},s))})]})]})]}),e.jsx(a,{onClick:()=>{L()&&O(!0)},className:"w-full",disabled:!L(),children:"회원가입 완료"}),e.jsxs(a,{variant:"ghost",onClick:k,className:"w-full flex items-center gap-2 text-sm",children:[e.jsx(z,{className:"h-4 w-4"}),"로그인으로 돌아가기"]})]})]})}),e.jsx(s,{}),e.jsx(f,{open:F,onOpenChange:O,children:e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsx(N,{className:"text-center text-xl font-bold text-green-600",children:"환영합니다!"}),e.jsxs(b,{className:"text-center text-base py-4",children:["서비스 홈으로 이동하여",e.jsx("br",{}),"TDM 진행할 환자 정보를 등록해주세요."]})]}),e.jsx(v,{className:"flex justify-center",children:e.jsx(w,{onClick:()=>{try{const e=JSON.parse(window.localStorage.getItem("tdmfriends:registeredUsers")||"[]");e.includes(T.phoneNumber)||(e.push(T.phoneNumber),window.localStorage.setItem("tdmfriends:registeredUsers",JSON.stringify(e)));const s={name:T.name,email:"",phone:T.phoneNumber,organization:T.organization,role:"의사"===T.medicalRole?"doctor":"간호사"===T.medicalRole?"nurse":"other"};y.setJSON(C.userProfile,s),O(!1),A()}catch(e){O(!1),J(!0)}},className:"w-full max-w-xs",children:"확인"})})]})}),e.jsx(f,{open:I,onOpenChange:J,children:e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsx(N,{className:"text-center text-xl font-bold text-red-600",children:"오류 발생"}),e.jsxs(b,{className:"text-center text-base py-4",children:["회원가입 정보 저장 중 오류가 발생했습니다.",e.jsx("br",{}),"다시 시도해주세요."]})]}),e.jsx(v,{className:"flex justify-center",children:e.jsx(w,{onClick:()=>J(!1),className:"w-full max-w-xs",children:"확인"})})]})})]})};export{k as default};
