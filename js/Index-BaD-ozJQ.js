import{u as e,j as t,c as n,a as r,b as a,d as i,P as s,e as o,f as l,g as d,h as c,i as u,A as m,S as f,D as p,C as h,k as g,V as x,R as v,l as b,m as j,n as y,o as w,p as N,q as C}from"./index-BZp4hj3a.js";import{r as D,d as S,a as T,c as k,g as M}from"./react-vendor-D3qZqZSO.js";import{C as R,a as I,b as _,c as E,d as P}from"./card-C1OJzykZ.js";import{B as A,b as $}from"./button-CiO9JQfX.js";import{I as O}from"./input-ClsGhfN_.js";import{a as L,C as F,b as V,d as H,X as K,U as B,T as U,E as z,F as W,S as G,e as Y,f as X,g as q,A as J,P as Z,h as Q,i as ee,j as te,k as ne,l as re,H as ae,m as ie,n as se}from"./ui-vendor-BO8OVbCP.js";import{s as oe,S as le,T as de,P as ce,h as ue,E as me}from"./html2canvas.esm-fFqdJ0Qg.js";import{R as fe,A as pe,C as he,X as ge,Y as xe,a as ve,b as be,L as je,T as ye,c as we,d as Ne}from"./chart-vendor-D3M3oaDN.js";var Ce=S["useId".toString()]||(()=>{}),De=0;function Se(t){const[n,r]=D.useState(Ce());return e(()=>{t||r(e=>e??String(De++))},[t]),t||(n?`radix-${n}`:"")}function Te(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const r=n.reduce((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]}),{});return D.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}var ke=D.createContext(void 0);function Me(e){const t=D.useContext(ke);return e||t||"ltr"}var Re="rovingFocusGroup.onEntryFocus",Ie={bubbles:!1,cancelable:!0},_e="RovingFocusGroup",[Ee,Pe,Ae]=n(_e),[$e,Oe]=function(e,n=[]){let r=[];const a=()=>{const t=r.map(e=>D.createContext(e));return function(n){const r=(null==n?void 0:n[e])||t;return D.useMemo(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return a.scopeName=e,[function(n,a){const i=D.createContext(a),s=r.length;function o(n){const{scope:r,children:a,...o}=n,l=(null==r?void 0:r[e][s])||i,d=D.useMemo(()=>o,Object.values(o));return t.jsx(l.Provider,{value:d,children:a})}return r=[...r,a],o.displayName=n+"Provider",[o,function(t,r){const o=(null==r?void 0:r[e][s])||i,l=D.useContext(o);if(l)return l;if(void 0!==a)return a;throw new Error(`\`${t}\` must be used within \`${n}\``)}]},Te(a,...n)]}(_e,[Ae]),[Le,Fe]=$e(_e),Ve=D.forwardRef((e,n)=>t.jsx(Ee.Provider,{scope:e.__scopeRovingFocusGroup,children:t.jsx(Ee.Slot,{scope:e.__scopeRovingFocusGroup,children:t.jsx(He,{...e,ref:n})})}));Ve.displayName=_e;var He=D.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:l,orientation:d,loop:c=!1,dir:u,currentTabStopId:m,defaultCurrentTabStopId:f,onCurrentTabStopIdChange:p,onEntryFocus:h,preventScrollOnEntryFocus:g=!1,...x}=e,v=D.useRef(null),b=r(n,v),j=Me(u),[y=null,w]=a({prop:m,defaultProp:f,onChange:p}),[N,C]=D.useState(!1),S=i(h),T=Pe(l),k=D.useRef(!1),[M,R]=D.useState(0);return D.useEffect(()=>{const e=v.current;if(e)return e.addEventListener(Re,S),()=>e.removeEventListener(Re,S)},[S]),t.jsx(Le,{scope:l,orientation:d,dir:j,loop:c,currentTabStopId:y,onItemFocus:D.useCallback(e=>w(e),[w]),onItemShiftTab:D.useCallback(()=>C(!0),[]),onFocusableItemAdd:D.useCallback(()=>R(e=>e+1),[]),onFocusableItemRemove:D.useCallback(()=>R(e=>e-1),[]),children:t.jsx(s.div,{tabIndex:N||0===M?-1:0,"data-orientation":d,...x,ref:b,style:{outline:"none",...e.style},onMouseDown:o(e.onMouseDown,()=>{k.current=!0}),onFocus:o(e.onFocus,e=>{const t=!k.current;if(e.target===e.currentTarget&&t&&!N){const t=new CustomEvent(Re,Ie);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=T().filter(e=>e.focusable);ze([e.find(e=>e.active),e.find(e=>e.id===y),...e].filter(Boolean).map(e=>e.ref.current),g)}}k.current=!1}),onBlur:o(e.onBlur,()=>C(!1))})})}),Ke="RovingFocusGroupItem",Be=D.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:r,focusable:a=!0,active:i=!1,tabStopId:l,...d}=e,c=Se(),u=l||c,m=Fe(Ke,r),f=m.currentTabStopId===u,p=Pe(r),{onFocusableItemAdd:h,onFocusableItemRemove:g}=m;return D.useEffect(()=>{if(a)return h(),()=>g()},[a,h,g]),t.jsx(Ee.ItemSlot,{scope:r,id:u,focusable:a,active:i,children:t.jsx(s.span,{tabIndex:f?0:-1,"data-orientation":m.orientation,...d,ref:n,onMouseDown:o(e.onMouseDown,e=>{a?m.onItemFocus(u):e.preventDefault()}),onFocus:o(e.onFocus,()=>m.onItemFocus(u)),onKeyDown:o(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void m.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,n){const r=function(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,n);return"vertical"===t&&["ArrowLeft","ArrowRight"].includes(r)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(r)?void 0:Ue[r]}(e,m.orientation,m.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let a=p().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)a.reverse();else if("prev"===t||"next"===t){"prev"===t&&a.reverse();const i=a.indexOf(e.currentTarget);a=m.loop?(r=i+1,(n=a).map((e,t)=>n[(r+t)%n.length])):a.slice(i+1)}setTimeout(()=>ze(a))}var n,r})})})});Be.displayName=Ke;var Ue={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ze(e,t=!1){const n=document.activeElement;for(const r of e){if(r===n)return;if(r.focus({preventScroll:t}),document.activeElement!==n)return}}var We=Ve,Ge=Be,Ye="Tabs",[Xe,qe]=l(Ye,[Oe]),Je=Oe(),[Ze,Qe]=Xe(Ye),et=D.forwardRef((e,n)=>{const{__scopeTabs:r,value:i,onValueChange:o,defaultValue:l,orientation:d="horizontal",dir:c,activationMode:u="automatic",...m}=e,f=Me(c),[p,h]=a({prop:i,onChange:o,defaultProp:l});return t.jsx(Ze,{scope:r,baseId:Se(),value:p,onValueChange:h,orientation:d,dir:f,activationMode:u,children:t.jsx(s.div,{dir:f,"data-orientation":d,...m,ref:n})})});et.displayName=Ye;var tt="TabsList",nt=D.forwardRef((e,n)=>{const{__scopeTabs:r,loop:a=!0,...i}=e,o=Qe(tt,r),l=Je(r);return t.jsx(We,{asChild:!0,...l,orientation:o.orientation,dir:o.dir,loop:a,children:t.jsx(s.div,{role:"tablist","aria-orientation":o.orientation,...i,ref:n})})});nt.displayName=tt;var rt="TabsTrigger",at=D.forwardRef((e,n)=>{const{__scopeTabs:r,value:a,disabled:i=!1,...l}=e,d=Qe(rt,r),c=Je(r),u=ot(d.baseId,a),m=lt(d.baseId,a),f=a===d.value;return t.jsx(Ge,{asChild:!0,...c,focusable:!i,active:f,children:t.jsx(s.button,{type:"button",role:"tab","aria-selected":f,"aria-controls":m,"data-state":f?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:u,...l,ref:n,onMouseDown:o(e.onMouseDown,e=>{i||0!==e.button||!1!==e.ctrlKey?e.preventDefault():d.onValueChange(a)}),onKeyDown:o(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&d.onValueChange(a)}),onFocus:o(e.onFocus,()=>{const e="manual"!==d.activationMode;f||i||!e||d.onValueChange(a)})})})});at.displayName=rt;var it="TabsContent",st=D.forwardRef((e,n)=>{const{__scopeTabs:r,value:a,forceMount:i,children:o,...l}=e,c=Qe(it,r),u=ot(c.baseId,a),m=lt(c.baseId,a),f=a===c.value,p=D.useRef(f);return D.useEffect(()=>{const e=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(e)},[]),t.jsx(d,{present:i||f,children:({present:r})=>t.jsx(s.div,{"data-state":f?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":u,hidden:!r,id:m,tabIndex:0,...l,ref:n,style:{...e.style,animationDuration:p.current?"0s":void 0},children:r&&o})})});function ot(e,t){return`${e}-trigger-${t}`}function lt(e,t){return`${e}-content-${t}`}st.displayName=it;var dt=nt,ct=at,ut=st;const mt=et,ft=D.forwardRef(({className:e,...n},r)=>t.jsx(dt,{ref:r,className:c("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...n}));ft.displayName=dt.displayName;const pt=D.forwardRef(({className:e,...n},r)=>t.jsx(ct,{ref:r,className:c("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm","data-[state=active]:bg-primary/90 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:border data-[state=active]:border-primary dark:data-[state=active]:bg-primary/80 dark:data-[state=active]:text-primary-foreground dark:data-[state=active]:border-primary",e),...n}));pt.displayName=ct.displayName;const ht=D.forwardRef(({className:e,...n},r)=>t.jsx(ut,{ref:r,className:c("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...n}));ht.displayName=ut.displayName;var gt=D.forwardRef((e,n)=>t.jsx(s.label,{...e,ref:n,onMouseDown:t=>{var n;t.target.closest("button, input, select, textarea")||(null==(n=e.onMouseDown)||n.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));gt.displayName="Label";var xt=gt;const vt=L("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),bt=D.forwardRef(({className:e,...n},r)=>t.jsx(xt,{ref:r,className:c(vt(),e),...n}));function jt(e,[t,n]){return Math.min(n,Math.max(t,e))}bt.displayName=xt.displayName;var yt=0;function wt(){D.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??Nt()),document.body.insertAdjacentElement("beforeend",e[1]??Nt()),yt++,()=>{1===yt&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),yt--}},[])}function Nt(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var Ct="focusScope.autoFocusOnMount",Dt="focusScope.autoFocusOnUnmount",St={bubbles:!1,cancelable:!0},Tt=D.forwardRef((e,n)=>{const{loop:a=!1,trapped:o=!1,onMountAutoFocus:l,onUnmountAutoFocus:d,...c}=e,[u,m]=D.useState(null),f=i(l),p=i(d),h=D.useRef(null),g=r(n,e=>m(e)),x=D.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;D.useEffect(()=>{if(o){let e=function(e){if(x.paused||!u)return;const t=e.target;u.contains(t)?h.current=t:It(h.current,{select:!0})},t=function(e){if(x.paused||!u)return;const t=e.relatedTarget;null!==t&&(u.contains(t)||It(h.current,{select:!0}))},n=function(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&It(u)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);const r=new MutationObserver(n);return u&&r.observe(u,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),r.disconnect()}}},[o,u,x.paused]),D.useEffect(()=>{if(u){_t.add(x);const t=document.activeElement;if(!u.contains(t)){const n=new CustomEvent(Ct,St);u.addEventListener(Ct,f),u.dispatchEvent(n),n.defaultPrevented||(!function(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(It(r,{select:t}),document.activeElement!==n)return}((e=kt(u),e.filter(e=>"A"!==e.tagName)),{select:!0}),document.activeElement===t&&It(u))}return()=>{u.removeEventListener(Ct,f),setTimeout(()=>{const e=new CustomEvent(Dt,St);u.addEventListener(Dt,p),u.dispatchEvent(e),e.defaultPrevented||It(t??document.body,{select:!0}),u.removeEventListener(Dt,p),_t.remove(x)},0)}}var e},[u,f,p,x]);const v=D.useCallback(e=>{if(!a&&!o)return;if(x.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,n=document.activeElement;if(t&&n){const t=e.currentTarget,[r,i]=function(e){const t=kt(e),n=Mt(t,e),r=Mt(t.reverse(),e);return[n,r]}(t);r&&i?e.shiftKey||n!==i?e.shiftKey&&n===r&&(e.preventDefault(),a&&It(i,{select:!0})):(e.preventDefault(),a&&It(r,{select:!0})):n===t&&e.preventDefault()}},[a,o,x.paused]);return t.jsx(s.div,{tabIndex:-1,...c,ref:g,onKeyDown:v})});function kt(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function Mt(e,t){for(const n of e)if(!Rt(n,{upTo:t}))return n}function Rt(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function It(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&function(e){return e instanceof HTMLInputElement&&"select"in e}(e)&&t&&e.select()}}Tt.displayName="FocusScope";var _t=function(){let e=[];return{add(t){const n=e[0];t!==n&&(null==n||n.pause()),e=Et(e,t),e.unshift(t)},remove(t){var n;e=Et(e,t),null==(n=e[0])||n.resume()}}}();function Et(e,t){const n=[...e],r=n.indexOf(t);return-1!==r&&n.splice(r,1),n}function Pt(e){const t=D.useRef({value:e,previous:e});return D.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var At=new WeakMap,$t=new WeakMap,Ot={},Lt=0,Ft=function(e){return e&&(e.host||Ft(e.parentNode))},Vt=function(e,t,n,r){var a=function(e,t){return t.map(function(t){if(e.contains(t))return t;var n=Ft(t);return n&&e.contains(n)?n:null}).filter(function(e){return Boolean(e)})}(t,Array.isArray(e)?e:[e]);Ot[n]||(Ot[n]=new WeakMap);var i=Ot[n],s=[],o=new Set,l=new Set(a),d=function(e){e&&!o.has(e)&&(o.add(e),d(e.parentNode))};a.forEach(d);var c=function(e){e&&!l.has(e)&&Array.prototype.forEach.call(e.children,function(e){if(o.has(e))c(e);else try{var t=e.getAttribute(r),a=null!==t&&"false"!==t,l=(At.get(e)||0)+1,d=(i.get(e)||0)+1;At.set(e,l),i.set(e,d),s.push(e),1===l&&a&&$t.set(e,!0),1===d&&e.setAttribute(n,"true"),a||e.setAttribute(r,"true")}catch(u){}})};return c(t),o.clear(),Lt++,function(){s.forEach(function(e){var t=At.get(e)-1,a=i.get(e)-1;At.set(e,t),i.set(e,a),t||($t.has(e)||e.removeAttribute(r),$t.delete(e)),a||e.removeAttribute(n)}),--Lt||(At=new WeakMap,At=new WeakMap,$t=new WeakMap,Ot={})}},Ht=function(e,t,n){void 0===n&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),a=function(e){return"undefined"==typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body}(e);return a?(r.push.apply(r,Array.from(a.querySelectorAll("[aria-live]"))),Vt(r,a,n,"aria-hidden")):function(){return null}},Kt=function(){return Kt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Kt.apply(this,arguments)};function Bt(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}"function"==typeof SuppressedError&&SuppressedError;var Ut="right-scroll-bar-position",zt="width-before-scroll-bar";function Wt(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}var Gt="undefined"!=typeof window?D.useLayoutEffect:D.useEffect,Yt=new WeakMap;function Xt(e,t){var n,r,a,i=(n=null,r=function(t){return e.forEach(function(e){return Wt(e,t)})},(a=D.useState(function(){return{value:n,callback:r,facade:{get current(){return a.value},set current(e){var t=a.value;t!==e&&(a.value=e,a.callback(e,t))}}}})[0]).callback=r,a.facade);return Gt(function(){var t=Yt.get(i);if(t){var n=new Set(t),r=new Set(e),a=i.current;n.forEach(function(e){r.has(e)||Wt(e,null)}),r.forEach(function(e){n.has(e)||Wt(e,a)})}Yt.set(i,e)},[e]),i}function qt(e){return e}var Jt=function(e){var t=e.sideCar,n=Bt(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw new Error("Sidecar medium not found");return D.createElement(r,Kt({},n))};Jt.isSideCarExport=!0;var Zt=function(e){void 0===e&&(e={});var t=function(e,t){void 0===t&&(t=qt);var n=[],r=!1;return{read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(e){var a=t(e,r);return n.push(a),function(){n=n.filter(function(e){return e!==a})}},assignSyncMedium:function(e){for(r=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){r=!0;var t=[];if(n.length){var a=n;n=[],a.forEach(e),t=n}var i=function(){var n=t;t=[],n.forEach(e)},s=function(){return Promise.resolve().then(i)};s(),n={push:function(e){t.push(e),s()},filter:function(e){return t=t.filter(e),n}}}}}(null);return t.options=Kt({async:!0,ssr:!1},e),t}(),Qt=function(){},en=D.forwardRef(function(e,t){var n=D.useRef(null),r=D.useState({onScrollCapture:Qt,onWheelCapture:Qt,onTouchMoveCapture:Qt}),a=r[0],i=r[1],s=e.forwardProps,o=e.children,l=e.className,d=e.removeScrollBar,c=e.enabled,u=e.shards,m=e.sideCar,f=e.noIsolation,p=e.inert,h=e.allowPinchZoom,g=e.as,x=void 0===g?"div":g,v=e.gapMode,b=Bt(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),j=m,y=Xt([n,t]),w=Kt(Kt({},b),a);return D.createElement(D.Fragment,null,c&&D.createElement(j,{sideCar:Zt,removeScrollBar:d,shards:u,noIsolation:f,inert:p,setCallbacks:i,allowPinchZoom:!!h,lockRef:n,gapMode:v}),s?D.cloneElement(D.Children.only(o),Kt(Kt({},w),{ref:y})):D.createElement(x,Kt({},w,{className:l,ref:y}),o))});en.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},en.classNames={fullWidth:zt,zeroRight:Ut};function tn(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=function(){if("undefined"!=typeof __webpack_nonce__)return __webpack_nonce__}();return t&&e.setAttribute("nonce",t),e}var nn=function(){var e=0,t=null;return{add:function(n){var r,a;0==e&&(t=tn())&&(a=n,(r=t).styleSheet?r.styleSheet.cssText=a:r.appendChild(document.createTextNode(a)),function(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}(t)),e++},remove:function(){! --e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},rn=function(){var e,t=(e=nn(),function(t,n){D.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])});return function(e){var n=e.styles,r=e.dynamic;return t(n,r),null}},an={left:0,top:0,right:0,gap:0},sn=function(e){return parseInt(e||"",10)||0},on=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return an;var t=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],r=t["padding"===e?"paddingTop":"marginTop"],a=t["padding"===e?"paddingRight":"marginRight"];return[sn(n),sn(r),sn(a)]}(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},ln=rn(),dn="data-scroll-locked",cn=function(e,t,n,r){var a=e.left,i=e.top,s=e.right,o=e.gap;return void 0===n&&(n="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(r,";\n   padding-right: ").concat(o,"px ").concat(r,";\n  }\n  body[").concat(dn,"] {\n    overflow: hidden ").concat(r,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(r,";"),"margin"===n&&"\n    padding-left: ".concat(a,"px;\n    padding-top: ").concat(i,"px;\n    padding-right: ").concat(s,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(o,"px ").concat(r,";\n    "),"padding"===n&&"padding-right: ".concat(o,"px ").concat(r,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(Ut," {\n    right: ").concat(o,"px ").concat(r,";\n  }\n  \n  .").concat(zt," {\n    margin-right: ").concat(o,"px ").concat(r,";\n  }\n  \n  .").concat(Ut," .").concat(Ut," {\n    right: 0 ").concat(r,";\n  }\n  \n  .").concat(zt," .").concat(zt," {\n    margin-right: 0 ").concat(r,";\n  }\n  \n  body[").concat(dn,"] {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(o,"px;\n  }\n")},un=function(){var e=parseInt(document.body.getAttribute(dn)||"0",10);return isFinite(e)?e:0},mn=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,a=void 0===r?"margin":r;D.useEffect(function(){return document.body.setAttribute(dn,(un()+1).toString()),function(){var e=un()-1;e<=0?document.body.removeAttribute(dn):document.body.setAttribute(dn,e.toString())}},[]);var i=D.useMemo(function(){return on(a)},[a]);return D.createElement(ln,{styles:cn(i,!t,a,n?"":"!important")})},fn=!1;if("undefined"!=typeof window)try{var pn=Object.defineProperty({},"passive",{get:function(){return fn=!0,!0}});window.addEventListener("test",pn,pn),window.removeEventListener("test",pn,pn)}catch(pd){fn=!1}var hn=!!fn&&{passive:!1},gn=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&!function(e){return"TEXTAREA"===e.tagName}(e)&&"visible"===n[t])},xn=function(e,t){var n=t.ownerDocument,r=t;do{if("undefined"!=typeof ShadowRoot&&r instanceof ShadowRoot&&(r=r.host),vn(e,r)){var a=bn(e,r);if(a[1]>a[2])return!0}r=r.parentNode}while(r&&r!==n.body);return!1},vn=function(e,t){return"v"===e?function(e){return gn(e,"overflowY")}(t):function(e){return gn(e,"overflowX")}(t)},bn=function(e,t){return"v"===e?[(n=t).scrollTop,n.scrollHeight,n.clientHeight]:function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]}(t);var n},jn=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},yn=function(e){return[e.deltaX,e.deltaY]},wn=function(e){return e&&"current"in e?e.current:e},Nn=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},Cn=0,Dn=[];function Sn(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Tn=(kn=function(e){var t=D.useRef([]),n=D.useRef([0,0]),r=D.useRef(),a=D.useState(Cn++)[0],i=D.useState(rn)[0],s=D.useRef(e);D.useEffect(function(){s.current=e},[e]),D.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(a));var t=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}([e.lockRef.current],(e.shards||[]).map(wn),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(a))})}}},[e.inert,e.lockRef.current,e.shards]);var o=D.useCallback(function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!s.current.allowPinchZoom;var a,i=jn(e),o=n.current,l="deltaX"in e?e.deltaX:o[0]-i[0],d="deltaY"in e?e.deltaY:o[1]-i[1],c=e.target,u=Math.abs(l)>Math.abs(d)?"h":"v";if("touches"in e&&"h"===u&&"range"===c.type)return!1;var m=xn(u,c);if(!m)return!0;if(m?a=u:(a="v"===u?"h":"v",m=xn(u,c)),!m)return!1;if(!r.current&&"changedTouches"in e&&(l||d)&&(r.current=a),!a)return!0;var f=r.current||a;return function(e,t,n,r,a){var i=function(e,t){return"h"===e&&"rtl"===t?-1:1}(e,window.getComputedStyle(t).direction),s=i*r,o=n.target,l=t.contains(o),d=!1,c=s>0,u=0,m=0;do{var f=bn(e,o),p=f[0],h=f[1]-f[2]-i*p;(p||h)&&vn(e,o)&&(u+=h,m+=p),o=o instanceof ShadowRoot?o.host:o.parentNode}while(!l&&o!==document.body||l&&(t.contains(o)||t===o));return c&&(Math.abs(u)<1||!a)?d=!0:c||!(Math.abs(m)<1)&&a||(d=!0),d}(f,t,e,"h"===f?l:d,!0)},[]),l=D.useCallback(function(e){var n=e;if(Dn.length&&Dn[Dn.length-1]===i){var r="deltaY"in n?yn(n):jn(n),a=t.current.filter(function(e){return e.name===n.type&&(e.target===n.target||n.target===e.shadowParent)&&(t=e.delta,a=r,t[0]===a[0]&&t[1]===a[1]);var t,a})[0];if(a&&a.should)n.cancelable&&n.preventDefault();else if(!a){var l=(s.current.shards||[]).map(wn).filter(Boolean).filter(function(e){return e.contains(n.target)});(l.length>0?o(n,l[0]):!s.current.noIsolation)&&n.cancelable&&n.preventDefault()}}},[]),d=D.useCallback(function(e,n,r,a){var i={name:e,delta:n,target:r,should:a,shadowParent:Sn(r)};t.current.push(i),setTimeout(function(){t.current=t.current.filter(function(e){return e!==i})},1)},[]),c=D.useCallback(function(e){n.current=jn(e),r.current=void 0},[]),u=D.useCallback(function(t){d(t.type,yn(t),t.target,o(t,e.lockRef.current))},[]),m=D.useCallback(function(t){d(t.type,jn(t),t.target,o(t,e.lockRef.current))},[]);D.useEffect(function(){return Dn.push(i),e.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:m}),document.addEventListener("wheel",l,hn),document.addEventListener("touchmove",l,hn),document.addEventListener("touchstart",c,hn),function(){Dn=Dn.filter(function(e){return e!==i}),document.removeEventListener("wheel",l,hn),document.removeEventListener("touchmove",l,hn),document.removeEventListener("touchstart",c,hn)}},[]);var f=e.removeScrollBar,p=e.inert;return D.createElement(D.Fragment,null,p?D.createElement(i,{styles:Nn(a)}):null,f?D.createElement(mn,{gapMode:e.gapMode}):null)},Zt.useMedium(kn),Jt);var kn,Mn=D.forwardRef(function(e,t){return D.createElement(en,Kt({},e,{ref:t,sideCar:Tn}))});Mn.classNames=en.classNames;var Rn=[" ","Enter","ArrowUp","ArrowDown"],In=[" ","Enter"],_n="Select",[En,Pn,An]=n(_n),[$n,On]=l(_n,[An,u]),Ln=u(),[Fn,Vn]=$n(_n),[Hn,Kn]=$n(_n),Bn=e=>{const{__scopeSelect:n,children:r,open:i,defaultOpen:s,onOpenChange:o,value:l,defaultValue:d,onValueChange:c,dir:u,name:m,autoComplete:f,disabled:p,required:h,form:g}=e,x=Ln(n),[b,j]=D.useState(null),[y,w]=D.useState(null),[N,C]=D.useState(!1),S=Me(u),[T=!1,k]=a({prop:i,defaultProp:s,onChange:o}),[M,R]=a({prop:l,defaultProp:d,onChange:c}),I=D.useRef(null),_=!b||(g||!!b.closest("form")),[E,P]=D.useState(new Set),A=Array.from(E).map(e=>e.props.value).join(";");return t.jsx(v,{...x,children:t.jsxs(Fn,{required:h,scope:n,trigger:b,onTriggerChange:j,valueNode:y,onValueNodeChange:w,valueNodeHasChildren:N,onValueNodeHasChildrenChange:C,contentId:Se(),value:M,onValueChange:R,open:T,onOpenChange:k,dir:S,triggerPointerDownPosRef:I,disabled:p,children:[t.jsx(En.Provider,{scope:n,children:t.jsx(Hn,{scope:e.__scopeSelect,onNativeOptionAdd:D.useCallback(e=>{P(t=>new Set(t).add(e))},[]),onNativeOptionRemove:D.useCallback(e=>{P(t=>{const n=new Set(t);return n.delete(e),n})},[]),children:r})}),_?t.jsxs(Mr,{"aria-hidden":!0,required:h,tabIndex:-1,name:m,autoComplete:f,value:M,onChange:e=>R(e.target.value),disabled:p,form:g,children:[void 0===M?t.jsx("option",{value:""}):null,Array.from(E)]},A):null]})})};Bn.displayName=_n;var Un="SelectTrigger",zn=D.forwardRef((e,n)=>{const{__scopeSelect:a,disabled:i=!1,...l}=e,d=Ln(a),c=Vn(Un,a),u=c.disabled||i,f=r(n,c.onTriggerChange),p=Pn(a),h=D.useRef("touch"),[g,x,v]=Rr(e=>{const t=p().filter(e=>!e.disabled),n=t.find(e=>e.value===c.value),r=Ir(t,e,n);void 0!==r&&c.onValueChange(r.value)}),b=e=>{u||(c.onOpenChange(!0),v()),e&&(c.triggerPointerDownPosRef.current={x:Math.round(e.pageX),y:Math.round(e.pageY)})};return t.jsx(m,{asChild:!0,...d,children:t.jsx(s.button,{type:"button",role:"combobox","aria-controls":c.contentId,"aria-expanded":c.open,"aria-required":c.required,"aria-autocomplete":"none",dir:c.dir,"data-state":c.open?"open":"closed",disabled:u,"data-disabled":u?"":void 0,"data-placeholder":kr(c.value)?"":void 0,...l,ref:f,onClick:o(l.onClick,e=>{e.currentTarget.focus(),"mouse"!==h.current&&b(e)}),onPointerDown:o(l.onPointerDown,e=>{h.current=e.pointerType;const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),0===e.button&&!1===e.ctrlKey&&"mouse"===e.pointerType&&(b(e),e.preventDefault())}),onKeyDown:o(l.onKeyDown,e=>{const t=""!==g.current;e.ctrlKey||e.altKey||e.metaKey||1!==e.key.length||x(e.key),t&&" "===e.key||Rn.includes(e.key)&&(b(),e.preventDefault())})})})});zn.displayName=Un;var Wn="SelectValue",Gn=D.forwardRef((n,a)=>{const{__scopeSelect:i,className:o,style:l,children:d,placeholder:c="",...u}=n,m=Vn(Wn,i),{onValueNodeHasChildrenChange:f}=m,p=void 0!==d,h=r(a,m.onValueNodeChange);return e(()=>{f(p)},[f,p]),t.jsx(s.span,{...u,ref:h,style:{pointerEvents:"none"},children:kr(m.value)?t.jsx(t.Fragment,{children:c}):d})});Gn.displayName=Wn;var Yn=D.forwardRef((e,n)=>{const{__scopeSelect:r,children:a,...i}=e;return t.jsx(s.span,{"aria-hidden":!0,...i,ref:n,children:a||"▼"})});Yn.displayName="SelectIcon";var Xn=e=>t.jsx(b,{asChild:!0,...e});Xn.displayName="SelectPortal";var qn="SelectContent",Jn=D.forwardRef((n,r)=>{const a=Vn(qn,n.__scopeSelect),[i,s]=D.useState();if(e(()=>{s(new DocumentFragment)},[]),!a.open){const e=i;return e?T.createPortal(t.jsx(Qn,{scope:n.__scopeSelect,children:t.jsx(En.Slot,{scope:n.__scopeSelect,children:t.jsx("div",{children:n.children})})}),e):null}return t.jsx(tr,{...n,ref:r})});Jn.displayName=qn;var Zn=10,[Qn,er]=$n(qn),tr=D.forwardRef((e,n)=>{const{__scopeSelect:a,position:i="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:l,onPointerDownOutside:d,side:c,sideOffset:u,align:m,alignOffset:h,arrowPadding:g,collisionBoundary:x,collisionPadding:v,sticky:b,hideWhenDetached:j,avoidCollisions:y,...w}=e,N=Vn(qn,a),[C,S]=D.useState(null),[T,k]=D.useState(null),M=r(n,e=>S(e)),[R,I]=D.useState(null),[_,E]=D.useState(null),P=Pn(a),[A,$]=D.useState(!1),O=D.useRef(!1);D.useEffect(()=>{if(C)return Ht(C)},[C]),wt();const L=D.useCallback(e=>{const[t,...n]=P().map(e=>e.ref.current),[r]=n.slice(-1),a=document.activeElement;for(const i of e){if(i===a)return;if(null==i||i.scrollIntoView({block:"nearest"}),i===t&&T&&(T.scrollTop=0),i===r&&T&&(T.scrollTop=T.scrollHeight),null==i||i.focus(),document.activeElement!==a)return}},[P,T]),F=D.useCallback(()=>L([R,C]),[L,R,C]);D.useEffect(()=>{A&&F()},[A,F]);const{onOpenChange:V,triggerPointerDownPosRef:H}=N;D.useEffect(()=>{if(C){let e={x:0,y:0};const t=t=>{var n,r;e={x:Math.abs(Math.round(t.pageX)-((null==(n=H.current)?void 0:n.x)??0)),y:Math.abs(Math.round(t.pageY)-((null==(r=H.current)?void 0:r.y)??0))}},n=n=>{e.x<=10&&e.y<=10?n.preventDefault():C.contains(n.target)||V(!1),document.removeEventListener("pointermove",t),H.current=null};return null!==H.current&&(document.addEventListener("pointermove",t),document.addEventListener("pointerup",n,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",t),document.removeEventListener("pointerup",n,{capture:!0})}}},[C,V,H]),D.useEffect(()=>{const e=()=>V(!1);return window.addEventListener("blur",e),window.addEventListener("resize",e),()=>{window.removeEventListener("blur",e),window.removeEventListener("resize",e)}},[V]);const[K,B]=Rr(e=>{const t=P().filter(e=>!e.disabled),n=t.find(e=>e.ref.current===document.activeElement),r=Ir(t,e,n);r&&setTimeout(()=>r.ref.current.focus())}),U=D.useCallback((e,t,n)=>{const r=!O.current&&!n;(void 0!==N.value&&N.value===t||r)&&(I(e),r&&(O.current=!0))},[N.value]),z=D.useCallback(()=>null==C?void 0:C.focus(),[C]),W=D.useCallback((e,t,n)=>{const r=!O.current&&!n;(void 0!==N.value&&N.value===t||r)&&E(e)},[N.value]),G="popper"===i?rr:nr,Y=G===rr?{side:c,sideOffset:u,align:m,alignOffset:h,arrowPadding:g,collisionBoundary:x,collisionPadding:v,sticky:b,hideWhenDetached:j,avoidCollisions:y}:{};return t.jsx(Qn,{scope:a,content:C,viewport:T,onViewportChange:k,itemRefCallback:U,selectedItem:R,onItemLeave:z,itemTextRefCallback:W,focusSelectedItem:F,selectedItemText:_,position:i,isPositioned:A,searchRef:K,children:t.jsx(Mn,{as:f,allowPinchZoom:!0,children:t.jsx(Tt,{asChild:!0,trapped:N.open,onMountAutoFocus:e=>{e.preventDefault()},onUnmountAutoFocus:o(s,e=>{var t;null==(t=N.trigger)||t.focus({preventScroll:!0}),e.preventDefault()}),children:t.jsx(p,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:e=>e.preventDefault(),onDismiss:()=>N.onOpenChange(!1),children:t.jsx(G,{role:"listbox",id:N.contentId,"data-state":N.open?"open":"closed",dir:N.dir,onContextMenu:e=>e.preventDefault(),...w,...Y,onPlaced:()=>$(!0),ref:M,style:{display:"flex",flexDirection:"column",outline:"none",...w.style},onKeyDown:o(w.onKeyDown,e=>{const t=e.ctrlKey||e.altKey||e.metaKey;if("Tab"===e.key&&e.preventDefault(),t||1!==e.key.length||B(e.key),["ArrowUp","ArrowDown","Home","End"].includes(e.key)){let t=P().filter(e=>!e.disabled).map(e=>e.ref.current);if(["ArrowUp","End"].includes(e.key)&&(t=t.slice().reverse()),["ArrowUp","ArrowDown"].includes(e.key)){const n=e.target,r=t.indexOf(n);t=t.slice(r+1)}setTimeout(()=>L(t)),e.preventDefault()}})})})})})})});tr.displayName="SelectContentImpl";var nr=D.forwardRef((n,a)=>{const{__scopeSelect:i,onPlaced:o,...l}=n,d=Vn(qn,i),c=er(qn,i),[u,m]=D.useState(null),[f,p]=D.useState(null),h=r(a,e=>p(e)),g=Pn(i),x=D.useRef(!1),v=D.useRef(!0),{viewport:b,selectedItem:j,selectedItemText:y,focusSelectedItem:w}=c,N=D.useCallback(()=>{if(d.trigger&&d.valueNode&&u&&f&&b&&j&&y){const e=d.trigger.getBoundingClientRect(),t=f.getBoundingClientRect(),n=d.valueNode.getBoundingClientRect(),r=y.getBoundingClientRect();if("rtl"!==d.dir){const a=r.left-t.left,i=n.left-a,s=e.left-i,o=e.width+s,l=Math.max(o,t.width),d=window.innerWidth-Zn,c=jt(i,[Zn,Math.max(Zn,d-l)]);u.style.minWidth=o+"px",u.style.left=c+"px"}else{const a=t.right-r.right,i=window.innerWidth-n.right-a,s=window.innerWidth-e.right-i,o=e.width+s,l=Math.max(o,t.width),d=window.innerWidth-Zn,c=jt(i,[Zn,Math.max(Zn,d-l)]);u.style.minWidth=o+"px",u.style.right=c+"px"}const a=g(),i=window.innerHeight-2*Zn,s=b.scrollHeight,l=window.getComputedStyle(f),c=parseInt(l.borderTopWidth,10),m=parseInt(l.paddingTop,10),p=parseInt(l.borderBottomWidth,10),h=c+m+s+parseInt(l.paddingBottom,10)+p,v=Math.min(5*j.offsetHeight,h),w=window.getComputedStyle(b),N=parseInt(w.paddingTop,10),C=parseInt(w.paddingBottom,10),D=e.top+e.height/2-Zn,S=i-D,T=j.offsetHeight/2,k=c+m+(j.offsetTop+T),M=h-k;if(k<=D){const e=a.length>0&&j===a[a.length-1].ref.current;u.style.bottom="0px";const t=f.clientHeight-b.offsetTop-b.offsetHeight,n=k+Math.max(S,T+(e?C:0)+t+p);u.style.height=n+"px"}else{const e=a.length>0&&j===a[0].ref.current;u.style.top="0px";const t=Math.max(D,c+b.offsetTop+(e?N:0)+T)+M;u.style.height=t+"px",b.scrollTop=k-D+b.offsetTop}u.style.margin=`${Zn}px 0`,u.style.minHeight=v+"px",u.style.maxHeight=i+"px",null==o||o(),requestAnimationFrame(()=>x.current=!0)}},[g,d.trigger,d.valueNode,u,f,b,j,y,d.dir,o]);e(()=>N(),[N]);const[C,S]=D.useState();e(()=>{f&&S(window.getComputedStyle(f).zIndex)},[f]);const T=D.useCallback(e=>{e&&!0===v.current&&(N(),null==w||w(),v.current=!1)},[N,w]);return t.jsx(ar,{scope:i,contentWrapper:u,shouldExpandOnScrollRef:x,onScrollButtonChange:T,children:t.jsx("div",{ref:m,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:C},children:t.jsx(s.div,{...l,ref:h,style:{boxSizing:"border-box",maxHeight:"100%",...l.style}})})})});nr.displayName="SelectItemAlignedPosition";var rr=D.forwardRef((e,n)=>{const{__scopeSelect:r,align:a="start",collisionPadding:i=Zn,...s}=e,o=Ln(r);return t.jsx(h,{...o,...s,ref:n,align:a,collisionPadding:i,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});rr.displayName="SelectPopperPosition";var[ar,ir]=$n(qn,{}),sr="SelectViewport",or=D.forwardRef((e,n)=>{const{__scopeSelect:a,nonce:i,...l}=e,d=er(sr,a),c=ir(sr,a),u=r(n,d.onViewportChange),m=D.useRef(0);return t.jsxs(t.Fragment,{children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),t.jsx(En.Slot,{scope:a,children:t.jsx(s.div,{"data-radix-select-viewport":"",role:"presentation",...l,ref:u,style:{position:"relative",flex:1,overflow:"hidden auto",...l.style},onScroll:o(l.onScroll,e=>{const t=e.currentTarget,{contentWrapper:n,shouldExpandOnScrollRef:r}=c;if((null==r?void 0:r.current)&&n){const e=Math.abs(m.current-t.scrollTop);if(e>0){const r=window.innerHeight-2*Zn,a=parseFloat(n.style.minHeight),i=parseFloat(n.style.height),s=Math.max(a,i);if(s<r){const a=s+e,i=Math.min(r,a),o=a-i;n.style.height=i+"px","0px"===n.style.bottom&&(t.scrollTop=o>0?o:0,n.style.justifyContent="flex-end")}}}m.current=t.scrollTop})})})]})});or.displayName=sr;var lr="SelectGroup",[dr,cr]=$n(lr);D.forwardRef((e,n)=>{const{__scopeSelect:r,...a}=e,i=Se();return t.jsx(dr,{scope:r,id:i,children:t.jsx(s.div,{role:"group","aria-labelledby":i,...a,ref:n})})}).displayName=lr;var ur="SelectLabel",mr=D.forwardRef((e,n)=>{const{__scopeSelect:r,...a}=e,i=cr(ur,r);return t.jsx(s.div,{id:i.id,...a,ref:n})});mr.displayName=ur;var fr="SelectItem",[pr,hr]=$n(fr),gr=D.forwardRef((e,n)=>{const{__scopeSelect:a,value:i,disabled:l=!1,textValue:d,...c}=e,u=Vn(fr,a),m=er(fr,a),f=u.value===i,[p,h]=D.useState(d??""),[g,x]=D.useState(!1),v=r(n,e=>{var t;return null==(t=m.itemRefCallback)?void 0:t.call(m,e,i,l)}),b=Se(),j=D.useRef("touch"),y=()=>{l||(u.onValueChange(i),u.onOpenChange(!1))};if(""===i)throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return t.jsx(pr,{scope:a,value:i,disabled:l,textId:b,isSelected:f,onItemTextChange:D.useCallback(e=>{h(t=>t||((null==e?void 0:e.textContent)??"").trim())},[]),children:t.jsx(En.ItemSlot,{scope:a,value:i,disabled:l,textValue:p,children:t.jsx(s.div,{role:"option","aria-labelledby":b,"data-highlighted":g?"":void 0,"aria-selected":f&&g,"data-state":f?"checked":"unchecked","aria-disabled":l||void 0,"data-disabled":l?"":void 0,tabIndex:l?void 0:-1,...c,ref:v,onFocus:o(c.onFocus,()=>x(!0)),onBlur:o(c.onBlur,()=>x(!1)),onClick:o(c.onClick,()=>{"mouse"!==j.current&&y()}),onPointerUp:o(c.onPointerUp,()=>{"mouse"===j.current&&y()}),onPointerDown:o(c.onPointerDown,e=>{j.current=e.pointerType}),onPointerMove:o(c.onPointerMove,e=>{var t;j.current=e.pointerType,l?null==(t=m.onItemLeave)||t.call(m):"mouse"===j.current&&e.currentTarget.focus({preventScroll:!0})}),onPointerLeave:o(c.onPointerLeave,e=>{var t;e.currentTarget===document.activeElement&&(null==(t=m.onItemLeave)||t.call(m))}),onKeyDown:o(c.onKeyDown,e=>{var t;""!==(null==(t=m.searchRef)?void 0:t.current)&&" "===e.key||(In.includes(e.key)&&y()," "===e.key&&e.preventDefault())})})})})});gr.displayName=fr;var xr="SelectItemText",vr=D.forwardRef((n,a)=>{const{__scopeSelect:i,className:o,style:l,...d}=n,c=Vn(xr,i),u=er(xr,i),m=hr(xr,i),f=Kn(xr,i),[p,h]=D.useState(null),g=r(a,e=>h(e),m.onItemTextChange,e=>{var t;return null==(t=u.itemTextRefCallback)?void 0:t.call(u,e,m.value,m.disabled)}),x=null==p?void 0:p.textContent,v=D.useMemo(()=>t.jsx("option",{value:m.value,disabled:m.disabled,children:x},m.value),[m.disabled,m.value,x]),{onNativeOptionAdd:b,onNativeOptionRemove:j}=f;return e(()=>(b(v),()=>j(v)),[b,j,v]),t.jsxs(t.Fragment,{children:[t.jsx(s.span,{id:m.textId,...d,ref:g}),m.isSelected&&c.valueNode&&!c.valueNodeHasChildren?T.createPortal(d.children,c.valueNode):null]})});vr.displayName=xr;var br="SelectItemIndicator",jr=D.forwardRef((e,n)=>{const{__scopeSelect:r,...a}=e;return hr(br,r).isSelected?t.jsx(s.span,{"aria-hidden":!0,...a,ref:n}):null});jr.displayName=br;var yr="SelectScrollUpButton",wr=D.forwardRef((n,a)=>{const i=er(yr,n.__scopeSelect),s=ir(yr,n.__scopeSelect),[o,l]=D.useState(!1),d=r(a,s.onScrollButtonChange);return e(()=>{if(i.viewport&&i.isPositioned){let e=function(){const e=t.scrollTop>0;l(e)};const t=i.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}},[i.viewport,i.isPositioned]),o?t.jsx(Dr,{...n,ref:d,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=i;e&&t&&(e.scrollTop=e.scrollTop-t.offsetHeight)}}):null});wr.displayName=yr;var Nr="SelectScrollDownButton",Cr=D.forwardRef((n,a)=>{const i=er(Nr,n.__scopeSelect),s=ir(Nr,n.__scopeSelect),[o,l]=D.useState(!1),d=r(a,s.onScrollButtonChange);return e(()=>{if(i.viewport&&i.isPositioned){let e=function(){const e=t.scrollHeight-t.clientHeight,n=Math.ceil(t.scrollTop)<e;l(n)};const t=i.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}},[i.viewport,i.isPositioned]),o?t.jsx(Dr,{...n,ref:d,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=i;e&&t&&(e.scrollTop=e.scrollTop+t.offsetHeight)}}):null});Cr.displayName=Nr;var Dr=D.forwardRef((n,r)=>{const{__scopeSelect:a,onAutoScroll:i,...l}=n,d=er("SelectScrollButton",a),c=D.useRef(null),u=Pn(a),m=D.useCallback(()=>{null!==c.current&&(window.clearInterval(c.current),c.current=null)},[]);return D.useEffect(()=>()=>m(),[m]),e(()=>{var e;const t=u().find(e=>e.ref.current===document.activeElement);null==(e=null==t?void 0:t.ref.current)||e.scrollIntoView({block:"nearest"})},[u]),t.jsx(s.div,{"aria-hidden":!0,...l,ref:r,style:{flexShrink:0,...l.style},onPointerDown:o(l.onPointerDown,()=>{null===c.current&&(c.current=window.setInterval(i,50))}),onPointerMove:o(l.onPointerMove,()=>{var e;null==(e=d.onItemLeave)||e.call(d),null===c.current&&(c.current=window.setInterval(i,50))}),onPointerLeave:o(l.onPointerLeave,()=>{m()})})}),Sr=D.forwardRef((e,n)=>{const{__scopeSelect:r,...a}=e;return t.jsx(s.div,{"aria-hidden":!0,...a,ref:n})});Sr.displayName="SelectSeparator";var Tr="SelectArrow";function kr(e){return""===e||void 0===e}D.forwardRef((e,n)=>{const{__scopeSelect:r,...a}=e,i=Ln(r),s=Vn(Tr,r),o=er(Tr,r);return s.open&&"popper"===o.position?t.jsx(g,{...i,...a,ref:n}):null}).displayName=Tr;var Mr=D.forwardRef((e,n)=>{const{value:a,...i}=e,s=D.useRef(null),o=r(n,s),l=Pt(a);return D.useEffect(()=>{const e=s.current,t=window.HTMLSelectElement.prototype,n=Object.getOwnPropertyDescriptor(t,"value").set;if(l!==a&&n){const t=new Event("change",{bubbles:!0});n.call(e,a),e.dispatchEvent(t)}},[l,a]),t.jsx(x,{asChild:!0,children:t.jsx("select",{...i,ref:o,defaultValue:a})})});function Rr(e){const t=i(e),n=D.useRef(""),r=D.useRef(0),a=D.useCallback(e=>{const a=n.current+e;t(a),function e(t){n.current=t,window.clearTimeout(r.current),""!==t&&(r.current=window.setTimeout(()=>e(""),1e3))}(a)},[t]),s=D.useCallback(()=>{n.current="",window.clearTimeout(r.current)},[]);return D.useEffect(()=>()=>window.clearTimeout(r.current),[]),[n,a,s]}function Ir(e,t,n){const r=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,a=n?e.indexOf(n):-1;let i=(s=e,o=Math.max(a,0),s.map((e,t)=>s[(o+t)%s.length]));var s,o;1===r.length&&(i=i.filter(e=>e!==n));const l=i.find(e=>e.textValue.toLowerCase().startsWith(r.toLowerCase()));return l!==n?l:void 0}Mr.displayName="BubbleSelect";var _r=zn,Er=Yn,Pr=Xn,Ar=Jn,$r=or,Or=mr,Lr=gr,Fr=vr,Vr=jr,Hr=wr,Kr=Cr,Br=Sr;const Ur=Bn,zr=Gn,Wr=D.forwardRef(({className:e,children:n,...r},a)=>t.jsxs(_r,{ref:a,className:c("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[n,t.jsx(Er,{asChild:!0,children:t.jsx(F,{className:"h-4 w-4 opacity-50"})})]}));Wr.displayName=_r.displayName;const Gr=D.forwardRef(({className:e,...n},r)=>t.jsx(Hr,{ref:r,className:c("flex cursor-default items-center justify-center py-1",e),...n,children:t.jsx(V,{className:"h-4 w-4"})}));Gr.displayName=Hr.displayName;const Yr=D.forwardRef(({className:e,...n},r)=>t.jsx(Kr,{ref:r,className:c("flex cursor-default items-center justify-center py-1",e),...n,children:t.jsx(F,{className:"h-4 w-4"})}));Yr.displayName=Kr.displayName;const Xr=D.forwardRef(({className:e,children:n,position:r="popper",...a},i)=>t.jsx(Pr,{children:t.jsxs(Ar,{ref:i,className:c("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...a,children:[t.jsx(Gr,{}),t.jsx($r,{className:c("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),t.jsx(Yr,{})]})}));Xr.displayName=Ar.displayName;D.forwardRef(({className:e,...n},r)=>t.jsx(Or,{ref:r,className:c("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...n})).displayName=Or.displayName;const qr=D.forwardRef(({className:e,children:n,...r},a)=>t.jsxs(Lr,{ref:a,className:c("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[t.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(Vr,{children:t.jsx(H,{className:"h-4 w-4"})})}),t.jsx(Fr,{children:n})]}));qr.displayName=Lr.displayName;D.forwardRef(({className:e,...n},r)=>t.jsx(Br,{ref:r,className:c("-mx-1 my-1 h-px bg-muted",e),...n})).displayName=Br.displayName;const Jr=D.forwardRef(({className:e,...n},r)=>t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsx("table",{ref:r,className:c("w-full caption-bottom text-sm",e),...n})}));Jr.displayName="Table";const Zr=D.forwardRef(({className:e,...n},r)=>t.jsx("thead",{ref:r,className:c("[&_tr]:border-b",e),...n}));Zr.displayName="TableHeader";const Qr=D.forwardRef(({className:e,...n},r)=>t.jsx("tbody",{ref:r,className:c("[&_tr:last-child]:border-0",e),...n}));Qr.displayName="TableBody";D.forwardRef(({className:e,...n},r)=>t.jsx("tfoot",{ref:r,className:c("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...n})).displayName="TableFooter";const ea=D.forwardRef(({className:e,...n},r)=>t.jsx("tr",{ref:r,className:c("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...n}));ea.displayName="TableRow";const ta=D.forwardRef(({className:e,...n},r)=>t.jsx("th",{ref:r,className:c("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...n}));ta.displayName="TableHead";const na=D.forwardRef(({className:e,...n},r)=>t.jsx("td",{ref:r,className:c("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...n}));na.displayName="TableCell";D.forwardRef(({className:e,...n},r)=>t.jsx("caption",{ref:r,className:c("mt-4 text-sm text-muted-foreground",e),...n})).displayName="TableCaption";var ra="Dialog",[aa,ia]=l(ra),[sa,oa]=aa(ra),la=e=>{const{__scopeDialog:n,children:r,open:i,defaultOpen:s,onOpenChange:o,modal:l=!0}=e,d=D.useRef(null),c=D.useRef(null),[u=!1,m]=a({prop:i,defaultProp:s,onChange:o});return t.jsx(sa,{scope:n,triggerRef:d,contentRef:c,contentId:Se(),titleId:Se(),descriptionId:Se(),open:u,onOpenChange:m,onOpenToggle:D.useCallback(()=>m(e=>!e),[m]),modal:l,children:r})};la.displayName=ra;var da="DialogTrigger",ca=D.forwardRef((e,n)=>{const{__scopeDialog:a,...i}=e,l=oa(da,a),d=r(n,l.triggerRef);return t.jsx(s.button,{type:"button","aria-haspopup":"dialog","aria-expanded":l.open,"aria-controls":l.contentId,"data-state":Ma(l.open),...i,ref:d,onClick:o(e.onClick,l.onOpenToggle)})});ca.displayName=da;var ua="DialogPortal",[ma,fa]=aa(ua,{forceMount:void 0}),pa=e=>{const{__scopeDialog:n,forceMount:r,children:a,container:i}=e,s=oa(ua,n);return t.jsx(ma,{scope:n,forceMount:r,children:D.Children.map(a,e=>t.jsx(d,{present:r||s.open,children:t.jsx(b,{asChild:!0,container:i,children:e})}))})};pa.displayName=ua;var ha="DialogOverlay",ga=D.forwardRef((e,n)=>{const r=fa(ha,e.__scopeDialog),{forceMount:a=r.forceMount,...i}=e,s=oa(ha,e.__scopeDialog);return s.modal?t.jsx(d,{present:a||s.open,children:t.jsx(xa,{...i,ref:n})}):null});ga.displayName=ha;var xa=D.forwardRef((e,n)=>{const{__scopeDialog:r,...a}=e,i=oa(ha,r);return t.jsx(Mn,{as:f,allowPinchZoom:!0,shards:[i.contentRef],children:t.jsx(s.div,{"data-state":Ma(i.open),...a,ref:n,style:{pointerEvents:"auto",...a.style}})})}),va="DialogContent",ba=D.forwardRef((e,n)=>{const r=fa(va,e.__scopeDialog),{forceMount:a=r.forceMount,...i}=e,s=oa(va,e.__scopeDialog);return t.jsx(d,{present:a||s.open,children:s.modal?t.jsx(ja,{...i,ref:n}):t.jsx(ya,{...i,ref:n})})});ba.displayName=va;var ja=D.forwardRef((e,n)=>{const a=oa(va,e.__scopeDialog),i=D.useRef(null),s=r(n,a.contentRef,i);return D.useEffect(()=>{const e=i.current;if(e)return Ht(e)},[]),t.jsx(wa,{...e,ref:s,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:o(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),null==(t=a.triggerRef.current)||t.focus()}),onPointerDownOutside:o(e.onPointerDownOutside,e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey;(2===t.button||n)&&e.preventDefault()}),onFocusOutside:o(e.onFocusOutside,e=>e.preventDefault())})}),ya=D.forwardRef((e,n)=>{const r=oa(va,e.__scopeDialog),a=D.useRef(!1),i=D.useRef(!1);return t.jsx(wa,{...e,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var n,s;null==(n=e.onCloseAutoFocus)||n.call(e,t),t.defaultPrevented||(a.current||null==(s=r.triggerRef.current)||s.focus(),t.preventDefault()),a.current=!1,i.current=!1},onInteractOutside:t=>{var n,s;null==(n=e.onInteractOutside)||n.call(e,t),t.defaultPrevented||(a.current=!0,"pointerdown"===t.detail.originalEvent.type&&(i.current=!0));const o=t.target;(null==(s=r.triggerRef.current)?void 0:s.contains(o))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}})}),wa=D.forwardRef((e,n)=>{const{__scopeDialog:a,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,...l}=e,d=oa(va,a),c=D.useRef(null),u=r(n,c);return wt(),t.jsxs(t.Fragment,{children:[t.jsx(Tt,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:s,onUnmountAutoFocus:o,children:t.jsx(p,{role:"dialog",id:d.contentId,"aria-describedby":d.descriptionId,"aria-labelledby":d.titleId,"data-state":Ma(d.open),...l,ref:u,onDismiss:()=>d.onOpenChange(!1)})}),t.jsxs(t.Fragment,{children:[t.jsx(Ea,{titleId:d.titleId}),t.jsx(Pa,{contentRef:c,descriptionId:d.descriptionId})]})]})}),Na="DialogTitle",Ca=D.forwardRef((e,n)=>{const{__scopeDialog:r,...a}=e,i=oa(Na,r);return t.jsx(s.h2,{id:i.titleId,...a,ref:n})});Ca.displayName=Na;var Da="DialogDescription",Sa=D.forwardRef((e,n)=>{const{__scopeDialog:r,...a}=e,i=oa(Da,r);return t.jsx(s.p,{id:i.descriptionId,...a,ref:n})});Sa.displayName=Da;var Ta="DialogClose",ka=D.forwardRef((e,n)=>{const{__scopeDialog:r,...a}=e,i=oa(Ta,r);return t.jsx(s.button,{type:"button",...a,ref:n,onClick:o(e.onClick,()=>i.onOpenChange(!1))})});function Ma(e){return e?"open":"closed"}ka.displayName=Ta;var Ra="DialogTitleWarning",[Ia,_a]=j(Ra,{contentName:va,titleName:Na,docsSlug:"dialog"}),Ea=({titleId:e})=>{const t=_a(Ra),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.\n\nIf you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return D.useEffect(()=>{if(e){document.getElementById(e)}},[n,e]),null},Pa=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${_a("DialogDescriptionWarning").contentName}}.`;return D.useEffect(()=>{var n;const r=null==(n=e.current)?void 0:n.getAttribute("aria-describedby");if(t&&r){document.getElementById(t)}},[n,e,t]),null},Aa=la,$a=ca,Oa=pa,La=ga,Fa=ba,Va=Ca,Ha=Sa,Ka=ka;const Ba=Aa,Ua=$a,za=Oa,Wa=D.forwardRef(({className:e,...n},r)=>t.jsx(La,{ref:r,className:c("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...n}));Wa.displayName=La.displayName;const Ga=D.forwardRef(({className:e,children:n,...r},a)=>t.jsxs(za,{children:[t.jsx(Wa,{}),t.jsxs(Fa,{ref:a,className:c("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[n,t.jsxs(Ka,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[t.jsx(K,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ga.displayName=Fa.displayName;const Ya=({className:e,...n})=>t.jsx("div",{className:c("flex flex-col space-y-1.5 text-center sm:text-left",e),...n});Ya.displayName="DialogHeader";const Xa=D.forwardRef(({className:e,...n},r)=>t.jsx(Va,{ref:r,className:c("text-lg font-semibold leading-none tracking-tight",e),...n}));Xa.displayName=Va.displayName;const qa=D.forwardRef(({className:e,...n},r)=>t.jsx(Ha,{ref:r,className:c("text-sm text-muted-foreground",e),...n}));qa.displayName=Ha.displayName;var Ja={exports:{}};const Za=M(Ja.exports=function(){var e=1e3,t=6e4,n=36e5,r="millisecond",a="second",i="minute",s="hour",o="day",l="week",d="month",c="quarter",u="year",m="date",f="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},x=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},v={s:x,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),a=n%60;return(t<=0?"+":"-")+x(r,2,"0")+":"+x(a,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),a=t.clone().add(r,d),i=n-a<0,s=t.clone().add(r+(i?-1:1),d);return+(-(r+(n-a)/(i?a-s:s-a))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:d,y:u,w:l,d:o,D:m,h:s,m:i,s:a,ms:r,Q:c}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},b="en",j={};j[b]=g;var y="$isDayjsObject",w=function(e){return e instanceof S||!(!e||!e[y])},N=function e(t,n,r){var a;if(!t)return b;if("string"==typeof t){var i=t.toLowerCase();j[i]&&(a=i),n&&(j[i]=n,a=i);var s=t.split("-");if(!a&&s.length>1)return e(s[0])}else{var o=t.name;j[o]=t,a=o}return!r&&a&&(b=a),a||!r&&b},C=function(e,t){if(w(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new S(n)},D=v;D.l=N,D.i=w,D.w=function(e,t){return C(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var S=function(){function g(e){this.$L=N(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[y]=!0}var x=g.prototype;return x.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(D.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(p);if(r){var a=r[2]-1||0,i=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)):new Date(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)}}return new Date(t)}(e),this.init()},x.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},x.$utils=function(){return D},x.isValid=function(){return!(this.$d.toString()===f)},x.isSame=function(e,t){var n=C(e);return this.startOf(t)<=n&&n<=this.endOf(t)},x.isAfter=function(e,t){return C(e)<this.startOf(t)},x.isBefore=function(e,t){return this.endOf(t)<C(e)},x.$g=function(e,t,n){return D.u(e)?this[t]:this.set(n,e)},x.unix=function(){return Math.floor(this.valueOf()/1e3)},x.valueOf=function(){return this.$d.getTime()},x.startOf=function(e,t){var n=this,r=!!D.u(t)||t,c=D.p(e),f=function(e,t){var a=D.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?a:a.endOf(o)},p=function(e,t){return D.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},h=this.$W,g=this.$M,x=this.$D,v="set"+(this.$u?"UTC":"");switch(c){case u:return r?f(1,0):f(31,11);case d:return r?f(1,g):f(0,g+1);case l:var b=this.$locale().weekStart||0,j=(h<b?h+7:h)-b;return f(r?x-j:x+(6-j),g);case o:case m:return p(v+"Hours",0);case s:return p(v+"Minutes",1);case i:return p(v+"Seconds",2);case a:return p(v+"Milliseconds",3);default:return this.clone()}},x.endOf=function(e){return this.startOf(e,!1)},x.$set=function(e,t){var n,l=D.p(e),c="set"+(this.$u?"UTC":""),f=(n={},n[o]=c+"Date",n[m]=c+"Date",n[d]=c+"Month",n[u]=c+"FullYear",n[s]=c+"Hours",n[i]=c+"Minutes",n[a]=c+"Seconds",n[r]=c+"Milliseconds",n)[l],p=l===o?this.$D+(t-this.$W):t;if(l===d||l===u){var h=this.clone().set(m,1);h.$d[f](p),h.init(),this.$d=h.set(m,Math.min(this.$D,h.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},x.set=function(e,t){return this.clone().$set(e,t)},x.get=function(e){return this[D.p(e)]()},x.add=function(r,c){var m,f=this;r=Number(r);var p=D.p(c),h=function(e){var t=C(f);return D.w(t.date(t.date()+Math.round(e*r)),f)};if(p===d)return this.set(d,this.$M+r);if(p===u)return this.set(u,this.$y+r);if(p===o)return h(1);if(p===l)return h(7);var g=(m={},m[i]=t,m[s]=n,m[a]=e,m)[p]||1,x=this.$d.getTime()+r*g;return D.w(x,this)},x.subtract=function(e,t){return this.add(-1*e,t)},x.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var r=e||"YYYY-MM-DDTHH:mm:ssZ",a=D.z(this),i=this.$H,s=this.$m,o=this.$M,l=n.weekdays,d=n.months,c=n.meridiem,u=function(e,n,a,i){return e&&(e[n]||e(t,r))||a[n].slice(0,i)},m=function(e){return D.s(i%12||12,e,"0")},p=c||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(h,function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return D.s(t.$y,4,"0");case"M":return o+1;case"MM":return D.s(o+1,2,"0");case"MMM":return u(n.monthsShort,o,d,3);case"MMMM":return u(d,o);case"D":return t.$D;case"DD":return D.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return u(n.weekdaysMin,t.$W,l,2);case"ddd":return u(n.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(i);case"HH":return D.s(i,2,"0");case"h":return m(1);case"hh":return m(2);case"a":return p(i,s,!0);case"A":return p(i,s,!1);case"m":return String(s);case"mm":return D.s(s,2,"0");case"s":return String(t.$s);case"ss":return D.s(t.$s,2,"0");case"SSS":return D.s(t.$ms,3,"0");case"Z":return a}return null}(e)||a.replace(":","")})},x.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},x.diff=function(r,m,f){var p,h=this,g=D.p(m),x=C(r),v=(x.utcOffset()-this.utcOffset())*t,b=this-x,j=function(){return D.m(h,x)};switch(g){case u:p=j()/12;break;case d:p=j();break;case c:p=j()/3;break;case l:p=(b-v)/6048e5;break;case o:p=(b-v)/864e5;break;case s:p=b/n;break;case i:p=b/t;break;case a:p=b/e;break;default:p=b}return f?p:D.a(p)},x.daysInMonth=function(){return this.endOf(d).$D},x.$locale=function(){return j[this.$L]},x.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=N(e,t,!0);return r&&(n.$L=r),n},x.clone=function(){return D.w(this.$d,this)},x.toDate=function(){return new Date(this.valueOf())},x.toJSON=function(){return this.isValid()?this.toISOString():null},x.toISOString=function(){return this.$d.toISOString()},x.toString=function(){return this.$d.toUTCString()},g}(),T=S.prototype;return C.prototype=T,[["$ms",r],["$s",a],["$m",i],["$H",s],["$W",o],["$M",d],["$y",u],["$D",m]].forEach(function(e){T[e[1]]=function(t){return this.$g(t,e[0],e[1])}}),C.extend=function(e,t){return e.$i||(e(t,S,C),e.$i=!0),C},C.locale=N,C.isDayjs=w,C.unix=function(e){return C(1e3*e)},C.en=j[b],C.Ls=j,C.p={},C}()),Qa=D.forwardRef(({onAddPatient:e,onUpdatePatient:n,onDeletePatient:r,patients:a,selectedPatient:i,setSelectedPatient:s,showHeader:o=!0},l)=>{const[d,c]=D.useState({patientNo:"",name:"",gender:"",birth:"",age:"",weight:"",height:"",medicalHistory:"",allergies:""}),[u,m]=D.useState(!1),[f,p]=D.useState(!1),[h,g]=D.useState(!1),[x,v]=D.useState(null),[b,j]=D.useState(""),[y,w]=D.useState([]),[N,C]=D.useState(null),S=e=>{c({patientNo:e.id,name:e.name,gender:e.gender,birth:e.birthDate,age:e.age.toString(),weight:e.weight.toString(),height:e.height.toString(),medicalHistory:e.medicalHistory,allergies:e.allergies}),s(e),m(!0),p(!0)},T=e=>{v(e),(e=>{try{const t=oe.getJSON(le.prescriptions,[]).filter(t=>t.patientId===e).sort((e,t)=>{const n=new Date(e.startDate||e.id);return new Date(t.startDate||t.id).getTime()-n.getTime()});w(t)}catch(t){w([])}})(e.id),g(!0)},k=()=>{c({patientNo:"",name:"",gender:"",birth:"",age:"",weight:"",height:"",medicalHistory:"",allergies:""}),m(!1),s(null),p(!1)},M=()=>{c({patientNo:"",name:"",gender:"",birth:"",age:"",weight:"",height:"",medicalHistory:"",allergies:""}),m(!1),s(null),p(!0)},$=e=>{S(e)},L=e=>{T(e)},F=a.filter(e=>e.name.toLowerCase().includes(b.toLowerCase())||e.id.includes(b));return D.useImperativeHandle(l,()=>({openRegistrationModal:M,openEditModalForPatient:$,openViewModalForPatient:L})),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[o&&t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:"환자 정보 관리"}),t.jsx("p",{className:"text-muted-foreground",children:"환자 등록, 수정, 조회를 관리합니다"})]}),!o&&t.jsx("div",{}),t.jsx("div",{className:"flex gap-2",children:t.jsxs(Ba,{open:f,onOpenChange:p,children:[t.jsx(Ua,{asChild:!0,children:t.jsxs(A,{onClick:()=>{c({patientNo:"",name:"",gender:"",birth:"",age:"",weight:"",height:"",medicalHistory:"",allergies:""}),m(!1),s(null),p(!0)},className:"flex items-center gap-2",children:[t.jsx(B,{className:"h-4 w-4"}),"신규 환자 등록"]})}),t.jsxs(Ga,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[t.jsxs(Ya,{children:[t.jsxs(Xa,{className:"flex items-center gap-2",children:[t.jsx(B,{className:"h-5 w-5"}),u?"환자 정보 수정":"신규 환자 등록"]}),t.jsx(qa,{children:u?"환자 정보를 수정합니다":"환자 정보를 입력해 등록하세요"})]}),t.jsxs("form",{onSubmit:u?e=>{if(e.preventDefault(),!i)return;const t={...i,name:d.name,age:parseInt(d.age),weight:parseFloat(d.weight),height:parseFloat(d.height),gender:d.gender,medicalHistory:d.medicalHistory,allergies:d.allergies};n(t),k(),p(!1)}:t=>{t.preventDefault();const n={id:Date.now().toString(),name:d.name,age:parseInt(d.age),weight:parseFloat(d.weight),height:parseFloat(d.height),gender:d.gender,medicalHistory:d.medicalHistory,allergies:d.allergies,birthDate:d.birth,createdAt:new Date};e(n),k(),p(!1)},className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"patientNo",children:"환자 번호 *"}),t.jsx(O,{id:"patientNo",value:d.patientNo,onChange:e=>c({...d,patientNo:e.target.value}),placeholder:"환자 번호 입력",required:!0})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"name",children:"이름 *"}),t.jsx(O,{id:"name",value:d.name,onChange:e=>c({...d,name:e.target.value}),placeholder:"이름 입력",required:!0})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"gender",children:"성별 *"}),t.jsxs(Ur,{value:d.gender,onValueChange:e=>c({...d,gender:e}),required:!0,children:[t.jsx(Wr,{children:t.jsx(zr,{placeholder:"성별 선택"})}),t.jsxs(Xr,{children:[t.jsx(qr,{value:"male",children:"남성"}),t.jsx(qr,{value:"female",children:"여성"}),t.jsx(qr,{value:"other",children:"기타"})]})]})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"birth",children:"생년월일 *"}),t.jsx(O,{id:"birth",type:"date",value:d.birth,onChange:e=>{return t=e.target.value,void c(e=>{let n="";if(t){const e=Za(),r=Za(t);n=e.diff(r,"year").toString()}return{...e,birth:t,age:n}});var t},required:!0})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"weight",children:"체중(kg) *"}),t.jsx(O,{id:"weight",type:"number",step:"0.1",value:d.weight,onChange:e=>c({...d,weight:e.target.value}),placeholder:"체중(kg)",min:"0",required:!0})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"height",children:"신장(cm) *"}),t.jsx(O,{id:"height",type:"number",value:d.height,onChange:e=>c({...d,height:e.target.value}),placeholder:"신장(cm)",min:"0",required:!0})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"age",children:"나이"}),t.jsx(O,{id:"age",value:d.age,readOnly:!0,placeholder:"생년월일 입력 시 자동 계산"})]}),t.jsxs("div",{children:[t.jsx(bt,{children:"BMI"}),t.jsx(O,{value:(()=>{const e=parseFloat(d.weight),t=parseFloat(d.height);return e&&t?(e/Math.pow(t/100,2)).toFixed(1):""})(),readOnly:!0,placeholder:"자동 계산"})]}),t.jsxs("div",{children:[t.jsx(bt,{children:"BSA"}),t.jsx(O,{value:(()=>{const e=parseFloat(d.weight),t=parseFloat(d.height);return e&&t?Math.sqrt(e*t/3600).toFixed(2):""})(),readOnly:!0,placeholder:"자동 계산"})]})]}),t.jsxs("div",{className:"flex gap-2 pt-4",children:[u&&t.jsx(A,{type:"button",variant:"destructive",onClick:()=>{i&&(r(i.id),k(),p(!1))},className:"w-fit p-2",children:t.jsx(U,{className:"h-4 w-4"})}),t.jsx(A,{type:"submit",className:"flex-1",children:u?"수정하기":"등록하기"}),t.jsx(A,{type:"button",variant:"outline",onClick:k,children:"취소"})]})]})]})]})})]}),t.jsx(Ba,{open:h,onOpenChange:g,children:t.jsxs(Ga,{className:"min-w-[1000px] min-h-[500px] max-h-[80vh] p-0",children:[t.jsxs(Ya,{className:"px-6 pt-6 pb-0",children:[t.jsxs(Xa,{children:[null==x?void 0:x.name," 환자의 Report 조회"]}),t.jsx(qa,{children:"TDM 분석 내역을 선택하면 해당 분석의 Report를 조회하고 다운로드할 수 있습니다."})]}),x&&t.jsx("div",{className:"px-6 pb-6",children:y.length>0?t.jsx("div",{className:"rounded-md border",children:t.jsxs(Jr,{children:[t.jsx(Zr,{children:t.jsxs(ea,{children:[t.jsx(ta,{className:"w-[120px]",children:"등록일"}),t.jsx(ta,{className:"w-[150px]",children:"약물명"}),t.jsx(ta,{className:"w-[200px]",children:"적응증"}),t.jsx(ta,{className:"w-[200px]",children:"추가정보"}),t.jsx(ta,{className:"w-[200px]",children:"TDM 목표치"}),t.jsx(ta,{className:"w-[100px]",children:"액션"})]})}),t.jsx(Qr,{children:y.map((e,n)=>t.jsxs(ea,{className:"cursor-pointer hover:bg-blue-50/50 "+((null==N?void 0:N.id)===e.id?"bg-blue-50":""),onClick:()=>C(e),children:[t.jsx(na,{className:"align-top",children:Za(e.startDate||e.id).format("YYYY.M.D")}),t.jsx(na,{className:"font-medium align-top",children:e.drugName}),t.jsx(na,{className:"align-top",children:e.indication||"-"}),t.jsx(na,{className:"align-top",children:e.additionalInfo||"-"}),t.jsx(na,{className:"align-top",children:e.tdmTargetValue||"-"}),t.jsx(na,{className:"align-top",children:t.jsxs(A,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),(e=>{if(!x)return;window.localStorage.setItem(`tdmfriends:selectedDrug:${x.id}`,e.drugName);const t=`${window.location.origin}${window.location.pathname}report?patientId=${x.id}`;window.open(t,"_blank"),g(!1)})(e)},className:"flex items-center gap-1",children:[t.jsx(z,{className:"h-3 w-3"}),"조회"]})})]},e.id))})]})}):t.jsxs("div",{className:"text-center py-8 px-6",children:[t.jsx(W,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"등록된 TDM 분석 내역이 없습니다."})]})})]})}),t.jsxs(R,{children:[t.jsx(I,{children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs(_,{children:["등록된 환자 (",a.length,")"]}),t.jsx(E,{children:"환자를 클릭하면 상세 정보 확인 및 수정이 가능합니다"})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("div",{className:"relative",children:[t.jsx(G,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),t.jsx(O,{placeholder:"환자 검색...",value:b,onChange:e=>j(e.target.value),className:"pl-8 w-64"})]})})]})}),t.jsx(P,{children:F.length>0?t.jsx("div",{className:"rounded-md border",children:t.jsxs(Jr,{children:[t.jsx(Zr,{children:t.jsxs(ea,{children:[t.jsx(ta,{children:"이름"}),t.jsx(ta,{children:"나이"}),t.jsx(ta,{children:"성별"}),t.jsx(ta,{children:"체중"}),t.jsx(ta,{children:"신장"}),t.jsx(ta,{children:"등록일"}),t.jsx(ta,{children:"수정과 조회"})]})}),t.jsx(Qr,{children:F.map(e=>t.jsxs(ea,{className:"cursor-pointer hover:bg-muted/50 "+((null==i?void 0:i.id)===e.id?"bg-muted":""),onClick:()=>s(e),children:[t.jsx(na,{className:"font-medium",children:e.name}),t.jsx(na,{children:e.age}),t.jsx(na,{className:"capitalize",children:e.gender}),t.jsxs(na,{children:[e.weight," kg"]}),t.jsxs(na,{children:[e.height," cm"]}),t.jsx(na,{children:e.createdAt.toLocaleDateString()}),t.jsx(na,{children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx(A,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),S(e)},children:t.jsx(Y,{className:"h-4 w-4"})}),t.jsx(A,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),T(e)},children:t.jsx(W,{className:"h-4 w-4"})})]})})]},e.id))})]})}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx("p",{className:"text-muted-foreground",children:b?"검색 결과가 없습니다":"아직 등록된 환자가 없습니다"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:b?"다른 검색어를 시도해보세요":"위 버튼을 통해 첫 환자를 등록하세요"})]})})]})]})}),ei=({onAddPatient:e,onUpdatePatient:n,onDeletePatient:r,patients:a,selectedPatient:i,setSelectedPatient:s})=>t.jsx(Qa,{onAddPatient:e,onUpdatePatient:n,onDeletePatient:r,patients:a,selectedPatient:i,setSelectedPatient:s,showHeader:!1});function ti(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const r=n.reduce((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]}),{});return D.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}var ni="Progress",[ri,ai]=function(e,n=[]){let r=[];const a=()=>{const t=r.map(e=>D.createContext(e));return function(n){const r=(null==n?void 0:n[e])||t;return D.useMemo(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return a.scopeName=e,[function(n,a){const i=D.createContext(a),s=r.length;function o(n){const{scope:r,children:a,...o}=n,l=(null==r?void 0:r[e][s])||i,d=D.useMemo(()=>o,Object.values(o));return t.jsx(l.Provider,{value:d,children:a})}return r=[...r,a],o.displayName=n+"Provider",[o,function(t,r){const o=(null==r?void 0:r[e][s])||i,l=D.useContext(o);if(l)return l;if(void 0!==a)return a;throw new Error(`\`${t}\` must be used within \`${n}\``)}]},ti(a,...n)]}(ni),[ii,si]=ri(ni),oi=D.forwardRef((e,n)=>{const{__scopeProgress:r,value:a=null,max:i,getValueLabel:o=ci,...l}=e;(i||0===i)&&fi(i);const d=fi(i)?i:100;null!==a&&pi(a,d);const c=pi(a,d)?a:null,u=mi(c)?o(c,d):void 0;return t.jsx(ii,{scope:r,value:c,max:d,children:t.jsx(s.div,{"aria-valuemax":d,"aria-valuemin":0,"aria-valuenow":mi(c)?c:void 0,"aria-valuetext":u,role:"progressbar","data-state":ui(c,d),"data-value":c??void 0,"data-max":d,...l,ref:n})})});oi.displayName=ni;var li="ProgressIndicator",di=D.forwardRef((e,n)=>{const{__scopeProgress:r,...a}=e,i=si(li,r);return t.jsx(s.div,{"data-state":ui(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...a,ref:n})});function ci(e,t){return`${Math.round(e/t*100)}%`}function ui(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function mi(e){return"number"==typeof e}function fi(e){return mi(e)&&!isNaN(e)&&e>0}function pi(e,t){return mi(e)&&!isNaN(e)&&e<=t&&e>=0}di.displayName=li;var hi=oi,gi=di;const xi=D.forwardRef(({className:e,value:n,...r},a)=>t.jsx(hi,{ref:a,className:c("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...r,children:t.jsx(gi,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(n||0)}%)`}})}));xi.displayName=hi.displayName;const vi=({patients:e,selectedPatient:n,setSelectedPatient:r,onAddPatient:a,onUpdatePatient:i,onDeletePatient:s,onNext:o,isCompleted:l})=>t.jsx("div",{className:"space-y-6",children:t.jsxs(R,{children:[t.jsxs(I,{children:[t.jsxs(_,{className:"flex items-center gap-2",children:[t.jsx(X,{className:"h-5 w-5"}),"1단계: 환자 선택",l&&t.jsx(q,{className:"h-5 w-5 text-green-600"})]}),t.jsx(E,{children:"기존 환자를 선택하거나 신규 환자를 등록하세요."})]}),t.jsxs(P,{className:"space-y-6",children:[t.jsx(Qa,{onAddPatient:a,onUpdatePatient:i,onDeletePatient:s,patients:e,selectedPatient:n,setSelectedPatient:r,showHeader:!1}),n&&t.jsxs(R,{className:"border-green-200 bg-green-50",children:[t.jsx(I,{children:t.jsx(_,{className:"text-green-800",children:"Selected Patient"})}),t.jsx(P,{children:t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"이름"}),t.jsx("p",{className:"text-sm",children:n.name})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"생년월일"}),t.jsx("p",{className:"text-sm",children:n.birthDate})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"나이"}),t.jsxs("p",{className:"text-sm",children:[n.age,"세"]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"성별"}),t.jsx("p",{className:"text-sm",children:"male"===n.gender?"남성":"female"===n.gender?"여성":"기타"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"체중"}),t.jsxs("p",{className:"text-sm",children:[n.weight," kg"]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"신장"}),t.jsxs("p",{className:"text-sm",children:[n.height," cm"]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"BMI"}),t.jsx("p",{className:"text-sm",children:n.weight&&n.height?(n.weight/Math.pow(n.height/100,2)).toFixed(1):"-"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"BSA"}),t.jsxs("p",{className:"text-sm",children:[n.weight&&n.height?Math.sqrt(n.weight*n.height/3600).toFixed(2):"-"," m²"]})]})]})})]}),l&&t.jsx("div",{className:"flex justify-end",children:t.jsxs(A,{onClick:o,className:"flex items-center gap-2 w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center",children:["TDM 선택",t.jsx(J,{className:"h-4 w-4"})]})})]})]})}),bi=[{name:"Vancomycin",indications:["Not specified/Korean","Neurosurgical patients/Korean"],additionalInfo:{default:["신기능","체중","나이","감염 부위","미생물 민감도"],"Neurosurgical patients/Korean":["복용 중인 약물 없음","Nephrotoxic drugs including aminoglycosides (amikacin and tobramycin)","Liposomal amphotericin B","Antiviral agents (acyclovir, famciclovir and ganciclovir)","Colistimethate","Cytotoxic agents (cytosine arabinoside, fludarabine and idarubicin)","Cyclosporin","Tacrolimus","Non-steroidal anti-inflammatory agents (aceclofenac, ibuprofen, ketoprofen, ketorolac and zaltoprofen)","Trimethoprim/sulfamethoxazole","기타"]},targets:[{type:"Trough Concentration",value:"10-20 mg/L"},{type:"Peak Concentration",value:"25-40 mg/L"},{type:"AUC",value:"400-600 mg·h/L"}],defaultTargets:{"Not specified/Korean":{type:"AUC",value:"400-600 mg·h/L"},"Neurosurgical patients/Korean":{type:"AUC",value:"400-600 mg·h/L"}}},{name:"Cyclosporin",indications:["Renal transplant recipients/Korean","Allo-HSCT/Korean","Thoracic transplant recipients/European"],additionalInfo:{default:["신기능","간기능","혈압","약물상호작용","이식 후 경과"],"Renal transplant recipients/Korean":["POD ~2","POD 3~6","POD 7~"]},targets:[{type:"Trough Concentration",value:"100-400 ng/mL"},{type:"Peak Concentration",value:"800-1200 ng/mL"},{type:"C2 Concentration",value:"1200-1700 ng/mL"}],defaultTargets:{"Allo-HSCT/Korean":{type:"Trough Concentration",value:"150-400 ng/mL"},"Thoracic transplant recipients/European":{type:"Trough Concentration",value:"170-230 ng/mL"},"Renal transplant recipients/Korean":{type:"Trough Concentration",value:"300-350 ng/mL"}}}],ji=({patients:e,prescriptions:n,selectedPatient:r,selectedPrescription:a,setSelectedPrescription:i,onAddPrescription:s,onNext:o,onPrev:l,isCompleted:d,bloodTests:c,setBloodTests:u,drugAdministrations:m,setDrugAdministrations:f,onClearLaterStepData:p,onResetWorkflow:h})=>{const[g,x]=D.useState({drugName:"",indication:"",additionalInfo:"",tdmTarget:"",tdmTargetValue:""}),[v,b]=D.useState(null),[j,y]=D.useState(null),w=e=>e.startsWith("temp"),N=e=>!w(e);D.useEffect(()=>{if(!r)return;const e=`tdmfriends:prescription:${r.id}`;try{const t=localStorage.getItem(e);if(t){const e=JSON.parse(t);if(e.selectedTdmId){b(e.selectedTdmId);const t=n.find(t=>t.id===e.selectedTdmId&&t.patientId===r.id);t&&i(t)}e.newlyAddedTdmId&&y(e.newlyAddedTdmId)}}catch(t){}},[r,n,i,null==r?void 0:r.id]),D.useEffect(()=>{if(!r)return;const e=`tdmfriends:prescription:${r.id}`;try{const t={selectedTdmId:v,newlyAddedTdmId:j,formData:g};localStorage.setItem(e,JSON.stringify(t))}catch(t){}},[v,j,g,r,null==r?void 0:r.id]),D.useEffect(()=>{if(!r||!v)return;const e=n.find(e=>e.id===v&&e.patientId===r.id);e&&i(e)},[v,n,r,null==r?void 0:r.id,i]),D.useEffect(()=>{if(r&&j&&v!==j){n.find(e=>e.id===j&&e.patientId===r.id)&&b(j)}},[n,j,r,null==r?void 0:r.id,v]);const C=r?n.filter(e=>e.patientId===r.id):[],S=bi.find(e=>e.name===g.drugName),T=S?S.targets:[],k=(()=>{if(!S||!g.indication)return[];if("object"==typeof S.additionalInfo&&!Array.isArray(S.additionalInfo)){const e=S.additionalInfo[g.indication];if(e)return e;const t=S.additionalInfo.default;if(t)return t}return Array.isArray(S.additionalInfo)?S.additionalInfo:[]})(),M=()=>"Vancomycin"===(null==S?void 0:S.name)&&"Neurosurgical patients/Korean"===g.indication||"Cyclosporin"===(null==S?void 0:S.name)&&"Renal transplant recipients/Korean"===g.indication,$=()=>{if(!r)return!1;const e=c.some(e=>e.patientId===r.id),t=m.some(e=>e.patientId===r.id);return e||t};return r?t.jsx("div",{className:"space-y-6",children:t.jsxs(R,{children:[t.jsxs(I,{children:[t.jsxs(_,{className:"flex items-center gap-2",children:[t.jsx(Z,{className:"h-5 w-5"}),"2단계: TDM 선택",d&&t.jsx(q,{className:"h-5 w-5 text-green-600"})]}),t.jsx(E,{children:r?`${r.name} 환자의 TDM 약물 정보를 입력하세요.`:"TDM 약물 정보를 입력하세요."})]}),t.jsxs(P,{className:"space-y-6",children:[C.length>0&&t.jsxs(R,{children:[t.jsxs(I,{children:[t.jsxs(_,{children:["TDM 내역 (",C.length,")"]}),t.jsx(E,{children:"기 수행된 TDM의 F/U TDM을 진행하신다면 아래 내역 중 선택해 주세요."})]}),t.jsx(P,{children:t.jsx("div",{className:"rounded-md border",children:t.jsxs(Jr,{children:[t.jsx(Zr,{children:t.jsxs(ea,{children:[t.jsx(ta,{children:"분석일"}),t.jsx(ta,{children:"약물명"}),t.jsx(ta,{children:"적응증"}),t.jsx(ta,{children:"추가정보"}),t.jsx(ta,{children:"TDM 목표치"}),t.jsx(ta,{children:"삭제"})]})}),t.jsx(Qr,{children:C.map(e=>t.jsxs(ea,{className:"cursor-pointer hover:bg-blue-50/50 "+(v===e.id?"bg-blue-50":""),onClick:()=>(e=>{b(e.id),i(e),e.id!==j&&y(null);const t={drugName:e.drugName||"",indication:e.indication||"",additionalInfo:e.additionalInfo||"",tdmTarget:e.tdmTarget||"Trough Concentration",tdmTargetValue:e.tdmTargetValue||""};x(t)})(e),children:[t.jsx(na,{children:N(e.id)?"진행 중":e.startDate?new Date(e.startDate).toLocaleDateString("ko-KR"):"-"}),t.jsx(na,{className:"font-medium",children:e.drugName}),t.jsx(na,{children:e.indication||"-"}),t.jsx(na,{children:e.additionalInfo||"-"}),t.jsx(na,{children:e.tdmTarget&&e.tdmTargetValue?`${e.tdmTarget}: ${e.tdmTargetValue}`:e.tdmTargetValue||"-"}),t.jsx(na,{children:N(e.id)&&t.jsxs(A,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),(e=>{if(!r)return;if(!N(e))return;const t=n.find(t=>t.id===e&&t.patientId===r.id);if(!t)return;if(!window.confirm(`${t.drugName} TDM이 진행 중입니다.\n\n해당 TDM 내역을 삭제 시 관련된 Lab정보와 투약 기록, 시뮬레이션 데이터가 초기화 됩니다.\n\n삭제하시겠습니까?`))return;const a=t.drugName,o=n.filter(t=>!(t.id===e&&t.patientId===r.id));s(void 0,o);const l=c.filter(e=>!(e.patientId===r.id&&e.drugName===a));u(l);const d=m.filter(e=>!(e.patientId===r.id&&e.drugName===a));f(d);try{localStorage.removeItem(`tdmfriends:renal:${r.id}:${a}`)}catch(h){}const p=o.filter(e=>e.patientId===r.id);if(p.length>0){const e=p.sort((e,t)=>{const n=parseInt(e.id);return parseInt(t.id)-n})[0];b(e.id),i(e),N(e.id)?y(e.id):y(null);const t={drugName:e.drugName||"",indication:e.indication||"",additionalInfo:e.additionalInfo||"",tdmTarget:e.tdmTarget||"Trough Concentration",tdmTargetValue:e.tdmTargetValue||""};x(t)}else b(null),i(null);e===j&&y(null)})(e.id)},children:[t.jsx("span",{className:"sr-only",children:"삭제"}),t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})]})})]},e.id))})]})})})]}),t.jsxs(R,{children:[t.jsx(I,{children:t.jsxs(_,{className:"flex items-center gap-2",children:[t.jsx(Q,{className:"h-4 w-4"}),"신규 TDM 추가",v&&(()=>{const e=C.find(e=>e.id===v);if(!e)return null;if("existing"!==(w(e.id)?"existing":"newly-added"))return null;const n=e.startDate?new Date(e.startDate).toLocaleDateString("ko-KR"):"";return t.jsxs("span",{className:"text-sm text-blue-600 font-normal",children:["(",n,"에 진행한 TDM을 F/U합니다)"]})})()]})}),t.jsx(P,{children:t.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!r)return;if(n.filter(e=>e.patientId===r.id&&e.drugName===g.drugName&&N(e.id)).length>0){if(!window.confirm(`${g.drugName}에 대한 신규 TDM이 이미 등록되어 있습니다. 삭제 후 새로운 TDM을 추가하시겠습니까?`))return;const e=n.filter(e=>{if(e.patientId!==r.id)return!0;if(e.drugName!==g.drugName)return!0;return!N(e.id)}),t={id:Date.now().toString(),patientId:r.id,drugName:g.drugName,dosage:0,unit:"",frequency:"",startDate:new Date,route:"",prescribedBy:"",indication:g.indication,tdmTarget:g.tdmTarget,tdmTargetValue:g.tdmTargetValue,additionalInfo:g.additionalInfo},a=[...e,t];return s(void 0,a),y(t.id),b(t.id),void x({drugName:"",indication:"",additionalInfo:"",tdmTarget:"",tdmTargetValue:""})}if("Vancomycin"===g.drugName&&"Neurosurgical patients/Korean"===g.indication&&!g.additionalInfo)return void alert(`${g.indication}의 경우 복용 중인 약물 정보를 입력해주세요.`);if("Cyclosporin"===g.drugName&&"Renal transplant recipients/Korean"===g.indication&&!g.additionalInfo)return void alert(`${g.indication}의 경우 POD 정보를 입력해주세요.`);const t={id:Date.now().toString(),patientId:r.id,drugName:g.drugName,dosage:0,unit:"",frequency:"",startDate:new Date,route:"",prescribedBy:"",indication:g.indication,tdmTarget:g.tdmTarget,tdmTargetValue:g.tdmTargetValue,additionalInfo:g.additionalInfo},a=n.filter(e=>e.patientId!==r.id);s(t,a),y(t.id),b(t.id),x({drugName:"",indication:"",additionalInfo:"",tdmTarget:"",tdmTargetValue:""})},className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"drugName",children:"약물명 *"}),t.jsxs(Ur,{value:g.drugName,onValueChange:e=>{var t,n;if(C.length>0&&C[0].drugName!==e){$()&&p()}const r=bi.find(t=>t.name===e),a=(null==r?void 0:r.indications[0])||"",i=null==(t=null==r?void 0:r.defaultTargets)?void 0:t[a];x({drugName:e,indication:a,additionalInfo:"",tdmTarget:(null==i?void 0:i.type)||"Trough Concentration",tdmTargetValue:(null==i?void 0:i.value)||(null==(n=null==r?void 0:r.targets.find(e=>"Trough Concentration"===e.type))?void 0:n.value)||""})},required:!0,children:[t.jsx(Wr,{id:"drugName",children:t.jsx(zr,{placeholder:"TDM 약물 선택"})}),t.jsx(Xr,{children:bi.map(e=>t.jsx(qr,{value:e.name,children:e.name},e.name))})]})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"indication",children:"적응증/Demographic *"}),t.jsxs(Ur,{value:g.indication,onValueChange:e=>{var t;const n=null==(t=null==S?void 0:S.defaultTargets)?void 0:t[e];x(t=>({...t,indication:e,additionalInfo:v?t.additionalInfo:"",tdmTarget:(null==n?void 0:n.type)||t.tdmTarget,tdmTargetValue:(null==n?void 0:n.value)||t.tdmTargetValue}))},required:!0,disabled:!g.drugName,children:[t.jsx(Wr,{id:"indication",children:t.jsx(zr,{placeholder:"적응증 선택"})}),t.jsx(Xr,{children:null==S?void 0:S.indications.map(e=>t.jsx(qr,{value:e,children:e},e))})]})]}),!(!S||!g.indication)&&("Vancomycin"===S.name&&"Neurosurgical patients/Korean"===g.indication||"Cyclosporin"===S.name&&"Renal transplant recipients/Korean"===g.indication)&&t.jsxs("div",{children:[t.jsxs(bt,{htmlFor:"additionalInfo",children:[S&&g.indication?"Vancomycin"===S.name&&"Neurosurgical patients/Korean"===g.indication?"복용 중인 약물":"Cyclosporin"===S.name&&"Renal transplant recipients/Korean"===g.indication?"POD":"추가정보":"추가정보"," ",M()?"*":""]}),t.jsxs(Ur,{value:g.additionalInfo,onValueChange:e=>x(t=>({...t,additionalInfo:e})),required:M(),children:[t.jsx(Wr,{id:"additionalInfo",children:t.jsx(zr,{placeholder:"Renal transplant recipients/Korean"===g.indication?"POD를 선택하세요":"약물명 선택"})}),t.jsx(Xr,{children:k.map(e=>t.jsx(qr,{value:e,children:e},e))})]})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"tdmTarget",children:"TDM 목표 *"}),t.jsxs(Ur,{value:g.tdmTarget,onValueChange:e=>{const t=T.find(t=>t.type===e);x(n=>({...n,tdmTarget:e,tdmTargetValue:(null==t?void 0:t.value)||""}))},required:!0,disabled:!g.drugName,children:[t.jsx(Wr,{id:"tdmTarget",children:t.jsx(zr,{placeholder:"TDM 목표 선택"})}),t.jsx(Xr,{children:T.map(e=>t.jsx(qr,{value:e.type,children:e.type},e.type))})]})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"tdmTargetValue",children:"TDM 목표치 *"}),t.jsx(O,{id:"tdmTargetValue",value:g.tdmTargetValue,onChange:e=>x(t=>({...t,tdmTargetValue:e.target.value})),placeholder:"TDM 목표 선택 시 자동 입력, 수정 가능",required:!0,disabled:!g.tdmTarget})]})]}),t.jsx(A,{type:"submit",className:"w-full",children:"TDM 추가"})]})})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs(A,{variant:"outline",onClick:l,className:"flex items-center gap-2",children:[t.jsx(ee,{className:"h-4 w-4"}),"환자 등록 및 선택"]}),d&&t.jsxs(A,{onClick:o,className:"flex items-center gap-2 w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center",children:["Lab",t.jsx(J,{className:"h-4 w-4"})]})]})]})]})}):t.jsx(R,{children:t.jsx(P,{className:"py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx(Z,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"Please select a patient first"})]})})})};var yi="Checkbox",[wi,Ni]=l(yi),[Ci,Di]=wi(yi),Si=D.forwardRef((e,n)=>{const{__scopeCheckbox:i,name:l,checked:d,defaultChecked:c,required:u,disabled:m,value:f="on",onCheckedChange:p,form:h,...g}=e,[x,v]=D.useState(null),b=r(n,e=>v(e)),j=D.useRef(!1),y=!x||(h||!!x.closest("form")),[w=!1,N]=a({prop:d,defaultProp:c,onChange:p}),C=D.useRef(w);return D.useEffect(()=>{const e=null==x?void 0:x.form;if(e){const t=()=>N(C.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[x,N]),t.jsxs(Ci,{scope:i,state:w,disabled:m,children:[t.jsx(s.button,{type:"button",role:"checkbox","aria-checked":Ri(w)?"mixed":w,"aria-required":u,"data-state":Ii(w),"data-disabled":m?"":void 0,disabled:m,value:f,...g,ref:b,onKeyDown:o(e.onKeyDown,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:o(e.onClick,e=>{N(e=>!!Ri(e)||!e),y&&(j.current=e.isPropagationStopped(),j.current||e.stopPropagation())})}),y&&t.jsx(Mi,{control:x,bubbles:!j.current,name:l,value:f,checked:w,required:u,disabled:m,form:h,style:{transform:"translateX(-100%)"},defaultChecked:!Ri(c)&&c})]})});Si.displayName=yi;var Ti="CheckboxIndicator",ki=D.forwardRef((e,n)=>{const{__scopeCheckbox:r,forceMount:a,...i}=e,o=Di(Ti,r);return t.jsx(d,{present:a||Ri(o.state)||!0===o.state,children:t.jsx(s.span,{"data-state":Ii(o.state),"data-disabled":o.disabled?"":void 0,...i,ref:n,style:{pointerEvents:"none",...e.style}})})});ki.displayName=Ti;var Mi=e=>{const{control:n,checked:r,bubbles:a=!0,defaultChecked:i,...s}=e,o=D.useRef(null),l=Pt(r),d=y(n);D.useEffect(()=>{const e=o.current,t=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(t,"checked").set;if(l!==r&&n){const t=new Event("click",{bubbles:a});e.indeterminate=Ri(r),n.call(e,!Ri(r)&&r),e.dispatchEvent(t)}},[l,r,a]);const c=D.useRef(!Ri(r)&&r);return t.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i??c.current,...s,tabIndex:-1,ref:o,style:{...e.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Ri(e){return"indeterminate"===e}function Ii(e){return Ri(e)?"indeterminate":e?"checked":"unchecked"}var _i=Si,Ei=ki;const Pi=D.forwardRef(({className:e,...n},r)=>t.jsx(_i,{ref:r,className:c("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-muted disabled:border-muted-foreground/20 disabled:text-muted-foreground data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground disabled:data-[state=checked]:bg-muted disabled:data-[state=checked]:text-muted-foreground",e),...n,children:t.jsx(Ei,{className:c("flex items-center justify-center text-current"),children:t.jsx(H,{className:"h-4 w-4"})})}));Pi.displayName=_i.displayName;var Ai="AlertDialog",[$i,Oi]=l(Ai,[ia]),Li=ia(),Fi=e=>{const{__scopeAlertDialog:n,...r}=e,a=Li(n);return t.jsx(Aa,{...a,...r,modal:!0})};Fi.displayName=Ai;D.forwardRef((e,n)=>{const{__scopeAlertDialog:r,...a}=e,i=Li(r);return t.jsx($a,{...i,...a,ref:n})}).displayName="AlertDialogTrigger";var Vi=e=>{const{__scopeAlertDialog:n,...r}=e,a=Li(n);return t.jsx(Oa,{...a,...r})};Vi.displayName="AlertDialogPortal";var Hi=D.forwardRef((e,n)=>{const{__scopeAlertDialog:r,...a}=e,i=Li(r);return t.jsx(La,{...i,...a,ref:n})});Hi.displayName="AlertDialogOverlay";var Ki="AlertDialogContent",[Bi,Ui]=$i(Ki),zi=D.forwardRef((e,n)=>{const{__scopeAlertDialog:a,children:i,...s}=e,l=Li(a),d=D.useRef(null),c=r(n,d),u=D.useRef(null);return t.jsx(Ia,{contentName:Ki,titleName:Wi,docsSlug:"alert-dialog",children:t.jsx(Bi,{scope:a,cancelRef:u,children:t.jsxs(Fa,{role:"alertdialog",...l,...s,ref:c,onOpenAutoFocus:o(s.onOpenAutoFocus,e=>{var t;e.preventDefault(),null==(t=u.current)||t.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[t.jsx(w,{children:i}),t.jsx(Qi,{contentRef:d})]})})})});zi.displayName=Ki;var Wi="AlertDialogTitle",Gi=D.forwardRef((e,n)=>{const{__scopeAlertDialog:r,...a}=e,i=Li(r);return t.jsx(Va,{...i,...a,ref:n})});Gi.displayName=Wi;var Yi="AlertDialogDescription",Xi=D.forwardRef((e,n)=>{const{__scopeAlertDialog:r,...a}=e,i=Li(r);return t.jsx(Ha,{...i,...a,ref:n})});Xi.displayName=Yi;var qi=D.forwardRef((e,n)=>{const{__scopeAlertDialog:r,...a}=e,i=Li(r);return t.jsx(Ka,{...i,...a,ref:n})});qi.displayName="AlertDialogAction";var Ji="AlertDialogCancel",Zi=D.forwardRef((e,n)=>{const{__scopeAlertDialog:a,...i}=e,{cancelRef:s}=Ui(Ji,a),o=Li(a),l=r(n,s);return t.jsx(Ka,{...o,...i,ref:l})});Zi.displayName=Ji;var Qi=({contentRef:e})=>{const t=`\`${Ki}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${Ki}\` by passing a \`${Yi}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Ki}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return D.useEffect(()=>{var t;document.getElementById(null==(t=e.current)?void 0:t.getAttribute("aria-describedby"))},[t,e]),null},es=Hi,ts=zi,ns=qi,rs=Zi,as=Gi,is=Xi;const ss=Fi,os=Vi,ls=D.forwardRef(({className:e,...n},r)=>t.jsx(es,{className:c("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...n,ref:r}));ls.displayName=es.displayName;const ds=D.forwardRef(({className:e,...n},r)=>t.jsxs(os,{children:[t.jsx(ls,{}),t.jsx(ts,{ref:r,className:c("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...n})]}));ds.displayName=ts.displayName;const cs=({className:e,...n})=>t.jsx("div",{className:c("flex flex-col space-y-2 text-center sm:text-left",e),...n});cs.displayName="AlertDialogHeader";const us=({className:e,...n})=>t.jsx("div",{className:c("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...n});us.displayName="AlertDialogFooter";const ms=D.forwardRef(({className:e,...n},r)=>t.jsx(as,{ref:r,className:c("text-lg font-semibold",e),...n}));ms.displayName=as.displayName;const fs=D.forwardRef(({className:e,...n},r)=>t.jsx(is,{ref:r,className:c("text-sm text-muted-foreground",e),...n}));fs.displayName=is.displayName;const ps=D.forwardRef(({className:e,...n},r)=>t.jsx(ns,{ref:r,className:c($(),e),...n}));ps.displayName=ns.displayName;const hs=D.forwardRef(({className:e,...n},r)=>t.jsx(rs,{ref:r,className:c($({variant:"outline"}),"mt-2 sm:mt-0",e),...n}));hs.displayName=rs.displayName;const gs=({patients:e,bloodTests:n,selectedPatient:r,selectedPrescription:a,onAddBloodTest:i,onDeleteBloodTest:s,onUpdateBloodTest:o=()=>{},onNext:l,onPrev:d,isCompleted:c,prescriptions:u})=>{const[m,f]=D.useState({creatinine:"",date:"",formula:"cockcroft-gault",result:"",dialysis:"N",renalReplacement:"",isBlack:!1}),[p,h]=D.useState([]),[g,x]=D.useState(!1),v=(e,t,n,r=!1)=>{if(!e||e<=0)return"";switch(t){case"cockcroft-gault":return b(e,n.age,n.weight,n.height,n.gender);case"mdrd":return j(e,n.age,n.gender,r);case"ckd-epi":return y(e,n.age,n.gender,r);default:return""}},b=(e,t,n,r,a)=>{const i="여성"===a?.85:1,s=((e,t)=>"여성"===t?45.5+.9*(e-152):50+.9*(e-152))(r,a),o=n/Math.pow(r/100,2)>30||n>1.2*s,l=o?((e,t)=>t+.4*(e-t))(n,s):n,d=(140-t)*l*i/(72*e),c=o?` (조정체중: ${Math.round(10*l)/10}kg)`:"";return`CRCL = ${Math.round(10*d)/10} mL/min${c}`},j=(e,t,n,r)=>{const a="여성"===n?.742:1,i=r?1.212:1,s=175*Math.pow(e,-1.154)*Math.pow(t,-.203)*a*i;return`eGFR = ${Math.round(10*s)/10} mL/min/1.73m²`},y=(e,t,n,r)=>{const a=r?1.212:1;let i,s;"여성"===n?(i=-.329,s=.7):(i=-.411,s=.9);const o=Math.min(Math.max(e/s,1),999),l=141*Math.pow(o,i)*Math.pow(.993,t)*a;return`eGFR = ${Math.round(10*l)/10} mL/min/1.73m²`},w=a;D.useEffect(()=>{if(r&&w){x(!1);try{const e=window.localStorage.getItem(`tdmfriends:renal:${r.id}:${w.drugName}`);if(e){const t=JSON.parse(e);h(t)}else h([])}catch(e){}finally{x(!0)}}},[null==r?void 0:r.id,null==w?void 0:w.drugName]),D.useEffect(()=>{if(r&&w&&g)try{window.localStorage.setItem(`tdmfriends:renal:${r.id}:${w.drugName}`,JSON.stringify(p))}catch(e){}},[null==r?void 0:r.id,null==w?void 0:w.drugName,p,g]);const[N,C]=D.useState({testDate:"",testTime:"",concentration:"",unit:"ng/mL",measurementType:"Trough"}),[S,T]=D.useState(!1),k=r&&w?n.filter(e=>e.patientId===r.id&&e.drugName===w.drugName):[],M=Za().format("YYYY-MM-DD");D.useEffect(()=>{const e="Vancomycin"===(null==w?void 0:w.drugName)?"mg/L":"ng/mL";C(t=>({...t,unit:e}))},[null==w?void 0:w.drugName]);return r?t.jsxs("div",{className:"space-y-6",children:[t.jsxs(R,{children:[t.jsxs(I,{children:[t.jsxs(_,{className:"flex items-center gap-2",children:[t.jsx(te,{className:"h-5 w-5"}),"3단계: Lab",c&&t.jsx(q,{className:"h-5 w-5 text-green-600"})]}),t.jsx(E,{children:r?`${r.name} 환자의 신기능(혈청 크레아티닌)과 혈중 약물 농도 정보를 입력하세요.`:"신기능(혈청 크레아티닌)과 혈중 약물 농도 정보를 입력하세요."})]}),t.jsxs(P,{className:"space-y-6",children:[w&&r&&t.jsxs("div",{className:"py-3 px-4 rounded bg-muted dark:bg-slate-800 mb-4",children:[t.jsxs("div",{className:"grid grid-cols-6 gap-4 mb-3",children:[t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"font-medium",children:"나이:"})," ",r.age]}),t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"font-medium",children:"성별:"})," ",r.gender]}),t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"font-medium",children:"몸무게:"})," ",r.weight,"kg"]}),t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"font-medium",children:"키:"})," ",r.height,"cm"]}),t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"font-medium",children:"BMI:"})," ",(()=>{if(!(null==r?void 0:r.weight)||!(null==r?void 0:r.height))return"N/A";return(r.weight/Math.pow(r.height/100,2)).toFixed(1)})()]}),t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"font-medium",children:"BSA:"})," ",(()=>{if(!(null==r?void 0:r.weight)||!(null==r?void 0:r.height))return"N/A";return Math.sqrt(r.height*r.weight/3600).toFixed(2)})()]})]}),t.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"약품명:"}),t.jsx("span",{className:"ml-2 font-semibold",children:w.drugName})]}),t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"적응증:"}),t.jsx("span",{className:"ml-2",children:w.indication})]})]})]}),t.jsxs(R,{children:[t.jsxs(I,{children:[t.jsxs(_,{children:["신기능 데이터 (",p.length,")"]}),t.jsx(E,{children:"체크박스를 선택하면 해당 신기능 데이터가 시뮬레이션에 반영됩니다."})]}),t.jsxs(P,{className:"space-y-6",children:[t.jsx("div",{className:"rounded-md border",children:t.jsxs(Jr,{children:[t.jsx(Zr,{children:t.jsxs(ea,{children:[t.jsx(ta,{className:"w-16",children:"분석사용"}),t.jsx(ta,{children:"혈청 크레아티닌"}),t.jsx(ta,{children:"검사일"}),t.jsx(ta,{children:"계산식"}),t.jsx(ta,{children:"결과"}),t.jsx(ta,{children:"투석 여부"}),t.jsx(ta,{children:"신 대체요법"}),t.jsx(ta,{className:"w-16",children:"삭제"})]})}),t.jsxs(Qr,{children:[t.jsxs(ea,{children:[t.jsx(na,{children:t.jsx(Pi,{checked:p.every(e=>!e.isSelected),onCheckedChange:e=>{e&&h(p.map(e=>({...e,isSelected:!1})))}})}),t.jsx(na,{colSpan:6,className:"text-center text-muted-foreground",children:"해당 회차 TDM은 신기능 데이터를 사용하지 않습니다"}),t.jsx(na,{})]}),p.map(e=>t.jsxs(ea,{children:[t.jsx(na,{children:t.jsx(Pi,{checked:e.isSelected,onCheckedChange:t=>((e,t)=>{h(p.map(n=>({...n,isSelected:n.id===e&&t})))})(e.id,t)})}),t.jsxs(na,{children:[e.creatinine," mg/dL"]}),t.jsx(na,{children:e.date}),t.jsx(na,{children:e.formula}),t.jsx(na,{children:e.result||"-"}),t.jsx(na,{children:e.dialysis}),t.jsx(na,{children:"Y"===e.dialysis?e.renalReplacement||"-":"N"}),t.jsx(na,{children:t.jsx(A,{variant:"ghost",size:"icon",onClick:()=>{return t=e.id,void h(p.filter(e=>e.id!==t));var t},children:t.jsx(K,{className:"h-4 w-4"})})})]},e.id))]})]})}),t.jsxs("div",{className:"border-t pt-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx(Q,{className:"h-4 w-4"}),t.jsx("h3",{className:"text-lg font-semibold",children:"신기능 데이터 추가"})]}),t.jsxs("form",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"creatinine",children:"혈청 크레아티닌 (mg/dL) *"}),t.jsx(O,{id:"creatinine",type:"number",step:"0.01",value:m.creatinine,onChange:e=>f({...m,creatinine:e.target.value}),onBlur:()=>{if(m.creatinine&&r){const e=parseFloat(m.creatinine);if(!isNaN(e)){const t=v(e,m.formula,r,m.isBlack);f(e=>({...e,result:t}))}}},placeholder:"예: 1.2",required:!0})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"renalDate",children:"검사일 *"}),t.jsx(O,{id:"renalDate",type:"date",value:m.date,max:M,onChange:e=>f({...m,date:e.target.value}),required:!0})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"renalFormula",children:"계산식 *"}),t.jsxs(Ur,{value:m.formula,onValueChange:e=>{f(t=>{const n={...t,formula:e};if(t.creatinine&&r){const a=parseFloat(t.creatinine);if(!isNaN(a)){const i=v(a,e,r,t.isBlack);n.result=i}}return n})},required:!0,children:[t.jsx(Wr,{children:t.jsx(zr,{placeholder:"계산식 선택"})}),t.jsxs(Xr,{children:[t.jsx(qr,{value:"cockcroft-gault",children:"Cockcroft-Gault"}),t.jsx(qr,{value:"mdrd",children:"MDRD"}),t.jsx(qr,{value:"ckd-epi",children:"CKD-EPI"})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"result",children:"계산 결과"}),t.jsx(O,{id:"result",value:m.result,onChange:e=>{if(m.result&&m.result.includes("=")&&e.target.value!==m.result){if(!window.confirm("자동계산된 데이터를 삭제하고 직접 입력하시겠습니까?"))return}f({...m,result:e.target.value})},placeholder:"자동계산"})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"dialysis",children:"투석 여부 *"}),t.jsxs(Ur,{value:m.dialysis,onValueChange:e=>f({...m,dialysis:e}),required:!0,children:[t.jsx(Wr,{children:t.jsx(zr,{placeholder:"선택"})}),t.jsxs(Xr,{children:[t.jsx(qr,{value:"N",children:"N"}),t.jsx(qr,{value:"Y",children:"Y"})]})]})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"renalReplacement",children:"신 대체요법"}),t.jsxs(Ur,{value:m.renalReplacement,onValueChange:e=>f({...m,renalReplacement:e}),disabled:"N"===m.dialysis,children:[t.jsx(Wr,{children:t.jsx(zr,{placeholder:"신 대체요법 선택"})}),t.jsxs(Xr,{children:[t.jsx(qr,{value:"HD",children:"HD"}),t.jsx(qr,{value:"CRRT",children:"CRRT"}),t.jsx(qr,{value:"PD",children:"PD"}),t.jsx(qr,{value:"기타",children:"기타"})]})]})]})]}),t.jsx(A,{type:"button",onClick:()=>{if(!m.creatinine||!m.date||!m.formula)return void alert("신기능 데이터의 필수 항목을 모두 입력해주세요. (혈청 크레아티닌, 검사일, 투석여부)");if("Y"===m.dialysis&&!m.renalReplacement.trim())return void alert("신 대체요법을 입력해주세요.");"CRRT"===m.renalReplacement.toUpperCase()&&T(!0);const e={id:Date.now().toString(),...m,isSelected:!0},t=p.map(e=>({...e,isSelected:!1}));h([...t,e]),f({creatinine:"",date:"",formula:"cockcroft-gault",result:"",dialysis:"N",renalReplacement:"",isBlack:!1})},className:"w-full",children:"신기능 데이터 추가"})]})]})]})]}),t.jsxs(R,{children:[t.jsx(I,{children:t.jsx(_,{children:"혈중 약물 농도"})}),t.jsxs(P,{children:[t.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!r)return;if(!N.testDate||!N.concentration)return;const t=N.testDate.trim().replace(/[-: ]/g,"");if(!/^\d{12}$/.test(t))return void alert("날짜와 시간 형식이 올바르지 않습니다. 예: 2025-09-01 14:00 또는 202509011400");const n=`${t.slice(0,4)}-${t.slice(4,6)}-${t.slice(6,8)}`,a=`${t.slice(8,10)}:${t.slice(10,12)}`;if(n>M)return void alert("날짜는 오늘 이후로 입력할 수 없습니다.");const s=Za(`${n} ${a}`,"YYYY-MM-DD HH:mm").toDate(),o=p.find(e=>e.isSelected),l={id:Date.now().toString(),patientId:r.id,drugName:(null==w?void 0:w.drugName)||"",concentration:parseFloat(N.concentration),unit:N.unit,timeAfterDose:0,testDate:s,measurementType:N.measurementType,creatinine:(null==o?void 0:o.result)||void 0,dialysis:(null==o?void 0:o.dialysis)||void 0,renalReplacement:(null==o?void 0:o.renalReplacement)||void 0};i(l);const d="Vancomycin"===(null==w?void 0:w.drugName)?"mg/L":"ng/mL";C({testDate:"",testTime:"",concentration:"",unit:d,measurementType:"Trough"})},className:"flex flex-col md:flex-row gap-4 items-end",children:[t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"drugDateTime",children:"날짜/시간"}),t.jsx(O,{id:"drugDateTime",type:"text",value:N.testDate,placeholder:"예: 2025-07-25 14:00 또는 202507251400",onChange:e=>C({...N,testDate:e.target.value}),max:M+" 23:59"})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"concentration",children:"농도"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(O,{id:"concentration",type:"number",step:"0.01",value:N.concentration,onChange:e=>C({...N,concentration:e.target.value}),className:"flex-1"}),t.jsxs(Ur,{value:N.unit,onValueChange:e=>C({...N,unit:e}),children:[t.jsx(Wr,{className:"w-24",children:t.jsx(zr,{})}),t.jsx(Xr,{children:"Vancomycin"===(null==w?void 0:w.drugName)?t.jsxs(t.Fragment,{children:[t.jsx(qr,{value:"mg/L",children:"mg/L"}),t.jsx(qr,{value:"μg/mL",children:"ng/mL"}),t.jsx(qr,{value:"μg/mL",children:"μg/mL"})]}):t.jsxs(t.Fragment,{children:[t.jsx(qr,{value:"mg/L",children:"mg/L"}),t.jsx(qr,{value:"ng/mL",children:"ng/mL"}),t.jsx(qr,{value:"μg/L",children:"μg/L"})]})})]})]})]}),t.jsxs("div",{children:[t.jsx(bt,{htmlFor:"measurementType",children:"측정 기준"}),t.jsxs(Ur,{value:N.measurementType,onValueChange:e=>C({...N,measurementType:e}),children:[t.jsx(Wr,{children:t.jsx(zr,{placeholder:"측정 기준 선택"})}),t.jsxs(Xr,{children:[t.jsx(qr,{value:"Trough",children:"Trough"}),t.jsx(qr,{value:"Peak",children:"Peak"})]})]})]}),t.jsx(A,{type:"submit",children:"추가"})]}),k.length>0&&t.jsx("div",{className:"mt-4",children:t.jsxs(Jr,{children:[t.jsx(Zr,{children:t.jsxs(ea,{children:[t.jsx(ta,{children:"날짜"}),t.jsx(ta,{children:"시간"}),t.jsx(ta,{children:"농도"}),t.jsx(ta,{children:"측정 기준"}),t.jsx(ta,{className:"w-16",children:"삭제"})]})}),t.jsx(Qr,{children:k.map(e=>t.jsxs(ea,{children:[t.jsx(na,{children:e.testDate.toLocaleDateString()}),t.jsx(na,{children:e.testDate.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t.jsxs(na,{children:[e.concentration," ",e.unit]}),t.jsx(na,{children:e.measurementType||"-"}),t.jsx(na,{children:t.jsx(A,{variant:"ghost",size:"icon",onClick:()=>s(e.id),children:t.jsx(K,{className:"h-4 w-4"})})})]},e.id))})]})})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs(A,{variant:"outline",onClick:d,className:"flex items-center gap-2",children:[t.jsx(ee,{className:"h-4 w-4"}),"TDM 선택"]}),c&&t.jsxs(A,{onClick:()=>{if("Vancomycin"===(null==w?void 0:w.drugName)){if(!p.some(e=>e.isSelected))return void alert("신기능 데이터를 입력해주세요.")}l()},className:"flex items-center gap-2 w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center",children:["투약 기록",t.jsx(J,{className:"h-4 w-4"})]})]})]})]}),r&&t.jsx(ss,{open:S,onOpenChange:T,children:t.jsxs(ds,{className:"transform scale-[1.5]",children:[t.jsxs(cs,{children:[t.jsx(ms,{children:t.jsx("div",{className:"text-center",children:"혈중 약물 농도 측정 가이드"})}),t.jsx(fs,{children:t.jsxs("div",{className:"text-center",children:[r.name," 환자는 고위험군 환자입니다.",t.jsx("br",{}),"가이드에 맞게 측정되었는지 확인 후 혈중 약물 농도를 입력해 주세요."]})})]}),t.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-4",children:[t.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-accent w-1/2",children:[t.jsx("h2",{className:"font-semibold text-lg text-center mb-2",children:"Check point"}),t.jsxs("ul",{className:"list-disc list-inside text-sm space-y-1",children:[t.jsx("li",{className:"text-gray-700",children:"투석 여부: Y"}),t.jsx("li",{className:"text-gray-700",children:"신 대체요법: CRRT"})]})]}),t.jsx(J,{className:"h-6 w-6 text-gray-500"}),t.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-accent w-1/2",children:[t.jsx("h2",{className:"font-semibold text-lg text-center mb-2",children:"Guide"}),t.jsx("ul",{className:"text-sm space-y-1 text-center",children:t.jsx("li",{className:"text-gray-700",children:"투약 2시간 후 최고 흡수 농도 측정 권고(C2)"})})]})]}),t.jsx(us,{children:t.jsx("div",{className:"flex justify-center w-full",children:t.jsx(ps,{onClick:()=>T(!1),className:"w-[calc(100%)]",children:"확인"})})})]})})]}):t.jsx(R,{children:t.jsx(P,{className:"py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx(te,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"환자를 먼저 선택해 주세요."})]})})})},xs=({simulationData:e,showSimulation:n,currentPatientName:r,selectedDrug:a,chartTitle:i="용법 조정 시뮬레이션",targetMin:s,targetMax:o,recentAUC:l,recentMax:d,recentTrough:c,predictedAUC:u,predictedMax:m,predictedTrough:f,ipredSeries:p,predSeries:h,observedSeries:g,chartColor:x="pink",tdmIndication:v,tdmTarget:b,tdmTargetValue:j,latestAdministration:y,drugAdministrations:w=[],currentMethodSeries:N=[],isEmptyChart:C=!1,selectedButton:S})=>{const T=()=>{if(!w||0===w.length)return new Date;const e=w.filter(e=>e.drugName===a).sort((e,t)=>new Date(`${e.date}T${e.time}`).getTime()-new Date(`${t.date}T${t.time}`).getTime());return e.length>0?new Date(`${e[0].date}T${e[0].time}`):new Date},k=D.useMemo(()=>{if(!w||0===w.length)return[0,8,16,24,32,40,48,56,64,72];const e=T(),t=w.filter(e=>e.drugName===a).map(t=>{const n=new Date(`${t.date}T${t.time}`);return{time:(n.getTime()-e.getTime())/36e5,dateTime:n}}).sort((e,t)=>e.time-t.time),n=t.map(e=>e.time);if(t.length>0){const e=Math.max(...n),r=t.length>1?t[1].time-t[0].time:12,a=[];let i=e+r;for(;i<=72;)a.push(i),i+=r;return[...n,...a].sort((e,t)=>e-t)}return n},[w,a]),M=D.useMemo(()=>{if(!w||0===w.length)return null;const e=w.filter(e=>e.drugName===a).map(e=>{const t=new Date(`${e.date}T${e.time}`),n=T();return(t.getTime()-n.getTime())/36e5}).sort((e,t)=>e-t);return e.length>0?Math.max(...e):null},[w,a]),E=e=>{if(!w||0===w.length)return`${e}h`;const t=T();return new Date(t.getTime()+60*e*60*1e3).toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/\. /g,".")},A=D.useMemo(()=>{if(C)return[];if(p&&p.length||h&&h.length||g&&g.length||N&&N.length){const e=new Map,t=t=>{const n=Number(t)||0,r=e.get(n);if(r)return r;const a={time:n,predicted:0,observed:null,controlGroup:0,averageLine:0,currentMethod:0};return e.set(n,a),a},n="Cyclosporin"===a?1e3:1;for(const r of p||[]){const e=Number(r.time)||0,a=(Number(r.value)||0)*n;t(e).predicted=a}for(const r of N||[]){const e=Number(r.time)||0,a=(Number(r.value)||0)*n;t(e).currentMethod=a}for(const r of g||[]){const e=Number(r.time)||0,a=Number(r.value)*n;t(e).observed=a}return Array.from(e.values()).sort((e,t)=>e.time-t.time)}return e},[e,p,h,g,N,C]),$=l??335,O=d??29,L=c??5,F=u??490,V=m??38,H=f??18,K=(()=>{if(!A||A.length<2)return null;const e=[...A].sort((e,t)=>e.time-t.time),t=e[0].time,n=e[e.length-1].time-t;if(n<=0)return null;let r=0;for(let a=1;a<e.length;a++){const t=e[a].time-e[a-1].time;if(t<=0)continue;r+=((e[a-1].predicted??0)+(e[a].predicted??0))/2*t}return r/n})(),B=D.useMemo(()=>K?A.map(e=>({...e,averageLine:K})):A,[A,K]),U=D.useMemo(()=>{const e=(A||[]).reduce((e,t)=>{const n=[t.predicted,t.observed??0].filter(e=>"number"==typeof e),r=n.length?Math.max(...n):0;return Math.max(e,r)},0),t="number"==typeof o?o:0,n=Math.max(e,t);return n<=.2?.2:Math.ceil(1.2*n*10)/10},[A,o]),z={pink:{stroke:"#ec4899",fill:"#ec4899",fillOpacity:.3},green:{stroke:"#22c55e",fill:"#22c55e",fillOpacity:.3}}[x],W=e=>{switch(e){case"Vancomycin":default:return"mg/L";case"Cyclosporin":return"ng/mL"}},G=()=>{const e=(null==b?void 0:b.toLowerCase())||"";return e.includes("auc")?{value:null!=F?`${Math.round(F).toLocaleString()} mg*h/L`:"-",unit:"mg*h/L",numericValue:F}:e.includes("max")||e.includes("peak")?{value:null!=V?`${V} ${W(a)}`:"-",unit:W(a),numericValue:V}:e.includes("trough")?{value:null!=H?`${H} ${W(a)}`:"-",unit:W(a),numericValue:H}:{value:null!=F?`${Math.round(F).toLocaleString()} mg*h/L`:"-",unit:"mg*h/L",numericValue:F}};return t.jsxs("div",{className:"w-full",children:[!C&&t.jsxs("div",{className:"flex justify-center gap-6 mb-4",children:[N&&N.length>0&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-0.5 bg-blue-500"}),t.jsxs("span",{className:"text-sm text-gray-600",children:[r||"환자","의 현용법"]})]}),p&&p.length>0&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-0.5",style:{backgroundColor:z.stroke,opacity:1}}),t.jsx("span",{className:"text-sm text-gray-600",children:"용법 조정 결과"})]}),g&&g.length>0&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:"#dc2626"}}),t.jsx("span",{className:"text-sm text-gray-600",children:"실제 혈중 농도"})]}),!("Vancomycin"===a&&(null==b?void 0:b.toLowerCase().includes("auc")))&&"number"==typeof K&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-0.5 border-dashed border-t-2 border-gray-500"}),t.jsx("span",{className:"text-sm text-gray-600",children:"평균 농도"})]}),null!==s&&null!==o&&o>s&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-4 bg-blue-500 bg-opacity-20"}),t.jsx("span",{className:"text-sm text-gray-600",children:"TDM 목표치"})]})]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("div",{className:"h-96 "+(C?"":"overflow-x-auto overflow-y-hidden"),children:t.jsx("div",{className:"h-full "+(C?"":"min-w-[1800px]"),style:C?{}:{width:"300%"},children:t.jsx(fe,{width:"100%",height:"100%",children:"Vancomycin"===a&&(null==b?void 0:b.toLowerCase().includes("auc"))?t.jsxs(pe,{data:B,children:[t.jsx(he,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),t.jsx(ge,{dataKey:"time",tick:{fontSize:12},domain:C?[0,24]:[0,72],type:"number",scale:"linear",ticks:C?[0,4,8,12,16,20,24]:k,tickFormatter:E,interval:"preserveStartEnd"}),t.jsx(xe,{label:{value:"Concentration(mg/L)",angle:-90,position:"outside",style:{textAnchor:"middle"},offset:10},tick:{fontSize:12},domain:[0,U],tickCount:6,tickFormatter:e=>`${e.toFixed(2)}`,width:80}),null!==s&&null!==o&&o>s&&t.jsx(ve,{y1:s,y2:o,fill:"#3b82f6",fillOpacity:.1}),M&&t.jsx(be,{x:M,stroke:"#ff6b6b",strokeWidth:2,strokeDasharray:"5 5",label:{value:"실제 투약",position:"top",offset:10}}),"number"==typeof K&&t.jsx(je,{type:"monotone",dataKey:"averageLine",stroke:"#808080",strokeDasharray:"5 5",strokeWidth:.5,name:"평균 약물 농도",dot:!1}),t.jsx(ye,{formatter:(e,t)=>"실제 혈중 농도"===t?[`${e.toFixed(2)} mg/L`,"실제 혈중 농도"]:["number"==typeof e?`${e.toFixed(2)} mg/L`:"N/A","환자 현용법"===t?"용법 조정 후 농도":"평균 약물 농도"===t?"평균 농도":"실제값"],labelFormatter:(e,n)=>{const r=n&&n[0]&&n[0].payload;if(r&&null!==r.observed&&void 0!==r.observed&&r.actualTestTime)return t.jsxs("strong",{children:["검사 시간: ",r.actualTestTime]});if(w&&w.length>0){const n=T(),r=new Date(n.getTime()+60*Number(e)*60*1e3).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/\. /g,".");return t.jsxs("strong",{children:["투약 일시: ",r]})}return t.jsxs("strong",{children:["투약 ",Math.round(Number(e)),"시간 경과"]})}}),t.jsx(je,{type:"monotone",dataKey:"currentMethod",stroke:"#3b82f6",strokeWidth:2,name:"환자 현용법",dot:!1}),t.jsx(we,{type:"monotone",dataKey:"predicted",stroke:z.stroke,fill:z.fill,fillOpacity:z.fillOpacity,strokeWidth:2,name:"용법 조정 결과"}),t.jsx(je,{type:"monotone",dataKey:"observed",stroke:"#dc2626",strokeWidth:0,dot:{fill:"#dc2626",r:4},name:"실제 혈중 농도"})]}):t.jsxs(Ne,{data:B,children:[t.jsx(he,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),t.jsx(ge,{dataKey:"time",tick:{fontSize:12},domain:C?[0,24]:[0,72],type:"number",scale:"linear",ticks:C?[0,4,8,12,16,20,24]:k,tickFormatter:E,interval:"preserveStartEnd"}),t.jsx(xe,{label:{value:"Concentration(ng/mL)",angle:-90,position:"outside",style:{textAnchor:"middle"},offset:10},tick:{fontSize:12},domain:[0,U],tickCount:6,tickFormatter:e=>`${Math.round(e)}`,width:80}),null!==s&&null!==o&&o>s&&t.jsx(ve,{y1:s,y2:o,fill:"#3b82f6",fillOpacity:.1}),M&&t.jsx(be,{x:M,stroke:"#ff6b6b",strokeWidth:2,strokeDasharray:"5 5",label:{value:"실제 투약",position:"top",offset:10}}),"number"==typeof K&&t.jsx(je,{type:"monotone",dataKey:"averageLine",stroke:"#808080",strokeDasharray:"5 5",strokeWidth:.5,name:"평균 약물 농도",dot:!1}),t.jsx(ye,{formatter:(e,t)=>"실제 혈중 농도"===t?[`${e.toFixed(2)} ng/mL`,"실제 혈중 농도"]:["number"==typeof e?`${e.toFixed(2)} ng/mL`:"N/A","환자 현용법"===t?"조정 농도":"평균 약물 농도"===t?"평균 농도":"실제값"],labelFormatter:(e,n)=>{const r=n&&n[0]&&n[0].payload;if(r&&null!==r.observed&&void 0!==r.observed&&r.actualTestTime)return t.jsxs("strong",{children:["검사 시간: ",r.actualTestTime]});if(w&&w.length>0){const n=T(),r=new Date(n.getTime()+60*Number(e)*60*1e3).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/\. /g,".");return t.jsxs("strong",{children:["투약 일시: ",r]})}return t.jsxs("strong",{children:["투약 ",Math.round(Number(e)),"시간 경과"]})}}),t.jsx(je,{type:"monotone",dataKey:"currentMethod",stroke:"#3b82f6",strokeWidth:2,name:"환자 현용법",dot:!1}),t.jsx(je,{type:"monotone",dataKey:"predicted",stroke:z.stroke,strokeWidth:2,name:"용법 조정 결과",dot:!1}),t.jsx(je,{type:"monotone",dataKey:"observed",stroke:"#dc2626",strokeWidth:2,dot:{fill:"#dc2626",r:4,strokeWidth:0},name:"실제 혈중 농도",connectNulls:!1})]})})})}),!C&&t.jsx("div",{className:"flex justify-center mt-2",children:t.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"투약 일시"})})]}),!C&&t.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-8"}),!C&&t.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/30 rounded-lg p-6 mb-6 border border-slate-200 dark:border-slate-700 mt-4",children:[t.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-slate-200 mb-4 flex items-center gap-2",children:"TDM Summary"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[t.jsxs(R,{className:"bg-white border-2",children:[t.jsx(I,{className:"pb-2",children:t.jsx(_,{className:"text-lg text-gray-800",children:"최근 혈중 약물 농도"})}),t.jsxs(P,{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"AUC:"}),t.jsx("span",{className:"font-semibold",children:null!=$?`${Math.round($).toLocaleString()} mg*h/L`:"-"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"max 농도:"}),t.jsx("span",{className:"font-semibold",children:null!=O?`${O} ${W(a)}`:"-"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"trough 농도:"}),t.jsx("span",{className:"font-semibold",children:null!=L?`${L} ${W(a)}`:"-"})]})]})]}),t.jsxs(R,{className:"bg-white border-2",children:[t.jsx(I,{className:"pb-2",children:t.jsx(_,{className:"text-lg text-gray-800",children:"예측 약물 농도"})}),t.jsxs(P,{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"AUC:"}),t.jsx("span",{className:"font-semibold",children:null!=F?`${Math.round(F).toLocaleString()} mg*h/L`:"-"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"max 농도:"}),t.jsx("span",{className:"font-semibold",children:null!=V?`${V} ${W(a)}`:"-"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"trough 농도:"}),t.jsx("span",{className:"font-semibold",children:null!=H?`${H} ${W(a)}`:"-"})]})]})]})]}),t.jsxs(R,{className:"bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700",children:[t.jsx(I,{className:"pb-3",children:t.jsx(_,{className:"text-lg text-slate-800 dark:text-slate-200 flex items-center gap-2",children:"용법 조정 결과"})}),t.jsxs(P,{className:"space-y-1.5 text-sm text-gray-700 dark:text-gray-300",children:[t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-800 dark:bg-gray-200 rounded-full mt-2 flex-shrink-0"}),t.jsxs("p",{className:"leading-relaxed",children:[v||"적응증","의 ",a||"약물명"," 처방 시 TDM 목표는",t.jsxs("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:[" ",b||"목표 유형"," (",j||"목표값",")"]}),"입니다."]})]}),t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-800 dark:bg-gray-200 rounded-full mt-2 flex-shrink-0"}),t.jsxs("p",{className:"leading-relaxed",children:[t.jsxs("span",{className:"font-semibold",children:["현 용법 ",(null==y?void 0:y.intervalHours)||"시간"," 간격으로 ",(null==y?void 0:y.dose)||0,(null==y?void 0:y.unit)||"mg"," 투약 시"]})," Steady State까지 TDM 목표 ",t.jsx("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:b||"목표 유형"}),"는",t.jsxs("span",{className:"font-semibold text-red-600 dark:text-red-400",children:[" ",G().value]}),"으로",(()=>{const e=G(),t=j||"";if(!t||!e.numericValue)return!0;const n=t.match(/(\d+(?:\.\d+)?)\s*-\s*(\d+(?:\.\d+)?)/);if(!n)return!0;const r=parseFloat(n[1]),a=parseFloat(n[2]),i=e.numericValue;return i>=r&&i<=a})()?t.jsx(t.Fragment,{children:" 적절한 용법입니다."}):t.jsx(t.Fragment,{children:" 치료 범위를 벗어납니다."})]})]})]})]})]})]})},vs=(e,t)=>new Date(`${e}T${t}`),bs=(e,t)=>(e.getTime()-t.getTime())/36e5,js=e=>{try{if(!e)return null;const t=window.localStorage.getItem(`tdmfriends:renal:${e}`);if(!t)return null;const n=JSON.parse(t);return n.find(e=>e.isSelected)||n[n.length-1]||null}catch{return null}},ys=(e,t)=>e&&t?Math.sqrt(t*e/3600):1.73,ws=e=>{if(!e)return e;return(e.charAt(0).toLowerCase()+e.slice(1)).replace(/-/g,"_")},Ns={Vancomycin:{"Not specified/Korean":{default:"Vancomycin1-1",CRRT:"Vancomycin1-2"},"Neurosurgical patients/Korean":{default:"Vancomycin2-1",within72h:"Vancomycin2-2"}},Cyclosporin:{"Renal transplant recipients/Korean":{"POD ~2":"Cyclosporin1-1","POD 3~6":"Cyclosporin1-2","POD 7~":"Cyclosporin1-3",default:"Cyclosporin1-1"},"Allo-HSCT/Korean":"Cyclosporin2","Thoracic transplant recipients/European":"Cyclosporin3"}},Cs=e=>{if(!e)return 0;const{isIVInfusion:t,infusionTime:n,dose:r}=e;return t&&"number"==typeof n&&n>0?r/(n/60):0},Ds=e=>{const{patients:t,prescriptions:n,bloodTests:r,drugAdministrations:a,selectedPatientId:i,selectedDrugName:s,overrides:o}=e,l=t.find(e=>e.id===i),d=n.find(e=>e.patientId===i&&(!s||e.drugName===s))||n.find(e=>e.patientId===i);if(!l||!d)return null;const c=l.weight,u=l.age,m="male"===l.gender?1:0,f=l.height,p=((e,t,n,r,a)=>{const i=js(e);if(i){const e=parseFloat((i.result||"").toString().replace(/[^0-9.-]/g,""));if(!Number.isNaN(e)&&e>0)return e;const s=parseFloat((i.creatinine||"").toString());if(!Number.isNaN(s)&&s>0){const e=0===r;if("cockcroft-gault"===i.formula){const r=(140-n)*t/(72*s);return e?.85*r:r}if("mdrd"===i.formula){const r=ys(a,t);return 175*Math.pow(s,-1.154)*Math.pow(n,-.203)*(e?.742:1)*(r/1.73)}if("ckd-epi"===i.formula){const r=ys(a,t),i=e?.7:.9,o=e?-.329:-.411,l=Math.min(s/i,1),d=Math.max(s/i,1);return 141*Math.pow(l,o)*Math.pow(d,-1.209)*Math.pow(.993,n)*(e?1.018:1)*(r/1.73)}const o=(140-n)*t/(72*s);return e?.85*o:o}}return 90})(i,c,u,m,f),h=(a||[]).filter(e=>e.patientId===i),g=(e=>{if(!e||e.length<2)return;const t=[...e].sort((e,t)=>vs(e.date,e.time).getTime()-vs(t.date,t.time).getTime()),n=t[t.length-1],r=t[t.length-2],a=bs(vs(n.date,n.time),vs(r.date,r.time));return a>0?a:void 0})(h),x=h.length>0?[...h].sort((e,t)=>vs(e.date,e.time).getTime()-vs(t.date,t.time).getTime())[h.length-1]:void 0,v=x?x.dose:void 0,b=(null==o?void 0:o.amount)??v,j=g,y=(null==o?void 0:o.tau)??j,{auc:w,trough:N}=((e,t)=>{if(!t)return{};const n=(t.match(/\d+\.?\d*/g)||[]).map(e=>parseFloat(e));if(0===n.length)return{};const r=1===n.length?n[0]:(n[0]+n[1])/2;return e&&e.toLowerCase().includes("auc")?{auc:r}:e&&e.toLowerCase().includes("trough")?{trough:r}:{}})(d.tdmTarget,d.tdmTargetValue),C=Cs(x),D=C,S=(d.route||"").toLowerCase(),T=S.includes("po")||S.includes("경구")?2:1,k=[],M=[...h].sort((e,t)=>vs(e.date,e.time).getTime()-vs(t.date,t.time).getTime()),R=M.length>0?vs(M[0].date,M[0].time):void 0;if(M.length>0&&R)for(const P of M){const e=P,t=Math.max(0,bs(vs(P.date,P.time),R)),n=Cs(e),r=e.route.includes("po")||e.route.includes("경구")?2:1;k.push({ID:i,TIME:t,DV:null,AMT:P.dose,RATE:n,CMT:r,WT:c,SEX:m,AGE:u,CRCL:p,TOXI:1,EVID:1})}else void 0!==b&&k.push({ID:i,TIME:0,DV:null,AMT:b,RATE:0,CMT:T,WT:c,SEX:m,AGE:u,CRCL:p,TOXI:1,EVID:1});const I=R||(M.length>0?vs(M[0].date,M[0].time):new Date),_=s?r.filter(e=>e.patientId===i&&e.drugName===s):r.filter(e=>e.patientId===i);if(_.length>0)for(const P of _){const e=bs(P.testDate,I),t=P.unit&&P.unit.toLowerCase().includes("ng/ml")?P.concentration/1e3:P.concentration;k.push({ID:i,TIME:e,DV:t,AMT:0,RATE:0,CMT:T,WT:c,SEX:m,AGE:u,CRCL:p,TOXI:1,EVID:0})}else k.push({ID:i,TIME:y??2,DV:null,AMT:0,RATE:0,CMT:T,WT:c,SEX:m,AGE:u,CRCL:p,TOXI:1,EVID:0});const E=(e=>{const{patientId:t,drugName:n,indication:r,additionalInfo:a,lastDoseDate:i}=e;if(!n||!r)return;const s=Ns[n];if(!s)return;const o=js(t),l=/crrt/i.test((null==o?void 0:o.renalReplacement)||""),d=!!i&&((new Date).getTime()-i.getTime())/36e5<=72,c=s[r];if(c){if("string"==typeof c)return ws(c);if("Vancomycin"===n)return l&&c.CRRt?ws(c.CRRt):l&&c.CRRT?ws(c.CRRT):d&&c.within72h?ws(c.within72h):ws(c.default);if("Cyclosporin"===n){const e=null==a?void 0:a.trim(),t=e&&c[e]||c.default;return t?ws(t):void 0}return"string"==typeof c.default?ws(c.default):void 0}})({patientId:i,drugName:d.drugName,indication:d.indication,additionalInfo:d.additionalInfo,lastDoseDate:x?vs(x.date,x.time):void 0});return{input_tau:y??12,input_amount:b??100,input_WT:c,input_CRCL:p,input_AGE:u,input_SEX:m,input_TOXI:1,input_AUC:w??void 0,input_CTROUGH:N??void 0,input_tau_before:j??y??12,input_amount_before:v??b??100,input_rate_before:C,input_cmt_before:T,input_tau_after:y??j??12,input_amount_after:b??v??100,input_rate_after:D,input_cmt_after:T,model_name:E,dataset:k}},Ss=async e=>{const{body:t,persist:n,patientId:r,drugName:a}=e,i=await fetch("https://b74ljng162.apigw.ntruss.com/tdm/prod/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok)throw new Error(`TDM API error: ${i.status}`);const s=await i.json();if(n&&r)try{if(window.localStorage.setItem(`tdmfriends:tdmResult:${r}`,JSON.stringify(s)),a){const e=`tdmfriends:tdmResults:${r}:${a}`,n=window.localStorage.getItem(e),i=n?JSON.parse(n):[],o=t,l={id:`${Date.now()}`,timestamp:(new Date).toISOString(),model_name:null==o?void 0:o.model_name,summary:{AUCtau_before:(null==s?void 0:s.AUCtau_before)??(null==s?void 0:s.AUC_before),AUC24h_before:null==s?void 0:s.AUC24h_before,CMAX_before:null==s?void 0:s.CMAX_before,CTROUGH_before:null==s?void 0:s.CTROUGH_before,AUCtau_after:(null==s?void 0:s.AUCtau_after)??(null==s?void 0:s.AUC_after),AUC24h_after:null==s?void 0:s.AUC24h_after,CMAX_after:null==s?void 0:s.CMAX_after,CTROUGH_after:null==s?void 0:s.CTROUGH_after},dataset:(null==o?void 0:o.dataset)||[],data:s};i.push(l),window.localStorage.setItem(e,JSON.stringify(i)),window.localStorage.setItem(`tdmfriends:tdmResult:${r}:${a}`,JSON.stringify(s))}}catch(o){}return s},Ts=[{name:"Vancomycin",indications:["Not specified/Korean","Neurosurgical patients/Korean"],targets:[{type:"Trough Concentration",value:"10-20 mg/L"},{type:"Peak Concentration",value:"25-40 mg/L"},{type:"AUC",value:"400-600 mg·h/L"}],defaultTargets:{"Not specified/Korean":{type:"AUC",value:"400-600 mg·h/L"},"Neurosurgical patients/Korean":{type:"AUC",value:"400-600 mg·h/L"}}},{name:"Cyclosporin",indications:["Renal transplant recipients/Korean","Allo-HSCT/Korean","Thoracic transplant recipients/European"],targets:[{type:"Trough Concentration",value:"100-400 ng/mL"},{type:"Peak Concentration",value:"800-1200 ng/mL"},{type:"C2 Concentration",value:"1200-1700 ng/mL"}],defaultTargets:{"Allo-HSCT/Korean":{type:"Trough Concentration",value:"150-400 ng/mL"},"Thoracic transplant recipients/European":{type:"Trough Concentration",value:"170-230 ng/mL"},"Renal transplant recipients/Korean":{type:"Trough Concentration",value:"100-400 ng/mL"}}}],ks=({patients:e,prescriptions:n,bloodTests:r,selectedPatient:a,selectedPrescription:i,drugAdministrations:s=[],onDownloadPDF:o})=>{const[l,d]=D.useState((null==a?void 0:a.id)||""),[c,u]=D.useState((null==i?void 0:i.drugName)||""),m=a&&i?s.filter(e=>e.patientId===a.id&&e.drugName===i.drugName):[],f=m.length>0?[...m].sort((e,t)=>new Date(`${e.date}T${e.time}`).getTime()-new Date(`${t.date}T${t.time}`).getTime())[m.length-1]:null,[p,h]=D.useState({dose:"",halfLife:"",clearance:"",volumeDistribution:""}),[g,x]=D.useState(!1);D.useRef(null),D.useState("250"),D.useState(""),D.useState("mg"),D.useState(""),D.useState("6"),D.useState("current");const[v,b]=D.useState(null),[j,y]=D.useState([]),[w,N]=D.useState([]),[C,S]=D.useState([]),[T,k]=D.useState(null);D.useState(null),D.useState(null);const[M,R]=D.useState(null),[I,_]=D.useState(null),[E,P]=D.useState([]),[$,O]=D.useState({}),[L,F]=D.useState({}),[V,H]=D.useState(!1),[K,B]=D.useState(null),[U,z]=D.useState({}),[W,G]=D.useState({}),[Y,X]=D.useState({}),q=D.useRef({}),[J,Z]=D.useState({}),Q=e.find(e=>e.id===l),ee=D.useMemo(()=>l?n.filter(e=>e.patientId===l):[],[l,n]),te=D.useMemo(()=>l&&i?r.filter(e=>e.patientId===l&&e.drugName===i.drugName):[],[l,i,r]),ne=D.useCallback(e=>{var t,n,r,a,i,s,o,l,d;const c=ee.find(t=>t.drugName===e),u=Ts.find(t=>t.name===e);return{indication:(null==c?void 0:c.indication)||(null==(t=null==u?void 0:u.indications)?void 0:t[0])||"적응증",target:(null==c?void 0:c.tdmTarget)||(null==(r=null==(n=null==u?void 0:u.defaultTargets)?void 0:n[(null==c?void 0:c.indication)||""])?void 0:r.type)||(null==(i=null==(a=null==u?void 0:u.targets)?void 0:a[0])?void 0:i.type)||"목표 유형",targetValue:(null==c?void 0:c.tdmTargetValue)||(null==(o=null==(s=null==u?void 0:u.defaultTargets)?void 0:s[(null==c?void 0:c.indication)||""])?void 0:o.value)||(null==(d=null==(l=null==u?void 0:u.targets)?void 0:l[0])?void 0:d.value)||"목표값",dosage:(null==c?void 0:c.dosage)||0,unit:(null==c?void 0:c.unit)||"mg",frequency:(null==c?void 0:c.frequency)||"시간"}},[ee]),re=D.useMemo(()=>Array.from(new Set([...ee.map(e=>e.drugName),...te.map(e=>e.drugName)])),[ee,te]);D.useEffect(()=>{re.length>0&&!c&&u(re[0])},[re,c]);const ae=D.useMemo(()=>c?te.filter(e=>e.drugName===c):[],[c,te]),ie=te.length>0?[...te].sort((e,t)=>new Date(t.testDate).getTime()-new Date(e.testDate).getTime())[0]:null;(()=>{var e;if(!p.dose||!p.halfLife)return[];const t=parseFloat(p.dose),n=.693/parseFloat(p.halfLife),r=[];for(let a=0;a<=24;a+=.5){const i=t*Math.exp(-n*a);r.push({time:a,predicted:i,observed:(null==(e=ae.find(e=>Math.abs(e.timeAfterDose-a)<.5))?void 0:e.concentration)||null})}})();(()=>{var e;if(ae.length<2)return null;const t=[...ae].sort((e,t)=>e.timeAfterDose-t.timeAfterDose),n=t[0],r=t[t.length-1];if(n.timeAfterDose===r.timeAfterDose)return null;const a=Math.log(n.concentration/r.concentration)/(r.timeAfterDose-n.timeAfterDose),i=.693/a,s=ae.reduce((e,t,n)=>{if(0===n)return 0;const r=ae[n-1];return e+(t.concentration+r.concentration)*(t.timeAfterDose-r.timeAfterDose)/2},0);i.toFixed(2),a.toFixed(4),s.toFixed(2),Math.max(...ae.map(e=>e.concentration)).toFixed(2),null==(e=ae.find(e=>e.concentration===Math.max(...ae.map(e=>e.concentration))))||e.timeAfterDose.toFixed(1)})();const se=(e,t)=>{F(n=>({...n,[e]:t})),z(t=>({...t,[e]:!0}));try{const e=parseInt(t.replace(/[^0-9]/g,""),10);Number.isFinite(e)&&ge(e)}catch{}},oe=D.useCallback(()=>{try{if(!l)return null;const e=window.localStorage.getItem(`tdmfriends:renal:${l}`);if(!e)return null;const t=JSON.parse(e);return t.find(e=>e.isSelected)||t[t.length-1]||null}catch{return null}},[l]),le=D.useCallback((e,t,n)=>{const r=oe();if(r){const a=parseFloat((r.result||"").toString().replace(/[^0-9.-]/g,""));if(!Number.isNaN(a)&&a>0)return a;const i=parseFloat((r.creatinine||"").toString()),s=0===n,o=(null==Q?void 0:Q.height)??0,l=o>0&&e>0?Math.sqrt(e*o/3600):1.73;if(!Number.isNaN(i)&&i>0){if("cockcroft-gault"===r.formula){const n=(140-t)*e/(72*i);return s?.85*n:n}if("mdrd"===r.formula){return 175*Math.pow(i,-1.154)*Math.pow(t,-.203)*(s?.742:1)*(l/1.73)}if("ckd-epi"===r.formula){const e=s?.7:.9,n=s?-.329:-.411,r=Math.min(i/e,1),a=Math.max(i/e,1);return 141*Math.pow(r,n)*Math.pow(a,-1.209)*Math.pow(.993,t)*(s?1.018:1)*(l/1.73)}const n=(140-t)*e/(72*i);return s?.85*n:n}}return 90},[Q,oe]),ue=(e,t)=>new Date(`${e}T${t}`),me=(e,t)=>(e.getTime()-t.getTime())/36e5,fe=D.useCallback(e=>{if(e.length<2)return;const t=[...e].sort((e,t)=>ue(e.date,e.time).getTime()-ue(t.date,t.time).getTime()),n=t[t.length-1],r=t[t.length-2],a=me(ue(n.date,n.time),ue(r.date,r.time));return a>0?a:void 0},[]),pe=D.useCallback((e,t)=>{try{const n=(null==e?void 0:e.IPRED_CONC)||[],r=(null==e?void 0:e.PRED_CONC)||[],a=new Map,i=e=>{const t=Number(e)||0,n=a.get(t);if(n)return n;const r={time:t,predicted:0,observed:null,controlGroup:0};return a.set(t,r),r};for(const e of n){const t=Number(e.time)||0,n=Number(e.IPRED??0)||0;i(t).predicted=n}for(const e of r){const t=Number(e.time)||0,n=Number(e.PRED??e.IPRED??0)||0;i(t).controlGroup=n}if(t&&t.length>0)for(const e of t)if(0===e.EVID&&null!=e.DV){const t=Number(e.TIME)||0,n=Number(e.DV);i(t).observed=n}return Array.from(a.values()).sort((e,t)=>e.time-t.time)}catch{return[]}},[]),he=D.useCallback(async t=>{try{if(!l||!c)return;x(!1);const a=Ds({patients:e,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:l,selectedDrugName:c,overrides:{amount:t}});if(!a)return;const i=await Ss({body:a,persist:!0,patientId:l,drugName:c});b(i),y(pe(i,a.dataset||[])),k({ipredSeries:((null==i?void 0:i.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==i?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(a.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==i?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)});try{const e=`tdmfriends:tdmExtraSeries:${l}:${c}`;window.localStorage.setItem(e,JSON.stringify({ipredSeries:(null==i?void 0:i.IPRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:(null==i?void 0:i.PRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(a.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:(null==i?void 0:i.PRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}))}catch{}x(!0)}catch(a){}},[e,n,r,s,l,c,pe]),ge=D.useCallback(async t=>{try{if(!l||!c)return;x(!1);const a=Ds({patients:e,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:l,selectedDrugName:c,overrides:{tau:t}});if(!a)return;const i=await Ss({body:a,persist:!0,patientId:l,drugName:c});b(i),y(pe(i,a.dataset||[])),k({ipredSeries:((null==i?void 0:i.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==i?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(a.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==i?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)});try{const e=`tdmfriends:tdmExtraSeries:${l}:${c}`;window.localStorage.setItem(e,JSON.stringify({ipredSeries:(null==i?void 0:i.IPRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:(null==i?void 0:i.PRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(a.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:(null==i?void 0:i.PRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}))}catch{}x(!0)}catch(a){}},[e,n,r,s,l,c,pe]),xe=D.useCallback(async t=>{var a,i,o;try{X(e=>({...e,[t]:!0}));const d=Q;if(!d)return;const u=ee.find(e=>e.drugName===c)||ee[0];if(!u)return;const m=(u.drugName||"").toLowerCase();let f=10;if("cyclosporin"===m||"cyclosporine"===m){let e=null;try{const t=d?`tdmfriends:conditions:${d.id}`:null;if(t){const n=window.localStorage.getItem(t);if(n){const t=JSON.parse(n).find(e=>"경구"===e.route||"oral"===e.route);e=(null==t?void 0:t.dosageForm)||null}}}catch(l){}f=e&&"capsule/tablet"===e.toLowerCase()?25:10}const p=(s||[]).filter(e=>e.patientId===d.id&&e.drugName===u.drugName),h=p.length>0?[...p].sort((e,t)=>ue(e.date,e.time).getTime()-ue(t.date,t.time).getTime())[p.length-1]:void 0,g=Number((null==h?void 0:h.dose)||u.dosage||100),x=[-3,-2,-1,1,2,3].map(e=>Math.max(1,g+e*f)),j=(u.tdmTarget||"").toLowerCase(),w=(u.tdmTargetValue||"").match(/\d+\.?\d*/g)||[],N=w[0]?parseFloat(w[0]):void 0,C=w[1]?parseFloat(w[1]):void 0;if(!Ds({patients:e,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:d.id,selectedDrugName:u.drugName}))return;const D=await Promise.all(x.map(async t=>{const a=Ds({patients:e,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:d.id,selectedDrugName:u.drugName,overrides:{amount:t}});try{const e=await Ss({body:a}),n=Number(((null==e?void 0:e.CTROUGH_after)??(null==e?void 0:e.CTROUGH_before))||0),r=Number(((null==e?void 0:e.AUC24h_after)??(null==e?void 0:e.AUC_after)??(null==e?void 0:e.AUC24h_before)??(null==e?void 0:e.AUC_before))||0);let i=0;if(j.includes("auc")&&(N||C)){const e=r||0,t=N??e,n=C??e;i=e<t?t-e:e>n?e-n:0}else if((j.includes("trough")||j.includes("cmax"))&&(N||C)){const e=n||0,t=N??e,r=C??e;i=e<t?t-e:e>r?e-r:0}else i=Math.abs((n||0)-((null==v?void 0:v.CTROUGH_before)||0));return{amt:t,score:i,resp:e,dataset:(null==a?void 0:a.dataset)||[]}}catch{return{amt:t,score:Number.POSITIVE_INFINITY,resp:null,dataset:(null==a?void 0:a.dataset)||[]}}})),S=D.sort((e,t)=>e.score-t.score).slice(0,3).map(e=>e.amt).sort((e,t)=>e-t);if(G(e=>({...e,[t]:S})),Z(e=>{const n={...e||{}};n[t]=n[t]||{};for(const r of D)r&&r.resp&&S.includes(r.amt)&&(n[t][r.amt]={data:r.resp,dataset:r.dataset});return n}),S.length>0){const e=S[0];O(n=>({...n,[t]:`${e}mg`}));const n=D.find(t=>t.amt===e);n&&n.resp&&(b(n.resp),y(pe(n.resp,n.dataset||[])),k({ipredSeries:((null==(a=n.resp)?void 0:a.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0&&e.time<=72),predSeries:((null==(i=n.resp)?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0&&e.time<=72),observedSeries:(n.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0&&e.time<=72),currentMethodSeries:((null==(o=n.resp)?void 0:o.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0&&e.time<=72)}),z(e=>({...e,[t]:!0})))}}catch(l){}finally{X(e=>({...e,[t]:!1}))}},[e,n,r,s,Q,c,ee,v,pe]),ve=D.useCallback(e=>{var t;try{(null==(t=q.current)?void 0:t[e])&&window.clearTimeout(q.current[e]);const n=window.setTimeout(()=>{xe(e)},250);q.current[e]=n}catch{xe(e)}},[xe]),be=D.useCallback(t=>{const r=e.find(e=>e.id===l),a=n.find(e=>e.patientId===l);if(!r||!a)return null;const i=r.weight,o=r.age,d="male"===r.gender?1:0,u=le(i,o,d),m=(s||[]).filter(e=>e.patientId===l),f=parseFloat((p.halfLife||"").toString()),h=(null==t?void 0:t.tau)??(Number.isFinite(f)&&f>0?f:fe(m)??void 0),g=m.length>0?[...m].sort((e,t)=>ue(e.date,e.time).getTime()-ue(t.date,t.time).getTime())[m.length-1]:void 0,x=(null==t?void 0:t.amount)??(g?g.dose:(e=>{const t=parseFloat((e??"").toString().replace(/[^0-9.-]/g,""));return Number.isFinite(t)&&t>0?t:void 0})(p.dose)),{auc:v,trough:b}=((e,t)=>{if(!t)return{};const n=(t.match(/\d+\.?\d*/g)||[]).map(e=>parseFloat(e));if(0===n.length)return{};const r=1===n.length?n[0]:(n[0]+n[1])/2;return e&&e.toLowerCase().includes("auc")?{auc:r}:e&&e.toLowerCase().includes("trough")?{trough:r}:{}})(a.tdmTarget,a.tdmTargetValue),j=[],y=[...m].sort((e,t)=>ue(e.date,e.time).getTime()-ue(t.date,t.time).getTime()),w=y.length>0?ue(y[0].date,y[0].time):void 0;if(y.length>0&&w)for(const e of y){const t=me(ue(e.date,e.time),w),n=e.isIVInfusion&&e.infusionTime?e.dose/(e.infusionTime/60):0;j.push({ID:l,TIME:Math.max(0,t),DV:null,AMT:e.dose,RATE:n,CMT:1,WT:i,SEX:d,AGE:o,CRCL:u,TOXI:1,EVID:1})}else void 0!==x&&j.push({ID:l,TIME:0,DV:null,AMT:x,RATE:0,CMT:1,WT:i,SEX:d,AGE:o,CRCL:u,TOXI:1,EVID:1});const N=w||(y.length>0?ue(y[0].date,y[0].time):new Date),C=c?te.filter(e=>e.drugName===c):te;if(C.length>0)for(const e of C){const t=me(e.testDate,N),n=e.unit&&e.unit.toLowerCase().includes("ng/ml")?e.concentration/1e3:e.concentration;j.push({ID:l,TIME:Math.max(0,t),DV:n,AMT:0,RATE:0,CMT:1,WT:i,SEX:d,AGE:o,CRCL:u,TOXI:1,EVID:0})}else j.push({ID:l,TIME:h??2,DV:null,AMT:0,RATE:0,CMT:1,WT:i,SEX:d,AGE:o,CRCL:u,TOXI:1,EVID:0});return{input_tau:h??12,input_amount:x??100,input_WT:i,input_CRCL:u,input_AGE:o,input_SEX:d,input_TOXI:1,input_AUC:v??void 0,input_CTROUGH:b??void 0,dataset:j}},[e,l,n,s,p,c,te,le,fe]);D.useEffect(()=>{if(l){try{if(c){const e=`tdmfriends:tdmResults:${l}:${c}`,t=window.localStorage.getItem(e);if(t){const e=[...JSON.parse(t)].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())[0];if(e&&e.data){const t=e.data;b(t);const n=be();return y(pe(t,(null==n?void 0:n.dataset)||[])),k({ipredSeries:((null==t?void 0:t.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==t?void 0:t.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:((null==n?void 0:n.dataset)||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==t?void 0:t.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}),void x(!0)}}}const e=window.localStorage.getItem(`tdmfriends:tdmResult:${l}`);if(e){const t=JSON.parse(e);b(t);const n=be();y(pe(t,(null==n?void 0:n.dataset)||[])),k({ipredSeries:((null==t?void 0:t.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==t?void 0:t.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:((null==n?void 0:n.dataset)||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==t?void 0:t.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}),x(!0)}else y([])}catch(e){}R(null),_(null),N([]),S([])}},[l,c,pe,be]),D.useEffect(()=>{if(l)try{const e=window.localStorage.getItem(`tdmfriends:selectedDrug:${l}`);e&&u(e)}catch{}},[l]),D.useEffect(()=>{if(l&&c)try{window.localStorage.setItem(`tdmfriends:selectedDrug:${l}`,c)}catch{}},[l,c]);const[je,ye]=D.useState([]),[we,Ne]=D.useState(!1),[Ce,De]=D.useState(""),Se=D.useCallback(e=>{var t;if(!(null==e?void 0:e.data))return;Ne(!0);const n=e.data;b(n);const r=(null==e?void 0:e.dataset)||(null==(t=be())?void 0:t.dataset)||[];y(pe(n,r)),k({ipredSeries:((null==n?void 0:n.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==n?void 0:n.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(r||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==n?void 0:n.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)})},[be,pe]),Te=D.useCallback(()=>Ne(!1),[]);D.useEffect(()=>{try{if(!l||!c)return void ye([]);const e=`tdmfriends:tdmResults:${l}:${c}`,t=window.localStorage.getItem(e),n=[...t?JSON.parse(t):[]].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()).slice(0,5);ye(n)}catch{ye([])}},[l,c,v]);const ke=()=>{const e=ee.find(e=>e.drugName===c)||ee[0],t=((null==e?void 0:e.tdmTarget)||"").toLowerCase();if(!t||t.includes("auc"))return{};if(t.includes("trough")||t.includes("cmax")){const t=((null==e?void 0:e.tdmTargetValue)||"").match(/\d+\.?\d*/g)||[];return{min:t[0]?parseFloat(t[0]):void 0,max:t[1]?parseFloat(t[1]):void 0}}return{}};return l&&Q&&0!==re.length?t.jsxs("div",{className:"space-y-6",children:[t.jsx(de,{currentPatient:Q,selectedPrescription:i,latestBloodTest:ie,drugAdministrations:s}),t.jsxs("div",{className:"w-full",children:[je.length>0&&t.jsxs("div",{className:"mb-4 text-xs text-muted-foreground",children:[t.jsx("div",{className:"font-semibold mb-1",children:"최근 TDM 히스토리 (최대 5개)"}),t.jsx("ul",{className:"list-disc pl-5 space-y-1",children:je.map(e=>{var n,r,a,i;return t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsxs("span",{children:[new Date(e.timestamp).toLocaleString()," — AUC24h(before/after): ",(null==(n=e.summary)?void 0:n.AUC24h_before)??"-"," /"," ",(null==(r=e.summary)?void 0:r.AUC24h_after)??"-",", Ctrough(before/after):"," ",(null==(a=e.summary)?void 0:a.CTROUGH_before)??"-"," /"," ",(null==(i=e.summary)?void 0:i.CTROUGH_after)??"-"]}),t.jsx("button",{className:"underline",onClick:()=>Se(e),children:"불러오기"}),o&&t.jsx("button",{className:"underline",onClick:()=>{Se(e),setTimeout(()=>{try{null==o||o()}catch{}},0)},children:"리포트"})]},e.id)})}),we&&t.jsxs("div",{className:"mt-2 text-[11px]",children:["완료 보기 모드: 용법 조정 UI가 숨겨집니다."," ",t.jsx("button",{className:"underline",onClick:Te,children:"종료"})," ",o&&t.jsx("button",{className:"underline ml-2",onClick:()=>{try{null==o||o()}catch{}},children:"리포트 보기"})]})]}),v&&t.jsxs("div",{className:"mb-2 text-[11px] text-muted-foreground",children:["Before window: ",Number(v.beforeWindowHours??72),"h"]}),t.jsx(ce,{showSimulation:!0,currentPatientName:Q.name,selectedDrug:c,targetMin:ke().min,targetMax:ke().max,recentAUC:(null==v?void 0:v.AUC24h_before)??(null==v?void 0:v.AUC_before),recentMax:null==v?void 0:v.CMAX_before,recentTrough:null==v?void 0:v.CTROUGH_before,predictedAUC:we?null:(null==v?void 0:v.AUC24h_after)??(null==v?void 0:v.AUC_after),predictedMax:we?null:null==v?void 0:v.CMAX_after,predictedTrough:we?null:null==v?void 0:v.CTROUGH_after,ipredSeries:null==T?void 0:T.ipredSeries,predSeries:null==T?void 0:T.predSeries,observedSeries:null==T?void 0:T.observedSeries,tdmIndication:ne(c).indication,tdmTarget:ne(c).target,tdmTargetValue:ne(c).targetValue,latestAdministration:f,drugAdministrations:s})]}),!we&&E.map(e=>t.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg p-6 mt-6 shadow-lg border-2 "+("dosage"===e.type?"border-pink-200 dark:border-pink-800":"border-green-200 dark:border-green-800"),children:[t.jsxs("div",{className:"flex justify-between items-start mb-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["용법 조정 ",e.id]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"dosage"===e.type?"투약 용량을 조정하고 즉시 예측 결과를 확인해보세요":"투약 시간의 간격을 조정하고 즉시 예측 결과를 확인해보세요"})]}),t.jsx("button",{className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl font-bold flex-shrink-0",onClick:()=>{return t=e.id,B(t),void H(!0);var t},children:"×"})]}),t.jsx("div",{className:"flex justify-center gap-4 mb-6",children:"dosage"===e.type?t.jsxs(t.Fragment,{children:[(W[e.id]||[]).map(n=>{const r=`${n}mg`;return t.jsx(A,{variant:$[e.id]===r?"default":"outline",size:"default",onClick:()=>((e,t)=>{var n,r,a,i;O(n=>({...n,[e]:t})),z(t=>({...t,[e]:!0}));const s=parseFloat(t.replace(/[^0-9.]/g,"")),o=null==(n=null==J?void 0:J[e])?void 0:n[s];if(o&&o.data){b(o.data),y(pe(o.data,o.dataset||[]));const e=((null==(r=o.data)?void 0:r.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0&&e.time<=72);return void k({ipredSeries:((null==(a=o.data)?void 0:a.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==(i=o.data)?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.PRED??e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(o.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:e})}he(s)})(e.id,r),className:($[e.id]===r?"bg-black text-white hover:bg-gray-800":"")+" text-base px-6 py-3",children:r},`${e.id}-${n}`)}),(!W[e.id]||0===W[e.id].length)&&t.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[t.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),"제안을 계산 중..."]})]}):t.jsxs(t.Fragment,{children:[t.jsx(A,{variant:"4시간"===L[e.id]?"default":"outline",size:"default",onClick:()=>se(e.id,"4시간"),className:("4시간"===L[e.id]?"bg-black text-white hover:bg-gray-800":"")+" text-base px-6 py-3",children:"4시간"}),t.jsx(A,{variant:"6시간"===L[e.id]?"default":"outline",size:"default",onClick:()=>se(e.id,"6시간"),className:("6시간"===L[e.id]?"bg-black text-white hover:bg-gray-800":"")+" text-base px-6 py-3",children:"6시간"}),t.jsx(A,{variant:"8시간"===L[e.id]?"default":"outline",size:"default",onClick:()=>se(e.id,"8시간"),className:("8시간"===L[e.id]?"bg-black text-white hover:bg-gray-800":"")+" text-base px-6 py-3",children:"8시간"}),t.jsx(A,{variant:"12시간"===L[e.id]?"default":"outline",size:"default",onClick:()=>se(e.id,"12시간"),className:("12시간"===L[e.id]?"bg-black text-white hover:bg-gray-800":"")+" text-base px-6 py-3",children:"12시간"})]})}),t.jsx("div",{className:"mb-8",children:t.jsx(xs,{simulationData:[],showSimulation:g,currentPatientName:null==Q?void 0:Q.name,selectedDrug:c,chartTitle:`용법 조정 ${e.id}`,targetMin:ke().min,targetMax:ke().max,drugAdministrations:s,recentAUC:(null==v?void 0:v.AUC24h_before)??(null==v?void 0:v.AUC_before),recentMax:null==v?void 0:v.CMAX_before,recentTrough:null==v?void 0:v.CTROUGH_before,predictedAUC:(null==v?void 0:v.AUC24h_after)??(null==v?void 0:v.AUC_after),predictedMax:null==v?void 0:v.CMAX_after,predictedTrough:null==v?void 0:v.CTROUGH_after,ipredSeries:null==T?void 0:T.ipredSeries,predSeries:null==T?void 0:T.predSeries,observedSeries:null==T?void 0:T.observedSeries,currentMethodSeries:null==T?void 0:T.currentMethodSeries,chartColor:"dosage"===e.type?"pink":"green",isEmptyChart:!U[e.id]||Y[e.id]&&(!W[e.id]||0===W[e.id].length),selectedButton:"dosage"===e.type?$[e.id]:L[e.id]})})]},`adjustment-${e.id}`)),!we&&t.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-lg p-6 mt-6",children:t.jsxs("div",{className:"text-center mb-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"용법 조정 시뮬레이션을 진행하시겠습니까?"}),Ce&&t.jsx("div",{className:"text-sm text-red-600 mb-2",children:Ce}),t.jsxs("div",{className:"flex justify-center gap-4",children:[t.jsx(A,{onClick:()=>{Ce&&De("");const e=E.length+1;P(t=>[...t,{id:e,type:"dosage"}]),z(t=>({...t,[e]:!1})),ve(e)},className:"w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center",children:"투약 용량 조정"}),t.jsx(A,{onClick:()=>{Ce&&De("");const e=E.length+1;P(t=>[...t,{id:e,type:"interval"}]),z(t=>({...t,[e]:!1}))},className:"w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center",children:"투약 시간 조정"})]})]})})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-muted-foreground",children:[t.jsx("p",{className:"text-lg font-semibold",children:"환자와 약물을 먼저 선택해 주세요."}),t.jsx("p",{className:"text-sm mt-2",children:"이전 단계에서 환자, TDM 약물, 혈액검사 정보를 모두 입력해야 시뮬레이션이 가능합니다."})]})},Ms=({patients:e,prescriptions:n,bloodTests:r,selectedPatient:a,selectedPrescription:i,drugAdministrations:s,onPrev:o})=>{const[l,d]=D.useState(null),[c,u]=D.useState(!1);D.useEffect(()=>{if(a)try{const e=window.localStorage.getItem(`tdmfriends:tdmResult:${a.id}`);d(e?JSON.parse(e):null)}catch{d(null)}else d(null)},[null==a?void 0:a.id]);if(!a)return t.jsx(R,{children:t.jsx(P,{className:"py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx(ne,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"Please select a patient first"})]})})});n.filter(e=>e.patientId===a.id),!i||r.filter(e=>e.patientId===a.id&&e.drugName===i.drugName);const m=i?s.filter(e=>e.patientId===a.id&&e.drugName===i.drugName):[];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs(R,{children:[t.jsxs(I,{children:[t.jsxs(_,{className:"flex items-center gap-2",children:[t.jsx(ne,{className:"h-5 w-5"}),"TDM Simulation",t.jsx(q,{className:"h-5 w-5 text-green-600"})]}),t.jsxs(E,{children:[a.name," 환자의 TDM 분석 결과를 확인하고 약물 요법을 직접 시뮬레이션 해보세요."]})]}),t.jsxs(P,{children:[t.jsx("div",{id:"pk-simulation-content",children:t.jsx(ks,{patients:e,prescriptions:n,bloodTests:r,selectedPatient:a,selectedPrescription:i,drugAdministrations:m,onDownloadPDF:async()=>{const e=document.getElementById("pk-simulation-content");if(!e)return;const t=await ue(e),n=t.toDataURL("image/png"),r=new me({orientation:"landscape",unit:"px",format:[t.width,t.height]});r.addImage(n,"PNG",0,0,t.width,t.height),r.save("PK_simulation_report.pdf")}})}),t.jsxs("div",{className:"flex justify-between mt-6",children:[t.jsxs(A,{variant:"outline",onClick:o,className:"flex items-center gap-2",children:[t.jsx(ee,{className:"h-4 w-4"}),"투약 기록"]}),t.jsxs(A,{onClick:()=>{u(!0)},className:"flex items-center gap-2",children:[t.jsx(re,{className:"h-4 w-4"}),"TDM 분석 보고서 생성"]})]})]})]}),t.jsx(ss,{open:c,onOpenChange:u,children:t.jsxs(ds,{children:[t.jsxs(cs,{children:[t.jsxs(ms,{children:[a.name," 환자의 TDM 분석을 종료하시겠습니까?"]}),t.jsx(fs,{children:"분석 종료 후 데이터 수정은 불가하며 새 탭에서 PDF 파일로 보고서를 다운로드할 수 있습니다."})]}),t.jsxs(us,{children:[t.jsx(hs,{onClick:()=>{u(!1)},children:"취소"}),t.jsx(ps,{onClick:()=>{u(!1);const e=`${window.location.origin+window.location.pathname.split("/").slice(0,-1).join("/")}/report?patientId=${a.id}`;window.open(e,"_blank")},className:"bg-black text-white hover:bg-gray-800",children:"보고서 생성"})]})]})})]})},Rs=({row:e,onUpdate:n,isDarkMode:r})=>{const[a,i]=D.useState(e.injectionTime),[s,o]=D.useState(!1);D.useEffect(()=>{s||i(e.injectionTime)},[e.injectionTime,s]);return t.jsx("input",{type:"text",value:a,onChange:e=>{i(e.target.value)},onFocus:e=>{o(!0),e.target.setSelectionRange(e.target.value.length,e.target.value.length)},onBlur:t=>{o(!1),n(e.id,"injectionTime",t.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()},style:{border:"none",background:"transparent",textAlign:"center",width:"100%",color:r?"#e0e6f0":void 0}})},Is=({row:e,onUpdate:n,isDarkMode:r})=>{const[a,i]=D.useState(e.timeStr),[s,o]=D.useState(!1);D.useEffect(()=>{s||i(e.timeStr)},[e.timeStr,s]);return t.jsx("input",{type:"text",value:a,onChange:e=>{i(e.target.value)},onFocus:e=>{o(!0),e.target.select()},onBlur:t=>{o(!1);let r=t.target.value.toString().replace(/undefined/g,"").trim();if(/^\d{12}$/.test(r)){const e=r.substring(0,4),t=r.substring(4,6),n=r.substring(6,8),a=r.substring(8,10),i=r.substring(10,12);r=`${e}-${t}-${n} ${a}:${i}`}else if(/^\d{11}$/.test(r)){const e=r.substring(0,4),t=r.substring(4,6),n=r.substring(6,8),a=r.substring(8,10),i=r.substring(10,11);r=`${e}-${t}-${n} ${a}:0${i}`}else if(/^\d{10}$/.test(r)){const e=r.substring(0,4),t=r.substring(4,6),n=r.substring(6,8),a=r.substring(8,10);r=`${e}-${t}-${n} ${a}:00`}else if(r.includes(" ")&&r.includes(":")&&!r.includes("-")){const e=r.split(" ");if(4===e.length){const[t,n,a,i]=e;r=`${t}-${n.padStart(2,"0")}-${a.padStart(2,"0")} ${i}`}}n(e.id,"timeStr",r)},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()},placeholder:"YYYY-MM-DD HH:MM",style:{border:"none",background:"transparent",textAlign:"center",width:"100%",color:r?"#e0e6f0":void 0}})};function _s(e){var n;const[r,a]=D.useState({route:"",dosage:"",unit:"mg",intervalHours:"",injectionTime:"",dosageForm:"",firstDoseDate:"",firstDoseTime:"",totalDoses:""}),[i,s]=D.useState(e.initialConditions||[]),[o,l]=D.useState(e.initialTableData||[]),[d,c]=D.useState(e.initialIsTableGenerated||!1),[u,m]=D.useState(!0),[f,p]=D.useState(null),[h,g]=D.useState(new Set);D.useState(null);const[x,v]=D.useState(!1),[b,j]=D.useState(null);D.useState("table");const[y,w]=D.useState(""),[N,C]=D.useState(!1),S=D.useRef(!1),T=D.useRef(e.onRecordsChange);D.useEffect(()=>{T.current=e.onRecordsChange},[e.onRecordsChange]);const k=D.useRef(e.onConditionsChange);D.useEffect(()=>{k.current=e.onConditionsChange},[e.onConditionsChange]);const M=D.useRef(null);D.useEffect(()=>{const e=()=>C(document.documentElement.classList.contains("dark"));return e(),window.addEventListener("transitionend",e),window.addEventListener("click",e),window.addEventListener("keydown",e),()=>{window.removeEventListener("transitionend",e),window.removeEventListener("click",e),window.removeEventListener("keydown",e)}},[]),D.useEffect(()=>{const t=e.initialAdministrations||[];if(t&&0!==t.length)try{const e={id:"title",round:"회차",time:"투약 시간",amount:"투약용량",route:"투약경로",injectionTime:"주입시간",isTitle:!0},n=t.map((e,n)=>{const r=`${e.date} ${e.time}`,a=new Date(`${e.date}T${e.time}`);return{id:String(e.id||`${Date.now()}_${n}`),conditionId:null,doseIndex:n+1,totalDoses:t.length,time:a,timeStr:r,amount:`${e.dose} ${e.unit||"mg"}`,route:e.route,injectionTime:e.isIVInfusion?void 0!==e.infusionTime?String(e.infusionTime):"0":"-",isTitle:!1}}).sort((e,t)=>e.time-t.time);n.forEach((e,t)=>{e.round=`${t+1} 회차`}),S.current=!0,l([e,...n]),c(!0),setTimeout(()=>{S.current=!1},0)}catch{}},[e.initialAdministrations]),D.useEffect(()=>{if(!T.current)return;if(S.current)return void(S.current=!1);const e=o.filter(e=>!e.isTitle).map(e=>({timeStr:e.timeStr,amount:e.amount,route:e.route,injectionTime:e.injectionTime}));try{const t=JSON.stringify(e);if(M.current===t)return;M.current=t}catch{}T.current(e)},[o]),D.useEffect(()=>{k.current&&k.current(i)},[i]),D.useEffect(()=>{u&&m(!1)},[u]),D.useEffect(()=>{let t=!1;if(e.initialConditions&&(s(e.initialConditions),t=!0),e.initialTableData){S.current=!0;const n=e.initialTableData.map(e=>e.isTitle||"정맥"!==e.route||e.injectionTime&&"-"!==e.injectionTime?e.isTitle||"정맥"===e.route||"0"!==e.injectionTime?e:{...e,injectionTime:"-"}:{...e,injectionTime:"0"});l(n),t=!0}void 0!==e.initialIsTableGenerated&&(c(e.initialIsTableGenerated),t=!0),t&&setTimeout(()=>{S.current=!1},0)},[e.initialConditions,e.initialTableData,e.initialIsTableGenerated]);const R=[{value:"경구",label:"경구 (oral)"},{value:"정맥",label:"정맥 (IV)"},{value:"피하",label:"피하 (SC)"}],I=e=>{if(!e.firstDoseDate||!e.firstDoseTime)return"날짜와 시간을 입력해주세요";const t=e.unit?e.unit:"mg";return`${e.totalDoses}회 투약, ${e.intervalHours}시간 간격, ${e.firstDoseDate} ${e.firstDoseTime}, ${e.dosage} ${t}, ${e.route}${"정맥"===e.route&&e.injectionTime?` (${e.injectionTime})`:""}`},_=(t,n)=>{a(r=>{var a,i,s;const o={...r,[t]:n};if("route"===t&&(null==(a=e.tdmDrug)?void 0:a.drugName)){"cyclosporin"!==(null==(i=e.tdmDrug.drugName)?void 0:i.toLowerCase())&&"cyclosporine"!==(null==(s=e.tdmDrug.drugName)?void 0:s.toLowerCase())||"경구"!==n&&"oral"!==n?o.dosageForm="":o.dosageForm||(o.dosageForm="capsule/tablet");const t=((e,t)=>{if(!e||!t)return"mg";const n=e.toLowerCase(),r=t.toLowerCase();if("vancomycin"===n)return"mg";if("cyclosporin"===n){if("정맥"===r||"iv"===r)return"mg";if("경구"===r||"oral"===r)return"mg"}return"mg"})(e.tdmDrug.drugName,n);t&&(o.unit=t)}return o})},E=(e,t,n)=>{l(r=>r.map(r=>{if(r.id===e){const e={...r,[t]:n};if("timeStr"===t&&n){let t=n.toString().replace(/undefined/g,"").trim();if(/^\d{12}$/.test(t)){const e=t.substring(0,4),n=t.substring(4,6),r=t.substring(6,8),a=t.substring(8,10),i=t.substring(10,12);t=`${e}-${n}-${r} ${a}:${i}`}else if(/^\d{11}$/.test(t)){const e=t.substring(0,4),n=t.substring(4,6),r=t.substring(6,8),a=t.substring(8,10),i=t.substring(10,11);t=`${e}-${n}-${r} ${a}:0${i}`}else if(/^\d{10}$/.test(t)){const e=t.substring(0,4),n=t.substring(4,6),r=t.substring(6,8),a=t.substring(8,10);t=`${e}-${n}-${r} ${a}:00`}else if(t.includes(" ")&&t.includes(":")&&!t.includes("-")){const e=t.split(" ");if(4===e.length){const[n,r,a,i]=e;t=`${n}-${r.padStart(2,"0")}-${a.padStart(2,"0")} ${i}`}}if(t.includes(" ")&&t.includes("-")&&t.includes(":")){const n=t.split(" ");2===n.length&&(e.date=n[0],e.time=n[1])}else t.includes(":")&&(e.time=t,e.date||(e.date=(new Date).toISOString().split("T")[0]));e.timeStr=t}return"route"===t&&(e.injectionTime="정맥"===n?"0":"-"),e}return r}))},P=(e,t)=>{l(n=>n.map(n=>{if(n.id===e&&!n.isTitle){let e,r,a=n.timeStr||"";if(a=a.toString().replace(/undefined/g,"").trim(),a.includes(" ")&&a.includes("-")&&a.includes(":")){const t=a.split(" ");2===t.length&&(e=t[0],r=t[1])}else a.includes(":")?(r=a,e=n.date||(new Date).toISOString().split("T")[0]):(e=(new Date).toISOString().split("T")[0],r="09:00");const i=r.split(":");if(i.length>=2){parseInt(i[0],10),parseInt(i[1],10);const a=new Date(new Date(`${e}T${r}`));a.setMinutes(a.getMinutes()+("plus"===t?1:-1));const s=`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`,o=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`,l=`${s} ${o}`;return{...n,timeStr:l,date:s,time:o}}{const e=(new Date).toISOString().split("T")[0],t="09:00";return{...n,timeStr:`${e} ${t}`,date:e,time:t}}}return n}))},A=e=>{e.preventDefault()},$=(new Date).toISOString().slice(0,10);return t.jsxs("div",{style:{padding:"0",fontFamily:"Arial, sans-serif",background:N?"#181e29":"#f4f6fa",color:N?"#e0e6f0":"#333"},children:[t.jsx("div",{style:{width:"100%",margin:0,padding:"0 0 40px 0"},children:t.jsxs("div",{children:[t.jsxs("div",{style:{background:N?"#23293a":"#f8f9fa",padding:"20px",borderRadius:"8px",marginBottom:"30px",border:N?"1px solid #334155":"1px solid #dee2e6"},children:[t.jsx("h1",{style:{marginBottom:20,color:N?"#e0e6f0":"#495057"},children:"1단계: 처방 내역을 입력하세요"}),t.jsxs("div",{style:{marginBottom:20,color:N?"#9ca3af":"#6b7280",fontSize:"14px",lineHeight:"1.5"},children:[t.jsx("div",{style:{marginBottom:"8px"},children:"• 처방 내역을 입력한 후 [처방 내역 입력 완료] 버튼을 클릭하면 하단에 자동으로 ‘상세 투약 기록’ 테이블이 생성됩니다."}),t.jsx("div",{children:"• 처방 내역 변경이 있었다면 실제 처방에 일치하도록 새로운 처방 내역을 입력해야 합니다. (예: 1월 4일은 경구 투약, 1월 5일부터는 정맥 주입한 경우 처방 내역을 2개 등록)"})]}),t.jsxs("div",{style:{border:"2px solid #e0e7ff",padding:"20px",marginBottom:"20px",borderRadius:"8px",background:"white"},children:[t.jsxs("div",{style:{display:"flex",gap:"15px",marginBottom:"15px"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"투약 경로"}),t.jsxs("select",{value:r.route,onChange:e=>_("route",e.target.value),style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"},children:[t.jsx("option",{value:"",children:"투약 경로를 선택해주세요"}),R.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]})]}),(null==(n=e.tdmDrug)?void 0:n.drugName)&&("cyclosporin"===e.tdmDrug.drugName.toLowerCase()||"cyclosporine"===e.tdmDrug.drugName.toLowerCase())&&("경구"===r.route||"oral"===r.route)&&t.jsxs("div",{style:{flex:1},children:[t.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"제형"}),t.jsxs("select",{value:r.dosageForm,onChange:e=>_("dosageForm",e.target.value),style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"},children:[t.jsx("option",{value:"",children:"제형을 선택해주세요"}),t.jsx("option",{value:"capsule/tablet",children:"캡슐/정제"}),t.jsx("option",{value:"oral liquid",children:"경구현탁/액제"})]})]}),t.jsxs("div",{style:{flex:1},children:[t.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"투약 용량"}),t.jsx("input",{type:"number",value:r.dosage,onChange:e=>_("dosage",e.target.value),placeholder:"예: 500",style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"}})]}),t.jsxs("div",{style:{width:"5%"},children:[t.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"단위"}),t.jsx("select",{value:r.unit,onChange:e=>_("unit",e.target.value),style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"},children:["mg","g","mcg"].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("div",{style:{flex:1},children:[t.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"투약 간격(시간)"}),t.jsx("input",{type:"number",value:r.intervalHours,onChange:e=>_("intervalHours",e.target.value),placeholder:"예: 8",style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"}})]}),t.jsxs("div",{style:{flex:1},children:[t.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"주입시간 (분)"}),t.jsx("input",{type:"text",value:r.injectionTime,onChange:e=>_("injectionTime",e.target.value),placeholder:"bolus 투여 시 0 입력",disabled:"정맥"!==r.route,style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"정맥"!==r.route?"#f8f9fa":"#fff",height:"40px",boxSizing:"border-box",color:"#495057"}})]}),t.jsxs("div",{style:{flex:1},children:[t.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"최초 투약 날짜/시간"}),t.jsx("input",{type:"text",value:r.firstDoseDate,onChange:e=>_("firstDoseDate",e.target.value),placeholder:"예: 202507251400",style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"},max:$+" 23:59"})]}),t.jsxs("div",{style:{flex:1},children:[t.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"총 투약 횟수"}),t.jsx("input",{type:"number",value:r.totalDoses,onChange:e=>_("totalDoses",e.target.value),placeholder:"예: 10",style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"}})]})]}),t.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:24},children:t.jsxs("button",{onClick:()=>{if(!r.firstDoseDate)return void alert("날짜와 시간을 입력해주세요! (예: 202507251400)");let e="",t="",n=r.firstDoseDate.trim();if(!/^\d{8}\d{4}$/.test(n.replace(/[-: ]/g,"")))return void alert("날짜와 시간 형식이 올바르지 않습니다. 예: 202507251400");e=n.slice(0,8),t=n.slice(8,12),e=e.slice(0,4)+"-"+e.slice(4,6)+"-"+e.slice(6,8),t=t.slice(0,2)+":"+t.slice(2,4);if(e>(new Date).toISOString().slice(0,10))alert("투약 날짜는 오늘 이후로 입력할 수 없습니다.");else if(r.firstDoseDate=e,r.firstDoseTime=t,r.unit){if(x)s(e=>e.map(e=>e.id===b?{...r,id:b}:e)),v(!1),j(null);else{const e={id:Date.now(),...r};s(t=>[...t,e])}a({route:"",dosage:"",unit:"mg",intervalHours:"",injectionTime:"",firstDoseDate:"",firstDoseTime:"",totalDoses:""})}else alert("단위를 선택해주세요!")},style:{display:"flex",alignItems:"center",justifyContent:"center",background:"#eaf0fd",border:"none",color:"#1B44C8",fontWeight:600,fontSize:16,cursor:"pointer",padding:"8px 32px",margin:0,outline:"none",borderRadius:"12px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{e.target.style.backgroundColor="#dbeafe"},onMouseOut:e=>{e.target.style.backgroundColor="#eaf0fd"},children:[t.jsx("span",{style:{fontSize:20,marginRight:6,fontWeight:600,background:"transparent"},children:x?"✓":"+"}),x?"처방 내역 수정":"처방 내역 추가"]})})]}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx("h3",{style:{marginBottom:"10px",color:"#495057"},children:"처방 내역 summary"}),t.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"8px",padding:"15px",background:"white",maxHeight:"200px",overflowY:"auto"},children:0===i.length?t.jsx("div",{style:{color:"#6c757d",fontStyle:"italic"},children:"처방 내역을 추가해주세요."}):i.map((e,n)=>t.jsxs("div",{style:{borderBottom:"1px dashed #eee",paddingBottom:"10px",marginBottom:"10px",fontSize:"13px",color:"#6c757d",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsxs("span",{style:{fontWeight:"bold",color:"#007bff",marginRight:"10px"},children:["기록 ",n+1,":"]}),I(e)]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{onClick:()=>(e=>{const t=i.find(t=>t.id===e);if(t){const n=t.firstDoseDate.replace(/-/g,"")+t.firstDoseTime.replace(/:/g,"");a({route:t.route,dosage:t.dosage,unit:t.unit,intervalHours:t.intervalHours,injectionTime:t.injectionTime,firstDoseDate:n,firstDoseTime:t.firstDoseTime,totalDoses:t.totalDoses}),v(!0),j(e)}})(e.id),style:{padding:"4px 8px",backgroundColor:"#17a2b8",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:"수정"}),t.jsx("button",{onClick:()=>{return t=e.id,void s(e=>e.filter(e=>e.id!==t));var t},style:{padding:"4px 8px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:"삭제"})]})]},e.id))})]}),t.jsx("button",{onClick:()=>{if(0===i.length)return void alert("최소 1개의 조건을 추가해주세요!");for(let e of i)if(!(e.totalDoses&&e.intervalHours&&e.firstDoseDate&&e.firstDoseTime&&e.dosage&&e.route&&e.unit))return void alert("모든 필드를 입력해주세요!");const t=i.map(e=>{const t=parseInt(e.totalDoses),n=parseInt(e.intervalHours),r=`${e.firstDoseDate}T${e.firstDoseTime}`,a=new Date(r),i=new Date(a.getTime()+(t-1)*n*60*60*1e3);return{start:a,end:i}});for(let e=0;e<t.length;e++)for(let n=e+1;n<t.length;n++)if(t[e].start<=t[n].end&&t[n].start<=t[e].end)return void w("중복된 투약일정이 있습니다. 투약일시를 다시 확인해주세요.");let n=[];n.push({id:"title",round:"회차",time:"투약 시간",amount:"투약용량",route:"투약경로",injectionTime:"주입시간",isTitle:!0});let r=[];i.forEach(e=>{const t=parseInt(e.totalDoses),n=parseInt(e.intervalHours),a=e.unit,i=`${e.firstDoseDate}T${e.firstDoseTime}`,s=new Date(i),o=e.route,l=e.injectionTime;for(let d=0;d<t;d++){const i=new Date(s.getTime()+d*n*60*60*1e3);r.push({id:`${e.id}_${d+1}`,conditionId:e.id,doseIndex:d+1,totalDoses:t,time:i,timeStr:`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")} ${String(i.getHours()).padStart(2,"0")}:${String(i.getMinutes()).padStart(2,"0")}`,amount:`${e.dosage} ${a}`,route:o,injectionTime:"정맥"===o&&l?l:"-",isTitle:!1})}});const a=new Set;for(const e of r){if(a.has(e.timeStr))return void alert("중복된 투약일정이 있습니다. 투약일시를 다시 확인해주세요.");a.add(e.timeStr)}if(r.sort((e,t)=>e.time-t.time),r.forEach((e,t)=>{e.round=`${t+1} 회차`}),n=[n[0],...r],l(n),c(!0),e.onTableGenerated&&e.onTableGenerated(),g(new Set),e.onSaveRecords&&!u){const t=n.filter(e=>!e.isTitle).map(e=>({timeStr:e.timeStr,amount:e.amount,route:e.route,injectionTime:e.injectionTime}));e.onSaveRecords(t)}},disabled:0===i.length,style:{width:"100%",padding:"10px 0",backgroundColor:N?0===i.length?"#334155":"#1B44C8":"#fff",color:N?"#fff":"#1B44C8",border:"2px solid #1B44C8",borderRadius:"12px",fontSize:18,fontWeight:700,cursor:0===i.length?"not-allowed":"pointer",marginTop:"20px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{i.length>0&&(e.target.style.backgroundColor=N?"#274fcf":"#eaf0fd")},onMouseOut:e=>{i.length>0&&(e.target.style.backgroundColor=N?"#1B44C8":"#fff")},children:"처방 내역 입력 완료"})]}),t.jsxs("div",{style:{background:N?"#23293a":"white",padding:"20px",borderRadius:"8px",border:N?"1px solid #334155":"1px solid #dee2e6"},children:[t.jsx("h2",{style:{marginBottom:10,color:N?"#e0e6f0":"#495057"},children:"2단계: 투약 기록을 확인하세요"}),t.jsxs("div",{style:{marginBottom:20,color:N?"#9ca3af":"#6b7280",fontSize:"14px",lineHeight:"1.5"},children:[t.jsx("div",{style:{marginBottom:"8px"},children:"• 투약 기록 정보를 정확히 입력할 수록 분석의 정확도가 높아집니다."}),t.jsx("div",{children:"• 투약 시간을 선택해서 정확한 시간으로 수정할 수 있습니다."})]}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsx("table",{style:{width:"100%",borderCollapse:"collapse",border:N?"1px solid #334155":"1px solid #dee2e6",tableLayout:"fixed",background:N?"#23293a":"white"},children:t.jsx("tbody",{children:o.length>0?o.map(e=>t.jsxs("tr",{draggable:!e.isTitle,onDragStart:t=>{return!e.isTitle&&(n=e.id,void p(n));var n},onDragOver:A,onDrop:t=>!e.isTitle&&((e,t)=>{if(e.preventDefault(),f===t||"title"===f)return;const n=o.findIndex(e=>e.id===f),r=o.findIndex(e=>e.id===t);if(-1===n||-1===r)return;const a=[...o],i=a[n];a.splice(n,1),a.splice(r,0,i),a.forEach((e,t)=>{e.isTitle||(e.round=`${t+1}`)}),l(a),p(null)})(t,e.id),style:{backgroundColor:e.isTitle?N?"#2d3650":"#e9ecef":N?"#23293a":"white",fontWeight:e.isTitle?"bold":"normal",cursor:e.isTitle?"default":"grab",color:N?"#e0e6f0":void 0},children:[t.jsx("td",{style:{padding:"12px",border:N?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"12%",color:N?"#e0e6f0":void 0,background:N&&e.isTitle?"#2d3650":void 0},children:e.isTitle?e.round:t.jsx("input",{type:"text",value:e.round,onChange:t=>E(e.id,"round",t.target.value),style:{border:"none",background:"transparent",textAlign:"center",width:"100%",color:N?"#e0e6f0":void 0}})}),t.jsx("td",{style:{padding:"12px",border:N?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"25%",color:N?"#e0e6f0":void 0,background:N&&e.isTitle?"#2d3650":void 0},children:e.isTitle?e.time:t.jsxs("div",{style:{display:"flex",gap:"2px",alignItems:"center"},children:[t.jsx("div",{style:{flex:1},children:t.jsx(Is,{row:e,onUpdate:E,isDarkMode:N})}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1px"},children:[t.jsx("button",{type:"button",onClick:()=>P(e.id,"plus"),style:{width:"20px",height:"14px",border:"1px solid #d1d5db",borderRadius:"2px 2px 0 0",background:N?"#374151":"#f9fafb",color:N?"#e0e6f0":"#374151",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"bold",padding:"0"},onMouseOver:e=>{e.target.style.background=N?"#4b5563":"#e5e7eb"},onMouseOut:e=>{e.target.style.background=N?"#374151":"#f9fafb"},children:"▲"}),t.jsx("button",{type:"button",onClick:()=>P(e.id,"minus"),style:{width:"20px",height:"14px",border:"1px solid #d1d5db",borderRadius:"0 0 2px 2px",background:N?"#374151":"#f9fafb",color:N?"#e0e6f0":"#374151",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"bold",padding:"0"},onMouseOver:e=>{e.target.style.background=N?"#4b5563":"#e5e7eb"},onMouseOut:e=>{e.target.style.background=N?"#374151":"#f9fafb"},children:"▼"})]})]})}),t.jsx("td",{style:{padding:"12px",border:N?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"18%",color:N?"#e0e6f0":void 0,background:N&&e.isTitle?"#2d3650":void 0},children:e.isTitle?e.amount:t.jsx("input",{type:"text",value:e.amount,onChange:t=>E(e.id,"amount",t.target.value),style:{border:"none",background:"transparent",textAlign:"center",width:"100%",color:N?"#e0e6f0":void 0}})}),t.jsx("td",{style:{padding:"12px",border:N?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"18%",color:N?"#e0e6f0":void 0,background:N&&e.isTitle?"#2d3650":void 0},children:e.isTitle?e.route:t.jsx("select",{value:e.route,onChange:t=>E(e.id,"route",t.target.value),style:{border:"none",background:"transparent",textAlign:"center",width:"100%",color:N?"#e0e6f0":void 0,backgroundColor:N?"#23293a":void 0},children:R.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})}),t.jsx("td",{style:{padding:"12px",border:N?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"18%",color:N?"#e0e6f0":void 0,background:N&&e.isTitle?"#2d3650":void 0},children:e.isTitle?e.injectionTime:t.jsx(Rs,{row:e,onUpdate:E,isDarkMode:N})}),t.jsx("td",{style:{padding:"12px",border:N?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"10%",color:N?"#e0e6f0":void 0,background:N&&e.isTitle?"#2d3650":void 0},children:e.isTitle?"삭제":t.jsx("input",{type:"checkbox",checked:h.has(e.id),onChange:()=>{return t=e.id,void g(e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n});var t},style:{width:"16px",height:"16px",cursor:"pointer",accentColor:N?"#1B44C8":void 0}})})]},e.id)):t.jsx("tr",{children:t.jsx("td",{colSpan:"6",style:{padding:"40px",textAlign:"center",color:"#6b7280",fontStyle:"italic"},children:'처방 내역을 입력하고 "처방 내역 입력 완료" 버튼을 클릭하여 테이블을 생성하세요.'})})})})}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"15px"},children:[t.jsx("button",{onClick:()=>{window.confirm("투약 기록 테이블을 전체 삭제하시겠습니까? 처방 내역은 유지됩니다.")&&(l([]),c(!1),g(new Set),a({route:"",dosage:"",unit:"mg",intervalHours:"",injectionTime:"",firstDoseDate:"",firstDoseTime:"",totalDoses:""}),v(!1),j(null))},style:{padding:"8px 16px",backgroundColor:"#fff",color:"#dc2626",border:"1px solid #fecaca",borderRadius:"8px",cursor:"pointer",fontWeight:400,fontSize:"15px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{e.target.style.backgroundColor="#fef2f2"},onMouseOut:e=>{e.target.style.backgroundColor="#fff"},children:"🗑️ 전체 삭제"}),t.jsxs("div",{style:{display:"flex",gap:"10px"},children:[t.jsx("button",{onClick:()=>{const e=Math.max(0,...o.filter(e=>!e.isTitle).map(e=>parseInt(e.id)||0))+1,t=o.filter(e=>!e.isTitle&&e.timeStr).sort((e,t)=>{if(e.timeStr&&t.timeStr){const n=new Date(e.timeStr);return new Date(t.timeStr).getTime()-n.getTime()}return 0})[0];let n;if(t&&t.timeStr){const e=new Date(t.timeStr);n=new Date(e.getTime()+432e5)}else n=new Date,n.setHours(9,0,0,0);const r=n.toISOString().split("T")[0],a=n.toTimeString().slice(0,5),i=o.filter(e=>!e.isTitle&&e.amount&&"0"!==e.amount).map(e=>e.amount);let s="500 mg";if(i.length>0){const e={};i.forEach(t=>{e[t]=(e[t]||0)+1});s=Object.keys(e).reduce((t,n)=>e[t]>e[n]?t:n)}const d={id:String(e),round:`${e}회차`,date:r,time:a,timeStr:`${r} ${a}`,amount:s,route:"경구",injectionTime:"-",isTitle:!1};l(e=>[...e,d])},style:{padding:"8px 16px",backgroundColor:"#fff",color:"#222",border:"1px solid #dee2e6",borderRadius:"8px",cursor:"pointer",fontWeight:400,fontSize:"15px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{e.target.style.backgroundColor="#f4f6fa"},onMouseOut:e=>{e.target.style.backgroundColor="#fff"},children:"+ 행추가"}),t.jsx("button",{onClick:()=>{0!==h.size?window.confirm(`선택된 ${h.size}개 행을 삭제하시겠습니까?`)&&(l(e=>e.filter(e=>!h.has(e.id))),g(new Set)):alert("삭제할 행을 선택해주세요!")},style:{padding:"8px 16px",backgroundColor:"#fff",color:"#fb7185",border:"1px solid #ffe4e6",borderRadius:"8px",cursor:"pointer",fontWeight:400,fontSize:"15px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{e.target.style.backgroundColor="#f4f6fa"},onMouseOut:e=>{e.target.style.backgroundColor="#fff"},children:"선택 삭제"})]})]})]})]})}),y&&t.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.3)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px 32px",boxShadow:"0 4px 24px #0002",minWidth:"320px",textAlign:"center",border:"1.5px solid #222",color:"#222",fontWeight:600},children:[t.jsx("div",{style:{fontSize:"17px",marginBottom:"18px",whiteSpace:"pre-line"},children:"중복된 투약일정이 있습니다.\n투약일시를 다시 확인해주세요."}),t.jsx("button",{onClick:()=>w(""),style:{background:"#222",color:"white",border:"none",borderRadius:"6px",padding:"8px 28px",fontSize:"15px",fontWeight:600,cursor:"pointer"},children:"확인"})]})})]})}const Es=({patients:e,prescriptions:n,selectedPatient:r,selectedPrescription:a,onAddDrugAdministration:i,setDrugAdministrations:s,drugAdministrations:o,bloodTests:l,onNext:d,onPrev:c,isCompleted:u})=>{const m=a;D.useState({drugName:(null==m?void 0:m.drugName)||"",route:"",date:"",time:"",dose:0,unit:"mg",infusionTime:void 0});const[f,p]=D.useState(!1),[h,g]=D.useState(!1),[x,v]=D.useState([]);Za().format("YYYY-MM-DD");const b=r&&m?o.filter(e=>e.patientId===r.id&&e.drugName===m.drugName):[],j=D.useCallback(()=>r&&(null==m?void 0:m.drugName)?`tdmfriends:conditions:${r.id}:${m.drugName}`:null,[r,null==m?void 0:m.drugName]);return D.useEffect(()=>{if(!r)return;const e=j();if(e)try{const t=localStorage.getItem(e);if(t){const e=JSON.parse(t);v(e)}}catch(t){}},[r,null==m?void 0:m.drugName,j]),D.useEffect(()=>{if(!r)return;const e=j();if(e)try{localStorage.setItem(e,JSON.stringify(x))}catch(t){}},[x,r,null==m?void 0:m.drugName,j]),D.useEffect(()=>{},[]),t.jsxs("div",{className:"space-y-6",children:[t.jsxs(R,{children:[t.jsxs(I,{children:[t.jsxs(_,{className:"flex items-center gap-2",children:[t.jsx(ae,{className:"h-5 w-5"}),"4단계: 투약기록",u&&t.jsx(q,{className:"h-5 w-5 text-green-600"})]}),t.jsx(E,{children:"2단계에서 입력한 TDM 약물에 대해 7반감기 이내의 투약력을 입력하세요."})]}),t.jsx(P,{children:t.jsx("div",{className:"py-2 px-3 rounded bg-muted dark:bg-slate-800 text-base font-semibold mb-4",children:t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:"TDM 내역:"})," ",(null==m?void 0:m.drugName)||"-",", ",(null==m?void 0:m.indication)||"-"]})})})]}),t.jsxs(R,{className:"bg-white dark:bg-slate-900 border dark:border-slate-700 text-slate-900 dark:text-slate-200",children:[t.jsx(I,{children:t.jsx(_,{children:"투약 기록 입력"})}),t.jsxs(P,{children:[t.jsx(_s,{tdmDrug:m,onComplete:d,onTableGenerated:()=>p(!0),initialAdministrations:b,initialConditions:x,onConditionsChange:v,onSaveRecords:e=>{if(r&&m){const t=e.map((e,t)=>({id:`${Date.now()}_${t}`,patientId:r.id,drugName:m.drugName,route:e.route,date:e.timeStr.split(" ")[0],time:e.timeStr.split(" ")[1],dose:Number(e.amount.split(" ")[0]),unit:e.amount.split(" ")[1]||"mg",isIVInfusion:"정맥"===e.route,infusionTime:e.injectionTime&&"-"!==e.injectionTime?parseInt(String(e.injectionTime).replace(/[^0-9]/g,"")):void 0,administrationTime:void 0,intervalHours:x.length>0?Number(x[0].intervalHours):void 0})),n=[...o.filter(e=>!(e.patientId===r.id&&e.drugName===(null==m?void 0:m.drugName))),...t];s(n)}},onRecordsChange:e=>{if(r&&m){const t=e.map((e,t)=>({id:`${Date.now()}_${t}`,patientId:r.id,drugName:m.drugName,route:e.route,date:e.timeStr.split(" ")[0],time:e.timeStr.split(" ")[1],dose:Number(e.amount.split(" ")[0]),unit:e.amount.split(" ")[1]||"mg",isIVInfusion:"정맥"===e.route,infusionTime:e.injectionTime&&"-"!==e.injectionTime?parseInt(String(e.injectionTime).replace(/[^0-9]/g,"")):"정맥"===e.route?0:void 0,administrationTime:void 0,intervalHours:x.length>0?Number(x[0].intervalHours):void 0})),n=[...o.filter(e=>!(e.patientId===r.id&&e.drugName===(null==m?void 0:m.drugName))),...t];s(n)}}}),t.jsxs("div",{className:"flex justify-between mt-6",children:[t.jsxs(A,{variant:"outline",type:"button",onClick:c,className:"flex items-center gap-2 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-200",children:[t.jsx(ee,{className:"h-4 w-4"}),"Lab"]}),t.jsxs(A,{onClick:async()=>{if(r){g(!0);try{const t=Ds({patients:e,prescriptions:n,bloodTests:l,drugAdministrations:o,selectedPatientId:r.id,selectedDrugName:null==m?void 0:m.drugName});t&&await Ss({body:t,persist:!0,patientId:r.id})}catch(t){}finally{g(!1),d()}}else d()},disabled:h,className:"flex items-center gap-2 w-[300px] bg-black dark:bg-blue-700 text-white font-bold text-lg py-3 px-6 justify-center dark:hover:bg-blue-800 disabled:opacity-60",children:[h?"처리 중...":"TDM Simulation",t.jsx(J,{className:"h-4 w-4"})]})]})]})]})]})},Ps=({patients:e,prescriptions:n,bloodTests:r,selectedPatient:a,setSelectedPatient:i,onAddPatient:s,onUpdatePatient:o,onDeletePatient:l,onAddPrescription:d,setPrescriptions:c,onAddBloodTest:u,onDeleteBloodTest:m,setBloodTests:f,onAddDrugAdministration:p,drugAdministrations:h,setDrugAdministrations:g,onResetWorkflow:x})=>{const[v,b]=D.useState(null),[j,y]=D.useState(1);D.useEffect(()=>{if(a)try{const e=window.localStorage.getItem(`tdmfriends:prescription:${a.id}`);if(!e)return;const t=JSON.parse(e),r=t.selectedTdmId||t.newlyAddedTdmId;if(!r)return;const i=n.find(e=>e.id===r&&e.patientId===a.id)||null;i&&b(i)}catch(e){}else b(null)},[a,null==a?void 0:a.id,n]);const w=[{id:1,title:"환자 등록 및 선택",icon:X,description:"환자를 선택하거나 신규 등록해주세요."},{id:2,title:"TDM 선택",icon:Z,description:"TDM 약물 정보를 입력합니다."},{id:3,title:"Lab",icon:te,description:"신기능 및 혈중 약물 농도 정보를 입력합니다."},{id:4,title:"투약 기록",icon:ae,description:"투약 기록을 입력합니다."},{id:5,title:"Let's TDM",icon:ne,description:"정밀의료 시뮬레이션 결과를 확인해보세요."}],N=a?n.filter(e=>e.patientId===a.id):[],C=a?r.filter(e=>e.patientId===a.id):[],S=e=>{switch(e){case 1:return null!==a;case 2:return a&&N.length>0;case 3:return a&&C.length>0;case 4:return a&&h.length>0;case 5:return a&&C.length>0&&N.length>0&&h.length>0;default:return!1}},T=()=>{j<5&&y(j+1)},k=()=>{j>1&&y(j-1)},M=()=>{if(a){const e=r.filter(e=>e.patientId!==a.id);f(e);const t=h.filter(e=>e.patientId!==a.id);g(t)}},$=w.filter(e=>S(e.id)).length,O=$/w.length*100;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs(R,{children:[t.jsxs(I,{children:[t.jsxs(_,{className:"flex items-center gap-2",children:[t.jsx(ne,{className:"h-5 w-5"}),"TDM 분석 워크플로우"]}),t.jsxs(E,{children:["각 단계를 순서대로 진행해 주세요",a&&` (${a.name} 환자)`]})]}),t.jsx(P,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[t.jsxs("span",{children:["진행률: ",$," / ",w.length,"단계 완료"]}),t.jsxs("span",{children:[Math.round(O),"%"]})]}),t.jsx(xi,{value:O,className:"w-full"}),t.jsx("div",{className:"grid grid-cols-5 gap-2",children:w.map(e=>{const n=e.icon,r=S(e.id),a=j===e.id,i=1===(s=e.id)||S(s-1);var s;return t.jsxs(A,{variant:a?"default":r?"secondary":"outline",className:"flex flex-col items-center gap-1 h-auto py-3 "+(i?"":"opacity-50 cursor-not-allowed"),disabled:!i,onClick:()=>{i&&y(e.id)},children:[t.jsx("div",{className:"flex items-center gap-1",children:r?t.jsx(q,{className:"h-4 w-4"}):t.jsx(n,{className:"h-4 w-4"})}),t.jsx("span",{className:"text-xs text-center leading-tight",children:e.title})]},e.id)})})]})})]}),t.jsxs("div",{className:"min-h-[600px]",children:[1===j&&t.jsx(vi,{patients:e,selectedPatient:a,setSelectedPatient:i,onAddPatient:s,onUpdatePatient:o,onDeletePatient:l,onNext:T,isCompleted:S(1)}),2===j&&t.jsx(ji,{patients:e,prescriptions:n,selectedPatient:a,selectedPrescription:v,setSelectedPrescription:b,onAddPrescription:(e,t)=>{e?(d(e),b(e)):c(t)},onNext:T,onPrev:k,isCompleted:S(2),bloodTests:r,setBloodTests:f,drugAdministrations:h,setDrugAdministrations:g,onClearLaterStepData:M,onResetWorkflow:()=>{M(),x()}}),3===j&&t.jsx(gs,{patients:e,bloodTests:r,selectedPatient:a,selectedPrescription:v,onAddBloodTest:u,onDeleteBloodTest:m,onNext:T,onPrev:k,isCompleted:S(3),prescriptions:n}),4===j&&t.jsx(Es,{patients:e,prescriptions:n,selectedPatient:a,selectedPrescription:v,onAddDrugAdministration:p,setDrugAdministrations:g,drugAdministrations:h,bloodTests:r,onNext:T,onPrev:k,isCompleted:S(4)}),5===j&&t.jsx(Ms,{patients:e,prescriptions:n,bloodTests:r,selectedPatient:a,selectedPrescription:v,drugAdministrations:h,onPrev:k})]})]})};var As="Switch",[$s,Os]=l(As),[Ls,Fs]=$s(As),Vs=D.forwardRef((e,n)=>{const{__scopeSwitch:i,name:l,checked:d,defaultChecked:c,required:u,disabled:m,value:f="on",onCheckedChange:p,form:h,...g}=e,[x,v]=D.useState(null),b=r(n,e=>v(e)),j=D.useRef(!1),y=!x||(h||!!x.closest("form")),[w=!1,N]=a({prop:d,defaultProp:c,onChange:p});return t.jsxs(Ls,{scope:i,checked:w,disabled:m,children:[t.jsx(s.button,{type:"button",role:"switch","aria-checked":w,"aria-required":u,"data-state":Us(w),"data-disabled":m?"":void 0,disabled:m,value:f,...g,ref:b,onClick:o(e.onClick,e=>{N(e=>!e),y&&(j.current=e.isPropagationStopped(),j.current||e.stopPropagation())})}),y&&t.jsx(Bs,{control:x,bubbles:!j.current,name:l,value:f,checked:w,required:u,disabled:m,form:h,style:{transform:"translateX(-100%)"}})]})});Vs.displayName=As;var Hs="SwitchThumb",Ks=D.forwardRef((e,n)=>{const{__scopeSwitch:r,...a}=e,i=Fs(Hs,r);return t.jsx(s.span,{"data-state":Us(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:n})});Ks.displayName=Hs;var Bs=e=>{const{control:n,checked:r,bubbles:a=!0,...i}=e,s=D.useRef(null),o=Pt(r),l=y(n);return D.useEffect(()=>{const e=s.current,t=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(t,"checked").set;if(o!==r&&n){const t=new Event("click",{bubbles:a});n.call(e,r),e.dispatchEvent(t)}},[o,r,a]),t.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...i,tabIndex:-1,ref:s,style:{...e.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Us(e){return e?"checked":"unchecked"}var zs=Vs,Ws=Ks;const Gs=D.forwardRef(({className:e,...n},r)=>t.jsx(zs,{className:c("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...n,ref:r,children:t.jsx(Ws,{className:c("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Gs.displayName=zs.displayName;var Ys=["Enter"," "],Xs=["ArrowUp","PageDown","End"],qs=["ArrowDown","PageUp","Home",...Xs],Js={ltr:[...Ys,"ArrowRight"],rtl:[...Ys,"ArrowLeft"]},Zs={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Qs="Menu",[eo,to,no]=n(Qs),[ro,ao]=l(Qs,[no,u,Oe]),io=u(),so=Oe(),[oo,lo]=ro(Qs),[co,uo]=ro(Qs),mo=e=>{const{__scopeMenu:n,open:r=!1,children:a,dir:s,onOpenChange:o,modal:l=!0}=e,d=io(n),[c,u]=D.useState(null),m=D.useRef(!1),f=i(o),p=Me(s);return D.useEffect(()=>{const e=()=>{m.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>m.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),t.jsx(v,{...d,children:t.jsx(oo,{scope:n,open:r,onOpenChange:f,content:c,onContentChange:u,children:t.jsx(co,{scope:n,onClose:D.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:m,dir:p,modal:l,children:a})})})};mo.displayName=Qs;var fo=D.forwardRef((e,n)=>{const{__scopeMenu:r,...a}=e,i=io(r);return t.jsx(m,{...i,...a,ref:n})});fo.displayName="MenuAnchor";var po="MenuPortal",[ho,go]=ro(po,{forceMount:void 0}),xo=e=>{const{__scopeMenu:n,forceMount:r,children:a,container:i}=e,s=lo(po,n);return t.jsx(ho,{scope:n,forceMount:r,children:t.jsx(d,{present:r||s.open,children:t.jsx(b,{asChild:!0,container:i,children:a})})})};xo.displayName=po;var vo="MenuContent",[bo,jo]=ro(vo),yo=D.forwardRef((e,n)=>{const r=go(vo,e.__scopeMenu),{forceMount:a=r.forceMount,...i}=e,s=lo(vo,e.__scopeMenu),o=uo(vo,e.__scopeMenu);return t.jsx(eo.Provider,{scope:e.__scopeMenu,children:t.jsx(d,{present:a||s.open,children:t.jsx(eo.Slot,{scope:e.__scopeMenu,children:o.modal?t.jsx(wo,{...i,ref:n}):t.jsx(No,{...i,ref:n})})})})}),wo=D.forwardRef((e,n)=>{const a=lo(vo,e.__scopeMenu),i=D.useRef(null),s=r(n,i);return D.useEffect(()=>{const e=i.current;if(e)return Ht(e)},[]),t.jsx(Co,{...e,ref:s,trapFocus:a.open,disableOutsidePointerEvents:a.open,disableOutsideScroll:!0,onFocusOutside:o(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>a.onOpenChange(!1)})}),No=D.forwardRef((e,n)=>{const r=lo(vo,e.__scopeMenu);return t.jsx(Co,{...e,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),Co=D.forwardRef((e,n)=>{const{__scopeMenu:a,loop:i=!1,trapFocus:s,onOpenAutoFocus:l,onCloseAutoFocus:d,disableOutsidePointerEvents:c,onEntryFocus:u,onEscapeKeyDown:m,onPointerDownOutside:g,onFocusOutside:x,onInteractOutside:v,onDismiss:b,disableOutsideScroll:j,...y}=e,w=lo(vo,a),N=uo(vo,a),C=io(a),S=so(a),T=to(a),[k,M]=D.useState(null),R=D.useRef(null),I=r(n,R,w.onContentChange),_=D.useRef(0),E=D.useRef(""),P=D.useRef(0),A=D.useRef(null),$=D.useRef("right"),O=D.useRef(0),L=j?Mn:D.Fragment,F=j?{as:f,allowPinchZoom:!0}:void 0,V=e=>{var t,n;const r=E.current+e,a=T().filter(e=>!e.disabled),i=document.activeElement,s=null==(t=a.find(e=>e.ref.current===i))?void 0:t.textValue,o=function(e,t,n){const r=t.length>1&&Array.from(t).every(e=>e===t[0]),a=r?t[0]:t,i=n?e.indexOf(n):-1;let s=(o=e,l=Math.max(i,0),o.map((e,t)=>o[(l+t)%o.length]));var o,l;1===a.length&&(s=s.filter(e=>e!==n));const d=s.find(e=>e.toLowerCase().startsWith(a.toLowerCase()));return d!==n?d:void 0}(a.map(e=>e.textValue),r,s),l=null==(n=a.find(e=>e.textValue===o))?void 0:n.ref.current;!function e(t){E.current=t,window.clearTimeout(_.current),""!==t&&(_.current=window.setTimeout(()=>e(""),1e3))}(r),l&&setTimeout(()=>l.focus())};D.useEffect(()=>()=>window.clearTimeout(_.current),[]),wt();const H=D.useCallback(e=>{var t,n;return $.current===(null==(t=A.current)?void 0:t.side)&&function(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return function(e,t){const{x:n,y:r}=e;let a=!1;for(let i=0,s=t.length-1;i<t.length;s=i++){const e=t[i].x,o=t[i].y,l=t[s].x,d=t[s].y;o>r!=d>r&&n<(l-e)*(r-o)/(d-o)+e&&(a=!a)}return a}(n,t)}(e,null==(n=A.current)?void 0:n.area)},[]);return t.jsx(bo,{scope:a,searchRef:E,onItemEnter:D.useCallback(e=>{H(e)&&e.preventDefault()},[H]),onItemLeave:D.useCallback(e=>{var t;H(e)||(null==(t=R.current)||t.focus(),M(null))},[H]),onTriggerLeave:D.useCallback(e=>{H(e)&&e.preventDefault()},[H]),pointerGraceTimerRef:P,onPointerGraceIntentChange:D.useCallback(e=>{A.current=e},[]),children:t.jsx(L,{...F,children:t.jsx(Tt,{asChild:!0,trapped:s,onMountAutoFocus:o(l,e=>{var t;e.preventDefault(),null==(t=R.current)||t.focus({preventScroll:!0})}),onUnmountAutoFocus:d,children:t.jsx(p,{asChild:!0,disableOutsidePointerEvents:c,onEscapeKeyDown:m,onPointerDownOutside:g,onFocusOutside:x,onInteractOutside:v,onDismiss:b,children:t.jsx(We,{asChild:!0,...S,dir:N.dir,orientation:"vertical",loop:i,currentTabStopId:k,onCurrentTabStopIdChange:M,onEntryFocus:o(u,e=>{N.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:t.jsx(h,{role:"menu","aria-orientation":"vertical","data-state":qo(w.open),"data-radix-menu-content":"",dir:N.dir,...C,...y,ref:I,style:{outline:"none",...y.style},onKeyDown:o(y.onKeyDown,e=>{const t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,r=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&r&&V(e.key));const a=R.current;if(e.target!==a)return;if(!qs.includes(e.key))return;e.preventDefault();const i=T().filter(e=>!e.disabled).map(e=>e.ref.current);Xs.includes(e.key)&&i.reverse(),function(e){const t=document.activeElement;for(const n of e){if(n===t)return;if(n.focus(),document.activeElement!==t)return}}(i)}),onBlur:o(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(_.current),E.current="")}),onPointerMove:o(e.onPointerMove,Qo(e=>{const t=e.target,n=O.current!==e.clientX;if(e.currentTarget.contains(t)&&n){const t=e.clientX>O.current?"right":"left";$.current=t,O.current=e.clientX}}))})})})})})})});yo.displayName=vo;var Do=D.forwardRef((e,n)=>{const{__scopeMenu:r,...a}=e;return t.jsx(s.div,{role:"group",...a,ref:n})});Do.displayName="MenuGroup";var So=D.forwardRef((e,n)=>{const{__scopeMenu:r,...a}=e;return t.jsx(s.div,{...a,ref:n})});So.displayName="MenuLabel";var To="MenuItem",ko="menu.itemSelect",Mo=D.forwardRef((e,n)=>{const{disabled:a=!1,onSelect:i,...s}=e,l=D.useRef(null),d=uo(To,e.__scopeMenu),c=jo(To,e.__scopeMenu),u=r(n,l),m=D.useRef(!1);return t.jsx(Ro,{...s,ref:u,disabled:a,onClick:o(e.onClick,()=>{const e=l.current;if(!a&&e){const t=new CustomEvent(ko,{bubbles:!0,cancelable:!0});e.addEventListener(ko,e=>null==i?void 0:i(e),{once:!0}),C(e,t),t.defaultPrevented?m.current=!1:d.onClose()}}),onPointerDown:t=>{var n;null==(n=e.onPointerDown)||n.call(e,t),m.current=!0},onPointerUp:o(e.onPointerUp,e=>{var t;m.current||null==(t=e.currentTarget)||t.click()}),onKeyDown:o(e.onKeyDown,e=>{const t=""!==c.searchRef.current;a||t&&" "===e.key||Ys.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});Mo.displayName=To;var Ro=D.forwardRef((e,n)=>{const{__scopeMenu:a,disabled:i=!1,textValue:l,...d}=e,c=jo(To,a),u=so(a),m=D.useRef(null),f=r(n,m),[p,h]=D.useState(!1),[g,x]=D.useState("");return D.useEffect(()=>{const e=m.current;e&&x((e.textContent??"").trim())},[d.children]),t.jsx(eo.ItemSlot,{scope:a,disabled:i,textValue:l??g,children:t.jsx(Ge,{asChild:!0,...u,focusable:!i,children:t.jsx(s.div,{role:"menuitem","data-highlighted":p?"":void 0,"aria-disabled":i||void 0,"data-disabled":i?"":void 0,...d,ref:f,onPointerMove:o(e.onPointerMove,Qo(e=>{if(i)c.onItemLeave(e);else if(c.onItemEnter(e),!e.defaultPrevented){e.currentTarget.focus({preventScroll:!0})}})),onPointerLeave:o(e.onPointerLeave,Qo(e=>c.onItemLeave(e))),onFocus:o(e.onFocus,()=>h(!0)),onBlur:o(e.onBlur,()=>h(!1))})})})}),Io=D.forwardRef((e,n)=>{const{checked:r=!1,onCheckedChange:a,...i}=e;return t.jsx(Fo,{scope:e.__scopeMenu,checked:r,children:t.jsx(Mo,{role:"menuitemcheckbox","aria-checked":Jo(r)?"mixed":r,...i,ref:n,"data-state":Zo(r),onSelect:o(i.onSelect,()=>null==a?void 0:a(!!Jo(r)||!r),{checkForDefaultPrevented:!1})})})});Io.displayName="MenuCheckboxItem";var _o="MenuRadioGroup",[Eo,Po]=ro(_o,{value:void 0,onValueChange:()=>{}}),Ao=D.forwardRef((e,n)=>{const{value:r,onValueChange:a,...s}=e,o=i(a);return t.jsx(Eo,{scope:e.__scopeMenu,value:r,onValueChange:o,children:t.jsx(Do,{...s,ref:n})})});Ao.displayName=_o;var $o="MenuRadioItem",Oo=D.forwardRef((e,n)=>{const{value:r,...a}=e,i=Po($o,e.__scopeMenu),s=r===i.value;return t.jsx(Fo,{scope:e.__scopeMenu,checked:s,children:t.jsx(Mo,{role:"menuitemradio","aria-checked":s,...a,ref:n,"data-state":Zo(s),onSelect:o(a.onSelect,()=>{var e;return null==(e=i.onValueChange)?void 0:e.call(i,r)},{checkForDefaultPrevented:!1})})})});Oo.displayName=$o;var Lo="MenuItemIndicator",[Fo,Vo]=ro(Lo,{checked:!1}),Ho=D.forwardRef((e,n)=>{const{__scopeMenu:r,forceMount:a,...i}=e,o=Vo(Lo,r);return t.jsx(d,{present:a||Jo(o.checked)||!0===o.checked,children:t.jsx(s.span,{...i,ref:n,"data-state":Zo(o.checked)})})});Ho.displayName=Lo;var Ko=D.forwardRef((e,n)=>{const{__scopeMenu:r,...a}=e;return t.jsx(s.div,{role:"separator","aria-orientation":"horizontal",...a,ref:n})});Ko.displayName="MenuSeparator";var Bo=D.forwardRef((e,n)=>{const{__scopeMenu:r,...a}=e,i=io(r);return t.jsx(g,{...i,...a,ref:n})});Bo.displayName="MenuArrow";var[Uo,zo]=ro("MenuSub"),Wo="MenuSubTrigger",Go=D.forwardRef((e,n)=>{const r=lo(Wo,e.__scopeMenu),a=uo(Wo,e.__scopeMenu),i=zo(Wo,e.__scopeMenu),s=jo(Wo,e.__scopeMenu),l=D.useRef(null),{pointerGraceTimerRef:d,onPointerGraceIntentChange:c}=s,u={__scopeMenu:e.__scopeMenu},m=D.useCallback(()=>{l.current&&window.clearTimeout(l.current),l.current=null},[]);return D.useEffect(()=>m,[m]),D.useEffect(()=>{const e=d.current;return()=>{window.clearTimeout(e),c(null)}},[d,c]),t.jsx(fo,{asChild:!0,...u,children:t.jsx(Ro,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":i.contentId,"data-state":qo(r.open),...e,ref:N(n,i.onTriggerChange),onClick:t=>{var n;null==(n=e.onClick)||n.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:o(e.onPointerMove,Qo(t=>{s.onItemEnter(t),t.defaultPrevented||e.disabled||r.open||l.current||(s.onPointerGraceIntentChange(null),l.current=window.setTimeout(()=>{r.onOpenChange(!0),m()},100))})),onPointerLeave:o(e.onPointerLeave,Qo(e=>{var t,n;m();const a=null==(t=r.content)?void 0:t.getBoundingClientRect();if(a){const t=null==(n=r.content)?void 0:n.dataset.side,i="right"===t,o=i?-5:5,l=a[i?"left":"right"],c=a[i?"right":"left"];s.onPointerGraceIntentChange({area:[{x:e.clientX+o,y:e.clientY},{x:l,y:a.top},{x:c,y:a.top},{x:c,y:a.bottom},{x:l,y:a.bottom}],side:t}),window.clearTimeout(d.current),d.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(e),e.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:o(e.onKeyDown,t=>{var n;const i=""!==s.searchRef.current;e.disabled||i&&" "===t.key||Js[a.dir].includes(t.key)&&(r.onOpenChange(!0),null==(n=r.content)||n.focus(),t.preventDefault())})})})});Go.displayName=Wo;var Yo="MenuSubContent",Xo=D.forwardRef((e,n)=>{const a=go(vo,e.__scopeMenu),{forceMount:i=a.forceMount,...s}=e,l=lo(vo,e.__scopeMenu),c=uo(vo,e.__scopeMenu),u=zo(Yo,e.__scopeMenu),m=D.useRef(null),f=r(n,m);return t.jsx(eo.Provider,{scope:e.__scopeMenu,children:t.jsx(d,{present:i||l.open,children:t.jsx(eo.Slot,{scope:e.__scopeMenu,children:t.jsx(Co,{id:u.contentId,"aria-labelledby":u.triggerId,...s,ref:f,align:"start",side:"rtl"===c.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;c.isUsingKeyboardRef.current&&(null==(t=m.current)||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:o(e.onFocusOutside,e=>{e.target!==u.trigger&&l.onOpenChange(!1)}),onEscapeKeyDown:o(e.onEscapeKeyDown,e=>{c.onClose(),e.preventDefault()}),onKeyDown:o(e.onKeyDown,e=>{var t;const n=e.currentTarget.contains(e.target),r=Zs[c.dir].includes(e.key);n&&r&&(l.onOpenChange(!1),null==(t=u.trigger)||t.focus(),e.preventDefault())})})})})})});function qo(e){return e?"open":"closed"}function Jo(e){return"indeterminate"===e}function Zo(e){return Jo(e)?"indeterminate":e?"checked":"unchecked"}function Qo(e){return t=>"mouse"===t.pointerType?e(t):void 0}Xo.displayName=Yo;var el=mo,tl=fo,nl=xo,rl=yo,al=Do,il=So,sl=Mo,ol=Io,ll=Ao,dl=Oo,cl=Ho,ul=Ko,ml=Bo,fl=Go,pl=Xo,hl="DropdownMenu",[gl,xl]=l(hl,[ao]),vl=ao(),[bl,jl]=gl(hl),yl=e=>{const{__scopeDropdownMenu:n,children:r,dir:i,open:s,defaultOpen:o,onOpenChange:l,modal:d=!0}=e,c=vl(n),u=D.useRef(null),[m=!1,f]=a({prop:s,defaultProp:o,onChange:l});return t.jsx(bl,{scope:n,triggerId:Se(),triggerRef:u,contentId:Se(),open:m,onOpenChange:f,onOpenToggle:D.useCallback(()=>f(e=>!e),[f]),modal:d,children:t.jsx(el,{...c,open:m,onOpenChange:f,dir:i,modal:d,children:r})})};yl.displayName=hl;var wl="DropdownMenuTrigger",Nl=D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,disabled:a=!1,...i}=e,l=jl(wl,r),d=vl(r);return t.jsx(tl,{asChild:!0,...d,children:t.jsx(s.button,{type:"button",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":l.open?l.contentId:void 0,"data-state":l.open?"open":"closed","data-disabled":a?"":void 0,disabled:a,...i,ref:N(n,l.triggerRef),onPointerDown:o(e.onPointerDown,e=>{a||0!==e.button||!1!==e.ctrlKey||(l.onOpenToggle(),l.open||e.preventDefault())}),onKeyDown:o(e.onKeyDown,e=>{a||(["Enter"," "].includes(e.key)&&l.onOpenToggle(),"ArrowDown"===e.key&&l.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});Nl.displayName=wl;var Cl=e=>{const{__scopeDropdownMenu:n,...r}=e,a=vl(n);return t.jsx(nl,{...a,...r})};Cl.displayName="DropdownMenuPortal";var Dl="DropdownMenuContent",Sl=D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...a}=e,i=jl(Dl,r),s=vl(r),l=D.useRef(!1);return t.jsx(rl,{id:i.contentId,"aria-labelledby":i.triggerId,...s,...a,ref:n,onCloseAutoFocus:o(e.onCloseAutoFocus,e=>{var t;l.current||null==(t=i.triggerRef.current)||t.focus(),l.current=!1,e.preventDefault()}),onInteractOutside:o(e.onInteractOutside,e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;i.modal&&!r||(l.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Sl.displayName=Dl;D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...a}=e,i=vl(r);return t.jsx(al,{...i,...a,ref:n})}).displayName="DropdownMenuGroup";var Tl=D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...a}=e,i=vl(r);return t.jsx(il,{...i,...a,ref:n})});Tl.displayName="DropdownMenuLabel";var kl=D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...a}=e,i=vl(r);return t.jsx(sl,{...i,...a,ref:n})});kl.displayName="DropdownMenuItem";var Ml=D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...a}=e,i=vl(r);return t.jsx(ol,{...i,...a,ref:n})});Ml.displayName="DropdownMenuCheckboxItem";D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...a}=e,i=vl(r);return t.jsx(ll,{...i,...a,ref:n})}).displayName="DropdownMenuRadioGroup";var Rl=D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...a}=e,i=vl(r);return t.jsx(dl,{...i,...a,ref:n})});Rl.displayName="DropdownMenuRadioItem";var Il=D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...a}=e,i=vl(r);return t.jsx(cl,{...i,...a,ref:n})});Il.displayName="DropdownMenuItemIndicator";var _l=D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...a}=e,i=vl(r);return t.jsx(ul,{...i,...a,ref:n})});_l.displayName="DropdownMenuSeparator";D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...a}=e,i=vl(r);return t.jsx(ml,{...i,...a,ref:n})}).displayName="DropdownMenuArrow";var El=D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...a}=e,i=vl(r);return t.jsx(fl,{...i,...a,ref:n})});El.displayName="DropdownMenuSubTrigger";var Pl=D.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...a}=e,i=vl(r);return t.jsx(pl,{...i,...a,ref:n,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Pl.displayName="DropdownMenuSubContent";var Al=Cl,$l=Sl,Ol=Tl,Ll=kl,Fl=Ml,Vl=Rl,Hl=Il,Kl=_l,Bl=El,Ul=Pl;const zl=yl,Wl=Nl;D.forwardRef(({className:e,inset:n,children:r,...a},i)=>t.jsxs(Bl,{ref:i,className:c("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",e),...a,children:[r,t.jsx(ie,{className:"ml-auto h-4 w-4"})]})).displayName=Bl.displayName;D.forwardRef(({className:e,...n},r)=>t.jsx(Ul,{ref:r,className:c("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})).displayName=Ul.displayName;const Gl=D.forwardRef(({className:e,sideOffset:n=4,...r},a)=>t.jsx(Al,{children:t.jsx($l,{ref:a,sideOffset:n,className:c("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));Gl.displayName=$l.displayName;const Yl=D.forwardRef(({className:e,inset:n,...r},a)=>t.jsx(Ll,{ref:a,className:c("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",e),...r}));Yl.displayName=Ll.displayName;D.forwardRef(({className:e,children:n,checked:r,...a},i)=>t.jsxs(Fl,{ref:i,className:c("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...a,children:[t.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(Hl,{children:t.jsx(H,{className:"h-4 w-4"})})}),n]})).displayName=Fl.displayName;D.forwardRef(({className:e,children:n,...r},a)=>t.jsxs(Vl,{ref:a,className:c("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[t.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(Hl,{children:t.jsx(se,{className:"h-2 w-2 fill-current"})})}),n]})).displayName=Vl.displayName;const Xl=D.forwardRef(({className:e,inset:n,...r},a)=>t.jsx(Ol,{ref:a,className:c("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",e),...r}));Xl.displayName=Ol.displayName;const ql=D.forwardRef(({className:e,...n},r)=>t.jsx(Kl,{ref:r,className:c("-mx-1 my-1 h-px bg-muted",e),...n}));ql.displayName=Kl.displayName;var Jl="Avatar",[Zl,Ql]=l(Jl),[ed,td]=Zl(Jl),nd=D.forwardRef((e,n)=>{const{__scopeAvatar:r,...a}=e,[i,o]=D.useState("idle");return t.jsx(ed,{scope:r,imageLoadingStatus:i,onImageLoadingStatusChange:o,children:t.jsx(s.span,{...a,ref:n})})});nd.displayName=Jl;var rd="AvatarImage",ad=D.forwardRef((n,r)=>{const{__scopeAvatar:a,src:o,onLoadingStatusChange:l=()=>{},...d}=n,c=td(rd,a),u=function(t,n){const[r,a]=D.useState("idle");return e(()=>{if(!t)return void a("error");let e=!0;const r=new window.Image,i=t=>()=>{e&&a(t)};return a("loading"),r.onload=i("loaded"),r.onerror=i("error"),r.src=t,n&&(r.referrerPolicy=n),()=>{e=!1}},[t,n]),r}(o,d.referrerPolicy),m=i(e=>{l(e),c.onImageLoadingStatusChange(e)});return e(()=>{"idle"!==u&&m(u)},[u,m]),"loaded"===u?t.jsx(s.img,{...d,ref:r,src:o}):null});ad.displayName=rd;var id="AvatarFallback",sd=D.forwardRef((e,n)=>{const{__scopeAvatar:r,delayMs:a,...i}=e,o=td(id,r),[l,d]=D.useState(void 0===a);return D.useEffect(()=>{if(void 0!==a){const e=window.setTimeout(()=>d(!0),a);return()=>window.clearTimeout(e)}},[a]),l&&"loaded"!==o.imageLoadingStatus?t.jsx(s.span,{...i,ref:n}):null});sd.displayName=id;var od=nd,ld=ad,dd=sd;const cd=D.forwardRef(({className:e,...n},r)=>t.jsx(od,{ref:r,className:c("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...n}));cd.displayName=od.displayName;const ud=D.forwardRef(({className:e,...n},r)=>t.jsx(ld,{ref:r,className:c("aspect-square h-full w-full",e),...n}));ud.displayName=ld.displayName;const md=D.forwardRef(({className:e,...n},r)=>t.jsx(dd,{ref:r,className:c("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...n}));md.displayName=dd.displayName;const fd=({onLogout:e})=>{const[n,r]=D.useState([]),[a,i]=D.useState([]),[s,o]=D.useState([]),[l,d]=D.useState([]),[c,u]=D.useState(null),[m,f]=D.useState(!1),[p,h]=D.useState(!1);D.useEffect(()=>{const e=window.document.documentElement;m?e.classList.add("dark"):e.classList.remove("dark")},[m]),D.useEffect(()=>{const e=(oe.getJSON(le.patients,[])||[]).map(e=>({...e,createdAt:e.createdAt?new Date(e.createdAt):new Date}));r(e);const t=(oe.getJSON(le.prescriptions,[])||[]).map(e=>({...e,startDate:e.startDate?new Date(e.startDate):new Date,endDate:e.endDate?new Date(e.endDate):void 0}));i(t);const n=(oe.getJSON(le.bloodTests,[])||[]).map(e=>({...e,testDate:e.testDate?new Date(e.testDate):new Date}));o(n);const a=oe.getJSON(le.drugAdministrations,[]);d(a||[]);const s=oe.getJSON(le.selectedPatientId,null);if(s){const t=e.find(e=>e.id===s)||null;u(t)}h(!0)},[]),D.useEffect(()=>{p&&oe.setJSON(le.patients,n)},[p,n]),D.useEffect(()=>{p&&oe.setJSON(le.prescriptions,a)},[p,a]),D.useEffect(()=>{p&&oe.setJSON(le.bloodTests,s)},[p,s]),D.useEffect(()=>{p&&oe.setJSON(le.drugAdministrations,l)},[p,l]),D.useEffect(()=>{p&&((null==c?void 0:c.id)?oe.setJSON(le.selectedPatientId,c.id):oe.remove(le.selectedPatientId))},[p,c]);const g=e=>{r([...n,e])};return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950",children:[t.jsx("header",{className:"bg-white dark:bg-slate-900 shadow-sm border-b border-slate-200 dark:border-slate-700",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"flex justify-between items-center py-6",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(ne,{className:"h-8 w-8 text-blue-600 dark:text-blue-300"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"TDM Friends"}),t.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Precision Medicine의 시작"})]})]}),t.jsxs("div",{className:"flex items-center gap-6",children:[t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:["등록된 환자 수: ",n.length]}),t.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:["선택된 환자: ",(null==c?void 0:c.name)||"None"]})]}),t.jsxs(zl,{children:[t.jsx(Wl,{asChild:!0,children:t.jsxs(A,{variant:"ghost",className:"flex items-center gap-2",children:[t.jsxs(cd,{className:"h-9 w-9",children:[t.jsx(ud,{src:"https://avatar.vercel.sh/user.png",alt:"User"}),t.jsx(md,{children:"사용자"})]}),t.jsx("span",{className:"font-medium",children:"사용자"})]})}),t.jsxs(Gl,{className:"w-56",align:"end",forceMount:!0,children:[t.jsx(Xl,{className:"font-normal",children:t.jsxs("div",{className:"flex flex-col space-y-1",children:[t.jsx("p",{className:"text-sm font-medium leading-none",children:"사용자"}),t.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:"user@pk-friends.com"}),t.jsx("p",{className:"text-xs leading-none text-muted-foreground pt-1",children:"소속: PK 프렌즈 대학병원"})]})}),t.jsx(ql,{}),t.jsx(Yl,{onSelect:e=>e.preventDefault(),children:t.jsxs("div",{className:"flex items-center justify-between w-full",children:[t.jsx("span",{children:m?"다크 모드":"라이트 모드"}),t.jsx(Gs,{checked:m,onCheckedChange:f,className:"ml-4"})]})}),t.jsx(Yl,{children:"프로필 설정"}),t.jsx(Yl,{onClick:e,children:"로그아웃"})]})]})]})]})})}),t.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:t.jsxs(mt,{defaultValue:"workflow",className:"space-y-6",children:[t.jsxs(ft,{className:"grid w-full grid-cols-4 bg-white dark:bg-slate-800 border dark:border-slate-700 shadow-sm h-[52px]",children:[t.jsxs(pt,{value:"workflow",className:"flex items-center justify-center col-span-3 rounded-l-xl px-6 h-[52px] min-h-[52px] max-h-[52px] text-slate-900 dark:text-slate-200 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white dark:data-[state=inactive]:bg-slate-800 dark:data-[state=inactive]:text-slate-400 dark:focus:bg-slate-700 dark:focus:text-white dark:hover:bg-slate-700 dark:hover:text-white border-r border-slate-200 dark:border-slate-700 leading-none",children:[t.jsx(ne,{className:"h-4 w-4 mr-2"}),"Let's TDM"]}),t.jsxs(pt,{value:"management",className:"flex items-center justify-center col-span-1 rounded-r-xl px-6 h-[52px] min-h-[52px] max-h-[52px] text-slate-900 dark:text-slate-200 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white dark:data-[state=inactive]:bg-slate-800 dark:data-[state=inactive]:text-slate-400 dark:focus:bg-slate-700 dark:focus:text-white dark:hover:bg-slate-700 dark:hover:text-white border-l border-slate-200 dark:border-slate-700 leading-none",children:[t.jsx(X,{className:"h-4 w-4 mr-2"}),"환자 관리"]})]}),t.jsx(ht,{value:"workflow",children:t.jsx(Ps,{patients:n,prescriptions:a,bloodTests:s,selectedPatient:c,setSelectedPatient:u,onAddPatient:g,onAddPrescription:(e,t)=>{t?i(e?[...t,e]:t):e&&i([e,...a])},setPrescriptions:i,onAddBloodTest:e=>{o([...s,e])},onDeleteBloodTest:e=>{o(s.filter(t=>t.id!==e))},setBloodTests:o,onAddDrugAdministration:e=>{d([...l,e])},drugAdministrations:l,setDrugAdministrations:d,onUpdatePatient:e=>{r(n.map(t=>t.id===e.id?e:t))},onDeletePatient:e=>{r(n.filter(t=>t.id!==e))},onResetWorkflow:()=>{i([]),o([]),d([])}})}),t.jsx(ht,{value:"management",children:t.jsxs(R,{children:[t.jsxs(I,{children:[t.jsxs(_,{className:"flex items-center gap-2",children:[t.jsx(X,{className:"h-5 w-5"}),"환자 관리"]}),t.jsx(E,{children:"환자 관리 및 히스토리 조회"})]}),t.jsx(P,{children:t.jsx(ei,{onAddPatient:g,onUpdatePatient:e=>r(t=>t.map(t=>t.id===e.id?e:t)),onDeletePatient:e=>r(t=>t.filter(t=>t.id!==e)),patients:n,selectedPatient:c,setSelectedPatient:u})})]})})]})})]})};export{fd as default};
