import{j as e,F as s,J as a}from"./index-B2apw5Xw.js";import{r as t}from"./react-vendor-B8CcSR15.js";import{B as l}from"./button-CNch1c_D.js";import{C as r,a as n,b as o,c as i,d as c}from"./card-B9Kwb8SV.js";import{I as m}from"./input-BL8cETDw.js";import{L as d,S as h,d as x,e as u,f as j,g as p,A as f,h as g,i as N,j as v,k as b,l as w,n as S}from"./alert-dialog-DEfi66yj.js";import{H as y}from"./Header-ByXwxB6y.js";import{s as z,S as C}from"./storage-GRehWpHF.js";import{g as T}from"./ui-vendor-CU6wz7s2.js";import"./index-CtqvmGU1.js";const k=({onBack:k,onComplete:R,initialPhoneNumber:A=""})=>{const[F,Z]=t.useState({name:"",phoneNumber:A,organization:"",medicalRole:""}),[J,O]=t.useState(!1),[I,B]=t.useState(!1);t.useEffect(()=>{A&&Z(e=>({...e,phoneNumber:A}))},[A]);const E=(e,s)=>{if(!/^[가-힣a-zA-Z\s\-']*$/.test(e)){const a=e.replace(/[^가-힣a-zA-Z\s\-']/g,""),t=a!==s&&e!==s,l=E(a,s);return{value:l.value,shouldShowToast:t||l.shouldShowToast}}const a=/[가-힣]/.test(e),t=/[a-zA-Z]/.test(e),l=/[가-힣]/.test(s),r=/[a-zA-Z]/.test(s);if(a&&t&&(!l||!r))return{value:s,shouldShowToast:!0};if(a){if(e.length>50){const a=s.length<=50&&e.length>50;return{value:e.slice(0,50),shouldShowToast:a}}}else if(t&&e.length>100){const a=s.length<=100&&e.length>100;return{value:e.slice(0,100),shouldShowToast:a}}return{value:e,shouldShowToast:!1}},H=(e,s)=>{if("name"===e){if(I)return void Z(a=>({...a,[e]:s}));const t=F.name,l=E(s,t);if(l.shouldShowToast){const e=/[가-힣]/.test(s),t=/[a-zA-Z]/.test(s);e&&s.length>50?a.error("한글 이름은 최대 50자까지 입력 가능합니다."):t&&s.length>100?a.error("영문 이름은 최대 100자까지 입력 가능합니다."):a.error("이름은 한글 또는 영문으로 입력해 주세요. \n (띄어쓰기, 하이픈(-), 아포스트로피(') 사용 가능)")}Z(s=>({...s,[e]:l.value}))}else Z(a=>({...a,[e]:s}))},L=()=>""!==F.name.trim()&&""!==F.phoneNumber.trim()&&""!==F.organization&&""!==F.medicalRole;return e.jsxs("div",{className:"min-h-screen flex flex-col bg-slate-100 dark:bg-slate-900",children:[e.jsx(y,{}),e.jsx("div",{className:"flex flex-1 items-center justify-center p-4",children:e.jsxs(r,{className:"w-full max-w-md",children:[e.jsxs(n,{className:"text-center",children:[e.jsx(o,{className:"text-2xl font-bold",children:"회원정보 입력"}),e.jsx(i,{children:"회원가입을 위한 정보를 입력해주세요"})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"name",className:"text-sm font-medium",children:["이름 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{id:"name",type:"text",placeholder:"이름을 입력해주세요",value:F.name,onChange:e=>H("name",e.target.value),onCompositionStart:()=>{B(!0)},onCompositionEnd:e=>{B(!1),H("name",e.currentTarget.value)},maxLength:100})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"phoneNumber",className:"text-sm font-medium",children:["휴대폰 번호 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{id:"phoneNumber",type:"tel",placeholder:"휴대폰 번호를 입력해주세요 ('-' 제외)",value:F.phoneNumber,onChange:e=>H("phoneNumber",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"organization",className:"text-sm font-medium",children:["소속기관 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(h,{value:F.organization,onValueChange:e=>H("organization",e),children:[e.jsx(x,{children:e.jsx(u,{placeholder:"소속기관을 선택해주세요"})}),e.jsx(j,{children:["앳플로우"].map(s=>e.jsx(p,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"medicalRole",className:"text-sm font-medium",children:["의료진 구분 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(h,{value:F.medicalRole,onValueChange:e=>H("medicalRole",e),children:[e.jsx(x,{children:e.jsx(u,{placeholder:"의료진 구분을 선택해주세요"})}),e.jsx(j,{children:["의사","간호사","기타"].map(s=>e.jsx(p,{value:s,children:s},s))})]})]})]}),e.jsx(l,{onClick:()=>{L()?O(!0):a.error("모든 필수 항목을 입력해주세요.")},className:"w-full",disabled:!L(),children:"회원가입 완료"}),e.jsxs(l,{variant:"ghost",onClick:k,className:"w-full flex items-center gap-2 text-sm",children:[e.jsx(T,{className:"h-4 w-4"}),"로그인으로 돌아가기"]})]})]})}),e.jsx(s,{}),e.jsx(f,{open:J,onOpenChange:O,children:e.jsxs(g,{children:[e.jsxs(N,{children:[e.jsx(v,{className:"text-center text-xl font-bold text-green-600",children:"환영합니다!"}),e.jsxs(b,{className:"text-center text-base py-4",children:["서비스 홈으로 이동하여",e.jsx("br",{}),"TDM 진행할 환자 정보를 등록해주세요."]})]}),e.jsx(w,{className:"flex justify-center",children:e.jsx(S,{onClick:()=>{try{const e=JSON.parse(window.localStorage.getItem("tdmfriends:registeredUsers")||"[]");e.includes(F.phoneNumber)||(e.push(F.phoneNumber),window.localStorage.setItem("tdmfriends:registeredUsers",JSON.stringify(e)));const s={name:F.name,email:"",phone:F.phoneNumber,organization:F.organization,role:"의사"===F.medicalRole?"doctor":"간호사"===F.medicalRole?"nurse":"other"};z.setJSON(C.userProfile,s)}catch(e){a.error("회원가입 정보 저장 중 오류가 발생했습니다.")}O(!1),R()},className:"w-full max-w-xs",children:"확인"})})]})})]})};export{k as default};
