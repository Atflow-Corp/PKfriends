import{j as e,c as t,u as n,a as r,b as a,P as i,d as s,e as o,f as l,g as d,J as c,h as u,i as m,A as f,D as p,C as h,k as g,l as x,S as v,m as b,R as y,n as j,o as w}from"./index-B1LVcJqF.js";import{r as N,c as D,g as k,a as S}from"./react-vendor-B8CcSR15.js";import{u as T,a as C,O as _,C as I,b as M,T as O,D as $,R as P,c as R,P as A,L as E,S as L,d as F,e as V,f as H,g as U,A as W,h as z,i as K,j as B,k as G,l as Y,m as q,n as J,o as X,p as Z,F as Q,q as ee}from"./alert-dialog-HfFqSLfa.js";import{C as te,a as ne,b as re,c as ae,d as ie}from"./card-T3q_QJuy.js";import{B as se}from"./button-DQcJw-BW.js";import{I as oe}from"./input-waHpnmhz.js";import{X as le,U as de,T as ce,E as ue,F as me,S as fe,C as pe,b as he,d as ge,A as xe,e as ve,P as be,f as ye,g as je,c as we,h as Ne,i as De,j as ke,H as Se,k as Te,l as Ce,m as _e,a as Ie,n as Me,o as Oe,p as $e,q as Pe,r as Re}from"./ui-vendor-C4VXqYRS.js";import{s as Ae,S as Ee}from"./storage-GRehWpHF.js";import{g as Le,m as Fe,c as Ve,a as He,b as Ue,d as We,i as ze,T as Ke,e as Be,f as Ge,h as Ye,r as qe,j as Je,k as Xe,P as Ze,s as Qe,l as et,E as tt,n as nt,o as rt}from"./html2canvas.esm-DcHXelkC.js";import{u as at}from"./index-CtqvmGU1.js";function it(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const r=n.reduce((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]}),{});return N.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}var st="rovingFocusGroup.onEntryFocus",ot={bubbles:!1,cancelable:!0},lt="RovingFocusGroup",[dt,ct,ut]=t(lt),[mt,ft]=function(t,n=[]){let r=[];const a=()=>{const e=r.map(e=>N.createContext(e));return function(n){const r=(null==n?void 0:n[t])||e;return N.useMemo(()=>({[`__scope${t}`]:{...n,[t]:r}}),[n,r])}};return a.scopeName=t,[function(n,a){const i=N.createContext(a),s=r.length;function o(n){const{scope:r,children:a,...o}=n,l=(null==r?void 0:r[t][s])||i,d=N.useMemo(()=>o,Object.values(o));return e.jsx(l.Provider,{value:d,children:a})}return r=[...r,a],o.displayName=n+"Provider",[o,function(e,r){const o=(null==r?void 0:r[t][s])||i,l=N.useContext(o);if(l)return l;if(void 0!==a)return a;throw new Error(`\`${e}\` must be used within \`${n}\``)}]},it(a,...n)]}(lt,[ut]),[pt,ht]=mt(lt),gt=N.forwardRef((t,n)=>e.jsx(dt.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(dt.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(xt,{...t,ref:n})})}));gt.displayName=lt;var xt=N.forwardRef((t,o)=>{const{__scopeRovingFocusGroup:l,orientation:d,loop:c=!1,dir:u,currentTabStopId:m,defaultCurrentTabStopId:f,onCurrentTabStopIdChange:p,onEntryFocus:h,preventScrollOnEntryFocus:g=!1,...x}=t,v=N.useRef(null),b=n(o,v),y=T(u),[j=null,w]=r({prop:m,defaultProp:f,onChange:p}),[D,k]=N.useState(!1),S=a(h),C=ct(l),_=N.useRef(!1),[I,M]=N.useState(0);return N.useEffect(()=>{const e=v.current;if(e)return e.addEventListener(st,S),()=>e.removeEventListener(st,S)},[S]),e.jsx(pt,{scope:l,orientation:d,dir:y,loop:c,currentTabStopId:j,onItemFocus:N.useCallback(e=>w(e),[w]),onItemShiftTab:N.useCallback(()=>k(!0),[]),onFocusableItemAdd:N.useCallback(()=>M(e=>e+1),[]),onFocusableItemRemove:N.useCallback(()=>M(e=>e-1),[]),children:e.jsx(i.div,{tabIndex:D||0===I?-1:0,"data-orientation":d,...x,ref:b,style:{outline:"none",...t.style},onMouseDown:s(t.onMouseDown,()=>{_.current=!0}),onFocus:s(t.onFocus,e=>{const t=!_.current;if(e.target===e.currentTarget&&t&&!D){const t=new CustomEvent(st,ot);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=C().filter(e=>e.focusable);jt([e.find(e=>e.active),e.find(e=>e.id===j),...e].filter(Boolean).map(e=>e.ref.current),g)}}_.current=!1}),onBlur:s(t.onBlur,()=>k(!1))})})}),vt="RovingFocusGroupItem",bt=N.forwardRef((t,n)=>{const{__scopeRovingFocusGroup:r,focusable:a=!0,active:o=!1,tabStopId:l,...d}=t,c=C(),u=l||c,m=ht(vt,r),f=m.currentTabStopId===u,p=ct(r),{onFocusableItemAdd:h,onFocusableItemRemove:g}=m;return N.useEffect(()=>{if(a)return h(),()=>g()},[a,h,g]),e.jsx(dt.ItemSlot,{scope:r,id:u,focusable:a,active:o,children:e.jsx(i.span,{tabIndex:f?0:-1,"data-orientation":m.orientation,...d,ref:n,onMouseDown:s(t.onMouseDown,e=>{a?m.onItemFocus(u):e.preventDefault()}),onFocus:s(t.onFocus,()=>m.onItemFocus(u)),onKeyDown:s(t.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void m.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,n){const r=function(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,n);return"vertical"===t&&["ArrowLeft","ArrowRight"].includes(r)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(r)?void 0:yt[r]}(e,m.orientation,m.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let a=p().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)a.reverse();else if("prev"===t||"next"===t){"prev"===t&&a.reverse();const i=a.indexOf(e.currentTarget);a=m.loop?(r=i+1,(n=a).map((e,t)=>n[(r+t)%n.length])):a.slice(i+1)}setTimeout(()=>jt(a))}var n,r})})})});bt.displayName=vt;var yt={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function jt(e,t=!1){const n=document.activeElement;for(const r of e){if(r===n)return;if(r.focus({preventScroll:t}),document.activeElement!==n)return}}var wt=gt,Nt=bt,Dt="Tabs",[kt,St]=o(Dt,[ft]),Tt=ft(),[Ct,_t]=kt(Dt),It=N.forwardRef((t,n)=>{const{__scopeTabs:a,value:s,onValueChange:o,defaultValue:l,orientation:d="horizontal",dir:c,activationMode:u="automatic",...m}=t,f=T(c),[p,h]=r({prop:s,onChange:o,defaultProp:l});return e.jsx(Ct,{scope:a,baseId:C(),value:p,onValueChange:h,orientation:d,dir:f,activationMode:u,children:e.jsx(i.div,{dir:f,"data-orientation":d,...m,ref:n})})});It.displayName=Dt;var Mt="TabsList",Ot=N.forwardRef((t,n)=>{const{__scopeTabs:r,loop:a=!0,...s}=t,o=_t(Mt,r),l=Tt(r);return e.jsx(wt,{asChild:!0,...l,orientation:o.orientation,dir:o.dir,loop:a,children:e.jsx(i.div,{role:"tablist","aria-orientation":o.orientation,...s,ref:n})})});Ot.displayName=Mt;var $t="TabsTrigger",Pt=N.forwardRef((t,n)=>{const{__scopeTabs:r,value:a,disabled:o=!1,...l}=t,d=_t($t,r),c=Tt(r),u=Et(d.baseId,a),m=Lt(d.baseId,a),f=a===d.value;return e.jsx(Nt,{asChild:!0,...c,focusable:!o,active:f,children:e.jsx(i.button,{type:"button",role:"tab","aria-selected":f,"aria-controls":m,"data-state":f?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:u,...l,ref:n,onMouseDown:s(t.onMouseDown,e=>{o||0!==e.button||!1!==e.ctrlKey?e.preventDefault():d.onValueChange(a)}),onKeyDown:s(t.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&d.onValueChange(a)}),onFocus:s(t.onFocus,()=>{const e="manual"!==d.activationMode;f||o||!e||d.onValueChange(a)})})})});Pt.displayName=$t;var Rt="TabsContent",At=N.forwardRef((t,n)=>{const{__scopeTabs:r,value:a,forceMount:s,children:o,...d}=t,c=_t(Rt,r),u=Et(c.baseId,a),m=Lt(c.baseId,a),f=a===c.value,p=N.useRef(f);return N.useEffect(()=>{const e=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(e)},[]),e.jsx(l,{present:s||f,children:({present:r})=>e.jsx(i.div,{"data-state":f?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":u,hidden:!r,id:m,tabIndex:0,...d,ref:n,style:{...t.style,animationDuration:p.current?"0s":void 0},children:r&&o})})});function Et(e,t){return`${e}-trigger-${t}`}function Lt(e,t){return`${e}-content-${t}`}At.displayName=Rt;var Ft=Ot,Vt=Pt,Ht=At;const Ut=It,Wt=N.forwardRef(({className:t,...n},r)=>e.jsx(Ft,{ref:r,className:d("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...n}));Wt.displayName=Ft.displayName;const zt=N.forwardRef(({className:t,...n},r)=>e.jsx(Vt,{ref:r,className:d("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm","data-[state=active]:bg-primary/90 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:border data-[state=active]:border-primary dark:data-[state=active]:bg-primary/80 dark:data-[state=active]:text-primary-foreground dark:data-[state=active]:border-primary",t),...n}));zt.displayName=Vt.displayName;const Kt=N.forwardRef(({className:t,...n},r)=>e.jsx(Ht,{ref:r,className:d("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...n}));Kt.displayName=Ht.displayName;const Bt=N.forwardRef(({className:t,...n},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:d("w-full caption-bottom text-sm",t),...n})}));Bt.displayName="Table";const Gt=N.forwardRef(({className:t,...n},r)=>e.jsx("thead",{ref:r,className:d("[&_tr]:border-b",t),...n}));Gt.displayName="TableHeader";const Yt=N.forwardRef(({className:t,...n},r)=>e.jsx("tbody",{ref:r,className:d("[&_tr:last-child]:border-0",t),...n}));Yt.displayName="TableBody";N.forwardRef(({className:t,...n},r)=>e.jsx("tfoot",{ref:r,className:d("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...n})).displayName="TableFooter";const qt=N.forwardRef(({className:t,...n},r)=>e.jsx("tr",{ref:r,className:d("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...n}));qt.displayName="TableRow";const Jt=N.forwardRef(({className:t,...n},r)=>e.jsx("th",{ref:r,className:d("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...n}));Jt.displayName="TableHead";const Xt=N.forwardRef(({className:t,...n},r)=>e.jsx("td",{ref:r,className:d("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...n}));Xt.displayName="TableCell";N.forwardRef(({className:t,...n},r)=>e.jsx("caption",{ref:r,className:d("mt-4 text-sm text-muted-foreground",t),...n})).displayName="TableCaption";const Zt=P,Qt=R,en=A,tn=N.forwardRef(({className:t,...n},r)=>e.jsx(_,{ref:r,className:d("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n}));tn.displayName=_.displayName;const nn=N.forwardRef(({className:t,children:n,...r},a)=>e.jsxs(en,{container:document.body,children:[e.jsx(tn,{}),e.jsxs(I,{ref:a,className:d("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),onOpenAutoFocus:e=>{e.preventDefault();const t=e.currentTarget.querySelector('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled])');t&&t.focus()},...r,children:[n,e.jsxs(M,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));nn.displayName=I.displayName;const rn=({className:t,...n})=>e.jsx("div",{className:d("flex flex-col space-y-1.5 text-center sm:text-left",t),...n});rn.displayName="DialogHeader";const an=({className:t,...n})=>e.jsx("div",{className:d("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n});an.displayName="DialogFooter";const sn=N.forwardRef(({className:t,...n},r)=>e.jsx(O,{ref:r,className:d("text-lg font-semibold leading-none tracking-tight",t),...n}));sn.displayName=O.displayName;const on=N.forwardRef(({className:t,...n},r)=>e.jsx($,{ref:r,className:d("text-sm text-muted-foreground",t),...n}));on.displayName=$.displayName;var ln={exports:{}};const dn=k(ln.exports=function(){var e=1e3,t=6e4,n=36e5,r="millisecond",a="second",i="minute",s="hour",o="day",l="week",d="month",c="quarter",u="year",m="date",f="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},x=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},v={s:x,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),a=n%60;return(t<=0?"+":"-")+x(r,2,"0")+":"+x(a,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),a=t.clone().add(r,d),i=n-a<0,s=t.clone().add(r+(i?-1:1),d);return+(-(r+(n-a)/(i?a-s:s-a))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:d,y:u,w:l,d:o,D:m,h:s,m:i,s:a,ms:r,Q:c}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},b="en",y={};y[b]=g;var j="$isDayjsObject",w=function(e){return e instanceof S||!(!e||!e[j])},N=function e(t,n,r){var a;if(!t)return b;if("string"==typeof t){var i=t.toLowerCase();y[i]&&(a=i),n&&(y[i]=n,a=i);var s=t.split("-");if(!a&&s.length>1)return e(s[0])}else{var o=t.name;y[o]=t,a=o}return!r&&a&&(b=a),a||!r&&b},D=function(e,t){if(w(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new S(n)},k=v;k.l=N,k.i=w,k.w=function(e,t){return D(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var S=function(){function g(e){this.$L=N(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[j]=!0}var x=g.prototype;return x.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(k.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(p);if(r){var a=r[2]-1||0,i=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)):new Date(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)}}return new Date(t)}(e),this.init()},x.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},x.$utils=function(){return k},x.isValid=function(){return!(this.$d.toString()===f)},x.isSame=function(e,t){var n=D(e);return this.startOf(t)<=n&&n<=this.endOf(t)},x.isAfter=function(e,t){return D(e)<this.startOf(t)},x.isBefore=function(e,t){return this.endOf(t)<D(e)},x.$g=function(e,t,n){return k.u(e)?this[t]:this.set(n,e)},x.unix=function(){return Math.floor(this.valueOf()/1e3)},x.valueOf=function(){return this.$d.getTime()},x.startOf=function(e,t){var n=this,r=!!k.u(t)||t,c=k.p(e),f=function(e,t){var a=k.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?a:a.endOf(o)},p=function(e,t){return k.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},h=this.$W,g=this.$M,x=this.$D,v="set"+(this.$u?"UTC":"");switch(c){case u:return r?f(1,0):f(31,11);case d:return r?f(1,g):f(0,g+1);case l:var b=this.$locale().weekStart||0,y=(h<b?h+7:h)-b;return f(r?x-y:x+(6-y),g);case o:case m:return p(v+"Hours",0);case s:return p(v+"Minutes",1);case i:return p(v+"Seconds",2);case a:return p(v+"Milliseconds",3);default:return this.clone()}},x.endOf=function(e){return this.startOf(e,!1)},x.$set=function(e,t){var n,l=k.p(e),c="set"+(this.$u?"UTC":""),f=(n={},n[o]=c+"Date",n[m]=c+"Date",n[d]=c+"Month",n[u]=c+"FullYear",n[s]=c+"Hours",n[i]=c+"Minutes",n[a]=c+"Seconds",n[r]=c+"Milliseconds",n)[l],p=l===o?this.$D+(t-this.$W):t;if(l===d||l===u){var h=this.clone().set(m,1);h.$d[f](p),h.init(),this.$d=h.set(m,Math.min(this.$D,h.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},x.set=function(e,t){return this.clone().$set(e,t)},x.get=function(e){return this[k.p(e)]()},x.add=function(r,c){var m,f=this;r=Number(r);var p=k.p(c),h=function(e){var t=D(f);return k.w(t.date(t.date()+Math.round(e*r)),f)};if(p===d)return this.set(d,this.$M+r);if(p===u)return this.set(u,this.$y+r);if(p===o)return h(1);if(p===l)return h(7);var g=(m={},m[i]=t,m[s]=n,m[a]=e,m)[p]||1,x=this.$d.getTime()+r*g;return k.w(x,this)},x.subtract=function(e,t){return this.add(-1*e,t)},x.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var r=e||"YYYY-MM-DDTHH:mm:ssZ",a=k.z(this),i=this.$H,s=this.$m,o=this.$M,l=n.weekdays,d=n.months,c=n.meridiem,u=function(e,n,a,i){return e&&(e[n]||e(t,r))||a[n].slice(0,i)},m=function(e){return k.s(i%12||12,e,"0")},p=c||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(h,function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return k.s(t.$y,4,"0");case"M":return o+1;case"MM":return k.s(o+1,2,"0");case"MMM":return u(n.monthsShort,o,d,3);case"MMMM":return u(d,o);case"D":return t.$D;case"DD":return k.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return u(n.weekdaysMin,t.$W,l,2);case"ddd":return u(n.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(i);case"HH":return k.s(i,2,"0");case"h":return m(1);case"hh":return m(2);case"a":return p(i,s,!0);case"A":return p(i,s,!1);case"m":return String(s);case"mm":return k.s(s,2,"0");case"s":return String(t.$s);case"ss":return k.s(t.$s,2,"0");case"SSS":return k.s(t.$ms,3,"0");case"Z":return a}return null}(e)||a.replace(":","")})},x.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},x.diff=function(r,m,f){var p,h=this,g=k.p(m),x=D(r),v=(x.utcOffset()-this.utcOffset())*t,b=this-x,y=function(){return k.m(h,x)};switch(g){case u:p=y()/12;break;case d:p=y();break;case c:p=y()/3;break;case l:p=(b-v)/6048e5;break;case o:p=(b-v)/864e5;break;case s:p=b/n;break;case i:p=b/t;break;case a:p=b/e;break;default:p=b}return f?p:k.a(p)},x.daysInMonth=function(){return this.endOf(d).$D},x.$locale=function(){return y[this.$L]},x.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=N(e,t,!0);return r&&(n.$L=r),n},x.clone=function(){return k.w(this.$d,this)},x.toDate=function(){return new Date(this.valueOf())},x.toJSON=function(){return this.isValid()?this.toISOString():null},x.toISOString=function(){return this.$d.toISOString()},x.toString=function(){return this.$d.toUTCString()},g}(),T=S.prototype;return D.prototype=T,[["$ms",r],["$s",a],["$m",i],["$H",s],["$W",o],["$M",d],["$y",u],["$D",m]].forEach(function(e){T[e[1]]=function(t){return this.$g(t,e[0],e[1])}}),D.extend=function(e,t){return e.$i||(e(t,S,D),e.$i=!0),D},D.locale=N,D.isDayjs=w,D.unix=function(e){return D(1e3*e)},D.en=y[b],D.Ls=y,D.p={},D}()),cn=N.forwardRef(({onAddPatient:t,onUpdatePatient:n,onDeletePatient:r,patients:a,selectedPatient:i,setSelectedPatient:s,showHeader:o=!0},l)=>{const[d,u]=N.useState({patientNo:"",name:"",gender:"",birth:"",age:"",weight:"",height:"",medicalHistory:"",allergies:""}),m=dn().format("YYYY-MM-DD"),[f,p]=N.useState(!1),[h,g]=N.useState(!1),[x,v]=N.useState(!1),[b,y]=N.useState(null),[j,w]=N.useState(""),[D,k]=N.useState(!1),[S,T]=N.useState([]),[C,_]=N.useState(null),[I,M]=N.useState(!1),O=e=>{if(!e||""===e.trim())return null;const t=/[가-힣]/.test(e),n=/[a-zA-Z]/.test(e);if(/^[ㄱ-ㅎㅏ-ㅣ]+$/.test(e))return"완성된 한글만 입력 가능합니다. (자음/모음만 입력 불가)";if(t&&n)return"이름은 한글 또는 영문으로만 입력해 주세요. (혼용 불가)";if(t){if(e.length<2)return"한글 이름은 2자 이상 입력해 주세요.";if(e.length>10)return"한글 이름은 2~10자까지 입력 가능합니다.";if(/[\s0-9]/.test(e)||/[^가-힣]/.test(e))return"한글 이름은 한글만 입력 가능합니다. (띄어쓰기, 숫자, 특수문자 불가)"}if(n){if(e.length<2)return"영문 이름은 2자 이상 입력해 주세요.";if(e.length>50)return"영문 이름은 2~50자까지 입력 가능합니다.";if(/[0-9]/.test(e))return"영문 이름에는 숫자를 입력할 수 없습니다.";if(/[^a-zA-Z\s,\-]/.test(e))return"영문 이름은 영문, 띄어쓰기, comma(,), dash(-)만 입력 가능합니다."}return!t&&!n&&e.length>0?"이름은 한글 또는 영문으로 입력해 주세요.":null},$=e=>{if(I)return void u({...d,name:e});const t=((e,t)=>{if(""===e)return{value:"",shouldShowToast:!1};const n=/[가-힣]/.test(e),r=/[a-zA-Z]/.test(e),a=/[가-힣]/.test(t),i=/[a-zA-Z]/.test(t);if(n&&r&&(!a||!i))return{value:t,shouldShowToast:!0};let s=e,o=!1;if(n){if(/^[ㄱ-ㅎㅏ-ㅣ]+$/.test(e))return{value:t,shouldShowToast:!0};if(s=e.replace(/[^가-힣]/g,""),s=s.replace(/[ㄱ-ㅎㅏ-ㅣ]/g,""),s!==e&&(o=s!==t&&e!==t),s.length>10){const e=t.length<=10&&s.length>10;s=s.slice(0,10),o=o||e}}else if(r){if(/^[a-zA-Z\s,\-]*$/.test(e)||(s=e.replace(/[^a-zA-Z\s,\-]/g,""),o=s!==t&&e!==t),s.length>50){const e=t.length<=50&&s.length>50;s=s.slice(0,50),o=o||e}}else s="",o=e!==t;return{value:s,shouldShowToast:o}})(e,d.name);u({...d,name:t.value})},P=e=>{u({patientNo:e.id,name:e.name,gender:e.gender,birth:e.birthDate,age:e.age.toString(),weight:e.weight.toString(),height:e.height.toString(),medicalHistory:e.medicalHistory,allergies:e.allergies}),s(e),p(!0),g(!0)},R=e=>{y(e),(e=>{try{const t=Ae.getJSON(Ee.prescriptions,[]).filter(t=>t.patientId===e).sort((e,t)=>{const n=new Date(e.startDate||e.id);return new Date(t.startDate||t.id).getTime()-n.getTime()});T(t)}catch(t){T([])}})(e.id),v(!0)},A=()=>{u({patientNo:"",name:"",gender:"",birth:"",age:"",weight:"",height:"",medicalHistory:"",allergies:""}),p(!1),s(null),g(!1)},X=()=>{u({patientNo:"",name:"",gender:"",birth:"",age:"",weight:"",height:"",medicalHistory:"",allergies:""}),p(!1),s(null),g(!0)},Z=e=>{P(e)},Q=e=>{R(e)},ee=a.filter(e=>e.name.toLowerCase().includes(j.toLowerCase())||e.id.includes(j));return N.useImperativeHandle(l,()=>({openRegistrationModal:X,openEditModalForPatient:Z,openViewModalForPatient:Q})),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[o&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"환자 정보 관리"}),e.jsx("p",{className:"text-muted-foreground",children:"환자 등록, 수정, 조회를 관리합니다"})]}),!o&&e.jsx("div",{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Zt,{open:h,onOpenChange:g,children:[e.jsx(Qt,{asChild:!0,children:e.jsxs(se,{onClick:()=>{u({patientNo:"",name:"",gender:"",birth:"",age:"",weight:"",height:"",medicalHistory:"",allergies:""}),p(!1),s(null),g(!0)},className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"신규 환자 등록"]})}),e.jsxs(nn,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(rn,{children:[e.jsxs(sn,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),f?"환자 정보 수정":"신규 환자 등록"]}),e.jsx(on,{children:f?"환자 정보를 수정합니다":"환자 정보를 입력해 등록하세요"})]}),e.jsxs("form",{onSubmit:f?e=>{if(e.preventDefault(),!i)return;if(O(d.name.trim()))return;const t={...i,name:d.name.trim(),age:parseInt(d.age),weight:parseFloat(d.weight),height:parseFloat(d.height),gender:d.gender,medicalHistory:d.medicalHistory,allergies:d.allergies};n(t),A(),g(!1)}:e=>{e.preventDefault();if(O(d.name.trim()))return;const n={id:Date.now().toString(),name:d.name.trim(),age:parseInt(d.age),weight:parseFloat(d.weight),height:parseFloat(d.height),gender:d.gender,medicalHistory:d.medicalHistory,allergies:d.allergies,birthDate:d.birth,createdAt:new Date};t(n),A(),g(!1)},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"patientNo",children:"환자 번호 *"}),e.jsx(oe,{id:"patientNo",value:d.patientNo,onChange:e=>u({...d,patientNo:e.target.value}),placeholder:"환자 번호 입력",required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"name",children:"이름 *"}),e.jsx(oe,{id:"name",type:"text",value:d.name,onChange:e=>$(e.target.value),onCompositionStart:()=>{M(!0)},onCompositionEnd:e=>{M(!1),$(e.currentTarget.value)},placeholder:"이름 입력",required:!0,maxLength:100}),O(d.name)&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:O(d.name)})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"gender",children:"성별 *"}),e.jsxs(L,{value:d.gender,onValueChange:e=>u({...d,gender:e}),required:!0,children:[e.jsx(F,{children:e.jsx(V,{placeholder:"성별 선택"})}),e.jsxs(H,{children:[e.jsx(U,{value:"male",children:"남성"}),e.jsx(U,{value:"female",children:"여성"})]})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"birth",children:"생년월일 *"}),e.jsx(oe,{id:"birth",type:"date",value:d.birth,max:m,onChange:e=>{return t=e.target.value,void u(e=>{const n=t,r=n?dn(n):null;return{...e,birth:n,age:(null==r?void 0:r.isValid())?dn().diff(r,"year").toString():""}});var t},required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"weight",children:"체중(kg) *"}),e.jsx(oe,{id:"weight",type:"number",step:"0.1",value:d.weight,onChange:e=>u({...d,weight:e.target.value}),placeholder:"체중(kg)",min:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"height",children:"신장(cm) *"}),e.jsx(oe,{id:"height",type:"number",value:d.height,onChange:e=>u({...d,height:e.target.value}),placeholder:"신장(cm)",min:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"age",children:"나이"}),e.jsx(oe,{id:"age",value:d.age,readOnly:!0,placeholder:"생년월일 입력 시 자동 계산"})]}),e.jsxs("div",{children:[e.jsx(E,{children:"BMI"}),e.jsx(oe,{value:(()=>{const e=parseFloat(d.weight),t=parseFloat(d.height);return e&&t?(e/Math.pow(t/100,2)).toFixed(1):""})(),readOnly:!0,placeholder:"자동 계산"})]}),e.jsxs("div",{children:[e.jsx(E,{children:"BSA"}),e.jsx(oe,{value:(()=>{const e=parseFloat(d.weight),t=parseFloat(d.height);return e&&t?Math.sqrt(e*t/3600).toFixed(2):""})(),readOnly:!0,placeholder:"자동 계산"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[f&&e.jsx(se,{type:"button",variant:"destructive",onClick:()=>{i&&k(!0)},className:"w-fit p-2",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(se,{type:"submit",className:"flex-1",disabled:!!O(d.name.trim()),children:f?"수정하기":"등록하기"}),e.jsx(se,{type:"button",variant:"outline",onClick:A,children:"취소"})]})]})]})]}),e.jsx(W,{open:D,onOpenChange:k,children:e.jsxs(z,{children:[e.jsxs(K,{children:[e.jsx(B,{children:i?`${i.name} 환자의 정보를 삭제할까요?`:"환자 정보를 삭제할까요?"}),e.jsx(G,{children:"삭제된 환자 정보는 복구할 수 없습니다."})]}),e.jsxs(Y,{children:[e.jsx(q,{children:"취소"}),e.jsx(J,{onClick:()=>{i&&(i.name,r(i.id),A(),g(!1),k(!1),c.success("환자정보가 삭제되었습니다."))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"삭제"})]})]})})]})]}),e.jsx(Zt,{open:x,onOpenChange:v,children:e.jsxs(nn,{className:"min-w-[1000px] min-h-[500px] max-h-[80vh] p-0",children:[e.jsxs(rn,{className:"px-6 pt-6 pb-0",children:[e.jsxs(sn,{children:[null==b?void 0:b.name," 환자의 Report 조회"]}),e.jsx(on,{children:"TDM 분석 내역을 선택하면 해당 분석의 Report를 조회하고 다운로드할 수 있습니다."})]}),b&&e.jsx("div",{className:"px-6 pb-6",children:S.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(Bt,{children:[e.jsx(Gt,{children:e.jsxs(qt,{children:[e.jsx(Jt,{className:"w-[120px]",children:"분석일"}),e.jsx(Jt,{className:"w-[150px]",children:"약물명"}),e.jsx(Jt,{className:"w-[200px]",children:"적응증"}),e.jsx(Jt,{className:"w-[250px]",children:"TDM 목표"}),e.jsx(Jt,{className:"w-[120px]",children:"항정상태"}),e.jsx(Jt,{className:"w-[100px]",children:"조회"})]})}),e.jsx(Yt,{children:S.map((t,n)=>{const r=b?((e,t,n)=>{try{const r=`tdmfriends:tdmResult:${e}:${t}`,a=window.localStorage.getItem(r),i=`tdmfriends:tdmResult:${e}`,s=window.localStorage.getItem(i),o=`tdmfriends:tdmResults:${e}:${t}`,l=window.localStorage.getItem(o);if(a)return JSON.parse(a);if(l){const e=JSON.parse(l);if(e&&e.length>0){let t=e[e.length-1];if(n){const r=new Date(n).getTime();let a=e[0],i=Math.abs(new Date(e[0].timestamp).getTime()-r);for(const t of e){const e=new Date(t.timestamp).getTime(),n=Math.abs(e-r);n<i&&(i=n,a=t)}t=a}let r=t.data||t.summary||null;return t.data&&t.summary&&(r={...t.data,...t.summary}),r}}if(s)return JSON.parse(s)}catch(r){}return null})(b.id,t.drugName,t.startDate):null,a=((e,t)=>{const{tdmTarget:n,tdmTargetValue:r,drugName:a}=e;if(!n||!r)return"-";const i=(()=>{const e=n.toLowerCase();return e.includes("auc")?"AUC":e.includes("max")||e.includes("peak")?"Max":e.includes("trough")?"Trough":""})(),s=(null==t?void 0:t.AUC_24_before)||(null==t?void 0:t.AUC_tau_before)||(null==t?void 0:t.AUC24h_before)||(null==t?void 0:t.AUCtau_before)||null,o=(null==t?void 0:t.CMAX_before)||(null==t?void 0:t.CMax_before)||null,l=(null==t?void 0:t.CTROUGH_before)||(null==t?void 0:t.CTrough_before)||null,d=Le(n,s,o,l,a),c=(()=>{if(!r||!d.numericValue)return d.numericValue,null;const e=r.match(/(\d+(?:\.\d+)?)\s*-\s*(\d+(?:\.\d+)?)/);if(!e)return null;const t=parseFloat(e[1]),n=parseFloat(e[2]),a=d.numericValue;return a>n?"초과":a<t?"미달":"도달"})();return null!=d.numericValue&&c?`${i} ${d.value} 으로 목표범위 ${c}`:i?`${i} ${r}`:r})(t,r),i=(e=>{if(!e||void 0===e.Steady_state)return"-";const t=e.Steady_state;return("boolean"==typeof t?t:"true"===String(t).toLowerCase())?"도달":"미도달"})(r);return e.jsxs(qt,{className:"cursor-pointer hover:bg-accent/50 dark:hover:bg-accent/30 "+((null==C?void 0:C.id)===t.id?"bg-accent dark:bg-accent/50":""),onClick:()=>_(t),children:[e.jsx(Xt,{className:"align-top",children:dn(t.startDate||t.id).format("YYYY.M.D")}),e.jsx(Xt,{className:"font-medium align-top",children:t.drugName}),e.jsx(Xt,{className:"align-top",children:t.indication||"-"}),e.jsx(Xt,{className:"align-top",children:a}),e.jsx(Xt,{className:"align-top",children:i}),e.jsx(Xt,{className:"align-top",children:e.jsxs(se,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),(e=>{if(!b)return;window.localStorage.setItem(`tdmfriends:selectedDrug:${b.id}`,e.drugName);const t=`${window.location.origin}${window.location.pathname}report?patientId=${b.id}`;window.open(t,"_blank"),v(!1)})(t)},className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3"}),"조회"]})})]},t.id)})})]})}):e.jsxs("div",{className:"text-center py-8 px-6",children:[e.jsx(me,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"등록된 TDM 분석 내역이 없습니다."})]})})]})}),e.jsxs(te,{children:[e.jsx(ne,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs(re,{children:["등록된 환자 (",a.length,")"]}),e.jsx(ae,{children:"상세 정보 확인 및 수정이 가능합니다"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(oe,{placeholder:"환자 검색...",value:j,onChange:e=>w(e.target.value),className:"pl-8 w-64"})]})})]})}),e.jsx(ie,{children:ee.length>0?e.jsx("div",{className:"rounded-md border "+(i?"border-sky-300 dark:border-sky-700":""),children:e.jsxs(Bt,{children:[e.jsx(Gt,{children:e.jsxs(qt,{children:[e.jsx(Jt,{className:"w-12"}),e.jsx(Jt,{children:"이름 / 환자번호"}),e.jsx(Jt,{children:"나이 / 생년월일"}),e.jsx(Jt,{children:"성별"}),e.jsx(Jt,{children:"체중"}),e.jsx(Jt,{children:"신장"}),e.jsx(Jt,{children:"등록일"}),e.jsx(Jt,{children:"수정과 조회"})]})}),e.jsx(Yt,{children:ee.map(t=>{const n=(null==i?void 0:i.id)===t.id;return e.jsxs(qt,{className:"cursor-pointer hover:bg-muted/50 "+(n?"bg-sky-50 dark:bg-sky-900 border-l-4 border-l-sky-300 dark:border-l-sky-700":""),onClick:()=>s(t),children:[e.jsx(Xt,{children:n&&e.jsx(pe,{className:"h-5 w-5 text-sky-500 dark:text-sky-400"})}),e.jsxs(Xt,{className:""+(n?"font-bold text-[#333333] dark:text-white":"font-medium"),children:[e.jsx("span",{title:t.name,children:t.name&&t.name.length>5?`${t.name.slice(0,4)}...`:t.name}),t.id?` (${t.id})`:""]}),e.jsxs(Xt,{className:n?"font-bold text-[#333333] dark:text-white":"",children:["number"==typeof t.age?`${t.age}세`:"-",t.birthDate?` (${dn(t.birthDate).format("YYYY-MM-DD")})`:""]}),e.jsx(Xt,{className:"capitalize "+(n?"font-bold text-[#333333] dark:text-white":""),children:"male"===t.gender?"남성":"female"===t.gender?"여성":"-"}),e.jsxs(Xt,{className:n?"font-bold text-[#333333] dark:text-white":"",children:[t.weight," kg"]}),e.jsxs(Xt,{className:n?"font-bold text-[#333333] dark:text-white":"",children:[t.height," cm"]}),e.jsx(Xt,{className:n?"font-bold text-[#333333] dark:text-white":"",children:t.createdAt.toLocaleDateString()}),e.jsx(Xt,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(se,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),P(t)},children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(se,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),R(t)},children:e.jsx(me,{className:"h-4 w-4"})})]})})]},t.id)})})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:j?"검색 결과가 없습니다":"아직 등록된 환자가 없습니다"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:j?"다른 검색어를 시도해보세요":"위 버튼을 통해 첫 환자를 등록하세요"})]})})]})]})}),un=({onAddPatient:t,onUpdatePatient:n,onDeletePatient:r,patients:a,selectedPatient:i,setSelectedPatient:s})=>e.jsx(cn,{onAddPatient:t,onUpdatePatient:n,onDeletePatient:r,patients:a,selectedPatient:i,setSelectedPatient:s,showHeader:!1});function mn(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const r=n.reduce((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]}),{});return N.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}var fn="Progress",[pn,hn]=function(t,n=[]){let r=[];const a=()=>{const e=r.map(e=>N.createContext(e));return function(n){const r=(null==n?void 0:n[t])||e;return N.useMemo(()=>({[`__scope${t}`]:{...n,[t]:r}}),[n,r])}};return a.scopeName=t,[function(n,a){const i=N.createContext(a),s=r.length;function o(n){const{scope:r,children:a,...o}=n,l=(null==r?void 0:r[t][s])||i,d=N.useMemo(()=>o,Object.values(o));return e.jsx(l.Provider,{value:d,children:a})}return r=[...r,a],o.displayName=n+"Provider",[o,function(e,r){const o=(null==r?void 0:r[t][s])||i,l=N.useContext(o);if(l)return l;if(void 0!==a)return a;throw new Error(`\`${e}\` must be used within \`${n}\``)}]},mn(a,...n)]}(fn),[gn,xn]=pn(fn),vn=N.forwardRef((t,n)=>{const{__scopeProgress:r,value:a=null,max:s,getValueLabel:o=jn,...l}=t;(s||0===s)&&Dn(s);const d=Dn(s)?s:100;null!==a&&kn(a,d);const c=kn(a,d)?a:null,u=Nn(c)?o(c,d):void 0;return e.jsx(gn,{scope:r,value:c,max:d,children:e.jsx(i.div,{"aria-valuemax":d,"aria-valuemin":0,"aria-valuenow":Nn(c)?c:void 0,"aria-valuetext":u,role:"progressbar","data-state":wn(c,d),"data-value":c??void 0,"data-max":d,...l,ref:n})})});vn.displayName=fn;var bn="ProgressIndicator",yn=N.forwardRef((t,n)=>{const{__scopeProgress:r,...a}=t,s=xn(bn,r);return e.jsx(i.div,{"data-state":wn(s.value,s.max),"data-value":s.value??void 0,"data-max":s.max,...a,ref:n})});function jn(e,t){return`${Math.round(e/t*100)}%`}function wn(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function Nn(e){return"number"==typeof e}function Dn(e){return Nn(e)&&!isNaN(e)&&e>0}function kn(e,t){return Nn(e)&&!isNaN(e)&&e<=t&&e>=0}yn.displayName=bn;var Sn=vn,Tn=yn;const Cn=N.forwardRef(({className:t,value:n,...r},a)=>e.jsx(Sn,{ref:a,className:d("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...r,children:e.jsx(Tn,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(n||0)}%)`}})}));Cn.displayName=Sn.displayName;const _n=({patients:t,selectedPatient:n,setSelectedPatient:r,onAddPatient:a,onUpdatePatient:i,onDeletePatient:s,onNext:o,isCompleted:l})=>e.jsx("div",{className:"space-y-6",children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"1단계: 환자 선택",l&&e.jsx(pe,{className:"h-5 w-5 text-green-600"})]}),e.jsx(ae,{children:"기존 환자를 선택하거나 신규 환자를 등록하세요."})]}),e.jsxs(ie,{className:"space-y-6",children:[e.jsx(cn,{onAddPatient:a,onUpdatePatient:i,onDeletePatient:s,patients:t,selectedPatient:n,setSelectedPatient:r,showHeader:!1}),n&&e.jsxs(te,{className:"border-sky-300 dark:border-sky-700 bg-sky-50 dark:bg-sky-900",children:[e.jsx(ne,{children:e.jsx(re,{className:"text-sky-900 dark:text-sky-50",children:"환자 상세정보"})}),e.jsx(ie,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"이름 / 환자번호"}),e.jsxs("p",{className:"text-sm text-black dark:text-white",children:[n.name,n.id?` (${n.id})`:""]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"생년월일"}),e.jsx("p",{className:"text-sm text-black dark:text-white",children:n.birthDate})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"나이"}),e.jsxs("p",{className:"text-sm text-black dark:text-white",children:[n.age,"세"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"성별"}),e.jsx("p",{className:"text-sm text-black dark:text-white",children:"male"===n.gender?"남성":"female"===n.gender?"여성":"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"체중"}),e.jsxs("p",{className:"text-sm text-black dark:text-white",children:[n.weight," kg"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"신장"}),e.jsxs("p",{className:"text-sm text-black dark:text-white",children:[n.height," cm"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"BMI"}),e.jsx("p",{className:"text-sm text-black dark:text-white",children:n.weight&&n.height?(n.weight/Math.pow(n.height/100,2)).toFixed(1):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"BSA"}),e.jsxs("p",{className:"text-sm text-black dark:text-white",children:[n.weight&&n.height?Math.sqrt(n.weight*n.height/3600).toFixed(2):"-"," m²"]})]})]})})]}),l&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(se,{onClick:o,className:"flex items-center gap-2 w-[300px] bg-black dark:bg-primary text-white dark:text-primary-foreground font-bold text-lg py-3 px-6 justify-center hover:bg-gray-800 dark:hover:bg-primary/90",children:["TDM 선택",e.jsx(xe,{className:"h-4 w-4"})]})})]})]})});var In="Radio",[Mn,On]=o(In),[$n,Pn]=Mn(In),Rn=N.forwardRef((t,r)=>{const{__scopeRadio:a,name:o,checked:l=!1,required:d,disabled:c,value:u="on",onCheck:m,form:f,...p}=t,[h,g]=N.useState(null),x=n(r,e=>g(e)),v=N.useRef(!1),b=!h||(f||!!h.closest("form"));return e.jsxs($n,{scope:a,checked:l,disabled:c,children:[e.jsx(i.button,{type:"button",role:"radio","aria-checked":l,"data-state":Fn(l),"data-disabled":c?"":void 0,disabled:c,value:u,...p,ref:x,onClick:s(t.onClick,e=>{l||null==m||m(),b&&(v.current=e.isPropagationStopped(),v.current||e.stopPropagation())})}),b&&e.jsx(Ln,{control:h,bubbles:!v.current,name:o,value:u,checked:l,required:d,disabled:c,form:f,style:{transform:"translateX(-100%)"}})]})});Rn.displayName=In;var An="RadioIndicator",En=N.forwardRef((t,n)=>{const{__scopeRadio:r,forceMount:a,...s}=t,o=Pn(An,r);return e.jsx(l,{present:a||o.checked,children:e.jsx(i.span,{"data-state":Fn(o.checked),"data-disabled":o.disabled?"":void 0,...s,ref:n})})});En.displayName=An;var Ln=t=>{const{control:n,checked:r,bubbles:a=!0,...i}=t,s=N.useRef(null),o=at(r),l=u(n);return N.useEffect(()=>{const e=s.current,t=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(t,"checked").set;if(o!==r&&n){const t=new Event("click",{bubbles:a});n.call(e,r),e.dispatchEvent(t)}},[o,r,a]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:r,...i,tabIndex:-1,ref:s,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Fn(e){return e?"checked":"unchecked"}var Vn=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Hn="RadioGroup",[Un,Wn]=o(Hn,[ft,On]),zn=ft(),Kn=On(),[Bn,Gn]=Un(Hn),Yn=N.forwardRef((t,n)=>{const{__scopeRadioGroup:a,name:s,defaultValue:o,value:l,required:d=!1,disabled:c=!1,orientation:u,dir:m,loop:f=!0,onValueChange:p,...h}=t,g=zn(a),x=T(m),[v,b]=r({prop:l,defaultProp:o,onChange:p});return e.jsx(Bn,{scope:a,name:s,required:d,disabled:c,value:v,onValueChange:b,children:e.jsx(wt,{asChild:!0,...g,orientation:u,dir:x,loop:f,children:e.jsx(i.div,{role:"radiogroup","aria-required":d,"aria-orientation":u,"data-disabled":c?"":void 0,dir:x,...h,ref:n})})})});Yn.displayName=Hn;var qn="RadioGroupItem",Jn=N.forwardRef((t,r)=>{const{__scopeRadioGroup:a,disabled:i,...o}=t,l=Gn(qn,a),d=l.disabled||i,c=zn(a),u=Kn(a),m=N.useRef(null),f=n(r,m),p=l.value===o.value,h=N.useRef(!1);return N.useEffect(()=>{const e=e=>{Vn.includes(e.key)&&(h.current=!0)},t=()=>h.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}},[]),e.jsx(Nt,{asChild:!0,...c,focusable:!d,active:p,children:e.jsx(Rn,{disabled:d,required:l.required,checked:p,...u,...o,name:l.name,ref:f,onCheck:()=>l.onValueChange(o.value),onKeyDown:s(e=>{"Enter"===e.key&&e.preventDefault()}),onFocus:s(o.onFocus,()=>{var e;h.current&&(null==(e=m.current)||e.click())})})})});Jn.displayName=qn;var Xn=N.forwardRef((t,n)=>{const{__scopeRadioGroup:r,...a}=t,i=Kn(r);return e.jsx(En,{...i,...a,ref:n})});Xn.displayName="RadioGroupIndicator";var Zn=Yn,Qn=Jn,er=Xn;const tr=N.forwardRef(({className:t,...n},r)=>e.jsx(Zn,{className:d("grid gap-2",t),...n,ref:r}));tr.displayName=Zn.displayName;const nr=N.forwardRef(({className:t,...n},r)=>e.jsx(Qn,{ref:r,className:d("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(er,{className:"flex items-center justify-center",children:e.jsx(ve,{className:"h-2.5 w-2.5 fill-current text-current"})})}));nr.displayName=Qn.displayName;const rr=["복용 중인 약물 없음","Nephrotoxic drugs including aminoglycosides (amikacin and tobramycin)","Liposomal amphotericin B","Antiviral agents (acyclovir, famciclovir and ganciclovir)","Colistimethate","Cytotoxic agents (cytosine arabinoside, fludarabine and idarubicin)","Cyclosporin","Tacrolimus","Non-steroidal anti-inflammatory agents (aceclofenac, ibuprofen, ketoprofen, ketorolac and zaltoprofen)","Trimethoprim/sulfamethoxazole","기타"],ar=[{name:"Vancomycin",indications:["Not specified/Korean","Neurosurgical patients/Korean"],additionalInfo:{"Neurosurgical patients/Korean":rr},targets:[{type:"Trough Concentration",value:"10-20 mg/L"},{type:"Peak Concentration",value:"25-40 mg/L"},{type:"AUC",value:"400-600 mg·h/L"}],defaultTargets:{"Not specified/Korean":{type:"AUC",value:"400-600 mg·h/L"},"Neurosurgical patients/Korean":{type:"AUC",value:"400-600 mg·h/L"}}},{name:"Cyclosporin",indications:["Renal transplant recipients/Korean","Allo-HSCT/Korean","Thoracic transplant recipients/European"],additionalInfo:{"Renal transplant recipients/Korean":["POD ~2","POD 3~6","POD 7~"]},targets:[{type:"Trough Concentration",value:"100-400 ng/mL"},{type:"Peak Concentration",value:"800-1200 ng/mL"}],defaultTargets:{"Allo-HSCT/Korean":{type:"Trough Concentration",value:"150-400 ng/mL"},"Thoracic transplant recipients/European":{type:"Trough Concentration",value:"170-230 ng/mL"},"Renal transplant recipients/Korean":{type:"Trough Concentration",value:"300-350 ng/mL"}}}],ir=({patients:t,prescriptions:n,selectedPatient:r,selectedPrescription:a,setSelectedPrescription:i,onAddPrescription:s,onNext:o,onPrev:l,isCompleted:d,bloodTests:c,setBloodTests:u,drugAdministrations:m,setDrugAdministrations:f,onClearLaterStepData:p,onResetWorkflow:h})=>{const[g,x]=N.useState({drugName:"",indication:"",additionalInfo:"",tdmTarget:"",tdmTargetValue:""}),[v,b]=N.useState(!1),[y,j]=N.useState(""),[w,D]=N.useState(null),[k,S]=N.useState(null),T=e=>e.startsWith("temp"),C=e=>!T(e);N.useEffect(()=>{if(!r)return;const e=`tdmfriends:prescription:${r.id}`;try{const t=localStorage.getItem(e);if(t){const e=JSON.parse(t);if(e.selectedTdmId){D(e.selectedTdmId);const t=n.find(t=>t.id===e.selectedTdmId&&t.patientId===r.id);t&&i(t)}e.newlyAddedTdmId&&S(e.newlyAddedTdmId)}}catch(t){}},[r,n,i,null==r?void 0:r.id]),N.useEffect(()=>{if(!r)return;const e=`tdmfriends:prescription:${r.id}`;try{const t={selectedTdmId:w,newlyAddedTdmId:k,formData:g};localStorage.setItem(e,JSON.stringify(t))}catch(t){}},[w,k,g,r,null==r?void 0:r.id]),N.useEffect(()=>{if(!r||!w)return;const e=n.find(e=>e.id===w&&e.patientId===r.id);e&&i(e)},[w,n,r,null==r?void 0:r.id,i]),N.useEffect(()=>{if(!r||!k)return;const e=n.find(e=>e.id===k&&e.patientId===r.id);e&&(w!==k&&D(k),i(e))},[n,k,r,null==r?void 0:r.id,w,i]);const _=r?n.filter(e=>e.patientId===r.id):[],I=N.useCallback(e=>{const t={drugName:e.drugName||"",indication:e.indication||"",additionalInfo:e.additionalInfo||"",tdmTarget:e.tdmTarget||"Trough Concentration",tdmTargetValue:e.tdmTargetValue||""};x(t),j("Vancomycin"===t.drugName&&"Neurosurgical patients/Korean"===t.indication?"복용 중인 약물 없음"===t.additionalInfo?"아니오":t.additionalInfo?"네":"":"")},[]),M=N.useRef(null),O=N.useRef([]);N.useEffect(()=>{if(!r)return M.current=null,void(O.current=[]);const e=r.id,t=_.map(e=>e.id);if(M.current!==e)return M.current=e,void(O.current=t);const n=O.current,a=t.find(e=>!n.includes(e));if(a){D(a),S(a);const e=_.find(e=>e.id===a);e&&(i(e),I(e))}O.current=t},[_,r,I,i]);const $=ar.find(e=>e.name===g.drugName),P=$?$.targets:[],R=(()=>{if(!$||!g.indication)return[];if("Vancomycin"===$.name&&"Not specified/Korean"===g.indication)return["투석 안 함","CRRT"];if("object"==typeof $.additionalInfo&&!Array.isArray($.additionalInfo)){const e=$.additionalInfo[g.indication];if(e)return e;const t=$.additionalInfo.default;if(t)return t}return Array.isArray($.additionalInfo)?$.additionalInfo:[]})(),A=()=>"Vancomycin"===(null==$?void 0:$.name)&&"Not specified/Korean"===g.indication||("Vancomycin"===(null==$?void 0:$.name)&&"Neurosurgical patients/Korean"===g.indication||"Cyclosporin"===(null==$?void 0:$.name)&&"Renal transplant recipients/Korean"===g.indication),W=()=>{if(!r)return!1;const e=c.some(e=>e.patientId===r.id),t=m.some(e=>e.patientId===r.id);return e||t};return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"2단계: TDM 선택",d&&e.jsx(pe,{className:"h-5 w-5 text-green-600"})]}),e.jsx(ae,{children:r?`${r.name} 환자의 TDM 약물 정보를 입력하세요.`:"TDM 약물 정보를 입력하세요."})]}),e.jsxs(ie,{className:"space-y-6",children:[_.length>0&&e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsxs(re,{children:["TDM 내역 (",_.length,")"]}),e.jsx(ae,{children:"기 수행된 TDM의 F/U TDM을 진행하신다면 아래 내역 중 선택해 주세요."})]}),e.jsx(ie,{children:e.jsx("div",{className:"rounded-md border "+(w?"border-sky-300 dark:border-sky-700":""),children:e.jsxs(Bt,{children:[e.jsx(Gt,{children:e.jsxs(qt,{children:[e.jsx(Jt,{className:"w-12"}),e.jsx(Jt,{children:"분석일"}),e.jsx(Jt,{children:"약물명"}),e.jsx(Jt,{children:"적응증"}),e.jsx(Jt,{children:"추가정보"}),e.jsx(Jt,{children:"TDM 목표치"}),e.jsx(Jt,{children:"삭제"})]})}),e.jsx(Yt,{children:_.map(t=>{const a=w===t.id;return e.jsxs(qt,{className:"cursor-pointer hover:bg-muted/50 "+(a?"bg-sky-50 dark:bg-sky-900 border-l-4 border-l-sky-300 dark:border-l-sky-700":""),onClick:()=>(e=>{D(e.id),i(e),e.id!==k&&S(null),I(e)})(t),children:[e.jsx(Xt,{children:a&&e.jsx(pe,{className:"h-5 w-5 text-sky-500 dark:text-sky-400"})}),e.jsx(Xt,{className:a?"font-bold text-[#333333] dark:text-white":"",children:C(t.id)?"진행 중":t.startDate?new Date(t.startDate).toLocaleDateString("ko-KR"):"-"}),e.jsx(Xt,{className:""+(a?"font-bold text-[#333333] dark:text-white":"font-medium"),children:t.drugName}),e.jsx(Xt,{className:a?"font-bold text-[#333333] dark:text-white":"",children:t.indication||"-"}),e.jsx(Xt,{className:a?"font-bold text-[#333333] dark:text-white":"",children:t.additionalInfo?"Vancomycin"===t.drugName&&"Neurosurgical patients/Korean"===t.indication?"복용 중인 약물 없음"===t.additionalInfo?"신독성 약물 복용 안 함":"신독성 약물 복용 중":t.additionalInfo:"-"}),e.jsx(Xt,{className:a?"font-bold text-[#333333] dark:text-white":"",children:t.tdmTarget&&t.tdmTargetValue?`${t.tdmTarget}: ${t.tdmTargetValue}`:t.tdmTargetValue||"-"}),e.jsx(Xt,{children:C(t.id)&&e.jsxs(se,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),(e=>{if(!r)return;if(!C(e))return;const t=n.find(t=>t.id===e&&t.patientId===r.id);if(!t)return;if(!window.confirm(`${t.drugName} TDM이 진행 중입니다.\n\n해당 TDM 내역을 삭제 시 관련된 Lab정보와 투약 기록, 시뮬레이션 데이터가 초기화 됩니다.\n\n삭제하시겠습니까?`))return;const a=t.drugName,o=n.filter(t=>!(t.id===e&&t.patientId===r.id));s(void 0,o);const l=c.filter(e=>!(e.patientId===r.id&&e.drugName===a));u(l);const d=m.filter(e=>!(e.patientId===r.id&&e.drugName===a));f(d);try{localStorage.removeItem(`tdmfriends:renal:${r.id}:${a}`)}catch(h){}const p=o.filter(e=>e.patientId===r.id);if(p.length>0){const e=p.sort((e,t)=>{const n=parseInt(e.id);return parseInt(t.id)-n})[0];D(e.id),i(e),C(e.id)?S(e.id):S(null);const t={drugName:e.drugName||"",indication:e.indication||"",additionalInfo:e.additionalInfo||"",tdmTarget:e.tdmTarget||"Trough Concentration",tdmTargetValue:e.tdmTargetValue||""};x(t)}else D(null),i(null);e===k&&S(null)})(t.id)},children:[e.jsx("span",{className:"sr-only",children:"삭제"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})]})})]},t.id)})})]})})})]}),e.jsxs(te,{children:[e.jsx(ne,{children:e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"신규 TDM 추가",w&&(()=>{const t=_.find(e=>e.id===w);if(!t)return null;if("existing"!==(T(t.id)?"existing":"newly-added"))return null;const n=t.startDate?new Date(t.startDate).toLocaleDateString("ko-KR"):"";return e.jsxs("span",{className:"text-sm text-blue-600 font-normal",children:["(",n,"에 진행한 TDM을 F/U합니다)"]})})()]})}),e.jsx(ie,{children:e.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!r)return;if(!g.drugName)return void alert("약물명을 선택해주세요.");if(!g.indication)return void alert("적응증/Demographic을 선택해주세요.");if(!g.tdmTarget)return void alert("TDM 목표를 선택해주세요.");if(!g.tdmTargetValue)return void alert("TDM 목표치를 입력해주세요.");if(n.filter(e=>e.patientId===r.id&&e.drugName===g.drugName&&C(e.id)).length>0){if(!window.confirm(`${g.drugName}에 대한 신규 TDM이 이미 등록되어 있습니다. 삭제 후 새로운 TDM을 추가하시겠습니까?`))return;const e=n.filter(e=>{if(e.patientId!==r.id)return!0;if(e.drugName!==g.drugName)return!0;return!C(e.id)}),t={id:Date.now().toString(),patientId:r.id,drugName:g.drugName,dosage:0,unit:"",frequency:"",startDate:new Date,route:"",prescribedBy:"",indication:g.indication,tdmTarget:g.tdmTarget,tdmTargetValue:g.tdmTargetValue,additionalInfo:g.additionalInfo},a=[...e,t];return s(void 0,a),S(t.id),D(t.id),i(t),void x({drugName:"",indication:"",additionalInfo:"",tdmTarget:"",tdmTargetValue:""})}if("Vancomycin"===g.drugName&&"Not specified/Korean"===g.indication&&!g.additionalInfo)return void alert("투석여부(신 대체요법) 정보를 입력해주세요.");if("Vancomycin"===g.drugName&&"Neurosurgical patients/Korean"===g.indication&&!g.additionalInfo)return void alert(`${g.indication}의 경우 복용 중인 약물 정보를 입력해주세요.`);if("Cyclosporin"===g.drugName&&"Renal transplant recipients/Korean"===g.indication&&!g.additionalInfo)return void alert(`${g.indication}의 경우 POD 정보를 입력해주세요.`);const t={id:Date.now().toString(),patientId:r.id,drugName:g.drugName,dosage:0,unit:"",frequency:"",startDate:new Date,route:"",prescribedBy:"",indication:g.indication,tdmTarget:g.tdmTarget,tdmTargetValue:g.tdmTargetValue,additionalInfo:g.additionalInfo},a=n.filter(e=>e.patientId!==r.id);s(t,a),S(t.id),D(t.id),i(t),x({drugName:"",indication:"",additionalInfo:"",tdmTarget:"",tdmTargetValue:""})},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"drugName",children:"약물명 *"}),e.jsxs(L,{value:g.drugName,onValueChange:e=>{var t,n;if(_.length>0&&_[0].drugName!==e){W()&&p()}const r=ar.find(t=>t.name===e),a=(null==r?void 0:r.indications[0])||"",i=null==(t=null==r?void 0:r.defaultTargets)?void 0:t[a];x({drugName:e,indication:a,additionalInfo:"",tdmTarget:(null==i?void 0:i.type)||"Trough Concentration",tdmTargetValue:(null==i?void 0:i.value)||(null==(n=null==r?void 0:r.targets.find(e=>"Trough Concentration"===e.type))?void 0:n.value)||""}),j("")},required:!0,children:[e.jsx(F,{id:"drugName",children:e.jsx(V,{placeholder:"TDM 약물 선택"})}),e.jsx(H,{children:ar.map(t=>e.jsx(U,{value:t.name,children:t.name},t.name))})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"indication",children:"적응증/Demographic *"}),e.jsxs(L,{value:g.indication,onValueChange:e=>{var t;const n=null==(t=null==$?void 0:$.defaultTargets)?void 0:t[e];x(t=>({...t,indication:e,additionalInfo:w?t.additionalInfo:"",tdmTarget:(null==n?void 0:n.type)||t.tdmTarget,tdmTargetValue:(null==n?void 0:n.value)||t.tdmTargetValue})),"Vancomycin"===g.drugName&&"Neurosurgical patients/Korean"===e?j(w&&"복용 중인 약물 없음"===g.additionalInfo?"아니오":w&&g.additionalInfo&&"복용 중인 약물 없음"!==g.additionalInfo?"네":""):j("")},required:!0,disabled:!g.drugName,children:[e.jsx(F,{id:"indication",children:e.jsx(V,{placeholder:"적응증 선택"})}),e.jsx(H,{children:null==$?void 0:$.indications.map(t=>e.jsx(U,{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"tdmTarget",children:"TDM 목표 *"}),e.jsxs(L,{value:g.tdmTarget,onValueChange:e=>{const t=P.find(t=>t.type===e);x(n=>({...n,tdmTarget:e,tdmTargetValue:(null==t?void 0:t.value)||""}))},required:!0,disabled:!g.drugName,children:[e.jsx(F,{id:"tdmTarget",children:e.jsx(V,{placeholder:"TDM 목표 선택"})}),e.jsx(H,{children:P.map(t=>e.jsx(U,{value:t.type,children:t.type},t.type))})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"tdmTargetValue",children:"TDM 목표치 *"}),e.jsx(oe,{id:"tdmTargetValue",value:g.tdmTargetValue,onChange:e=>x(t=>({...t,tdmTargetValue:e.target.value})),placeholder:"TDM 목표 선택 시 자동 입력, 수정 가능",required:!0,disabled:!g.tdmTarget})]}),!(!$||!g.indication)&&("Vancomycin"===$.name&&"Not specified/Korean"===g.indication||"Vancomycin"===$.name&&"Neurosurgical patients/Korean"===g.indication||"Cyclosporin"===$.name&&"Renal transplant recipients/Korean"===g.indication)&&e.jsx("div",{className:"md:col-span-2",children:"Vancomycin"===g.drugName&&"Neurosurgical patients/Korean"===g.indication?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(E,{htmlFor:"nephrotoxic-drug",className:"font-bold",children:["신독성 약물을 복용 중인가요? ",A()?"*":""]}),e.jsx(se,{type:"button",variant:"link",className:"h-auto p-0 text-sm text-gray-600 underline",onClick:()=>b(!0),children:"약물 목록 보기"})]}),e.jsxs(tr,{value:y||("복용 중인 약물 없음"===g.additionalInfo?"아니오":g.additionalInfo&&"복용 중인 약물 없음"!==g.additionalInfo?"네":""),onValueChange:e=>{if(j(e),"아니오"===e)x(e=>({...e,additionalInfo:"복용 중인 약물 없음"}));else if("네"===e){const e=rr.find(e=>"복용 중인 약물 없음"!==e&&"기타"!==e);x(t=>({...t,additionalInfo:t.additionalInfo&&"복용 중인 약물 없음"!==t.additionalInfo?t.additionalInfo:e||""}))}},className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(nr,{value:"네",id:"yes"}),e.jsx(E,{htmlFor:"yes",children:"네"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(nr,{value:"아니오",id:"no"}),e.jsx(E,{htmlFor:"no",children:"아니오"})]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(E,{className:"font-bold",children:[$&&g.indication?"Vancomycin"===$.name&&"Not specified/Korean"===g.indication?"투석여부(신 대체요법)":"Vancomycin"===$.name&&"Neurosurgical patients/Korean"===g.indication?"복용 중인 약물":"Cyclosporin"===$.name&&"Renal transplant recipients/Korean"===g.indication?"수술 후 경과일(POD)":"추가정보":"추가정보"," ",A()?"*":""]}),"Vancomycin"===g.drugName&&"Not specified/Korean"===g.indication&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"Vancomycin의 Not specified/Korean 적응증에서는 CRRT 분석 모델만 지원됩니다."})]}),e.jsx(tr,{value:g.additionalInfo,onValueChange:e=>{x(t=>({...t,additionalInfo:e}))},className:"flex flex-wrap gap-4",children:R.map((t,n)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(nr,{value:t,id:`additional-${n}`}),e.jsx(E,{htmlFor:`additional-${n}`,className:"cursor-pointer",children:t})]},t))})]})})]}),e.jsx("div",{className:"pt-[30px]",children:e.jsx(se,{type:"submit",className:"w-full",children:"TDM 추가"})})]})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(se,{variant:"outline",onClick:l,className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"환자 등록 및 선택"]}),d&&e.jsxs(se,{onClick:()=>{w?o():alert("현재 진행 중인 TDM이 선택되어 있지 않습니다. TDM 내역을 선택한 후 다음 단계로 이동해주세요.")},className:"flex items-center gap-2 w-[300px] bg-black dark:bg-primary text-white dark:text-primary-foreground font-bold text-lg py-3 px-6 justify-center hover:bg-gray-800 dark:hover:bg-primary/90",children:["Lab",e.jsx(xe,{className:"h-4 w-4"})]})]})]})]}),e.jsx(Zt,{open:v,onOpenChange:b,children:e.jsxs(nn,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",onInteractOutside:()=>b(!1),children:[e.jsxs(rn,{children:[e.jsxs(sn,{children:["신독성 약물 목록 (",rr.filter(e=>"복용 중인 약물 없음"!==e&&"기타"!==e).length,")"]}),e.jsx(on,{children:'해당하는 약물이 있다면 "네"를 선택해주세요.'})]}),e.jsx("ul",{className:"list-disc pl-6 space-y-1 text-sm text-muted-foreground",children:rr.filter(e=>"복용 중인 약물 없음"!==e&&"기타"!==e).map((t,n)=>e.jsx("li",{className:"text-base text-foreground",children:t},n))}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(se,{type:"button",onClick:()=>b(!1),children:"확인"})})]})})]}):e.jsx(te,{children:e.jsx(ie,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(be,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Please select a patient first"})]})})})},sr=["onCopy","onCut","onPaste","onCompositionEnd","onCompositionStart","onCompositionUpdate","onFocus","onBlur","onInput","onInvalid","onReset","onSubmit","onLoad","onError","onKeyDown","onKeyPress","onKeyUp","onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting","onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop","onSelect","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut","onScroll","onWheel","onAnimationStart","onAnimationEnd","onAnimationIteration","onTransitionEnd","onChange","onToggle"];const or=(e,t,n,r)=>{if("length"===n||"prototype"===n)return;if("arguments"===n||"caller"===n)return;const a=Object.getOwnPropertyDescriptor(e,n),i=Object.getOwnPropertyDescriptor(t,n);!lr(a,i)&&r||Object.defineProperty(e,n,i)},lr=function(e,t){return void 0===e||e.configurable||e.writable===t.writable&&e.enumerable===t.enumerable&&e.configurable===t.configurable&&(e.writable||e.value===t.value)},dr=(e,t)=>`/* Wrapped ${e}*/\n${t}`,cr=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),ur=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name");function mr(e,t,{ignoreNonConfigurable:n=!1}={}){const{name:r}=e;for(const a of Reflect.ownKeys(t))or(e,t,a,n);return((e,t)=>{const n=Object.getPrototypeOf(t);n!==Object.getPrototypeOf(e)&&Object.setPrototypeOf(e,n)})(e,t),((e,t,n)=>{const r=""===n?"":`with ${n.trim()}() `,a=dr.bind(null,r,t.toString());Object.defineProperty(a,"name",ur);const{writable:i,enumerable:s,configurable:o}=cr;Object.defineProperty(e,"toString",{value:a,writable:i,enumerable:s,configurable:o})})(e,t,r),e}const fr=2147483647,pr=new WeakMap,hr=new WeakMap,gr=new WeakMap;function xr(e,{cacheKey:t,cache:n=new Map,maxAge:r}={}){if(0===r)return e;if("number"==typeof r&&Number.isFinite(r)){if(r>fr)throw new TypeError("The `maxAge` option cannot exceed 2147483647.");if(r<0)throw new TypeError("The `maxAge` option should not be a negative number.")}const a=function(...i){var s;const o=t?t(i):i[0],l=function(e,t){const n=e.get(t);if(n){if(!(n.maxAge<=Date.now()))return n;e.delete(t)}}(n,o);if(l)return l.data;const d=e.apply(this,i),c="function"==typeof r?r(...i):r;if(void 0!==c&&c!==Number.POSITIVE_INFINITY){if(!Number.isFinite(c))throw new TypeError("The `maxAge` function must return a finite number, `0`, or `Infinity`.");if(c<=0)return d;if(c>fr)throw new TypeError("The `maxAge` function result cannot exceed 2147483647.")}if(n.set(o,{data:d,maxAge:void 0===c||c===Number.POSITIVE_INFINITY?Number.POSITIVE_INFINITY:Date.now()+c}),void 0!==c&&c!==Number.POSITIVE_INFINITY){const e=setTimeout(()=>{var t;n.delete(o),null==(t=hr.get(a))||t.delete(e)},c);null==(s=e.unref)||s.call(e);const t=hr.get(a)??new Set;t.add(e),hr.set(a,t)}return d};return mr(a,e,{ignoreNonConfigurable:!0}),pr.set(a,n),gr.set(a,t??(e=>e[0])),a}function vr(e){return"string"==typeof e}function br(e,t,n){return n.indexOf(e)===t}function yr(e){return-1===e.indexOf(",")?e:e.split(",")}function jr(e){if(!e)return e;if("C"===e||"posix"===e||"POSIX"===e)return"en-US";if(-1!==e.indexOf(".")){var t=e.split(".")[0];return jr(void 0===t?"":t)}if(-1!==e.indexOf("@")){var n=e.split("@")[0];return jr(void 0===n?"":n)}if(-1===e.indexOf("-")||(r=e).toLowerCase()!==r)return e;var r,a=e.split("-"),i=a[0],s=a[1],o=void 0===s?"":s;return"".concat(i,"-").concat(o.toUpperCase())}var wr=xr(function(e){var t=void 0===e?{}:e,n=t.useFallbackLocale,r=void 0===n||n,a=t.fallbackLocale,i=void 0===a?"en-US":a,s=[];if("undefined"!=typeof navigator){for(var o=[],l=0,d=navigator.languages||[];l<d.length;l++){var c=d[l];o=o.concat(yr(c))}var u=navigator.language,m=u?yr(u):u;s=s.concat(o,m)}return r&&s.push(i),s.filter(vr).map(jr).filter(br)},{cacheKey:JSON.stringify});var Nr=xr(function(e){return wr(e)[0]||null},{cacheKey:JSON.stringify});function Dr(e,t,n){return function(r,a=n){const i=e(r)+a;return t(i)}}function kr(e){return function(t){return new Date(e(t).getTime()-1)}}function Sr(e,t){return function(n){return[e(n),t(n)]}}function Tr(e){if(e instanceof Date)return e.getFullYear();if("number"==typeof e)return e;const t=Number.parseInt(e,10);if("string"==typeof e&&!Number.isNaN(t))return t;throw new Error(`Failed to get year from date: ${e}.`)}function Cr(e){if(e instanceof Date)return e.getMonth();throw new Error(`Failed to get month from date: ${e}.`)}function _r(e){if(e instanceof Date)return e.getMonth()+1;throw new Error(`Failed to get human-readable month from date: ${e}.`)}function Ir(e){if(e instanceof Date)return e.getDate();throw new Error(`Failed to get year from date: ${e}.`)}function Mr(e){if(e instanceof Date)return e.getHours();if("string"==typeof e){const t=e.split(":");if(t.length>=2){const e=t[0];if(e){const t=Number.parseInt(e,10);if(!Number.isNaN(t))return t}}}throw new Error(`Failed to get hours from date: ${e}.`)}function Or(e){if(e instanceof Date)return e.getMinutes();if("string"==typeof e){const t=e.split(":");if(t.length>=2){const e=t[1]||"0",n=Number.parseInt(e,10);if(!Number.isNaN(n))return n}}throw new Error(`Failed to get minutes from date: ${e}.`)}function $r(e){if(e instanceof Date)return e.getSeconds();if("string"==typeof e){const t=e.split(":");if(t.length>=2){const e=t[2]||"0",n=Number.parseInt(e,10);if(!Number.isNaN(n))return n}}throw new Error(`Failed to get seconds from date: ${e}.`)}function Pr(e){if(e instanceof Date)return e.getMilliseconds();if("string"==typeof e){const t=e.split(":");if(t.length>=2){const e=(t[2]||"0").split(".")[1]||"0",n=Number.parseInt(e,10);if(!Number.isNaN(n))return n}}throw new Error(`Failed to get seconds from date: ${e}.`)}function Rr(e){const t=Tr(e),n=t+(1-t)%100,r=new Date;return r.setFullYear(n,0,1),r.setHours(0,0,0,0),r}const Ar=Dr(Tr,Rr,-100),Er=Dr(Tr,Rr,100),Lr=kr(Er),Fr=Dr(Tr,Lr,-100),Vr=Sr(Rr,Lr);function Hr(e){const t=Tr(e),n=t+(1-t)%10,r=new Date;return r.setFullYear(n,0,1),r.setHours(0,0,0,0),r}const Ur=Dr(Tr,Hr,-10),Wr=Dr(Tr,Hr,10),zr=kr(Wr),Kr=Dr(Tr,zr,-10),Br=Sr(Hr,zr);function Gr(e){const t=Tr(e),n=new Date;return n.setFullYear(t,0,1),n.setHours(0,0,0,0),n}const Yr=Dr(Tr,Gr,-1),qr=Dr(Tr,Gr,1),Jr=kr(qr),Xr=Dr(Tr,Jr,-1),Zr=Sr(Gr,Jr);function Qr(e,t){return function(n,r=t){const a=Tr(n),i=Cr(n)+r,s=new Date;return s.setFullYear(a,i,1),s.setHours(0,0,0,0),e(s)}}function ea(e){const t=Tr(e),n=Cr(e),r=new Date;return r.setFullYear(t,n,1),r.setHours(0,0,0,0),r}const ta=Qr(ea,-1),na=Qr(ea,1),ra=kr(na),aa=Qr(ra,-1),ia=Sr(ea,ra);function sa(e){const t=Tr(e),n=Cr(e),r=Ir(e),a=new Date;return a.setFullYear(t,n,r),a.setHours(0,0,0,0),a}var oa,la;const da=kr((oa=sa,la=1,function(e,t=la){const n=Tr(e),r=Cr(e),a=Ir(e)+t,i=new Date;return i.setFullYear(n,r,a),i.setHours(0,0,0,0),oa(i)})),ca=Sr(sa,da);function ua(e){return Ir(ra(e))}function ma(e,t=2){const n=`${e}`;return n.length>=t?e:`0000${n}`.slice(-t)}function fa(e){return`${ma(Mr(e))}:${ma(Or(e))}:${ma($r(e))}`}function pa(e){return`${ma(Tr(e),4)}-${ma(_r(e))}-${ma(Ir(e))}`}function ha(e){return`${pa(e)}T${fa(e)}`}var ga="gregory",xa="hebrew",va="islamic",ba="iso8601",ya={gregory:["en-CA","en-US","es-AR","es-BO","es-CL","es-CO","es-CR","es-DO","es-EC","es-GT","es-HN","es-MX","es-NI","es-PA","es-PE","es-PR","es-SV","es-VE","pt-BR"],hebrew:["he","he-IL"],islamic:["ar","ar-AE","ar-BH","ar-DZ","ar-EG","ar-IQ","ar-JO","ar-KW","ar-LY","ar-OM","ar-QA","ar-SA","ar-SD","ar-SY","ar-YE","dv","dv-MV","ps","ps-AR"]},ja=[0,1,2,3,4,5,6],wa=new Map;function Na(e){return function(t,n){return function(e){return function(t,n){var r=t||Nr();wa.has(r)||wa.set(r,new Map);var a=wa.get(r);return a.has(e)||a.set(e,new Intl.DateTimeFormat(r||void 0,e).format),a.get(e)(n)}}(e)(t,function(e){var t=new Date(e);return new Date(t.setHours(12))}(n))}}var Da=Na({day:"numeric"}),ka=Na({day:"numeric",month:"long",year:"numeric"}),Sa=Na({month:"long"}),Ta=Na({month:"long",year:"numeric"}),Ca=Na({weekday:"short"}),_a=Na({weekday:"long"}),Ia=Na({year:"numeric"}),Ma=ja[0],Oa=ja[5],$a=ja[6];function Pa(e,t){void 0===t&&(t=ba);var n=e.getDay();switch(t){case ba:return(n+6)%7;case va:return(n+1)%7;case xa:case ga:return n;default:throw new Error("Unsupported calendar type.")}}function Ra(e,t){void 0===t&&(t=ba);var n=Tr(e),r=Cr(e),a=e.getDate()-Pa(e,t);return new Date(n,r,a)}function Aa(e,t){switch(e){case"century":return Rr(t);case"decade":return Hr(t);case"year":return Gr(t);case"month":return ea(t);case"day":return sa(t);default:throw new Error("Invalid rangeType: ".concat(e))}}function Ea(e,t){switch(e){case"century":return Er(t);case"decade":return Wr(t);case"year":return qr(t);case"month":return na(t);default:throw new Error("Invalid rangeType: ".concat(e))}}function La(e,t){switch(e){case"century":return Lr(t);case"decade":return zr(t);case"year":return Jr(t);case"month":return ra(t);case"day":return da(t);default:throw new Error("Invalid rangeType: ".concat(e))}}function Fa(e,t){switch(e){case"century":return Vr(t);case"decade":return Br(t);case"year":return Zr(t);case"month":return ia(t);case"day":return ca(t);default:throw new Error("Invalid rangeType: ".concat(e))}}function Va(e,t,n){return n.map(function(n){return(t||Ia)(e,n)}).join(" – ")}function Ha(e,t,n){return Va(e,t,Br(n))}function Ua(e){return e.getDay()===(new Date).getDay()}function Wa(e,t){void 0===t&&(t=ba);var n=e.getDay();switch(t){case va:case xa:return n===Oa||n===$a;case ba:case ga:return n===$a||n===Ma;default:throw new Error("Unsupported calendar type.")}}var za="react-calendar__navigation";function Ka(t){var n,r=t.activeStartDate,a=t.drillUp,i=t.formatMonthYear,s=void 0===i?Ta:i,o=t.formatYear,l=void 0===o?Ia:o,d=t.locale,c=t.maxDate,u=t.minDate,m=t.navigationAriaLabel,f=void 0===m?"":m,p=t.navigationAriaLive,h=t.navigationLabel,g=t.next2AriaLabel,x=void 0===g?"":g,v=t.next2Label,b=void 0===v?"»":v,y=t.nextAriaLabel,j=void 0===y?"":y,w=t.nextLabel,N=void 0===w?"›":w,D=t.prev2AriaLabel,k=void 0===D?"":D,S=t.prev2Label,T=void 0===S?"«":S,C=t.prevAriaLabel,_=void 0===C?"":C,I=t.prevLabel,M=void 0===I?"‹":I,O=t.setActiveStartDate,$=t.showDoubleView,P=t.view,R=t.views.indexOf(P)>0,A="century"!==P,E=function(e,t){switch(e){case"century":return Ar(t);case"decade":return Ur(t);case"year":return Yr(t);case"month":return ta(t);default:throw new Error("Invalid rangeType: ".concat(e))}}(P,r),L=A?function(e,t){switch(e){case"decade":return Ur(t,-100);case"year":return Yr(t,-10);case"month":return ta(t,-12);default:throw new Error("Invalid rangeType: ".concat(e))}}(P,r):void 0,F=Ea(P,r),V=A?function(e,t){switch(e){case"decade":return Wr(t,100);case"year":return qr(t,10);case"month":return na(t,12);default:throw new Error("Invalid rangeType: ".concat(e))}}(P,r):void 0,H=function(){if(E.getFullYear()<0)return!0;var e=function(e,t){switch(e){case"century":return Fr(t);case"decade":return Kr(t);case"year":return Xr(t);case"month":return aa(t);default:throw new Error("Invalid rangeType: ".concat(e))}}(P,r);return u&&u>=e}(),U=A&&function(){if(L.getFullYear()<0)return!0;var e=function(e,t){switch(e){case"decade":return Kr(t,-100);case"year":return Xr(t,-10);case"month":return aa(t,-12);default:throw new Error("Invalid rangeType: ".concat(e))}}(P,r);return u&&u>=e}(),W=c&&c<F,z=A&&c&&c<V;function K(e){var t=function(){switch(P){case"century":return function(e,t,n){return Va(e,t,Vr(n))}(d,l,e);case"decade":return Ha(d,l,e);case"year":return l(d,e);case"month":return s(d,e);default:throw new Error("Invalid view: ".concat(P,"."))}}();return h?h({date:e,label:t,locale:d||Nr()||void 0,view:P}):t}return e.jsxs("div",{className:za,children:[null!==T&&A?e.jsx("button",{"aria-label":k,className:"".concat(za,"__arrow ").concat(za,"__prev2-button"),disabled:U,onClick:function(){O(L,"prev2")},type:"button",children:T}):null,null!==M&&e.jsx("button",{"aria-label":_,className:"".concat(za,"__arrow ").concat(za,"__prev-button"),disabled:H,onClick:function(){O(E,"prev")},type:"button",children:M}),(n="".concat(za,"__label"),e.jsxs("button",{"aria-label":f,"aria-live":p,className:n,disabled:!R,onClick:a,style:{flexGrow:1},type:"button",children:[e.jsx("span",{className:"".concat(n,"__labelText ").concat(n,"__labelText--from"),children:K(r)}),$?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"".concat(n,"__divider"),children:" – "}),e.jsx("span",{className:"".concat(n,"__labelText ").concat(n,"__labelText--to"),children:K(F)})]}):null]})),null!==N&&e.jsx("button",{"aria-label":j,className:"".concat(za,"__arrow ").concat(za,"__next-button"),disabled:W,onClick:function(){O(F,"next")},type:"button",children:N}),null!==b&&A?e.jsx("button",{"aria-label":x,className:"".concat(za,"__arrow ").concat(za,"__next2-button"),disabled:z,onClick:function(){O(V,"next2")},type:"button",children:b}):null]})}var Ba=function(){return Ba=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Ba.apply(this,arguments)};function Ga(e){return"".concat(e,"%")}function Ya(t){var n=t.children,r=t.className,a=t.count,i=t.direction,s=t.offset,o=t.style,l=t.wrap,d=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(t,["children","className","count","direction","offset","style","wrap"]);return e.jsx("div",Ba({className:r,style:Ba({display:"flex",flexDirection:i,flexWrap:l?"wrap":"nowrap"},o)},d,{children:N.Children.map(n,function(e,t){var n=s&&0===t?Ga(100*s/a):null;return N.cloneElement(e,Ba(Ba({},e.props),{style:{flexBasis:Ga(100/a),flexShrink:0,flexGrow:0,overflow:"hidden",marginLeft:n,marginInlineStart:n,marginInlineEnd:0}}))})}))}function qa(e,t){return t[0]<=e&&t[1]>=e}function Ja(e,t){return qa(e[0],t)||qa(e[1],t)}function Xa(e,t,n){var r=[];if(Ja(t,e)){r.push(n);var a=qa(e[0],t),i=qa(e[1],t);a&&r.push("".concat(n,"Start")),i&&r.push("".concat(n,"End")),a&&i&&r.push("".concat(n,"BothEnds"))}return r}function Za(e){if(!e)throw new Error("args is required");var t=e.value,n=e.date,r=e.hover,a="react-calendar__tile",i=[a];if(!n)return i;var s=new Date,o=function(){if(Array.isArray(n))return n;var t=e.dateType;if(!t)throw new Error("dateType is required when date is not an array of two dates");return Fa(t,n)}();if(qa(s,o)&&i.push("".concat(a,"--now")),!t||!function(e){return Array.isArray(e)?null!==e[0]&&null!==e[1]:null!==e}(t))return i;var l,d,c=function(){if(Array.isArray(t))return t;var n=e.valueType;if(!n)throw new Error("valueType is required when value is not an array of two dates");return Fa(n,t)}();d=o,(l=c)[0]<=d[0]&&l[1]>=d[1]?i.push("".concat(a,"--active")):Ja(c,o)&&i.push("".concat(a,"--hasActive"));var u=Xa(c,o,"".concat(a,"--range"));i.push.apply(i,u);var m=Array.isArray(t)?t:[t];if(r&&1===m.length){var f=Xa(r>c[0]?[c[0],r]:[r,c[0]],o,"".concat(a,"--hover"));i.push.apply(i,f)}return i}function Qa(t){for(var n=t.className,r=t.count,a=void 0===r?3:r,i=t.dateTransform,s=t.dateType,o=t.end,l=t.hover,d=t.offset,c=t.renderTile,u=t.start,m=t.step,f=void 0===m?1:m,p=t.value,h=t.valueType,g=[],x=u;x<=o;x+=f){var v=i(x);g.push(c({classes:Za({date:v,dateType:s,hover:l,value:p,valueType:h}),date:v}))}return e.jsx(Ya,{className:n,count:a,offset:d,wrap:!0,children:g})}function ei(t){var n=t.activeStartDate,r=t.children,a=t.classes,i=t.date,s=t.formatAbbr,o=t.locale,l=t.maxDate,d=t.maxDateTransform,c=t.minDate,u=t.minDateTransform,m=t.onClick,f=t.onMouseOver,p=t.style,h=t.tileClassName,g=t.tileContent,x=t.tileDisabled,v=t.view,b=N.useMemo(function(){return"function"==typeof h?h({activeStartDate:n,date:i,view:v}):h},[n,i,h,v]),y=N.useMemo(function(){return"function"==typeof g?g({activeStartDate:n,date:i,view:v}):g},[n,i,g,v]);return e.jsxs("button",{className:we(a,b),disabled:c&&u(c)>i||l&&d(l)<i||(null==x?void 0:x({activeStartDate:n,date:i,view:v})),onClick:m?function(e){return m(i,e)}:void 0,onFocus:f?function(){return f(i)}:void 0,onMouseOver:f?function(){return f(i)}:void 0,style:p,type:"button",children:[s?e.jsx("abbr",{"aria-label":s(o,i),children:r}):r,y]})}var ti=function(){return ti=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ti.apply(this,arguments)},ni="react-calendar__century-view__decades__decade";function ri(t){var n=t.classes,r=void 0===n?[]:n,a=t.currentCentury,i=t.formatYear,s=void 0===i?Ia:i,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(t,["classes","currentCentury","formatYear"]),l=o.date,d=o.locale,c=[];return r&&c.push.apply(c,r),c.push(ni),Rr(l).getFullYear()!==a&&c.push("".concat(ni,"--neighboringCentury")),e.jsx(ei,ti({},o,{classes:c,maxDateTransform:zr,minDateTransform:Hr,view:"century",children:Ha(d,s,l)}))}var ai=function(){return ai=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ai.apply(this,arguments)},ii=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};function si(t){var n=t.activeStartDate,r=t.hover,a=t.showNeighboringCentury,i=t.value,s=t.valueType,o=ii(t,["activeStartDate","hover","showNeighboringCentury","value","valueType"]),l=Tr(Rr(n)),d=l+(a?119:99);return e.jsx(Qa,{className:"react-calendar__century-view__decades",dateTransform:Hr,dateType:"decade",end:d,hover:r,renderTile:function(t){var r=t.date,a=ii(t,["date"]);return e.jsx(ri,ai({},o,a,{activeStartDate:n,currentCentury:l,date:r}),r.getTime())},start:l,step:10,value:i,valueType:s})}var oi=function(){return oi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},oi.apply(this,arguments)};function li(t){return e.jsx("div",{className:"react-calendar__century-view",children:e.jsx(si,oi({},t))})}var di=function(){return di=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},di.apply(this,arguments)},ci="react-calendar__decade-view__years__year";function ui(t){var n=t.classes,r=void 0===n?[]:n,a=t.currentDecade,i=t.formatYear,s=void 0===i?Ia:i,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(t,["classes","currentDecade","formatYear"]),l=o.date,d=o.locale,c=[];return r&&c.push.apply(c,r),c.push(ci),Hr(l).getFullYear()!==a&&c.push("".concat(ci,"--neighboringDecade")),e.jsx(ei,di({},o,{classes:c,maxDateTransform:Jr,minDateTransform:Gr,view:"decade",children:s(d,l)}))}var mi=function(){return mi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},mi.apply(this,arguments)},fi=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};function pi(t){var n=t.activeStartDate,r=t.hover,a=t.showNeighboringDecade,i=t.value,s=t.valueType,o=fi(t,["activeStartDate","hover","showNeighboringDecade","value","valueType"]),l=Tr(Hr(n)),d=l+(a?11:9);return e.jsx(Qa,{className:"react-calendar__decade-view__years",dateTransform:Gr,dateType:"year",end:d,hover:r,renderTile:function(t){var r=t.date,a=fi(t,["date"]);return e.jsx(ui,mi({},o,a,{activeStartDate:n,currentDecade:l,date:r}),r.getTime())},start:l,value:i,valueType:s})}var hi=function(){return hi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},hi.apply(this,arguments)};function gi(t){return e.jsx("div",{className:"react-calendar__decade-view",children:e.jsx(pi,hi({},t))})}var xi=function(){return xi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},xi.apply(this,arguments)},vi=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};function bi(t){var n=t.classes,r=void 0===n?[]:n,a=t.formatMonth,i=void 0===a?Sa:a,s=t.formatMonthYear,o=void 0===s?Ta:s,l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(t,["classes","formatMonth","formatMonthYear"]),d=l.date,c=l.locale;return e.jsx(ei,xi({},l,{classes:vi(vi([],r,!0),["react-calendar__year-view__months__month"],!1),formatAbbr:o,maxDateTransform:ra,minDateTransform:ea,view:"year",children:i(c,d)}))}var yi=function(){return yi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},yi.apply(this,arguments)},ji=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};function wi(t){var n=t.activeStartDate,r=t.hover,a=t.value,i=t.valueType,s=ji(t,["activeStartDate","hover","value","valueType"]),o=Tr(n);return e.jsx(Qa,{className:"react-calendar__year-view__months",dateTransform:function(e){var t=new Date;return t.setFullYear(o,e,1),ea(t)},dateType:"month",end:11,hover:r,renderTile:function(t){var r=t.date,a=ji(t,["date"]);return e.jsx(bi,yi({},s,a,{activeStartDate:n,date:r}),r.getTime())},start:0,value:a,valueType:i})}var Ni=function(){return Ni=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Ni.apply(this,arguments)};function Di(t){return e.jsx("div",{className:"react-calendar__year-view",children:e.jsx(wi,Ni({},t))})}var ki=function(){return ki=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ki.apply(this,arguments)},Si="react-calendar__month-view__days__day";function Ti(t){var n=t.calendarType,r=t.classes,a=void 0===r?[]:r,i=t.currentMonthIndex,s=t.formatDay,o=void 0===s?Da:s,l=t.formatLongDate,d=void 0===l?ka:l,c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(t,["calendarType","classes","currentMonthIndex","formatDay","formatLongDate"]),u=c.date,m=c.locale,f=[];return a&&f.push.apply(f,a),f.push(Si),Wa(u,n)&&f.push("".concat(Si,"--weekend")),u.getMonth()!==i&&f.push("".concat(Si,"--neighboringMonth")),e.jsx(ei,ki({},c,{classes:f,formatAbbr:d,maxDateTransform:da,minDateTransform:sa,view:"month",children:o(m,u)}))}var Ci=function(){return Ci=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Ci.apply(this,arguments)},_i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};function Ii(t){var n=t.activeStartDate,r=t.calendarType,a=t.hover,i=t.showFixedNumberOfWeeks,s=t.showNeighboringMonth,o=t.value,l=t.valueType,d=_i(t,["activeStartDate","calendarType","hover","showFixedNumberOfWeeks","showNeighboringMonth","value","valueType"]),c=Tr(n),u=Cr(n),m=i||s,f=Pa(n,r),p=m?0:f,h=1+(m?-f:0),g=function(){if(i)return h+42-1;var e=ua(n);if(s){var t=new Date;return t.setFullYear(c,u,e),t.setHours(0,0,0,0),e+(7-Pa(t,r)-1)}return e}();return e.jsx(Qa,{className:"react-calendar__month-view__days",count:7,dateTransform:function(e){var t=new Date;return t.setFullYear(c,u,e),sa(t)},dateType:"day",hover:a,end:g,renderTile:function(t){var a=t.date,i=_i(t,["date"]);return e.jsx(Ti,Ci({},d,i,{activeStartDate:n,calendarType:r,currentMonthIndex:u,date:a}),a.getTime())},offset:p,start:h,value:o,valueType:l})}var Mi="react-calendar__month-view__weekdays",Oi="".concat(Mi,"__weekday");function $i(t){for(var n=t.calendarType,r=t.formatShortWeekday,a=void 0===r?Ca:r,i=t.formatWeekday,s=void 0===i?_a:i,o=t.locale,l=t.onMouseLeave,d=ea(new Date),c=Tr(d),u=Cr(d),m=[],f=1;f<=7;f+=1){var p=new Date(c,u,f-Pa(d,n)),h=s(o,p);m.push(e.jsx("div",{className:we(Oi,Ua(p)&&"".concat(Oi,"--current"),Wa(p,n)&&"".concat(Oi,"--weekend")),children:e.jsx("abbr",{"aria-label":h,title:h,children:a(o,p).replace(".","")})},f))}return e.jsx(Ya,{className:Mi,count:7,onFocus:l,onMouseOver:l,children:m})}var Pi=function(){return Pi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Pi.apply(this,arguments)},Ri=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},Ai="react-calendar__tile";function Ei(t){var n=t.onClickWeekNumber,r=t.weekNumber,a=e.jsx("span",{children:r});if(n){var i=t.date,s=t.onClickWeekNumber,o=t.weekNumber,l=Ri(t,["date","onClickWeekNumber","weekNumber"]);return e.jsx("button",Pi({},l,{className:Ai,onClick:function(e){return s(o,i,e)},type:"button",children:a}))}t.date,t.onClickWeekNumber,t.weekNumber;l=Ri(t,["date","onClickWeekNumber","weekNumber"]);return e.jsx("div",Pi({},l,{className:Ai,children:a}))}function Li(t){var n=t.activeStartDate,r=t.calendarType,a=t.onClickWeekNumber,i=t.onMouseLeave,s=t.showFixedNumberOfWeeks,o=function(){if(s)return 6;var e=ua(n)-(7-Pa(n,r));return 1+Math.ceil(e/7)}(),l=function(){for(var e=Tr(n),t=Cr(n),a=Ir(n),i=[],s=0;s<o;s+=1)i.push(Ra(new Date(e,t,a+7*s),r));return i}(),d=l.map(function(e){return function(e,t){void 0===t&&(t=ba);var n,r=t===ga?ga:ba,a=Ra(e,t),i=Tr(e)+1;do{n=Ra(new Date(i,0,r===ba?4:1),t),i-=1}while(e<n);return Math.round((a.getTime()-n.getTime())/6048e5)+1}(e,r)});return e.jsx(Ya,{className:"react-calendar__month-view__weekNumbers",count:o,direction:"column",onFocus:i,onMouseOver:i,style:{flexBasis:"calc(100% * (1 / 8)",flexShrink:0},children:d.map(function(t,n){var r=l[n];if(!r)throw new Error("date is not defined");return e.jsx(Ei,{date:r,onClickWeekNumber:a,weekNumber:t},t)})})}var Fi=function(){return Fi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Fi.apply(this,arguments)};function Vi(t){var n=t.activeStartDate,r=t.locale,a=t.onMouseLeave,i=t.showFixedNumberOfWeeks,s=t.calendarType,o=void 0===s?function(e){if(e)for(var t=0,n=Object.entries(ya);t<n.length;t++){var r=n[t],a=r[0];if(r[1].includes(e))return a}return ba}(r):s,l=t.formatShortWeekday,d=t.formatWeekday,c=t.onClickWeekNumber,u=t.showWeekNumbers,m=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(t,["calendarType","formatShortWeekday","formatWeekday","onClickWeekNumber","showWeekNumbers"]);var f="react-calendar__month-view";return e.jsx("div",{className:we(f,u?"".concat(f,"--weekNumbers"):""),children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-end"},children:[u?e.jsx(Li,{activeStartDate:n,calendarType:o,onClickWeekNumber:c,onMouseLeave:a,showFixedNumberOfWeeks:i}):null,e.jsxs("div",{style:{flexGrow:1,width:"100%"},children:[e.jsx($i,{calendarType:o,formatShortWeekday:l,formatWeekday:d,locale:r,onMouseLeave:a}),e.jsx(Ii,Fi({calendarType:o},m))]})]})})}var Hi=function(){return Hi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Hi.apply(this,arguments)},Ui="react-calendar",Wi=["century","decade","year","month"],zi=["decade","year","month","day"],Ki=new Date;Ki.setFullYear(1,0,1),Ki.setHours(0,0,0,0);var Bi=new Date(864e13);function Gi(e){return e instanceof Date?e:new Date(e)}function Yi(e,t){return Wi.slice(Wi.indexOf(e),Wi.indexOf(t)+1)}function qi(e,t,n){return e&&function(e,t,n){return-1!==Yi(t,n).indexOf(e)}(e,t,n)?e:n}function Ji(e){var t=Wi.indexOf(e);return zi[t]}function Xi(e,t){var n=e.value,r=e.minDate,a=e.maxDate,i=e.maxDetail,s=function(e,t){var n=Array.isArray(e)?e[t]:e;if(!n)return null;var r=Gi(n);if(Number.isNaN(r.getTime()))throw new Error("Invalid date: ".concat(e));return r}(n,t);if(!s)return null;var o=Ji(i);return function(e,t,n){return t&&t>e?t:n&&n<e?n:e}(function(){switch(t){case 0:return Aa(o,s);case 1:return La(o,s);default:throw new Error("Invalid index value: ".concat(t))}}(),r,a)}var Zi=function(e){return Xi(e,0)},Qi=function(e){return Xi(e,1)},es=function(e){return[Zi,Qi].map(function(t){return t(e)})};function ts(e){var t=e.maxDate,n=e.maxDetail,r=e.minDate,a=e.minDetail,i=e.value;return Aa(qi(e.view,a,n),Zi({value:i,minDate:r,maxDate:t,maxDetail:n})||new Date)}function ns(e){return e&&(!Array.isArray(e)||1===e.length)}function rs(e,t){return e instanceof Date&&t instanceof Date&&e.getTime()===t.getTime()}var as=N.forwardRef(function(t,n){var r,a=t.activeStartDate,i=t.allowPartialRange,s=t.calendarType,o=t.className,l=t.defaultActiveStartDate,d=t.defaultValue,c=t.defaultView,u=t.formatDay,m=t.formatLongDate,f=t.formatMonth,p=t.formatMonthYear,h=t.formatShortWeekday,g=t.formatWeekday,x=t.formatYear,v=t.goToRangeStartOnSelect,b=void 0===v||v,y=t.inputRef,j=t.locale,w=t.maxDate,D=void 0===w?Bi:w,k=t.maxDetail,S=void 0===k?"month":k,T=t.minDate,C=void 0===T?Ki:T,_=t.minDetail,I=void 0===_?"century":_,M=t.navigationAriaLabel,O=t.navigationAriaLive,$=t.navigationLabel,P=t.next2AriaLabel,R=t.next2Label,A=t.nextAriaLabel,E=t.nextLabel,L=t.onActiveStartDateChange,F=t.onChange,V=t.onClickDay,H=t.onClickDecade,U=t.onClickMonth,W=t.onClickWeekNumber,z=t.onClickYear,K=t.onDrillDown,B=t.onDrillUp,G=t.onViewChange,Y=t.prev2AriaLabel,q=t.prev2Label,J=t.prevAriaLabel,X=t.prevLabel,Z=t.returnValue,Q=void 0===Z?"start":Z,ee=t.selectRange,te=t.showDoubleView,ne=t.showFixedNumberOfWeeks,re=t.showNavigation,ae=void 0===re||re,ie=t.showNeighboringCentury,se=t.showNeighboringDecade,oe=t.showNeighboringMonth,le=void 0===oe||oe,de=t.showWeekNumbers,ce=t.tileClassName,ue=t.tileContent,me=t.tileDisabled,fe=t.value,pe=t.view,he=N.useState(l),ge=he[0],xe=he[1],ve=N.useState(null),be=ve[0],ye=ve[1],je=N.useState(Array.isArray(d)?d.map(function(e){return null!==e?Gi(e):null}):null!=d?Gi(d):null),Ne=je[0],De=je[1],ke=N.useState(c),Se=ke[0],Te=ke[1],Ce=a||ge||function(e){var t=e.activeStartDate,n=e.defaultActiveStartDate,r=e.defaultValue,a=e.defaultView,i=e.maxDate,s=e.maxDetail,o=e.minDate,l=e.minDetail,d=e.value,c=e.view,u=qi(c,l,s),m=t||n;return m?Aa(u,m):ts({maxDate:i,maxDetail:s,minDate:o,minDetail:l,value:d||r,view:c||a})}({activeStartDate:a,defaultActiveStartDate:l,defaultValue:d,defaultView:c,maxDate:D,maxDetail:S,minDate:C,minDetail:I,value:fe,view:pe}),_e=(r=ee&&ns(Ne)?Ne:void 0!==fe?fe:Ne)?Array.isArray(r)?r.map(function(e){return null!==e?Gi(e):null}):null!==r?Gi(r):null:null,Ie=Ji(S),Me=qi(pe||Se,I,S),Oe=Yi(I,S),$e=ee?be:null,Pe=Oe.indexOf(Me)<Oe.length-1,Re=Oe.indexOf(Me)>0,Ae=N.useCallback(function(e){return function(){switch(Q){case"start":return Zi;case"end":return Qi;case"range":return es;default:throw new Error("Invalid returnValue.")}}()({maxDate:D,maxDetail:S,minDate:C,value:e})},[D,S,C,Q]),Ee=N.useCallback(function(e,t){xe(e);var n={action:t,activeStartDate:e,value:_e,view:Me};L&&!rs(Ce,e)&&L(n)},[Ce,L,_e,Me]),Le=N.useCallback(function(e,t){var n=function(){switch(Me){case"century":return H;case"decade":return z;case"year":return U;case"month":return V;default:throw new Error("Invalid view: ".concat(Me,"."))}}();n&&n(e,t)},[V,H,U,z,Me]),Fe=N.useCallback(function(e,t){if(Pe){Le(e,t);var n=Oe[Oe.indexOf(Me)+1];if(!n)throw new Error("Attempted to drill down from the lowest view.");xe(e),Te(n);var r={action:"drillDown",activeStartDate:e,value:_e,view:n};L&&!rs(Ce,e)&&L(r),G&&Me!==n&&G(r),K&&K(r)}},[Ce,Pe,L,Le,K,G,_e,Me,Oe]),Ve=N.useCallback(function(){if(Re){var e=Oe[Oe.indexOf(Me)-1];if(!e)throw new Error("Attempted to drill up from the highest view.");var t=Aa(e,Ce);xe(t),Te(e);var n={action:"drillUp",activeStartDate:t,value:_e,view:e};L&&!rs(Ce,t)&&L(n),G&&Me!==e&&G(n),B&&B(n)}},[Ce,Re,L,B,G,_e,Me,Oe]),He=N.useCallback(function(e,t){var n=_e;Le(e,t);var r,a=ee&&!ns(n);if(ee)if(a)r=Aa(Ie,e);else{if(!n)throw new Error("previousValue is required");if(Array.isArray(n))throw new Error("previousValue must not be an array");r=function(e,t,n){var r=[t,n].sort(function(e,t){return e.getTime()-t.getTime()});return[Aa(e,r[0]),La(e,r[1])]}(Ie,n,e)}else r=Ae(e);var s=!ee||a||b?ts({maxDate:D,maxDetail:S,minDate:C,minDetail:I,value:r,view:Me}):null;t.persist(),xe(s),De(r);var o={action:"onChange",activeStartDate:s,value:r,view:Me};if(L&&!rs(Ce,s)&&L(o),F)if(ee)if(ns(r)){if(i){if(Array.isArray(r))throw new Error("value must not be an array");F([r||null,null],t)}}else F(r||null,t);else F(r||null,t)},[Ce,i,Ae,b,D,S,C,I,L,F,Le,ee,_e,Ie,Me]);function Ue(e){ye(e)}function We(){ye(null)}function ze(t){var n={activeStartDate:t?Ea(Me,Ce):Aa(Me,Ce),hover:$e,locale:j,maxDate:D,minDate:C,onClick:Pe?Fe:He,onMouseOver:ee?Ue:void 0,tileClassName:ce,tileContent:ue,tileDisabled:me,value:_e,valueType:Ie};switch(Me){case"century":return e.jsx(li,Hi({formatYear:x,showNeighboringCentury:ie},n));case"decade":return e.jsx(gi,Hi({formatYear:x,showNeighboringDecade:se},n));case"year":return e.jsx(Di,Hi({formatMonth:f,formatMonthYear:p},n));case"month":return e.jsx(Vi,Hi({calendarType:s,formatDay:u,formatLongDate:m,formatShortWeekday:h,formatWeekday:g,onClickWeekNumber:W,onMouseLeave:ee?We:void 0,showFixedNumberOfWeeks:void 0!==ne?ne:te,showNeighboringMonth:le,showWeekNumbers:de},n));default:throw new Error("Invalid view: ".concat(Me,"."))}}N.useImperativeHandle(n,function(){return{activeStartDate:Ce,drillDown:Fe,drillUp:Ve,onChange:He,setActiveStartDate:Ee,value:_e,view:Me}},[Ce,Fe,Ve,He,Ee,_e,Me]);var Ke=Array.isArray(_e)?_e:[_e];return e.jsxs("div",{className:we(Ui,ee&&1===Ke.length&&"".concat(Ui,"--selectRange"),te&&"".concat(Ui,"--doubleView"),o),ref:y,children:[ae?e.jsx(Ka,{activeStartDate:Ce,drillUp:Ve,formatMonthYear:p,formatYear:x,locale:j,maxDate:D,minDate:C,navigationAriaLabel:M,navigationAriaLive:O,navigationLabel:$,next2AriaLabel:P,next2Label:R,nextAriaLabel:A,nextLabel:E,prev2AriaLabel:Y,prev2Label:q,prevAriaLabel:J,prevLabel:X,setActiveStartDate:Ee,showDoubleView:te,view:Me,views:Oe}):null,e.jsxs("div",{className:"".concat(Ui,"__viewContainer"),onBlur:ee?We:void 0,onMouseLeave:ee?We:void 0,children:[ze(),te?ze(!0):null]})]})});function is(t){var n=t.angle,r=void 0===n?0:n,a=t.name,i=t.length,s=void 0===i?100:i,o=t.oppositeLength,l=void 0===o?10:o,d=t.width,c=void 0===d?1:d;return e.jsx("div",{className:"react-clock__hand react-clock__".concat(a,"-hand"),style:{transform:"rotate(".concat(r,"deg)")},children:e.jsx("div",{className:"react-clock__hand__body react-clock__".concat(a,"-hand__body"),style:{width:"".concat(c,"px"),top:"".concat(50-s/2,"%"),bottom:"".concat(50-l/2,"%")}})})}var ss=N.memo(function(t){var n=t.angle,r=void 0===n?0:n,a=t.length,i=void 0===a?10:a,s=t.name,o=t.width,l=void 0===o?1:o;return e.jsx("div",{className:"react-clock__mark react-clock__".concat(s,"-mark"),style:{transform:"rotate(".concat(r,"deg)")},children:e.jsx("div",{className:"react-clock__mark__body react-clock__".concat(s,"-mark__body"),style:{width:"".concat(l,"px"),top:0,bottom:"".concat(100-i/2,"%")}})})}),os=N.memo(function(t){var n=t.angle,r=void 0===n?0:n,a=t.length,i=void 0===a?10:a,s=t.name,o=t.number;return e.jsx("div",{className:"react-clock__mark react-clock__".concat(s,"-mark"),style:{transform:"rotate(".concat(r,"deg)")},children:e.jsx("div",{className:"react-clock__mark__number",style:{transform:"rotate(-".concat(r,"deg)"),top:"".concat(i/2,"%")},children:o})})});function ls(e,t){return t.toLocaleString(e||Nr()||void 0)}function ds(e){return null!==e&&!1!==e&&!Number.isNaN(Number(e))}function cs(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Math.max.apply(Math,e.filter(ds))}function us(t){var n,r=t.className,a=t.formatHour,i=void 0===a?ls:a,s=t.hourHandLength,o=void 0===s?50:s,l=t.hourHandOppositeLength,d=t.hourHandWidth,c=void 0===d?4:d,u=t.hourMarksLength,m=void 0===u?10:u,f=t.hourMarksWidth,p=void 0===f?3:f,h=t.locale,g=t.minuteHandLength,x=void 0===g?70:g,v=t.minuteHandOppositeLength,b=t.minuteHandWidth,y=void 0===b?2:b,j=t.minuteMarksLength,w=void 0===j?6:j,N=t.minuteMarksWidth,D=void 0===N?1:N,k=t.renderHourMarks,S=void 0===k||k,T=t.renderMinuteHand,C=void 0===T||T,_=t.renderMinuteMarks,I=void 0===_||_,M=t.renderNumbers,O=t.renderSecondHand,$=void 0===O||O,P=t.secondHandLength,R=void 0===P?90:P,A=t.secondHandOppositeLength,E=t.secondHandWidth,L=void 0===E?1:E,F=t.size,V=void 0===F?150:F,H=t.useMillisecondPrecision,U=t.value;function W(){if(!I)return null;for(var t=[],n=1;n<=60;n+=1){S&&!(n%5)||t.push(e.jsx(ss,{angle:6*n,length:w,name:"minute",width:D},"minute_".concat(n)))}return t}function z(){if(!S)return null;for(var t=[],n=1;n<=12;n+=1)t.push(e.jsx(ss,{angle:30*n,length:m,name:"hour",width:p},"hour_".concat(n)));return t}function K(){if(!M)return null;for(var t=[],n=1;n<=12;n+=1)t.push(e.jsx(os,{angle:30*n,length:cs(S&&m,I&&w,0),name:"number",number:i(h,n)},"number_".concat(n)));return t}return e.jsxs("time",{className:we("react-clock",r),dateTime:U instanceof Date?U.toLocaleTimeString("en",{hourCycle:"h23",hour:"2-digit",minute:C?"2-digit":void 0,second:$?"2-digit":void 0}):U||void 0,style:{width:V,height:V},children:[e.jsxs("div",{className:"react-clock__face",children:[W(),z(),K()]}),(n=U?30*Mr(U)+Or(U)/2+$r(U)/120+(H?Pr(U)/12e4:0):0,e.jsx(is,{angle:n,length:o,name:"hour",oppositeLength:l,width:c})),function(){if(!C)return null;var t=U?360*Mr(U)+6*Or(U)+$r(U)/10+(H?Pr(U)/1e4:0):0;return e.jsx(is,{angle:t,length:x,name:"minute",oppositeLength:v,width:y})}(),function(){if(!$)return null;var t=U?360*Or(U)+6*$r(U)+(H?.006*Pr(U):0):0;return e.jsx(is,{angle:t,length:R,name:"second",oppositeLength:A,width:L})}()]})}function ms(e){return e.getBoundingClientRect()}function fs(e,t){return{get collidedTop(){return ms(e).top<ms(t).top},get collidedBottom(){return ms(e).bottom>ms(t).bottom},get collidedLeft(){return ms(e).left<ms(t).left},get collidedRight(){return ms(e).right>ms(t).right},get overflowTop(){return ms(t).top-ms(e).top},get overflowBottom(){return ms(e).bottom-ms(t).bottom},get overflowLeft(){return ms(t).left-ms(e).left},get overflowRight(){return ms(e).right-ms(t).right}}}const ps=k(function(){});const hs="undefined"!=typeof window&&"MutationObserver"in window;function gs(e){return e.charAt(0).toUpperCase()+e.slice(1)}function xs({axis:e,container:t,element:n,invertAxis:r,scrollContainer:a,secondary:i,spacing:s}){const o=window.getComputedStyle(n),l=t.parentElement;if(!l)return;const d=fs(l,a),c=fs(l,document.documentElement),u="x"===e,m=u?"left":"top",f=u?"right":"bottom",p=u?"width":"height",h=`overflow${gs(m)}`,g=`overflow${gs(f)}`,x=`scroll${gs(m)}`,v=gs(p),b=`offset${v}`,y=`client${v}`,j=`min-${p}`,w=a[b]-a[y],N="object"==typeof s?s[m]:s;let D=-Math.max(d[h],c[h]+document.documentElement[x])-N;const k="object"==typeof s?s[f]:s;let S=-Math.max(d[g],c[g]-document.documentElement[x])-k-w;i&&(D+=l[y],S+=l[y]);const T=n[b];function C(){n.style[m]="auto",n.style[f]=i?"0":"100%"}function _(){n.style[m]=i?"0":"100%",n.style[f]="auto"}function I(e,t){const n=T<=e;return n&&t(),n}function M(){return I(D,C)}function O(){return I(S,_)}let $;$=r?M()||O():O()||M(),$||function(){const e=D>S,t=o.getPropertyValue(j),r=t?Number.parseInt(t,10):null;function a(e){ps(!r||e>=r,`<Fit />'s child will not fit anywhere with its current ${j} of ${r}px.`);const t=Math.max(e,r||0);ps(!1,`<Fit />'s child needed to have its ${p} decreased to ${t}px.`),n.style[p]=`${t}px`}e?(a(D),C()):(a(S),_())}()}function vs(e){const{invertAxis:t,invertSecondaryAxis:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(e,["invertAxis","invertSecondaryAxis"]);!function(e){xs(e)}(Object.assign(Object.assign({},r),{invertAxis:t})),function(e){xs(Object.assign(Object.assign({},e),{axis:"x"===e.axis?"y":"x",secondary:!0}))}(Object.assign(Object.assign({},r),{invertAxis:n}))}function bs({children:t,invertAxis:n,invertSecondaryAxis:r,mainAxis:a="y",spacing:i=8}){const s=N.useRef(void 0),o=N.useRef(void 0),l=N.useRef(void 0),d=N.useRef(void 0),c=N.useRef(void 0),u=N.useCallback(()=>{if(!c.current||!s.current||!o.current)return;const e=o.current.clientWidth,t=o.current.clientHeight;if(l.current===e&&d.current===t)return;l.current=e,d.current=t;const u=s.current.parentElement;if(!u)return;const m=window.getComputedStyle(o.current),{position:f}=m;"absolute"!==f&&(o.current.style.position="absolute");const p=window.getComputedStyle(u),{position:h}=p;"relative"!==h&&"absolute"!==h&&(u.style.position="relative"),vs({axis:a,container:s.current,element:o.current,invertAxis:n,invertSecondaryAxis:r,scrollContainer:c.current,spacing:i})},[n,r,a,i]),m=N.Children.only(t);function f(e){e&&e instanceof HTMLElement&&(o.current=e,c.current=function(e){let t=e.parentElement;for(;t;){const{overflow:e}=window.getComputedStyle(t);if(e.split(" ").every(e=>"auto"===e||"scroll"===e))return t;t=t.parentElement}return document.documentElement}(e))}return N.useEffect(()=>{if(u(),hs&&o.current){new MutationObserver(function(){u()}).observe(o.current,{attributes:!0,attributeFilter:["class","style"]})}},[u]),e.jsx("span",{ref:e=>{if(!e)return;s.current=e;f(null==e?void 0:e.firstElementChild)},style:{display:"contents"},children:m})}var ys,js=["normal","small-caps"];function ws(e){if(!e)return"";var t=window.getComputedStyle(e);if(t.font)return t.font;if(!(""!==t.fontFamily))return"";var n=js.includes(t.fontVariant)?t.fontVariant:"normal";return"".concat(t.fontStyle," ").concat(n," ").concat(t.fontWeight," ").concat(t.fontSize," / ").concat(t.lineHeight," ").concat(t.fontFamily)}function Ns(e){if("undefined"==typeof document||!e)return null;var t=ws(e),n=function(e,t){var n=(ys||(ys=document.createElement("canvas"))).getContext("2d");if(!n)return null;n.font=t;var r=n.measureText(e).width;return Math.ceil(r)}(e.value||e.placeholder,t);return null===n?null:(e.style.width="".concat(n,"px"),n)}const Ds="undefined"!=typeof window,ks=Ds?N.useLayoutEffect:N.useEffect,Ss=Ds&&/(MSIE|Trident\/|Edge\/)/.test(navigator.userAgent),Ts=Ds&&/Firefox/.test(navigator.userAgent);function Cs(e){const{target:t}=e;Ss?requestAnimationFrame(()=>t.select()):t.select()}function _s(e){if(null!==e)return function(t){if(Ts)return;const{key:n,target:r}=t,{value:a}=r,i=1===n.length&&/\d/.test(n),s=function(e){if(e&&"selectionStart"in e&&null!==e.selectionStart&&"selectionEnd"in e&&null!==e.selectionEnd)return e.value.slice(e.selectionStart,e.selectionEnd);if("getSelection"in window){const e=window.getSelection();return null==e?void 0:e.toString()}return null}(r);i&&(s||a.length<e)||t.preventDefault()}}function Is({ariaLabel:t,autoFocus:n,className:r,disabled:a,inputRef:i,max:s,min:o,name:l,nameForClass:d,onChange:c,onKeyDown:u,onKeyUp:m,placeholder:f="--",required:p,showLeadingZeros:h,step:g,value:x}){ks(()=>{var e;i&&i.current&&(Ns(i.current),e=i.current,"complete"!==document.readyState&&window.addEventListener("load",function(){Ns(e)}),function(e){if(!document.fonts)return;const t=ws(e);if(!t)return;document.fonts.check(t)||document.fonts.addEventListener("loadingdone",function(){Ns(e)})}(i.current))},[i,x]);const v=h&&x&&Number(x)<10&&("0"===x||!x.toString().startsWith("0")),b=s?s.toString().length:null;return e.jsxs(e.Fragment,{children:[v?e.jsx("span",{className:`${r}__leadingZero`,children:"0"}):null,e.jsx("input",{"aria-label":t,autoComplete:"off",autoFocus:n,className:we(`${r}__input`,`${r}__${d||l}`,v&&`${r}__input--hasLeadingZero`),"data-input":"true",disabled:a,inputMode:"numeric",max:s,min:o,name:l,onChange:c,onFocus:Cs,onKeyDown:u,onKeyPress:_s(b),onKeyUp:e=>{Ns(e.target),m&&m(e)},placeholder:f,ref:i,required:p,step:g,type:"number",value:null!==x?x:""})]})}function Ms(e){return null!==e&&!1!==e&&!Number.isNaN(Number(e))}function Os(...e){return Math.min(...e.filter(Ms))}function $s(...e){return Math.max(...e.filter(Ms))}function Ps({maxDate:t,minDate:n,month:r,year:a,...i}){function s(e){return a===Tr(e).toString()&&r===_r(e).toString()}const o=Os(r?ua(new Date(Number(a),Number(r)-1,1)):31,t&&s(t)&&Ir(t)),l=$s(1,n&&s(n)&&Ir(n));return e.jsx(Is,{max:o,min:l,name:"day",...i})}function Rs({maxDate:t,minDate:n,year:r,...a}){function i(e){return e&&r===Tr(e).toString()}const s=Os(12,t&&i(t)&&_r(t)),o=$s(1,n&&i(n)&&_r(n));return e.jsx(Is,{max:s,min:o,name:"month",...a})}const As=new Map;function Es(e){return(t,n)=>function(e){return function(t,n){const r=t||Nr();As.has(r)||As.set(r,new Map);const a=As.get(r);return a.has(e)||a.set(e,new Intl.DateTimeFormat(r||void 0,e).format),a.get(e)(n)}}(e)(t,function(e){const t=new Date(e);return new Date(t.setHours(12))}(n))}const Ls=Es({month:"long"}),Fs=Es({month:"short"});function Vs({ariaLabel:t,autoFocus:n,className:r,disabled:a,inputRef:i,locale:s,maxDate:o,minDate:l,onChange:d,onKeyDown:c,placeholder:u="--",required:m,short:f,value:p,year:h}){function g(e){return e&&h===Tr(e).toString()}const x=Os(12,o&&g(o)&&_r(o)),v=$s(1,l&&g(l)&&_r(l)),b=[...Array(12)].map((e,t)=>new Date(2019,t,1)),y="month",j=f?Fs:Ls;return e.jsxs("select",{"aria-label":t,autoFocus:n,className:we(`${r}__input`,`${r}__${y}`),"data-input":"true","data-select":"true",disabled:a,name:y,onChange:d,onKeyDown:c,ref:i,required:m,value:null!==p?p:"",children:[!p&&e.jsx("option",{value:"",children:u}),b.map(t=>{const n=_r(t),r=n<v||n>x;return e.jsx("option",{disabled:r,value:n,children:j(s,t)},n)})]})}function Hs({maxDate:t,minDate:n,placeholder:r="----",valueType:a,...i}){const s=Os(275760,t&&Tr(t)),o=$s(1,n&&Tr(n)),l="century"===a?10:1;return e.jsx(Is,{max:s,min:o,name:"year",placeholder:r,step:l,...i})}function Us(e){return[Number(e)%12||12,Number(e)<12?"am":"pm"]}const Ws=new Map;const zs=new RegExp(`[${["9","٩"].join("")}]`),Ks=(Bs={hour:"numeric"},function(e,t){const n=e||Nr();Ws.has(n)||Ws.set(n,new Map);const r=Ws.get(n);return r.has(Bs)||r.set(Bs,new Intl.DateTimeFormat(n||void 0,Bs).format),r.get(Bs)(t)});var Bs;function Gs(e){return null!==e&&!1!==e&&!Number.isNaN(Number(e))}function Ys(...e){return Math.min(...e.filter(Gs))}function qs(...e){return Math.max(...e.filter(Gs))}function Js({ariaLabel:t,autoFocus:n,className:r,disabled:a,inputRef:i,locale:s,maxTime:o,minTime:l,onChange:d,onKeyDown:c,required:u,value:m}){const f=!!l&&"pm"===Us(Mr(l))[1],p=!!o&&"am"===Us(Mr(o))[1],h="amPm",[g,x]=function(e){const t=Ks(e,new Date(2017,0,1,9)),n=Ks(e,new Date(2017,0,1,21)),[r,a]=t.split(zs),[i,s]=n.split(zs);if(void 0!==s){if(r!==i)return[r,i].map(e=>e.trim());if(a!==s)return[a,s].map(e=>e.trim())}return["AM","PM"]}(s);return e.jsxs("select",{"aria-label":t,autoFocus:n,className:we(`${r}__input`,`${r}__${h}`),"data-input":"true","data-select":"true",disabled:a,name:h,onChange:d,onKeyDown:c,ref:i,required:u,value:null!==m?m:"",children:[!m&&e.jsx("option",{value:"",children:"--"}),e.jsx("option",{disabled:f,value:"am",children:g}),e.jsx("option",{disabled:p,value:"pm",children:x})]})}const Xs="undefined"!=typeof window,Zs=Xs?N.useLayoutEffect:N.useEffect,Qs=Xs&&/(MSIE|Trident\/|Edge\/)/.test(navigator.userAgent),eo=Xs&&/Firefox/.test(navigator.userAgent);function to(e){const{target:t}=e;Qs?requestAnimationFrame(()=>t.select()):t.select()}function no(e){if(null!==e)return function(t){if(eo)return;const{key:n,target:r}=t,{value:a}=r,i=1===n.length&&/\d/.test(n),s=function(e){if(e&&"selectionStart"in e&&null!==e.selectionStart&&"selectionEnd"in e&&null!==e.selectionEnd)return e.value.slice(e.selectionStart,e.selectionEnd);if("getSelection"in window){const e=window.getSelection();return null==e?void 0:e.toString()}return null}(r);i&&(s||a.length<e)||t.preventDefault()}}function ro({ariaLabel:t,autoFocus:n,className:r,disabled:a,inputRef:i,max:s,min:o,name:l,nameForClass:d,onChange:c,onKeyDown:u,onKeyUp:m,placeholder:f="--",required:p,showLeadingZeros:h,step:g,value:x}){Zs(()=>{var e;i&&i.current&&(Ns(i.current),e=i.current,"complete"!==document.readyState&&window.addEventListener("load",function(){Ns(e)}),function(e){if(!document.fonts)return;const t=ws(e);if(!t)return;document.fonts.check(t)||document.fonts.addEventListener("loadingdone",function(){Ns(e)})}(i.current))},[i,x]);const v=h&&x&&Number(x)<10&&("0"===x||!x.toString().startsWith("0")),b=s?s.toString().length:null;return e.jsxs(e.Fragment,{children:[v?e.jsx("span",{className:`${r}__leadingZero`,children:"0"}):null,e.jsx("input",{"aria-label":t,autoComplete:"off",autoFocus:n,className:we(`${r}__input`,`${r}__${d||l}`,v&&`${r}__input--hasLeadingZero`),"data-input":"true",disabled:a,inputMode:"numeric",max:s,min:o,name:l,onChange:c,onFocus:to,onKeyDown:u,onKeyPress:no(b),onKeyUp:e=>{Ns(e.target),m&&m(e)},placeholder:f,ref:i,required:p,step:g,type:"number",value:null!==x?x:""})]})}function ao({amPm:t,maxTime:n,minTime:r,value:a,...i}){const s=Ys(12,n&&(()=>{const[e,r]=Us(Mr(n));return r!==t?null:e})()),o=qs(1,r&&(()=>{const[e,n]=Us(Mr(r));return n!==t||12===e?null:e})()),l=a?Us(a)[0].toString():"";return e.jsx(ro,{max:s,min:o,name:"hour12",nameForClass:"hour",value:l,...i})}function io({maxTime:t,minTime:n,...r}){const a=Ys(23,t&&Mr(t)),i=qs(0,n&&Mr(n));return e.jsx(ro,{max:a,min:i,name:"hour24",nameForClass:"hour",...r})}function so({hour:t,maxTime:n,minTime:r,showLeadingZeros:a=!0,...i}){function s(e){return t===Mr(e).toString()}const o=Ys(59,n&&s(n)&&Or(n)),l=qs(0,r&&s(r)&&Or(r));return e.jsx(ro,{max:o,min:l,name:"minute",showLeadingZeros:a,...i})}function oo({hour:t,maxTime:n,minTime:r,minute:a,showLeadingZeros:i=!0,...s}){function o(e){return t===Mr(e).toString()&&a===Or(e).toString()}const l=Ys(59,n&&o(n)&&$r(n)),d=qs(0,r&&o(r)&&$r(r));return e.jsx(ro,{max:l,min:d,name:"second",showLeadingZeros:i,...s})}function lo({ariaLabel:t,disabled:n,maxDate:r,minDate:a,name:i,onChange:s,required:o,value:l,valueType:d}){const c=(()=>{switch(d){case"hour":return e=>`${pa(e)}T${Mr(e)}:00`;case"minute":return e=>{return`${pa(e)}T${t=e,`${ma(Mr(t))}:${ma(Or(t))}`}`;var t};case"second":return ha;default:throw new Error("Invalid valueType")}})(),u=(()=>{switch(d){case"hour":return 3600;case"minute":return 60;case"second":return 1;default:throw new Error("Invalid valueType")}})();return e.jsx("input",{"aria-label":t,disabled:n,hidden:!0,max:r?c(r):void 0,min:a?c(a):void 0,name:i,onChange:s,onFocus:function(e){e.stopPropagation()},required:o,step:u,style:{visibility:"hidden",position:"absolute",zIndex:"-999"},type:"datetime-local",value:l?c(l):""})}function co({children:t}){return e.jsx("span",{className:"react-datetime-picker__inputGroup__divider",children:t})}const uo=new Map;function mo(e){return function(t,n){const r=t||Nr();uo.has(r)||uo.set(r,new Map);const a=uo.get(r);return a.has(e)||a.set(e,new Intl.DateTimeFormat(r||void 0,e).format),a.get(e)(n)}}const fo=new Map;const po=mo({day:"numeric",month:"numeric",year:"numeric"});function ho(e,t){let n=Number(e);return"am"===t&&12===n?n=0:"pm"===t&&n<12&&(n+=12),n}const go=new RegExp(`[${["9","٩"].join("")}]`),xo=mo({hour:"numeric"});const vo={},bo=new Date;bo.setFullYear(1,0,1),bo.setHours(0,0,0,0);const yo=new Date(864e13),jo=["hour","minute","second"];function wo(e){return e instanceof Date?e:new Date(e)}function No(e,t,n,r){return t===Tr(e).toString()&&n===_r(e).toString()&&r===Ir(e).toString()}function Do({value:e,minDate:t,maxDate:n},r){const a=function(e,t){const n=Array.isArray(e)?e[t]:e;if(!n)return null;const r=wo(n);if(Number.isNaN(r.getTime()))throw new Error(`Invalid date: ${e}`);return r}(e,r);return a?function(e,t,n){return t&&t>e?t:n&&n<e?n:e}(a,t,n):null}function ko(e){return"true"===e.dataset.input}function So(e,t){let n=e;do{n=n[t]}while(n&&!ko(n));return n}function To(e){e&&e.focus()}const Co=function(e){return(t,n)=>{const r=t||Nr();fo.has(r)||fo.set(r,new Map);const a=fo.get(r);return a.has(e)||a.set(e,new Intl.NumberFormat(r||void 0,e).format),a.get(e)(n)}}({useGrouping:!1});function _o({amPmAriaLabel:t,autoFocus:n,className:r,dayAriaLabel:a,dayPlaceholder:i,disabled:s,format:o,hourAriaLabel:l,hourPlaceholder:d,isWidgetOpen:c,locale:u,maxDate:m,maxDetail:f="minute",minDate:p,minuteAriaLabel:h,minutePlaceholder:g,monthAriaLabel:x,monthPlaceholder:v,name:b="datetime",nativeInputAriaLabel:y,onChange:j,onInvalidChange:w,required:D,secondAriaLabel:k,secondPlaceholder:S,showLeadingZeros:T,value:C,yearAriaLabel:_,yearPlaceholder:I}){const[M,O]=N.useState(null),[$,P]=N.useState(null),[R,A]=N.useState(null),[E,L]=N.useState(null),[F,V]=N.useState(null),[H,U]=N.useState(null),[W,z]=N.useState(null),[K,B]=N.useState(null),G=N.useRef(null),Y=N.useRef(null),q=N.useRef(null),J=N.useRef(null),X=N.useRef(null),Z=N.useRef(null),Q=N.useRef(null),ee=N.useRef(null),te=N.useRef(null),[ne,re]=N.useState(c),ae=N.useRef(void 0);N.useEffect(()=>{re(c)},[c]),N.useEffect(()=>{const e=Do({value:C,minDate:p,maxDate:m},0);var t;e?(O((t=Mr(e),[Number(t)%12||12,Number(t)<12?"am":"pm"])[1]),P(Tr(e).toString()),A(_r(e).toString()),L(Ir(e).toString()),V(Mr(e).toString()),U(Or(e).toString()),z($r(e).toString()),B(wo(e))):(O(null),P(null),A(null),L(null),V(null),U(null),z(null),B(null))},[C,p,m,ne]);const ie=f,se=(()=>{const e=jo.indexOf(f),t=vo[e]||(()=>{const t={hour:"numeric"};return e>=1&&(t.minute="numeric"),e>=2&&(t.second="numeric"),vo[e]=t,t})();return mo(t)})(),oe=(()=>{const e=new Date(2017,11,11),t=po(u,e),n=["y","M","d"];let r=t;return["year","month","day"].forEach((t,a)=>{const i=function(e,t){const n=vo[e]||(()=>{const t={[e]:"numeric"};return vo[e]=t,t})();return mo(n)(u,t).match(/\d{1,}/)}(t,e);if(i){const e=i[0],t=n[a];r=r.replace(e,t)}}),r=r.replace("17","y"),r})(),le=(()=>{const e=new Date(2017,0,1,21,13,14);return se(u,e).replace(Co(u,9),"h").replace(Co(u,21),"H").replace(Co(u,13),"mm").replace(Co(u,14),"ss").replace(new RegExp(function(e){const t=xo(e,new Date(2017,0,1,9)),n=xo(e,new Date(2017,0,1,21)),[r,a]=t.split(go),[i,s]=n.split(go);if(void 0!==s){if(r!==i)return[r,i].map(e=>e.trim());if(a!==s)return[a,s].map(e=>e.trim())}return["AM","PM"]}(u).join("|")),"a")})(),de=o||`${oe} ${le}`,ce=(()=>{const e=oe.match(/[^0-9a-z]/i);return e?e[0]:null})(),ue=(()=>{const e=le.match(/[^0-9a-z]/i);return e?e[0]:null})(),me=(()=>{if(m&&No(m,$,R,E))return fa(m||yo)})(),fe=(()=>{if(p&&No(p,$,R,E))return fa(p||bo)})();function pe(e){const{name:t,value:n}=e.target;switch(t){case"amPm":O(n);break;case"year":P(n);break;case"month":A(n);break;case"day":L(n);break;case"hour12":V(n?ho(n,M||"am").toString():"");break;case"hour24":V(n);break;case"minute":U(n);break;case"second":z(n)}!function(){if(!j)return;const e=[G.current,X.current,q.current,J.current,Y.current,Z.current,Q.current,ee.current,te.current].filter(function(e){return Boolean(e)}),t=e.slice(1),n={};for(const i of e)n[i.name]="number"===i.type?i.valueAsNumber:i.value;if(t.every(e=>!e.value))return void j(null,!1);const r=e.every(e=>e.value),a=e.every(e=>e.validity.valid);if(r&&a){const e=Number(n.year||(new Date).getFullYear()),t=Number(n.month||1)-1,r=Number(n.day||1),a=Number(n.hour24||n.hour12&&n.amPm&&ho(n.hour12,n.amPm)||0),i=Number(n.minute||0),s=Number(n.second||0),o=new Date;return o.setFullYear(e,t,r),o.setHours(a,i,s,0),void j(o,!1)}w&&w()}()}function he(e){const{value:t}=e.target;if(!j)return;const n=(()=>{if(!t)return null;const[e,n]=t.split("T"),[r,a,i]=e.split("-"),s=Number(r),o=Number(a)-1||0,l=Number(i)||1,[d,c,u]=n.split(":"),m=Number(d)||0,f=Number(c)||0,p=Number(u)||0,h=new Date;return h.setFullYear(s,o,l),h.setHours(m,f,p,0),h})();j(n,!1)}const ge={className:r,disabled:s,maxDate:m||yo,minDate:p||bo,onChange:pe,onKeyDown:function(e){switch(ae.current=e.key,e.key){case"ArrowLeft":case"ArrowRight":case ce:case ue:{e.preventDefault();const{target:t}=e;To(So(t,"ArrowLeft"===e.key?"previousElementSibling":"nextElementSibling"));break}}},onKeyUp:function(e){const{key:t,target:n}=e;if(!(ae.current===t))return;if(!!Number.isNaN(Number(t)))return;const r=n.getAttribute("max");if(!r)return;const{value:a}=n;if(10*Number(a)>Number(r)||a.length>=r.length){To(So(n,"nextElementSibling"))}},required:Boolean(D||ne)},xe={maxTime:me,minTime:fe};function ve(t,r){if(t&&t.length>2)throw new Error(`Unsupported token: ${t}`);const s=t&&2===t.length;return e.jsx(Ps,{...ge,ariaLabel:a,autoFocus:0===r&&n,inputRef:X,month:R,placeholder:i,showLeadingZeros:s||T,value:E,year:$},"day")}function be(t,r){if(t&&t.length>4)throw new Error(`Unsupported token: ${t}`);if(t.length>2)return e.jsx(Vs,{...ge,ariaLabel:x,autoFocus:0===r&&n,inputRef:J,locale:u,placeholder:v,short:3===t.length,value:R,year:$},"month");const a=t&&2===t.length;return e.jsx(Rs,{...ge,ariaLabel:x,autoFocus:0===r&&n,inputRef:q,placeholder:v,showLeadingZeros:a||T,value:R,year:$},"month")}function ye(t,r){return e.jsx(Hs,{...ge,ariaLabel:_,autoFocus:0===r&&n,inputRef:Y,placeholder:I,value:$,valueType:"day"},"year")}function je(t,r){return/h/.test(t)?function(t,r){if(t&&t.length>2)throw new Error(`Unsupported token: ${t}`);const a=!!t&&2===t.length;return e.jsx(ao,{...ge,...xe,amPm:M,ariaLabel:l,autoFocus:0===r&&n,inputRef:Z,placeholder:d,showLeadingZeros:a,value:F},"hour12")}(t,r):function(t,r){if(t&&t.length>2)throw new Error(`Unsupported token: ${t}`);const a=!!t&&2===t.length;return e.jsx(io,{...ge,...xe,ariaLabel:l,autoFocus:0===r&&n,inputRef:Q,placeholder:d,showLeadingZeros:a,value:F},"hour24")}(t,r)}function we(t,r){if(t&&t.length>2)throw new Error(`Unsupported token: ${t}`);const a=!!t&&2===t.length;return e.jsx(so,{...ge,...xe,ariaLabel:h,autoFocus:0===r&&n,hour:F,inputRef:ee,placeholder:g,showLeadingZeros:a,value:H},"minute")}function Ne(t,r){if(t&&t.length>2)throw new Error(`Unsupported token: ${t}`);const a=!t||2===t.length;return e.jsx(oo,{...ge,...xe,ariaLabel:k,autoFocus:0===r&&n,hour:F,inputRef:te,minute:H,placeholder:S,showLeadingZeros:a,value:W},"second")}function De(r,a){return e.jsx(Js,{...ge,...xe,ariaLabel:t,autoFocus:0===a&&n,inputRef:G,locale:u,onChange:pe,value:M},"ampm")}return e.jsxs("div",{className:r,onClick:function(e){if(e.target===e.currentTarget){To(e.target.children[1])}},children:[e.jsx(lo,{ariaLabel:y,disabled:s,maxDate:m||yo,minDate:p||bo,name:b,onChange:he,required:D,value:K,valueType:ie},"datetime"),function(t,n,r){const a=[],i=new RegExp(Object.keys(n).map(e=>`${e}+`).join("|"),"g"),s=t.match(i);return t.split(i).reduce((t,i,o)=>{const l=i&&e.jsx(co,{children:i},`separator_${o}`);t.push(l);const d=null==s?void 0:s[o];if(d){const e=n[d]||n[Object.keys(n).find(e=>d.match(e))];if(!e)return t;!r&&a.includes(e)?t.push(d):(t.push(e(d,o)),a.push(e))}return t},[])}(de,{d:ve,M:be,y:ye,h:je,H:je,m:we,s:Ne,a:De},void 0!==o)]})}const Io="react-datetime-picker",Mo=["mousedown","focusin","touchstart"],Oo=["hour","minute","second"],$o={xmlns:"http://www.w3.org/2000/svg",width:19,height:19,viewBox:"0 0 19 19",stroke:"black",strokeWidth:2},Po=e.jsxs("svg",{...$o,"aria-hidden":"true",className:`${Io}__calendar-button__icon ${Io}__button__icon`,children:[e.jsx("rect",{fill:"none",height:"15",width:"15",x:"2",y:"2"}),e.jsx("line",{x1:"6",x2:"6",y1:"0",y2:"4"}),e.jsx("line",{x1:"13",x2:"13",y1:"0",y2:"4"})]}),Ro=e.jsxs("svg",{...$o,"aria-hidden":"true",className:`${Io}__clear-button__icon ${Io}__button__icon`,children:[e.jsx("line",{x1:"4",x2:"15",y1:"4",y2:"15"}),e.jsx("line",{x1:"15",x2:"4",y1:"4",y2:"15"})]});function Ao(t){const{amPmAriaLabel:n,autoFocus:r,calendarAriaLabel:a,calendarIcon:i=Po,className:s,clearAriaLabel:o,clearIcon:l=Ro,closeWidgets:d=!0,"data-testid":c,dayAriaLabel:u,dayPlaceholder:m,disableCalendar:f,disableClock:p,disabled:h,format:g,hourAriaLabel:x,hourPlaceholder:v,id:b,isCalendarOpen:y=null,isClockOpen:j=null,locale:w,maxDate:D,maxDetail:k="minute",minDate:T,minuteAriaLabel:C,minutePlaceholder:_,monthAriaLabel:I,monthPlaceholder:M,name:O="datetime",nativeInputAriaLabel:$,onCalendarClose:P,onCalendarOpen:R,onChange:A,onClockClose:E,onClockOpen:L,onFocus:F,onInvalidChange:V,openWidgetsOnFocus:H=!0,required:U,secondAriaLabel:W,secondPlaceholder:z,shouldCloseWidgets:K,shouldOpenWidgets:B,showLeadingZeros:G,value:Y,yearAriaLabel:q,yearPlaceholder:J,...X}=t,[Z,Q]=N.useState(y),[ee,te]=N.useState(j),ne=N.useRef(null),re=N.useRef(null),ae=N.useRef(null);function ie({reason:e}){B&&!B({reason:e,widget:"calendar"})||(te(!ee&&ee),Q(!0),R&&R())}N.useEffect(()=>{Q(y)},[y]),N.useEffect(()=>{te(j)},[j]);const se=N.useCallback(({reason:e})=>{K&&!K({reason:e,widget:"calendar"})||(Q(!1),P&&P())},[P,K]);function oe(){Z?se({reason:"buttonClick"}):ie({reason:"buttonClick"})}const le=N.useCallback(({reason:e})=>{K&&!K({reason:e,widget:"clock"})||(te(!1),E&&E())},[E,K]),de=N.useCallback(({reason:e})=>{se({reason:e}),le({reason:e})},[se,le]);function ce(e,t=d){t&&de({reason:"select"}),A&&A(e)}const ue=N.useCallback(e=>{"Escape"===e.key&&de({reason:"escape"})},[de]);function me(){ce(null)}function fe(e){e.stopPropagation()}const pe=N.useCallback(e=>{const{current:t}=ne,{current:n}=re,{current:r}=ae,a="composedPath"in e?e.composedPath()[0]:e.target;!a||!t||t.contains(a)||n&&n.contains(a)||r&&r.contains(a)||de({reason:"outsideAction"})},[de]),he=N.useCallback((e=Z||ee)=>{for(const t of Mo)e?document.addEventListener(t,pe):document.removeEventListener(t,pe);e?document.addEventListener("keydown",ue):document.removeEventListener("keydown",ue)},[Z,ee,pe,ue]);N.useEffect(()=>(he(),()=>{he(!1)}),[he]);const ge=N.useMemo(()=>function(e){const t={};for(const n of sr){const r=e[n];r&&(t[n]=r)}return t}(X),[X]);return e.jsxs("div",{className:we(Io,`${Io}--${Z||ee?"open":"closed"}`,`${Io}--${h?"disabled":"enabled"}`,s),"data-testid":c,id:b,...ge,onFocus:function(e){if(F&&F(e),!h&&H&&"true"!==e.target.dataset.select)switch(e.target.name){case"day":case"month":case"year":if(Z)return;ie({reason:"focus"});break;case"hour12":case"hour24":case"minute":case"second":if(ee)return;!function({reason:e}){B&&!B({reason:e,widget:"clock"})||(Q(!Z&&Z),te(!0),L&&L())}({reason:"focus"})}},ref:ne,children:[function(){const[t]=Array.isArray(Y)?Y:[Y],s={amPmAriaLabel:n,dayAriaLabel:u,hourAriaLabel:x,minuteAriaLabel:C,monthAriaLabel:I,nativeInputAriaLabel:$,secondAriaLabel:W,yearAriaLabel:q},d={dayPlaceholder:m,hourPlaceholder:v,minutePlaceholder:_,monthPlaceholder:M,secondPlaceholder:z,yearPlaceholder:J};return e.jsxs("div",{className:`${Io}__wrapper`,children:[e.jsx(_o,{...s,...d,autoFocus:r,className:`${Io}__inputGroup`,disabled:h,format:g,isWidgetOpen:Z||ee,locale:w,maxDate:D,maxDetail:k,minDate:T,name:O,onChange:ce,onInvalidChange:V,required:U,showLeadingZeros:G,value:t}),null!==l&&e.jsx("button",{"aria-label":o,className:`${Io}__clear-button ${Io}__button`,disabled:h,onClick:me,onFocus:fe,type:"button",children:"function"==typeof l?N.createElement(l):l}),null!==i&&!f&&e.jsx("button",{"aria-expanded":Z||!1,"aria-label":a,className:`${Io}__calendar-button ${Io}__button`,disabled:h,onClick:oe,onFocus:fe,type:"button",children:"function"==typeof i?N.createElement(i):i})]})}(),function(){if(null===Z||f)return null;const{calendarProps:n,portalContainer:r,value:a}=t,i=`${Io}__calendar`,s=we(i,`${i}--${Z?"open":"closed"}`),o=e.jsx(as,{locale:w,maxDate:D,minDate:T,onChange:e=>function(e,t){const[n]=Array.isArray(e)?e:[e],[r]=Array.isArray(Y)?Y:[Y];if(r&&n){const e=new Date(r),a=new Date(n);a.setHours(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),ce(a,t)}else ce(n,t)}(e),value:a,...n});return r?S.createPortal(e.jsx("div",{ref:re,className:s,children:o}),r):e.jsx(bs,{children:e.jsx("div",{ref:e=>{e&&!Z&&e.removeAttribute("style")},className:s,children:o})})}(),function(){if(null===ee||p)return null;const{clockProps:n,maxDetail:r="minute",portalContainer:a,value:i}=t,s=`${Io}__clock`,o=we(s,`${s}--${ee?"open":"closed"}`),[l]=Array.isArray(i)?i:[i],d=Oo.indexOf(r),c=e.jsx(us,{locale:w,renderMinuteHand:d>0,renderSecondHand:d>1,value:l,...n});return a?S.createPortal(e.jsx("div",{ref:ae,className:o,children:c}),a):e.jsx(bs,{children:e.jsx("div",{ref:e=>{e&&!ee&&e.removeAttribute("style")},className:o,children:c})})}()]})}const Eo=({patients:t,bloodTests:n,selectedPatient:r,selectedPrescription:a,onAddBloodTest:i,onDeleteBloodTest:s,onUpdateBloodTest:o=()=>{},onNext:l,onPrev:d,isCompleted:c,prescriptions:u})=>{const m=N.useRef(null),[f,p]=N.useState({creatinine:"",date:"",formula:"cockcroft-gault",result:"",dialysis:"N",renalReplacement:"",isBlack:!1}),[h,g]=N.useState([]),[x,v]=N.useState(!1),[b,y]=N.useState(!1);N.useEffect(()=>{const e=()=>y(document.documentElement.classList.contains("dark"));e();const t=new MutationObserver(e);return t.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>t.disconnect()},[]);const j=(e,t,n,r=!1)=>{if(!e||e<=0)return"";switch(t){case"cockcroft-gault":return w(e,n.age,n.weight,n.height,n.gender);case"mdrd":return D(e,n.age,n.gender,r);case"ckd-epi":return k(e,n.age,n.gender,r);default:return""}},w=(e,t,n,r,a)=>{const i="여성"===a?.85:1,s=((e,t)=>"여성"===t?45.5+.9*(e-152):50+.9*(e-152))(r,a),o=n/Math.pow(r/100,2)>30||n>1.2*s,l=o?((e,t)=>t+.4*(e-t))(n,s):n,d=(140-t)*l*i/(72*e),c=o?` (조정체중: ${Math.round(10*l)/10}kg)`:"";return`CRCL = ${Math.round(10*d)/10} mL/min${c}`},D=(e,t,n,r)=>{const a="여성"===n?.742:1,i=r?1.212:1,s=175*Math.pow(e,-1.154)*Math.pow(t,-.203)*a*i;return`eGFR = ${Math.round(10*s)/10} mL/min/1.73m²`},k=(e,t,n,r)=>{const a=r?1.212:1;let i,s;"여성"===n?(i=-.329,s=.7):(i=-.411,s=.9);const o=Math.min(Math.max(e/s,1),999),l=141*Math.pow(o,i)*Math.pow(.993,t)*a;return`eGFR = ${Math.round(10*l)/10} mL/min/1.73m²`},S=a,T=!a||"Cyclosporin"!==a.drugName&&("Vancomycin"!==a.drugName||"Not specified/Korean"!==a.indication||"CRRT"!==a.additionalInfo);N.useEffect(()=>{if(r&&S){v(!1);try{const e=window.localStorage.getItem(`tdmfriends:renal:${r.id}:${S.drugName}`);if(e){const t=JSON.parse(e);g(t)}else g([])}catch(e){}finally{v(!0)}}},[null==r?void 0:r.id,null==S?void 0:S.drugName]),N.useEffect(()=>{if(r&&S&&x)try{window.localStorage.setItem(`tdmfriends:renal:${r.id}:${S.drugName}`,JSON.stringify(h))}catch(e){}},[null==r?void 0:r.id,null==S?void 0:S.drugName,h,x]);const[C,_]=N.useState({testDate:"",testTime:"",concentration:"",unit:"ng/mL",measurementType:"Trough"}),[I,M]=N.useState(!1),[O,$]=N.useState(!1),[P,R]=N.useState(!1),[A,q]=N.useState(null),X=r&&S?n.filter(e=>e.patientId===r.id&&e.drugName===S.drugName):[],Z=dn().format("YYYY-MM-DD"),Q=()=>{var e,t;return!(!r||!a)&&("CRRT"===(null==(e=a.additionalInfo)?void 0:e.toUpperCase())||(null==(t=a.additionalInfo)?void 0:t.toUpperCase().includes("CRRT")))};N.useEffect(()=>{const e="Vancomycin"===(null==S?void 0:S.drugName)?"mg/L":"ng/mL";_(t=>({...t,unit:e}))},[null==S?void 0:S.drugName]),N.useEffect(()=>{R(!1)},[null==a?void 0:a.id]);const ee=e=>{q(e.id),p({creatinine:e.creatinine,date:e.date,formula:e.formula,result:e.result,dialysis:e.dialysis,renalReplacement:e.renalReplacement,isBlack:e.isBlack}),$(!0)},de=()=>{if(f.creatinine&&r){const e=parseFloat(f.creatinine);if(!isNaN(e)&&e>0){const t=j(e,f.formula,r,f.isBlack);p(e=>({...e,result:t}))}}};return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5"}),"3단계: Lab",c&&e.jsx(pe,{className:"h-5 w-5 text-green-600"})]}),e.jsx(ae,{children:r?`${r.name} 환자의 신기능(혈청 크레아티닌)과 혈중 약물 농도 정보를 입력하세요.`:"신기능(혈청 크레아티닌)과 혈중 약물 농도 정보를 입력하세요."})]}),e.jsxs(ie,{className:"space-y-6",children:[S&&r&&e.jsxs("div",{className:"py-3 px-4 rounded bg-muted dark:bg-slate-800 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-4 mb-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"나이:"})," ",r.age]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"성별:"})," ","male"===r.gender?"남성":"female"===r.gender?"여성":"-"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"몸무게:"})," ",r.weight,"kg"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"키:"})," ",r.height,"cm"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"BMI:"})," ",(()=>{if(!(null==r?void 0:r.weight)||!(null==r?void 0:r.height))return"N/A";return(r.weight/Math.pow(r.height/100,2)).toFixed(1)})()]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"BSA:"})," ",(()=>{if(!(null==r?void 0:r.weight)||!(null==r?void 0:r.height))return"N/A";return Math.sqrt(r.height*r.weight/3600).toFixed(2)})()]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"약품명:"}),e.jsx("span",{className:"ml-2 font-semibold",children:S.drugName})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"적응증:"}),e.jsx("span",{className:"ml-2",children:S.indication})]})]})]}),e.jsxs(te,{children:[e.jsx(ne,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(re,{children:["신기능 데이터 (",h.length,")"]}),e.jsx(ae,{children:"체크박스를 선택하면 해당 신기능 데이터가 시뮬레이션에 반영됩니다."})]}),e.jsxs(se,{onClick:()=>$(!0),className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"신규 추가"]})]})}),e.jsx(ie,{className:"space-y-6",children:e.jsx("div",{className:"rounded-md border "+(h.some(e=>e.isSelected)?"border-sky-300 dark:border-sky-700":""),children:e.jsxs(Bt,{children:[e.jsx(Gt,{children:e.jsxs(qt,{children:[e.jsx(Jt,{className:"w-12"}),e.jsx(Jt,{className:"text-center",children:"검사일"}),e.jsx(Jt,{className:"text-center",children:"혈청 크레아티닌"}),e.jsx(Jt,{className:"text-center",children:"결과"}),e.jsx(Jt,{className:"w-16",children:"삭제"})]})}),e.jsxs(Yt,{children:[(()=>{const t=!T&&h.every(e=>!e.isSelected);return e.jsxs(qt,{className:t?"bg-sky-50 dark:bg-sky-900 border-l-4 border-l-sky-300 dark:border-l-sky-700":"",children:[e.jsx(Xt,{children:t&&e.jsx(pe,{className:"h-5 w-5 text-sky-500 dark:text-sky-400"})}),e.jsx(Xt,{colSpan:3,className:"text-center "+(t?"font-bold text-[#333333] dark:text-white":"text-muted-foreground"),children:T?"해당 TDM은 신기능 데이터를 필수 입력해야 합니다":"해당 TDM은 신기능 데이터를 사용하지 않습니다"}),e.jsx(Xt,{})]})})(),h.map(t=>{const n=t.isSelected;return e.jsxs(qt,{className:"cursor-pointer hover:bg-muted/50 "+(n?"bg-sky-50 dark:bg-sky-900 border-l-4 border-l-sky-300 dark:border-l-sky-700":""),onClick:e=>{const n=e.target;n.closest("button")||n.closest("svg")||n.closest("circle")||ee(t)},onDoubleClick:e=>{e.target.closest("button")||ee(t)},children:[e.jsx(Xt,{onClick:e=>{var r,a;e.stopPropagation(),r=t.id,a=!n,g(h.map(e=>({...e,isSelected:e.id===r&&a})))},children:n&&e.jsx(pe,{className:"h-5 w-5 text-sky-500 dark:text-sky-400"})}),e.jsx(Xt,{className:"text-center "+(n?"font-bold text-[#333333] dark:text-white":""),children:t.date}),e.jsxs(Xt,{className:"text-center "+(n?"font-bold text-[#333333] dark:text-white":""),children:[t.creatinine," mg/dL"]}),e.jsx(Xt,{className:"text-center "+(n?"font-bold text-[#333333] dark:text-white":""),children:t.result||"-"}),e.jsx(Xt,{children:e.jsx(se,{variant:"ghost",size:"icon",onClick:e=>{var n;e.stopPropagation(),n=t.id,g(h.filter(e=>e.id!==n))},children:e.jsx(le,{className:"h-4 w-4"})})})]},t.id)})]})]})})})]}),e.jsxs(te,{children:[e.jsx(ne,{children:e.jsx(re,{children:"혈중 약물 농도"})}),e.jsxs(ie,{children:[e.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!r)return;if(!C.testDate||!C.testTime||!C.concentration)return;const t=`${C.testDate}T${C.testTime}`,n=dn(t);if(!n.isValid())return void alert("날짜와 시간 형식이 올바르지 않습니다.");if(n.isAfter(dn()))return void alert("날짜는 현재 시각 이후로 입력할 수 없습니다.");if(C.testDate>Z)return void alert("날짜는 오늘 이후로 입력할 수 없습니다.");const a=n.toDate(),s=h.find(e=>e.isSelected),o={id:Date.now().toString(),patientId:r.id,drugName:(null==S?void 0:S.drugName)||"",concentration:parseFloat(C.concentration),unit:C.unit,timeAfterDose:0,testDate:a,measurementType:C.measurementType,creatinine:(null==s?void 0:s.result)||void 0,dialysis:(null==s?void 0:s.dialysis)||void 0,renalReplacement:(null==s?void 0:s.renalReplacement)||void 0};i(o);const l="Vancomycin"===(null==S?void 0:S.drugName)?"mg/L":"ng/mL";_({testDate:"",testTime:"",concentration:"",unit:l,measurementType:"Trough"})},className:"flex flex-col md:flex-row gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"drugDateTime",children:"채혈한 날짜/시간 "}),e.jsxs("div",{style:{width:"100%"},onFocus:()=>{Q()&&!P&&(M(!0),R(!0))},ref:m,onClick:()=>{(e=>{if(!(null==e?void 0:e.current))return;const t=e.current.querySelector("input");t&&t.focus()})(m)},children:[e.jsx(Ao,{onChange:e=>{if(!e)return void _(e=>({...e,testDate:"",testTime:""}));const t=e instanceof Date?e:new Date(e);if(isNaN(t.getTime()))return;const n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0"),o=`${n}-${r}-${a}`,l=`${i}:${s}`;_(e=>({...e,testDate:o,testTime:l}))},value:C.testDate&&C.testTime?new Date(`${C.testDate}T${C.testTime}`):null,format:"y-MM-dd HH:mm",maxDate:new Date,disableClock:!1,clearIcon:null,calendarIcon:null,yearPlaceholder:"연도",monthPlaceholder:"월",dayPlaceholder:"일",hourPlaceholder:"시",minutePlaceholder:"분"}),e.jsx("style",{children:`\n                      .react-datetime-picker {\n                        width: 100%;\n                        height: 40px;\n                      }\n                      .react-datetime-picker__wrapper {\n                        width: 100%;\n                        height: 40px;\n                        padding: 8px 12px;\n                        border: ${b?"1px solid #334155":"1px solid #ced4da"};\n                        border-radius: 6px;\n                        background-color: ${b?"#1e293b":"#fff"};\n                        color: ${b?"#e0e6f0":"#495057"};\n                        font-size: 14px;\n                      }\n                      .react-datetime-picker__inputGroup {\n                        color: ${b?"#e0e6f0":"#495057"};\n                      }\n                      .react-datetime-picker__inputGroup__input {\n                        color: ${b?"#e0e6f0":"#495057"};\n                      }\n                      .react-datetime-picker__inputGroup__input::placeholder {\n                        color: ${b?"#6b7280":"#9ca3af"};\n                        opacity: 0.7;\n                      }\n                      .react-datetime-picker__button {\n                        color: ${b?"#e0e6f0":"#495057"};\n                      }\n                      .react-datetime-picker__button:hover {\n                        background-color: ${b?"#334155":"#f8f9fa"};\n                      }\n                      .react-calendar {\n                        background-color: ${b?"#1e293b":"#fff"};\n                        color: ${b?"#e0e6f0":"#495057"};\n                        border: ${b?"1px solid #334155":"1px solid #ced4da"};\n                      }\n                      .react-calendar__tile {\n                        color: ${b?"#e0e6f0":"#495057"};\n                      }\n                      .react-calendar__tile:enabled:hover {\n                        background-color: ${b?"#334155":"#f0f0f0"};\n                      }\n                      .react-calendar__tile--active {\n                        background-color: ${b?"#0f172a":"#000"};\n                        color: #fff;\n                      }\n                      .react-clock {\n                        background-color: ${b?"#1e293b":"#fff"};\n                        border: ${b?"1px solid #334155":"1px solid #ced4da"};\n                      }\n                      .react-clock__face {\n                        stroke: ${b?"#334155":"#ced4da"};\n                      }\n                      .react-clock__hand {\n                        stroke: ${b?"#e0e6f0":"#495057"};\n                      }\n                      .react-clock__mark {\n                        stroke: ${b?"#e0e6f0":"#495057"};\n                      }\n                    `})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"concentration",children:"농도"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(oe,{id:"concentration",type:"number",step:"0.01",value:C.concentration,onChange:e=>_({...C,concentration:e.target.value}),className:"flex-1"}),e.jsxs(L,{value:C.unit,onValueChange:e=>_({...C,unit:e}),children:[e.jsx(F,{className:"w-24",children:e.jsx(V,{})}),e.jsx(H,{children:"Vancomycin"===(null==S?void 0:S.drugName)?e.jsx(e.Fragment,{children:e.jsx(U,{value:"mg/L",children:"mg/L"})}):"Cyclosporin"===(null==S?void 0:S.drugName)?e.jsx(e.Fragment,{children:e.jsx(U,{value:"ng/mL",children:"ng/mL"})}):e.jsxs(e.Fragment,{children:[e.jsx(U,{value:"mg/L",children:"mg/L"}),e.jsx(U,{value:"ng/mL",children:"ng/mL"}),e.jsx(U,{value:"μg/L",children:"μg/L"})]})})]})]})]}),e.jsx(se,{type:"submit",children:"추가"})]}),X.length>0&&e.jsx("div",{className:"mt-4",children:e.jsxs(Bt,{children:[e.jsx(Gt,{children:e.jsxs(qt,{children:[e.jsx(Jt,{children:"채혈 날짜"}),e.jsx(Jt,{children:"채혈 시간"}),e.jsx(Jt,{children:"농도"}),e.jsx(Jt,{className:"w-16",children:"삭제"})]})}),e.jsx(Yt,{children:X.map(t=>e.jsxs(qt,{children:[e.jsx(Xt,{children:t.testDate.toLocaleDateString()}),e.jsx(Xt,{children:t.testDate.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsxs(Xt,{children:[t.concentration," ",t.unit]}),e.jsx(Xt,{children:e.jsx(se,{variant:"ghost",size:"icon",onClick:()=>s(t.id),children:e.jsx(le,{className:"h-4 w-4"})})})]},t.id))})]})})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(se,{variant:"outline",onClick:d,className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"TDM 선택"]}),c&&e.jsxs(se,{onClick:()=>{if(T){if(!h.some(e=>e.isSelected))return void alert("신기능 데이터를 입력해주세요.")}l()},className:"flex items-center gap-2 w-[300px] bg-black dark:bg-primary text-white dark:text-primary-foreground font-bold text-lg py-3 px-6 justify-center hover:bg-gray-800 dark:hover:bg-primary/90",children:["투약 기록",e.jsx(xe,{className:"h-4 w-4"})]})]})]})]}),e.jsx(Zt,{open:O,onOpenChange:e=>{$(e),e||(q(null),p({creatinine:"",date:"",formula:"cockcroft-gault",result:"",dialysis:"N",renalReplacement:"",isBlack:!1}))},children:e.jsxs(nn,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(rn,{children:[e.jsx(sn,{children:A?"신기능 데이터 수정":"신기능 데이터 추가"}),e.jsx(on,{children:A?"신기능 데이터를 수정하세요.":"신기능 데이터를 입력하세요."})]}),e.jsxs("form",{className:"space-y-4",onSubmit:e=>{e.preventDefault(),(()=>{if(f.creatinine&&f.date&&f.formula){if(A){const e=h.map(e=>e.id===A?{...e,...f}:e);g(e)}else{const e={id:Date.now().toString(),...f,isSelected:!0},t=h.map(e=>({...e,isSelected:!1}));g([...t,e])}p({creatinine:"",date:"",formula:"cockcroft-gault",result:"",dialysis:"N",renalReplacement:"",isBlack:!1}),$(!1),q(null)}else alert("신기능 데이터의 필수 항목을 모두 입력해주세요. (혈청 크레아티닌, 검사일, 계산식)")})()},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"modal-renalDate",children:"검사일 *"}),e.jsx(oe,{id:"modal-renalDate",type:"date",value:f.date,max:Z,onChange:e=>p({...f,date:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"modal-creatinine",className:"whitespace-nowrap",children:"혈청 크레아티닌 (mg/dL) *"}),e.jsx(oe,{id:"modal-creatinine",type:"number",step:"0.01",value:f.creatinine,onChange:e=>p({...f,creatinine:e.target.value}),onBlur:de,onKeyDown:e=>{if("Enter"===e.key){e.preventDefault(),de();const t=document.getElementById("modal-result");t&&setTimeout(()=>{t.focus()},100)}},placeholder:"예: 1.2",required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"modal-renalFormula",children:"계산식 *"}),e.jsxs(L,{value:f.formula,onValueChange:e=>{p(t=>{const n={...t,formula:e};if(t.creatinine&&r){const a=parseFloat(t.creatinine);if(!isNaN(a)){const i=j(a,e,r,t.isBlack);n.result=i}}return n})},required:!0,children:[e.jsx(F,{children:e.jsx(V,{placeholder:"계산식 선택"})}),e.jsxs(H,{children:[e.jsx(U,{value:"cockcroft-gault",children:"Cockcroft-Gault"}),e.jsx(U,{value:"mdrd",children:"MDRD"}),e.jsx(U,{value:"ckd-epi",children:"CKD-EPI"})]})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"modal-result",children:"계산 결과"}),e.jsx(oe,{id:"modal-result",value:f.result,onChange:e=>{if(f.result&&f.result.includes("=")&&e.target.value!==f.result){if(!window.confirm("자동계산된 데이터를 삭제하고 직접 입력하시겠습니까?"))return}p({...f,result:e.target.value})},placeholder:"자동계산"})]})]}),e.jsxs(an,{className:"justify-center sm:justify-center",children:[e.jsx(se,{type:"button",variant:"outline",onClick:()=>{$(!1),q(null),p({creatinine:"",date:"",formula:"cockcroft-gault",result:"",dialysis:"N",renalReplacement:"",isBlack:!1})},children:"취소"}),e.jsx(se,{type:"submit",children:A?"수정":"추가"})]})]})]})}),r&&Q()&&e.jsx(W,{open:I,onOpenChange:M,children:e.jsxs(z,{className:"transform scale-[1.5]",children:[e.jsxs(K,{children:[e.jsx(B,{children:e.jsx("div",{className:"text-center",children:"채혈 가이드"})}),e.jsx(G,{children:e.jsxs("div",{className:"text-center",children:[r.name," 환자는 고위험군 환자입니다.",e.jsx("br",{}),"가이드에 맞게 채혈되었는지 확인 후 입력해 주세요."]})})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-accent w-1/2",children:[e.jsx("h2",{className:"font-semibold text-lg text-center mb-2",children:"Check point"}),e.jsxs("ul",{className:"list-disc list-inside text-sm space-y-1",children:[e.jsx("li",{children:"투석 여부: Y"}),e.jsx("li",{children:"신 대체요법: CRRT"})]})]}),e.jsx(xe,{className:"h-6 w-6 text-gray-500"}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-accent w-1/2",children:[e.jsx("h2",{className:"font-semibold text-lg text-center mb-2",children:"Guide"}),e.jsx("ul",{className:"text-sm space-y-1 text-center",children:e.jsx("li",{children:"투약 2시간 후 최고 흡수 농도 측정 권고(C2)"})})]})]}),e.jsx(Y,{children:e.jsx("div",{className:"flex justify-center w-full",children:e.jsx(J,{onClick:()=>M(!1),className:"w-[calc(100%)]",children:"확인"})})})]})})]}):e.jsx(te,{children:e.jsx(ie,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ne,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"환자를 먼저 선택해 주세요."})]})})})},Lo=({simulationData:t,showSimulation:n,currentPatientName:r,selectedDrug:a,chartTitle:i="용법 조정 시뮬레이션",targetMin:s,targetMax:o,recentAUC:l,recentMax:d,recentTrough:c,predictedAUC:u,predictedMax:m,predictedTrough:f,ipredSeries:p,predSeries:h,observedSeries:g,chartColor:x="pink",tdmIndication:v,tdmTarget:b,tdmTargetValue:y,latestAdministration:j,originalAdministration:w,drugAdministrations:D=[],currentMethodSeries:k=[],isEmptyChart:S=!1,selectedButton:T,isLoading:C=!1,steadyState:_})=>{const[I,M]=N.useState(()=>"undefined"!=typeof window&&document.documentElement.classList.contains("dark"));N.useEffect(()=>{const e=()=>{M(document.documentElement.classList.contains("dark"))};e();const t=new MutationObserver(e);return t.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>t.disconnect()},[]);const O=N.useMemo(()=>S?[]:(null==p?void 0:p.length)||(null==h?void 0:h.length)||(null==g?void 0:g.length)||(null==k?void 0:k.length)?Fe(p,h,g,k):t,[p,h,g,k,t,S]),$=N.useMemo(()=>Ve(p,h,g,k),[p,h,g,k]),P=N.useMemo(()=>He(D,a),[D,a]),R=N.useMemo(()=>Ue(D,a),[D,a]),A=N.useMemo(()=>We(O),[O]),E=u??490,L=m??38,F=f??18,V=(null==j?void 0:j.intervalHours)??null,H=(null==j?void 0:j.dose)??null,U=(null==j?void 0:j.unit)||"mg";null==V||V.toLocaleString(),null==H||Number(H).toLocaleString();const W=N.useMemo(()=>Le(b,E,L,F,a),[b,E,L,F,a]),z=N.useMemo(()=>ze(b,y,E,L,F,a),[b,y,E,L,F,a]),K=N.useMemo(()=>{if(!b)return"";const e=b.toLowerCase();return e.includes("auc")?"AUC":e.includes("max")||e.includes("peak")?"Max":e.includes("trough")?"Trough":""},[b]),B=N.useMemo(()=>{if(!y||!W.numericValue)return null;const e=y.match(/(\d+(?:\.\d+)?)\s*-\s*(\d+(?:\.\d+)?)/);if(!e)return null;const t=parseFloat(e[1]),n=parseFloat(e[2]),r=W.numericValue;if(r>n){return`${((r-n)/n*100).toFixed(0)}% 초과`}if(r<t){return`${((t-r)/t*100).toFixed(0)}% 미달`}return"도달"},[y,W.numericValue]),G={pink:"#ec4899",green:"#22c55e"}[x],Y=N.useMemo(()=>{const e=[];return k&&k.length>0&&e.push({label:"현용법",dataKey:"currentMethod",borderColor:"#3b82f6",borderWidth:2}),e.push({label:"용법 조정 결과",dataKey:"predicted",borderColor:G,borderWidth:2,fill:"Vancomycin"===a&&((null==b?void 0:b.toLowerCase().includes("auc"))||!1)}),g&&g.length>0&&e.push({label:"실제 혈중 농도",dataKey:"observed",borderColor:"#ef4444",backgroundColor:"#ef4444",pointRadius:4,showLine:!1}),"Vancomycin"===a&&(null==b?void 0:b.toLowerCase().includes("auc"))||"number"!=typeof A||e.push({label:"용법조정 평균 농도",dataKey:"averageLine",borderColor:I?"#9ca3af":"#6b7280",borderDash:[5,5],borderWidth:2}),e},[k,G,a,b,g,A,I]);return e.jsxs("div",{className:"w-full",children:[!S&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6 text-gray-800 dark:text-gray-100",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("span",{className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide mb-2",children:"투약 간격"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:null!=V?V.toLocaleString():"-"}),e.jsx("span",{className:"text-base font-semibold text-gray-700 dark:text-gray-300",children:"시간"})]})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("span",{className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide mb-2",children:"1회 투약 용량"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:null!=H?Number(H).toLocaleString():"-"}),e.jsx("span",{className:"text-base font-semibold text-gray-700 dark:text-gray-300",children:U})]})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("span",{className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide mb-2",children:"TDM 목표"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[C||null==W.numericValue&&!B?e.jsx("div",{className:"text-xl font-bold text-gray-600 dark:text-gray-400",children:"결과를 예측 중"}):null!=W.numericValue&&B?e.jsxs("div",{className:"text-xl font-bold",children:[e.jsx("span",{className:""+(z?"text-blue-700 dark:text-blue-200":"text-red-600 dark:text-red-300"),children:W.value}),e.jsxs("span",{className:"text-gray-900 dark:text-white",children:[" ","으로 목표범위 ",B]})]}):null,e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["목표 범위 ",K," ",y||"-"]})]})]})]})}),!S&&e.jsxs("div",{className:"flex justify-center flex-wrap gap-6 mb-4",children:[k&&k.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[r||"환자","의 현용법"]})]}),p&&p.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5",style:{backgroundColor:G}}),e.jsx("span",{className:"text-sm text-gray-600",children:"용법 조정 결과"})]}),g&&g.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"실제 혈중 농도"})]}),!("Vancomycin"===a&&(null==b?void 0:b.toLowerCase().includes("auc")))&&"number"==typeof A&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 border-dashed border-t-2 border-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"용법 조정 평균 농도"})]}),null!==s&&null!==o&&o>s&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 bg-blue-500 bg-opacity-20"}),e.jsx("span",{className:"text-sm text-gray-600",children:"TDM 목표치"})]})]}),e.jsxs("div",{className:"relative",children:[C&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/80 dark:bg-slate-900/80 z-10 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"차트를 그리는 중입니다."}),e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto"})]})}),e.jsx(Ke,{data:O,datasets:Y,selectedDrug:a,targetMin:s,targetMax:o,dataTimeExtents:$,lastActualDoseTime:R,drugAdministrations:D,averageConcentration:A,currentTime:P,lastDoseColor:"#3b82f6"})]}),!S&&e.jsx(Be,{selectedDrug:a,tdmIndication:v,tdmTarget:b,tdmTargetValue:y,latestAdministration:j,originalAdministration:w,recentAUC:l,recentMax:d,recentTrough:c,predictedAUC:E,predictedMax:L,predictedTrough:F,commentTitle:"",currentResultTitle:"현 용법 유지 시",predictedResultTitle:"용법 변경 시",showSteadyStateComment:!1,isLoading:C})]})},Fo=[{name:"Vancomycin",indications:["Not specified/Korean","Neurosurgical patients/Korean"],targets:[{type:"Trough Concentration",value:"10-20 mg/L"},{type:"Peak Concentration",value:"25-40 mg/L"},{type:"AUC",value:"400-600 mg·h/L"}],defaultTargets:{"Not specified/Korean":{type:"AUC",value:"400-600 mg·h/L"},"Neurosurgical patients/Korean":{type:"AUC",value:"400-600 mg·h/L"}}},{name:"Cyclosporin",indications:["Renal transplant recipients/Korean","Allo-HSCT/Korean","Thoracic transplant recipients/European"],targets:[{type:"Trough Concentration",value:"100-400 ng/mL"},{type:"Peak Concentration",value:"800-1200 ng/mL"}],defaultTargets:{"Allo-HSCT/Korean":{type:"Trough Concentration",value:"150-400 ng/mL"},"Thoracic transplant recipients/European":{type:"Trough Concentration",value:"170-230 ng/mL"},"Renal transplant recipients/Korean":{type:"Trough Concentration",value:"100-400 ng/mL"}}}],Vo=({patients:t,prescriptions:n,bloodTests:r,selectedPatient:a,selectedPrescription:i,drugAdministrations:s=[],onDownloadPDF:o,forceExpandPatientDetails:l=!1})=>{const[d,c]=N.useState((null==a?void 0:a.id)||""),[u,m]=N.useState((null==i?void 0:i.drugName)||""),f=a&&i?s.filter(e=>e.patientId===a.id&&e.drugName===i.drugName):[],p=N.useMemo(()=>{if(0===f.length)return null;const e=[...f].sort((e,t)=>new Date(`${e.date}T${e.time}`).getTime()-new Date(`${t.date}T${t.time}`).getTime()),t=e[e.length-1];let n=t.intervalHours;if(!n){if(null==i?void 0:i.frequency){const e=i.frequency.match(/\d+/);e&&(n=parseInt(e[0],10))}!n&&f.length>=2&&(n=Ge(f))}return{dose:t.dose,unit:t.unit,intervalHours:n}},[f,i]),[h,g]=N.useState({dose:"",halfLife:"",clearance:"",volumeDistribution:""}),[x,v]=N.useState(!1);N.useRef(null),N.useState("250"),N.useState(""),N.useState("mg"),N.useState(""),N.useState("6"),N.useState("current");const[b,y]=N.useState(null),[j,w]=N.useState([]),[D,k]=N.useState([]),[S,T]=N.useState([]),[C,_]=N.useState(null);N.useState(null),N.useState(null);const[I,M]=N.useState(null),[O,$]=N.useState(null),[P,R]=N.useState(void 0),[A,E]=N.useState([]),[L,F]=N.useState({}),[V,H]=N.useState({}),[U,X]=N.useState({}),[Z,Q]=N.useState({}),[ee,te]=N.useState(!1),[ne,re]=N.useState(!1),[ae,ie]=N.useState({}),[le,de]=N.useState(null),[ce,ue]=N.useState({}),[me,fe]=N.useState({}),[pe,he]=N.useState({}),[ge,xe]=N.useState({}),[ve,be]=N.useState({}),ye=N.useRef({}),je=N.useRef(null),[we,Ne]=N.useState({}),[De,ke]=N.useState({}),[Se,Te]=N.useState({}),[Ce,_e]=N.useState({}),Ie=t.find(e=>e.id===d),Me=N.useMemo(()=>d?n.filter(e=>e.patientId===d):[],[d,n]),Oe=N.useMemo(()=>d?r.filter(e=>e.patientId===d&&(!i||e.drugName===i.drugName)):[],[d,i,r]),$e=N.useCallback(e=>{var t,n,r,a,i,s,o,l,d;const c=Me.find(t=>t.drugName===e),u=Fo.find(t=>t.name===e);return{indication:(null==c?void 0:c.indication)||(null==(t=null==u?void 0:u.indications)?void 0:t[0])||"적응증",target:(null==c?void 0:c.tdmTarget)||(null==(r=null==(n=null==u?void 0:u.defaultTargets)?void 0:n[(null==c?void 0:c.indication)||""])?void 0:r.type)||(null==(i=null==(a=null==u?void 0:u.targets)?void 0:a[0])?void 0:i.type)||"목표 유형",targetValue:(null==c?void 0:c.tdmTargetValue)||(null==(o=null==(s=null==u?void 0:u.defaultTargets)?void 0:s[(null==c?void 0:c.indication)||""])?void 0:o.value)||(null==(d=null==(l=null==u?void 0:u.targets)?void 0:l[0])?void 0:d.value)||"목표값",dosage:(null==c?void 0:c.dosage)||0,unit:(null==c?void 0:c.unit)||"mg",frequency:(null==c?void 0:c.frequency)||"시간"}},[Me]),Pe=N.useMemo(()=>Array.from(new Set([...Me.map(e=>e.drugName),...Oe.map(e=>e.drugName)])),[Me,Oe]);N.useEffect(()=>{(null==i?void 0:i.drugName)&&m(i.drugName)},[null==i?void 0:i.drugName]),N.useEffect(()=>{Pe.length>0&&!u&&m(Pe[0])},[Pe,u]);const Re=N.useMemo(()=>u?Oe.filter(e=>e.drugName===u):[],[u,Oe]),Ae=Oe.length>0?[...Oe].sort((e,t)=>new Date(t.testDate).getTime()-new Date(e.testDate).getTime())[0]:null;(()=>{var e;if(!h.dose||!h.halfLife)return[];const t=parseFloat(h.dose),n=.693/parseFloat(h.halfLife),r=[];for(let a=0;a<=24;a+=.5){const i=t*Math.exp(-n*a);r.push({time:a,predicted:i,observed:(null==(e=Re.find(e=>Math.abs(e.timeAfterDose-a)<.5))?void 0:e.concentration)||null})}})();(()=>{var e;if(Re.length<2)return null;const t=[...Re].sort((e,t)=>e.timeAfterDose-t.timeAfterDose),n=t[0],r=t[t.length-1];if(n.timeAfterDose===r.timeAfterDose)return null;const a=Math.log(n.concentration/r.concentration)/(r.timeAfterDose-n.timeAfterDose),i=.693/a,s=Re.reduce((e,t,n)=>{if(0===n)return 0;const r=Re[n-1];return e+(t.concentration+r.concentration)*(t.timeAfterDose-r.timeAfterDose)/2},0);i.toFixed(2),a.toFixed(4),s.toFixed(2),Math.max(...Re.map(e=>e.concentration)).toFixed(2),null==(e=Re.find(e=>e.concentration===Math.max(...Re.map(e=>e.concentration))))||e.timeAfterDose.toFixed(1)})();const Ee=(e,t)=>{var n,r,a;F(n=>({...n,[e]:t})),ue(t=>({...t,[e]:!0})),(null==(n=Ce[e])?void 0:n.currentMethodSeries)&&0!==(null==(r=Ce[e])?void 0:r.currentMethodSeries.length)||lt(e);const i=parseFloat(t.replace(/[^0-9.]/g,"")),o=(s||[]).filter(e=>e.patientId===d&&e.drugName===u),l=o.length>0?[...o].sort((e,t)=>nt(e.date,e.time).getTime()-nt(t.date,t.time).getTime())[o.length-1]:void 0,c=Number((null==l?void 0:l.dose)||0);if(Math.abs(i-c)<.01)return _e(t=>{var n,r;return{...t,[e]:{ipredSeries:[],predSeries:[],observedSeries:(null==(n=t[e])?void 0:n.observedSeries)||[],currentMethodSeries:(null==(r=t[e])?void 0:r.currentMethodSeries)||[]}}}),void fe(t=>({...t,[e]:!1}));const m=null==(a=null==we?void 0:we[e])?void 0:a[i],f=A.find(t=>t.id===e);if("dosageAndInterval"===(null==f?void 0:f.type)){const t=V[e];if(t){const n=Fe(t);if("number"==typeof n&&Number.isFinite(n))return void st(e,i,n)}const n=(s||[]).filter(e=>e.patientId===d&&e.drugName===u),r=n.length>0?[...n].sort((e,t)=>nt(e.date,e.time).getTime()-nt(t.date,t.time).getTime())[n.length-1]:void 0,a=(null==r?void 0:r.intervalHours)||12;return void st(e,i,a)}if(m&&m.data)return ke(t=>({...t,[e]:m.data})),Te(t=>({...t,[e]:at(m.data,m.dataset||[])})),_e(t=>{var n,r,a;return{...t,[e]:{ipredSeries:((null==(n=m.data)?void 0:n.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==(r=m.data)?void 0:r.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.PRED??e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(m.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:(null==(a=t[e])?void 0:a.currentMethodSeries)||[]}}}),void fe(t=>({...t,[e]:!1}));it(e,i)};je.current=Ee;const Fe=e=>{const t=e.match(/([0-9]+(?:\.[0-9]+)?)/);if(t){const n=Number(t[1]);if(!Number.isNaN(n))return e.includes("주")?24*n*7:n}return null},Ve=(e,t)=>{var n,r;H(n=>({...n,[e]:t})),ue(t=>({...t,[e]:!0})),(null==(n=Ce[e])?void 0:n.currentMethodSeries)&&0!==(null==(r=Ce[e])?void 0:r.currentMethodSeries.length)||lt(e);try{const n=Fe(t);if("number"==typeof n&&Number.isFinite(n)){Q(t=>({...t,[e]:String(n)}));const t=A.find(t=>t.id===e);if("dosageAndInterval"===(null==t?void 0:t.type)){const t=L[e];if(t){const r=parseFloat(t.replace(/[^0-9.]/g,""));isNaN(r)||st(e,r,n)}}else ot(e,n)}}catch{}},He=(e,t)=>{Q(n=>({...n,[e]:t}))},Ue=e=>{var t,n;const r=(Z[e]??"").trim();if(""===r)return void window.alert("투약 간격을 입력해주세요.");const a=Number(r);if(!Number.isFinite(a)||a<=0)return void window.alert("유효한 숫자를 입력해주세요.");const i=Number.isInteger(a)&&a>=1?String(a):a.toString(),s=`직접 입력 (${i}시간)`;(null==(t=Ce[e])?void 0:t.currentMethodSeries)&&0!==(null==(n=Ce[e])?void 0:n.currentMethodSeries.length)||lt(e);const o=A.find(t=>t.id===e);if("dosageAndInterval"===(null==o?void 0:o.type)){H(t=>({...t,[e]:s})),ue(t=>({...t,[e]:!0})),Q(t=>({...t,[e]:i}));const t=L[e];if(t){const n=parseFloat(t.replace(/[^0-9.]/g,""));isNaN(n)||st(e,n,a)}}else Ve(e,s),Q(t=>({...t,[e]:i}))},We=(e,t)=>{var n,r;const a=`${Number(t).toLocaleString()} mg`;X(n=>({...n,[e]:String(t)})),(null==(n=Ce[e])?void 0:n.currentMethodSeries)&&0!==(null==(r=Ce[e])?void 0:r.currentMethodSeries.length)||lt(e);const i=A.find(t=>t.id===e);if("dosageAndInterval"===(null==i?void 0:i.type)){F(t=>({...t,[e]:a})),ue(t=>({...t,[e]:!0}));const n=V[e];if(n){const r=Fe(n);"number"==typeof r&&Number.isFinite(r)&&st(e,t,r)}else{const n=(s||[]).filter(e=>e.patientId===d&&e.drugName===u),r=n.length>0?[...n].sort((e,t)=>nt(e.date,e.time).getTime()-nt(t.date,t.time).getTime())[n.length-1]:void 0,a=(null==r?void 0:r.intervalHours)||12;st(e,t,a)}}else Ee(e,a)},Ke=(e,t)=>{X(n=>({...n,[e]:t}))},Be=e=>{var t,n;const r=(U[e]??"").trim();if(""===r)return void window.alert("투약 용량을 입력해주세요.");const a=Number(r);if(!Number.isFinite(a)||a<=0)return void window.alert("유효한 숫자를 입력해주세요.");const i=`${Number(a).toLocaleString()} mg`;(null==(t=Ce[e])?void 0:t.currentMethodSeries)&&0!==(null==(n=Ce[e])?void 0:n.currentMethodSeries.length)||lt(e);const s=A.find(t=>t.id===e);if("dosageAndInterval"===(null==s?void 0:s.type)){F(t=>({...t,[e]:i})),ue(t=>({...t,[e]:!0})),X(t=>({...t,[e]:String(a)}));const t=V[e];if(t){const n=Fe(t);"number"==typeof n&&Number.isFinite(n)&&st(e,a,n)}}else Ee(e,i),X(t=>({...t,[e]:String(a)}))},et=N.useMemo(()=>[{label:"2시간",helper:"q2h"},{label:"3시간",helper:"q3h"},{label:"4시간",helper:"q4h"},{label:"6시간",helper:"q6h"},{label:"8시간",helper:"q8h"},{label:"12시간",helper:"q12h"},{label:"24시간",helper:"매일"},{label:"48시간",helper:"이틀 간격"},{label:"1주",helper:"주 1회"},{label:"2주",helper:"격주"},{label:"4주",helper:"매 4주"},{label:"6주",helper:"6주마다"},{label:"8주",helper:"8주마다"}],[]);N.useMemo(()=>"Vancomycin"===u?[125,250,375,500,625,750,875,1e3,1125]:"Cyclosporin"===u?[25,50,75,100,125,150,175,200,225,250,275,300,325,350]:[],[u]);const tt=N.useCallback(()=>{try{if(!d)return null;const e=window.localStorage.getItem(`tdmfriends:renal:${d}`);if(!e)return null;const t=JSON.parse(e);return t.find(e=>e.isSelected)||t[t.length-1]||null}catch{return null}},[d]),nt=(e,t)=>new Date(`${e}T${t}`),rt=N.useCallback((e,t)=>{try{const n=(null==e?void 0:e.IPRED_CONC)||[],r=(null==e?void 0:e.PRED_CONC)||[],a=Array.isArray(n)?n.length:0,i=Array.isArray(r)?r.length:0,s=Array.isArray(t)?t.filter(e=>0===e.EVID&&null!=e.DV).length:0,o=Math.max(a,i);return o+s>=5e4}catch{return!1}},[]),at=N.useCallback((e,t)=>{try{const n=(null==e?void 0:e.IPRED_CONC)||[],r=(null==e?void 0:e.PRED_CONC)||[],a=new Map,i=e=>{const t=Number(e)||0,n=a.get(t);if(n)return n;const r={time:t,predicted:0,observed:null,controlGroup:0};return a.set(t,r),r};for(const e of n){const t=Number(e.time)||0,n=Number(e.IPRED??0)||0;i(t).predicted=n}for(const e of r){const t=Number(e.time)||0,n=Number(e.PRED??e.IPRED??0)||0;i(t).controlGroup=n}if(t&&t.length>0)for(const e of t)if(0===e.EVID&&null!=e.DV){const t=Number(e.TIME)||0,n=Number(e.DV);i(t).observed=n}return Array.from(a.values()).sort((e,t)=>e.time-t.time)}catch{return[]}},[]);N.useCallback(async e=>{try{if(!d||!u)return;v(!1);const a=Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:d,selectedDrugName:u,overrides:{amount:e}});if(!a)return;const i=await qe({body:a,persist:!0,patientId:d,drugName:u});y(i);const o=a.dataset||[];if(o.length>0&&void 0!==o[0].TOXI&&R(o[0].TOXI),rt(i,o))return void re(!0);w(at(i,a.dataset||[])),_({ipredSeries:((null==i?void 0:i.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==i?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(a.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==i?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)});try{const e=`tdmfriends:tdmExtraSeries:${d}:${u}`;window.localStorage.setItem(e,JSON.stringify({ipredSeries:(null==i?void 0:i.IPRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:(null==i?void 0:i.PRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(a.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:(null==i?void 0:i.PRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}))}catch{}v(!0)}catch(a){}},[t,n,r,s,d,u,at]);const it=N.useCallback(async(e,a)=>{try{if(!d||!u)return;fe(t=>({...t,[e]:!0}));const i=Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:d,selectedDrugName:u,overrides:{amount:a}});if(!i)return;const o=await qe({body:i,persist:!1,patientId:d,drugName:u});ke(t=>({...t,[e]:o})),Te(t=>({...t,[e]:at(o,i.dataset||[])})),_e(t=>{var n;return{...t,[e]:{ipredSeries:((null==o?void 0:o.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==o?void 0:o.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.PRED??e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(i.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:(null==(n=t[e])?void 0:n.currentMethodSeries)||[]}}}),Ne(t=>{const n={...t||{}};return n[e]=n[e]||{},n[e][a]={data:o,dataset:i.dataset||[]},n}),fe(t=>({...t,[e]:!1}))}catch(i){fe(t=>({...t,[e]:!1}))}},[t,n,r,s,d,u,at,rt]);N.useCallback(async e=>{try{if(!d||!u)return;v(!1);const a=Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:d,selectedDrugName:u,overrides:{tau:e}});if(!a)return;const i=await qe({body:a,persist:!0,patientId:d,drugName:u});if(y(i),rt(i,a.dataset||[]))return void re(!0);w(at(i,a.dataset||[])),_({ipredSeries:((null==i?void 0:i.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==i?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(a.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==i?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)});try{const e=`tdmfriends:tdmExtraSeries:${d}:${u}`;window.localStorage.setItem(e,JSON.stringify({ipredSeries:(null==i?void 0:i.IPRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:(null==i?void 0:i.PRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(a.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:(null==i?void 0:i.PRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}))}catch{}v(!0)}catch(a){}},[t,n,r,s,d,u,at]);const st=N.useCallback(async(e,a,i)=>{var o;try{if(!d||!u)return;const l=null==(o=null==we?void 0:we[e])?void 0:o[a];if(l&&l.data){const t=(s||[]).filter(e=>e.patientId===d&&e.drugName===u),n=t.length>0?[...t].sort((e,t)=>nt(e.date,e.time).getTime()-nt(t.date,t.time).getTime())[t.length-1]:void 0,r=(null==n?void 0:n.intervalHours)||12;if(Math.abs(i-r)<.01)return ke(t=>({...t,[e]:l.data})),Te(t=>({...t,[e]:at(l.data,l.dataset||[])})),_e(t=>{var n,r,a;return{...t,[e]:{ipredSeries:((null==(n=l.data)?void 0:n.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==(r=l.data)?void 0:r.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.PRED??e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(l.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:(null==(a=t[e])?void 0:a.currentMethodSeries)||[]}}}),void fe(t=>({...t,[e]:!1}))}fe(t=>({...t,[e]:!0}));const c=Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:d,selectedDrugName:u,overrides:{amount:a,tau:i}});if(!c)return;const m=await qe({body:c,persist:!1,patientId:d,drugName:u});Ne(t=>{const n={...t||{}};return n[e]||(n[e]={}),n[e][a]={data:m,dataset:c.dataset||[]},n}),ke(t=>({...t,[e]:m})),Te(t=>({...t,[e]:at(m,c.dataset||[])})),_e(t=>{var n;return{...t,[e]:{ipredSeries:((null==m?void 0:m.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==m?void 0:m.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.PRED??e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(c.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:(null==(n=t[e])?void 0:n.currentMethodSeries)||[]}}}),fe(t=>({...t,[e]:!1}))}catch(l){fe(t=>({...t,[e]:!1}))}},[t,n,r,s,d,u,at,rt]),ot=N.useCallback(async(e,a)=>{try{if(!d||!u)return;fe(t=>({...t,[e]:!0}));const i=Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:d,selectedDrugName:u,overrides:{tau:a}});if(!i)return;const o=await qe({body:i,persist:!1,patientId:d,drugName:u});ke(t=>({...t,[e]:o})),Te(t=>({...t,[e]:at(o,i.dataset||[])})),_e(t=>{var n;return{...t,[e]:{ipredSeries:((null==o?void 0:o.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==o?void 0:o.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.PRED??e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(i.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:(null==(n=t[e])?void 0:n.currentMethodSeries)||[]}}}),fe(t=>({...t,[e]:!1}))}catch(i){fe(t=>({...t,[e]:!1}))}},[t,n,r,s,d,u,at,rt]),lt=N.useCallback(async e=>{if(d&&u){fe(t=>({...t,[e]:!0}));try{if(b){const a=Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:d,selectedDrugName:u,overrides:void 0});if(a){const t=((null==b?void 0:b.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),n=(a.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0);return Te(t=>({...t,[e]:at(b,a.dataset||[])})),_e(r=>{var a,i;return{...r,[e]:{ipredSeries:(null==(a=r[e])?void 0:a.ipredSeries)||[],predSeries:(null==(i=r[e])?void 0:i.predSeries)||[],observedSeries:n,currentMethodSeries:t}}}),ke(t=>({...t,[e]:b})),ue(t=>({...t,[e]:!0})),void fe(t=>({...t,[e]:!1}))}}const a=Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:d,selectedDrugName:u,overrides:void 0});if(!a)return;const i=await qe({body:a,persist:!1,patientId:d,drugName:u});Te(t=>({...t,[e]:at(i,a.dataset||[])}));const o=((null==i?void 0:i.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),l=(a.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0);if(_e(t=>{var n,r;return{...t,[e]:{ipredSeries:(null==(n=t[e])?void 0:n.ipredSeries)||[],predSeries:(null==(r=t[e])?void 0:r.predSeries)||[],observedSeries:l,currentMethodSeries:o}}}),ke(t=>({...t,[e]:i})),p){const t=p.dose,n=p.unit||"mg",r=`${Number(t).toLocaleString()}${n}`;if(F(t=>({...t,[e]:r})),p.intervalHours){const t=p.intervalHours,n=et.find(e=>Fe(e.label)===t);if(n)H(t=>({...t,[e]:n.label}));else{const n=Number.isInteger(t)&&t>=1?String(t):t.toString(),r=`직접 입력 (${n}시간)`;H(t=>({...t,[e]:r})),Q(t=>({...t,[e]:n}))}}}ue(t=>({...t,[e]:!0}))}catch(a){}finally{fe(t=>({...t,[e]:!1}))}}},[t,n,r,s,d,u,at,rt,p,et,b,at]),dt=N.useCallback(async e=>{try{xe(t=>({...t,[e]:!0})),be(t=>({...t,[e]:!1}));const i=Ie;if(!i)return;const o=Me.find(e=>e.drugName===u)||Me[0];if(!o)return;const l=(o.drugName||"").toLowerCase();let d=10;if("cyclosporin"===l||"cyclosporine"===l){let e=null;try{const t=i?`tdmfriends:conditions:${i.id}`:null;if(t){const n=window.localStorage.getItem(t);if(n){const t=JSON.parse(n).find(e=>"경구"===e.route||"oral"===e.route);e=(null==t?void 0:t.dosageForm)||null}}}catch(a){}d=e&&"capsule/tablet"===e.toLowerCase()?25:10}const c=(s||[]).filter(e=>e.patientId===i.id&&e.drugName===o.drugName),m=c.length>0?[...c].sort((e,t)=>nt(e.date,e.time).getTime()-nt(t.date,t.time).getTime())[c.length-1]:void 0,f=Number((null==m?void 0:m.dose)||o.dosage||100),p=(o.tdmTarget||"").toLowerCase(),h=(o.tdmTargetValue||"").match(/\d+\.?\d*/g)||[],g=h[0]?parseFloat(h[0]):void 0,x=h[1]?parseFloat(h[1]):void 0;if(!Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:i.id,selectedDrugName:o.drugName}))return;const v=(e,t,n)=>{if(!e)return Number.POSITIVE_INFINITY;const r=Number(((null==e?void 0:e.CTROUGH_after)??(null==e?void 0:e.CTROUGH_before))||0),a=Number(((null==e?void 0:e.AUC_24_after)??(null==e?void 0:e.AUC_24_before))||0);let i=0;if(p.includes("auc")&&(t||n)){const e=a||0,r=t??e,s=n??e;i=e<r?r-e:e>s?e-s:0}else if((p.includes("trough")||p.includes("cmax"))&&(t||n)){const e=r||0,a=t??e,s=n??e;i=e<a?a-e:e>s?e-s:0}else i=Math.abs((r||0)-((null==b?void 0:b.CTROUGH_before)||0));return i},y=e=>{if(!e)return null;return Le(o.tdmTarget,e.AUC_24_after??e.AUC_24_before??null,e.CMAX_after??e.CMAX_before??null,e.CTROUGH_after??e.CTROUGH_before??null,o.drugName).numericValue},j=e=>!!e&&ze(o.tdmTarget,o.tdmTargetValue,e.AUC_24_after??e.AUC_24_before??null,e.CMAX_after??e.CMAX_before??null,e.CTROUGH_after??e.CTROUGH_before??null,o.drugName),w=e=>{if(!e||!g||!x)return Number.POSITIVE_INFINITY;const t=y(e);return null===t?Number.POSITIVE_INFINITY:t>=g&&t<=x?0:t<g?g-t:t-x},N=async(e,a=3)=>{const l=Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:i.id,selectedDrugName:o.drugName,overrides:{amount:e}});try{const t=await qe({body:l,retries:a});return{amt:e,score:v(t,g,x),resp:t,dataset:(null==l?void 0:l.dataset)||[]}}catch(d){return{amt:e,score:Number.POSITIVE_INFINITY,resp:null,dataset:(null==l?void 0:l.dataset)||[]}}},D=5,[k,S]=await Promise.all([N(Math.max(1,f+d),D),N(Math.max(1,f-d),D)]);if(null===k.resp||null===S.resp)return be(t=>({...t,[e]:!0})),void xe(t=>({...t,[e]:!1}));be(t=>({...t,[e]:!1}));const T=f+d,C=f-d,_=y(k.resp),I=y(S.resp);let M=null;if(null!==_&&null!==I&&d>0){const e=T-C;0!==e&&(M=(_-I)/e)}let O=null,$=null;if(null!==M&&void 0!==g&&void 0!==x&&null!==I&&Math.abs(M)>1e-4){const e=(g-I)/M;O=Math.max(1,C+e);const t=(x-I)/M;$=Math.max(1,C+t),O=Math.round(O/d)*d,$=Math.round($/d)*d}let P=f,R=1;if(null!==O&&null!==$)P=Math.min(O,$),R=1;else{const e=w(k.resp),t=w(S.resp);R=e<t?1:-1}const A=[k,S],E=[];for(const e of A)j(e.resp)&&E.push(e);const L=Math.round((P-f)/d),V=new Set([1,-1]);let H=L;const U=3;let W=E.length>0,z=0;const K=20;for(;z++,!(z>K);){const t=[];for(let e=0;e<U;e++){const n=H+e*R;V.has(n)||t.push(n)}if(0===t.length){if(H+=U*R,Math.abs(H)>50)break;continue}const n=t.map(e=>Math.max(1,f+e*d)).filter(e=>e>0);if(0===n.length)break;const r=await Promise.all(n.map(e=>N(e))),a=[];for(let e=0;e<r.length;e++)null===r[e].resp&&a.push(N(r[e].amt).then(t=>{r[e]=t}));a.length>0&&await Promise.all(a);for(const e of t)V.add(e);A.push(...r);const i=[...r].sort((e,t)=>1===R?e.amt-t.amt:t.amt-e.amt);let s=!1,o=-1,l=-1;const c=[],u=[];for(let e=0;e<i.length;e++){const t=i[e],n=j(t.resp);c.push({amt:t.amt,inRange:n}),n&&(E.push(t),u.push(t),-1===o&&(o=e,W=!0),l=e,s=!0)}if(u.length>0&&(he(t=>{const n=t[e]||[],r=u.map(e=>e.amt),a=[...new Set([...n,...r])].sort((e,t)=>e-t);return{...t,[e]:a}}),Ne(t=>{const n={...t||{}};n[e]=n[e]||{};for(const r of u)r&&r.resp&&(n[e][r.amt]={data:r.resp,dataset:r.dataset});return n}),E.length===u.length)){const t=u.sort((e,t)=>e.amt-t.amt)[0].amt;setTimeout(()=>{je.current&&je.current(e,`${t} mg`)},100)}if(u.length,W){if(!s)break;{const e=i[i.length-1];if(!j(e.resp))break;H+=U*R}}else H+=U*R}const B=E.length>0?E.sort((e,t)=>e.amt-t.amt):A.sort((e,t)=>e.score-t.score).slice(0,6),G=B.map(e=>e.amt).sort((e,t)=>e-t);if(he(t=>({...t,[e]:G})),Ne(t=>{const n={...t||{}};n[e]=n[e]||{};for(const r of B)r&&r.resp&&(n[e][r.amt]={data:r.resp,dataset:r.dataset});return n}),G.length>0){let t=!1;if(F(n=>{if(n[e])return n;t=!0;const r=G[0];return{...n,[e]:`${r}mg`}}),t){const t=G[0];setTimeout(()=>{je.current&&je.current(e,`${t} mg`)},100)}}}catch(a){}finally{xe(t=>({...t,[e]:!1}))}},[t,n,r,s,Ie,u,Me,b,at]),ct=N.useCallback(e=>{var t;try{(null==(t=ye.current)?void 0:t[e])&&window.clearTimeout(ye.current[e]);const n=window.setTimeout(()=>{dt(e)},250);ye.current[e]=n}catch{dt(e)}},[dt]),ut=N.useCallback(e=>d?Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:d,selectedDrugName:u,overrides:e}):null,[t,n,r,s,d,u]);N.useEffect(()=>{if(d){try{if(u){const e=`tdmfriends:tdmResults:${d}:${u}`,t=window.localStorage.getItem(e);if(t){const e=[...JSON.parse(t)].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())[0];if(e&&e.data){const t=e.data;y(t);const n=ut();if(void 0!==(null==n?void 0:n.input_TOXI))R(n.input_TOXI);else{const e=(null==n?void 0:n.dataset)||[];e.length>0&&void 0!==e[0].TOXI&&R(e[0].TOXI)}const r=(null==n?void 0:n.dataset)||[];return w(at(t,r)),_({ipredSeries:((null==t?void 0:t.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==t?void 0:t.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:((null==n?void 0:n.dataset)||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==t?void 0:t.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}),void v(!0)}}}const e=window.localStorage.getItem(`tdmfriends:tdmResult:${d}`);if(e){const t=JSON.parse(e);y(t);const n=ut();if(void 0!==(null==n?void 0:n.input_TOXI))R(n.input_TOXI);else{const e=(null==n?void 0:n.dataset)||[];e.length>0&&void 0!==e[0].TOXI&&R(e[0].TOXI)}const r=(null==n?void 0:n.dataset)||[];if(rt(t,r))return void re(!0);w(at(t,(null==n?void 0:n.dataset)||[])),_({ipredSeries:((null==t?void 0:t.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==t?void 0:t.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:((null==n?void 0:n.dataset)||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==t?void 0:t.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}),v(!0)}else w([])}catch(e){}M(null),$(null),k([]),T([])}},[d,u,at,ut,rt]),N.useEffect(()=>{if(d)if(null==i?void 0:i.drugName)m(i.drugName);else try{const e=window.localStorage.getItem(`tdmfriends:selectedDrug:${d}`);e&&m(e)}catch{}},[d,null==i?void 0:i.drugName]),N.useEffect(()=>{if(d&&u)try{window.localStorage.setItem(`tdmfriends:selectedDrug:${d}`,u)}catch{}},[d,u]);const[mt,ft]=N.useState([]),[pt,ht]=N.useState(!1),[gt,xt]=N.useState(""),vt=N.useCallback(e=>{var t;if(!(null==e?void 0:e.data))return;ht(!0);const n=e.data;y(n);const r=(null==e?void 0:e.dataset)||(null==(t=ut())?void 0:t.dataset)||[];rt(n,r)?re(!0):(w(at(n,r)),_({ipredSeries:((null==n?void 0:n.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==n?void 0:n.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(r||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==n?void 0:n.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}))},[ut,at,rt]),bt=N.useCallback(()=>ht(!1),[]);N.useEffect(()=>{try{if(!d||!u)return void ft([]);const e=`tdmfriends:tdmResults:${d}:${u}`,t=window.localStorage.getItem(e),n=[...t?JSON.parse(t):[]].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()).slice(0,5);ft(n)}catch{ft([])}},[d,u,b]);const yt=()=>{const e=i||Me.find(e=>e.drugName===u);if(!e)return{};const t=(e.tdmTarget||"").toLowerCase();if(!t||t.includes("auc"))return{};if(t.includes("trough")||t.includes("cmax")){const t=((null==e?void 0:e.tdmTargetValue)||"").match(/\d+\.?\d*/g)||[];return{min:t[0]?parseFloat(t[0]):void 0,max:t[1]?parseFloat(t[1]):void 0}}return{}};return d&&Ie&&0!==Pe.length?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Je,{currentPatient:Ie,selectedPrescription:i,latestBloodTest:Ae,drugAdministrations:s,isExpanded:!!l||void 0,disableHover:l}),e.jsxs("div",{className:"w-full",children:[mt.length>0&&e.jsxs("div",{className:"mb-4 text-xs text-muted-foreground",children:[e.jsx("div",{className:"font-semibold mb-1",children:"최근 TDM 히스토리 (최대 5개)"}),e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:mt.map(t=>{var n,r,a,i;return e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:[new Date(t.timestamp).toLocaleString()," — AUC24h(before/after): ",(null==(n=t.summary)?void 0:n.AUC24h_before)??"-"," /"," ",(null==(r=t.summary)?void 0:r.AUC24h_after)??"-",", Ctrough(before/after):"," ",(null==(a=t.summary)?void 0:a.CTROUGH_before)??"-"," /"," ",(null==(i=t.summary)?void 0:i.CTROUGH_after)??"-"]}),e.jsx("button",{className:"underline",onClick:()=>vt(t),children:"불러오기"}),o&&e.jsx("button",{className:"underline",onClick:()=>{vt(t),setTimeout(()=>{try{null==o||o()}catch{}},0)},children:"리포트"})]},t.id)})}),pt&&e.jsxs("div",{className:"mt-2 text-[11px]",children:["완료 보기 모드: 용법 조정 UI가 숨겨집니다."," ",e.jsx("button",{className:"underline",onClick:bt,children:"종료"})," ",o&&e.jsx("button",{className:"underline ml-2",onClick:()=>{try{null==o||o()}catch{}},children:"리포트 보기"})]})]}),(()=>{var t,n;const r=tt(),a=Ie?Xe(d,Ie.weight,Ie.age,"male"===Ie.gender?1:0,Ie.height,u):{crcl:void 0,egfr:void 0};return e.jsx(Ze,{showSimulation:!0,currentPatientName:Ie.name,selectedDrug:u,targetMin:yt().min,targetMax:yt().max,recentAUC:null==b?void 0:b.AUC_24_before,recentMax:null==b?void 0:b.CMAX_before,recentTrough:null==b?void 0:b.CTROUGH_before,predictedAUC:pt?null:null==b?void 0:b.AUC_24_after,predictedMax:pt?null:null==b?void 0:b.CMAX_after,predictedTrough:pt?null:null==b?void 0:b.CTROUGH_after,ipredSeries:null==C?void 0:C.ipredSeries,predSeries:null==C?void 0:C.predSeries,observedSeries:null==C?void 0:C.observedSeries,tdmIndication:$e((null==i?void 0:i.drugName)||u).indication,tdmTarget:$e((null==i?void 0:i.drugName)||u).target,tdmTargetValue:$e((null==i?void 0:i.drugName)||u).targetValue,latestAdministration:p,drugAdministrations:s,steadyState:null==b?void 0:b.Steady_state,input_TOXI:P,tauBefore:null==(t=ut())?void 0:t.input_tau_before,amountBefore:null==(n=ut())?void 0:n.input_amount_before,prescriptionAdditionalInfo:null==i?void 0:i.additionalInfo,renalReplacement:null==r?void 0:r.renalReplacement,patientAge:null==Ie?void 0:Ie.age,currentCrCl:a.crcl,crclHistory:(()=>{try{if(!d)return[];const e=window.localStorage.getItem(`tdmfriends:renal:${d}`);if(!e)return[];const t=JSON.parse(e),n=[];for(const r of t){const e=(r.result||"").toString(),t=e.match(/(CRCL|eGFR)\s*=\s*([\d.]+)/i);if(t){const e=parseFloat(t[2]);!Number.isNaN(e)&&e>0&&n.push({value:e,date:new Date(r.date)})}else{const t=parseFloat(e.replace(/[^0-9.-]/g,""));!Number.isNaN(t)&&t>0&&n.push({value:t,date:new Date(r.date)})}}return n}catch{return[]}})()})})()]}),!pt&&A.map(t=>{var n,r,a,o,l,c,m,f,h,g;const v="dosage"===t.type||"dosageV2"===t.type||"dosageAndInterval"===t.type;return e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg p-6 mt-6 shadow-lg border-2 "+(v?"border-pink-200 dark:border-pink-800":"border-green-200 dark:border-green-800"),children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["용법 조정 ",t.id]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"dosage"===t.type?"투약 용량을 조정하고 즉시 예측 결과를 확인해보세요":"dosageV2"===t.type?"사전 정의된 용량 버튼 또는 직접 입력으로 투약 용량을 조정해보세요":"dosageAndInterval"===t.type?"투약 용량과 시간을 동시에 조정하고 즉시 예측 결과를 확인해보세요":"투약 시간의 간격을 조정하고 즉시 예측 결과를 확인해보세요"})]}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl font-bold flex-shrink-0",onClick:()=>{return e=t.id,de(e),void te(!0);var e},children:"×"})]}),e.jsx("div",{className:"mb-6 px-4",children:"dosageAndInterval"===t.type?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",role:"group","aria-label":"투약 용량 옵션",children:e.jsxs("div",{className:"flex-1 md:pr-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"투약 용량 선택"})}),e.jsxs("div",{className:"flex justify-center mb-4",children:[ve[t.id]&&!ge[t.id]&&e.jsx("div",{className:"flex flex-col items-center gap-3 w-full",children:e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:"제안 계산에 실패했습니다. 네트워크 상태를 확인하고 카드를 삭제한 후 다시 시도해주세요."})}),!ve[t.id]&&(!pe[t.id]||0===pe[t.id].length||ge[t.id])&&e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),"제안을 계산 중..."]})]}),!ge[t.id]&&(pe[t.id]||[]).length>0&&(()=>{const n=(s||[]).filter(e=>e.patientId===d&&e.drugName===u),r=n.length>0?[...n].sort((e,t)=>nt(e.date,e.time).getTime()-nt(t.date,t.time).getTime())[n.length-1]:void 0,a=Number((null==r?void 0:r.dose)||0);return e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3",children:(pe[t.id]||[]).map((n,r)=>{const i=`${Number(n).toLocaleString()} mg`,s=L[t.id]===i,o=Math.abs(n-a)<.01;return e.jsxs(se,{variant:s?"default":"outline",size:"default",onClick:()=>We(t.id,n),className:(s?"bg-black dark:bg-primary text-white dark:text-primary-foreground hover:bg-gray-800 dark:hover:bg-primary/90":"bg-white dark:bg-slate-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-slate-700")+" flex h-[70px] w-full min-w-0 flex-col items-center justify-center gap-1 px-4 py-3 text-sm font-semibold leading-tight transition",title:`${n}mg${o?" (현용법)":""}`,"aria-pressed":s,children:[e.jsx("span",{children:i}),e.jsx("span",{className:"text-xs font-normal "+(s?"text-gray-200 dark:text-primary-foreground":"text-muted-foreground"),children:o?"현용법":""})]},`${t.id}-${n}`)})})})()]})}),e.jsxs("div",{className:"flex flex-col gap-4",role:"group","aria-label":"투약 간격 옵션",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"투약 시간 선택"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:et.map(n=>{const r=V[t.id]===n.label;return e.jsxs(se,{variant:r?"default":"outline",size:"default",onClick:()=>Ve(t.id,n.label),className:(r?"bg-black dark:bg-primary text-white dark:text-primary-foreground hover:bg-gray-800 dark:hover:bg-primary/90":"bg-white dark:bg-slate-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-slate-700")+" rounded-full px-4 py-2 text-sm font-semibold transition h-auto flex flex-col items-center justify-center gap-0.5",title:n.helper,"aria-pressed":r,children:[e.jsx("span",{children:n.label}),e.jsx("span",{className:"text-xs font-normal "+(r?"text-gray-200 dark:text-primary-foreground":"text-muted-foreground"),children:n.helper})]},`${t.id}-${n.label}`)})})]}),e.jsx("div",{className:"flex w-full flex-col gap-2 border-t pt-4",children:e.jsx("div",{className:"flex justify-end",children:e.jsx(se,{variant:"outline",className:"w-[150px] h-[40px] px-4 py-2 text-sm leading-tight",onClick:()=>{p&&(!U[t.id]&&p.dose&&X(e=>({...e,[t.id]:String(p.dose)})),!Z[t.id]&&p.intervalHours&&Q(e=>({...e,[t.id]:String(p.intervalHours)}))),ie(e=>({...e,[t.id]:!0}))},children:"+ 직접 입력"})})})]})]}),e.jsx(Zt,{open:ae[t.id]||!1,onOpenChange:e=>{ie(n=>({...n,[t.id]:e})),e&&p&&(!U[t.id]&&p.dose&&X(e=>({...e,[t.id]:String(p.dose)})),!Z[t.id]&&p.intervalHours&&Q(e=>({...e,[t.id]:String(p.intervalHours)})))},children:e.jsxs(nn,{children:[e.jsx(rn,{children:e.jsx(sn,{children:"직접 입력"})}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2 block",children:"투약 용량 (mg)"}),e.jsx(oe,{type:"number",min:"0",step:"0.1",className:"w-full h-[80px] px-4 py-3 text-4xl font-semibold leading-tight text-center placeholder:text-2xl [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"용량 (mg)",value:U[t.id]??((null==p?void 0:p.dose)?String(p.dose):""),onChange:e=>Ke(t.id,e.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2 block",children:"투약 시간 (시간)"}),e.jsx(oe,{type:"number",min:"0",step:"0.1",className:"w-full h-[80px] px-4 py-3 text-4xl font-semibold leading-tight text-center placeholder:text-2xl [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"시간 (h)",value:Z[t.id]??((null==p?void 0:p.intervalHours)?String(p.intervalHours):""),onChange:e=>He(t.id,e.target.value)})]})]}),e.jsxs(an,{children:[e.jsx(se,{variant:"outline",onClick:()=>ie(e=>({...e,[t.id]:!1})),children:"취소"}),e.jsx(se,{onClick:()=>{U[t.id]&&Be(t.id),Z[t.id]&&Ue(t.id),ie(e=>({...e,[t.id]:!1}))},children:"확인"})]})]})})]}):"dosage"===t.type?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-center mb-4",children:[ve[t.id]&&!ge[t.id]&&e.jsxs("div",{className:"flex flex-col items-center gap-3 w-full",children:[e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:"제안 계산에 실패했습니다. 네트워크 상태를 확인하고 다시 시도해주세요."}),e.jsx(se,{variant:"outline",size:"default",onClick:()=>{be(e=>({...e,[t.id]:!1})),ct(t.id)},className:"text-base px-6 py-3",children:"다시 시도"})]}),!ve[t.id]&&(!pe[t.id]||0===pe[t.id].length||ge[t.id])&&e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),"제안을 계산 중..."]})]}),(pe[t.id]||[]).length>0&&e.jsx("div",{className:"flex flex-wrap justify-center gap-4",children:(pe[t.id]||[]).map(n=>{const r=`${Number(n).toLocaleString()} mg`;return e.jsx(se,{variant:L[t.id]===r?"default":"outline",size:"default",onClick:()=>Ee(t.id,r),className:(L[t.id]===r?"bg-black dark:bg-primary text-white dark:text-primary-foreground hover:bg-gray-800 dark:hover:bg-primary/90":"bg-white dark:bg-slate-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-slate-700")+" text-base px-6 py-3 flex-shrink-0",children:r},`${t.id}-${n}`)})})]}):"interval"===t.type?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",role:"group","aria-label":"투약 간격 옵션",children:[e.jsxs("div",{className:"flex-1 md:pr-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"투약 시간 선택"})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-7 gap-3",children:et.map(n=>{const r=V[t.id]===n.label;return e.jsxs(se,{variant:r?"default":"outline",size:"default",onClick:()=>Ve(t.id,n.label),className:(r?"bg-black dark:bg-primary text-white dark:text-primary-foreground hover:bg-gray-800 dark:hover:bg-primary/90":"bg-white dark:bg-slate-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-slate-700")+" flex h-auto w-full min-w-0 flex-col items-center justify-center gap-1 px-4 py-3 text-sm font-semibold leading-tight transition",title:n.helper,"aria-pressed":r,children:[e.jsx("span",{children:n.label}),e.jsx("span",{className:"text-xs font-normal "+(r?"text-gray-200 dark:text-primary-foreground":"text-muted-foreground"),children:n.helper})]},`${t.id}-${n.label}`)})})]}),e.jsxs("div",{className:"flex w-full flex-col gap-2 border-t pt-4 md:w-64 md:self-stretch md:border-t-0 md:border-l md:border-gray-200 md:pl-6 md:pt-0",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"직접 입력 (시간)"}),e.jsxs("div",{className:"flex flex-col items-stretch gap-2",children:[e.jsx(oe,{type:"number",min:"0",step:"0.1",className:"w-full h-[80px] px-4 py-3 text-lg font-semibold leading-tight text-center",placeholder:"시간 (h)",value:Z[t.id]??"",onChange:e=>He(t.id,e.target.value)}),e.jsx("div",{className:"flex",children:e.jsx(se,{className:"w-full h-[50px] px-4 py-3 text-sm font-semibold leading-tight",onClick:()=>Ue(t.id),children:"확인"})})]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-center mb-4",children:[ve[t.id]&&!ge[t.id]&&e.jsx("div",{className:"flex flex-col items-center gap-3 w-full",children:e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:"제안 계산에 실패했습니다. 네트워크 상태를 확인하고 카드를 삭제한 후 다시 시도해주세요."})}),!ve[t.id]&&(!pe[t.id]||0===pe[t.id].length||ge[t.id])&&e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),"제안을 계산 중..."]})]}),!ge[t.id]&&(pe[t.id]||[]).length>0&&e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",role:"group","aria-label":"투약 용량 옵션",children:[e.jsxs("div",{className:"flex-1 md:pr-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"투약 용량 선택"})}),(()=>{const n=(s||[]).filter(e=>e.patientId===d&&e.drugName===u),r=n.length>0?[...n].sort((e,t)=>nt(e.date,e.time).getTime()-nt(t.date,t.time).getTime())[n.length-1]:void 0,a=Number((null==r?void 0:r.dose)||0);return e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3",children:(pe[t.id]||[]).map(n=>{const r=`${Number(n).toLocaleString()} mg`,i=L[t.id]===r,s=Math.abs(n-a)<.01;return e.jsxs(se,{variant:i?"default":"outline",size:"default",onClick:()=>We(t.id,n),className:(i?"bg-black dark:bg-primary text-white dark:text-primary-foreground hover:bg-gray-800 dark:hover:bg-primary/90":"bg-white dark:bg-slate-800 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-slate-700")+" flex h-[70px] w-full min-w-0 flex-col items-center justify-center gap-1 px-4 py-3 text-sm font-semibold leading-tight transition",title:`${n}mg${s?" (현용법)":""}`,"aria-pressed":i,children:[e.jsx("span",{children:r}),e.jsx("span",{className:"text-xs font-normal "+(i?"text-gray-200 dark:text-primary-foreground":"text-muted-foreground"),children:s?"현용법":""})]},`${t.id}-${n}`)})})})()]}),e.jsxs("div",{className:"flex w-full flex-col gap-2 border-t pt-4 md:w-64 md:self-stretch md:border-t-0 md:border-l md:border-gray-200 md:pl-6 md:pt-0",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"직접 입력 (mg)"}),e.jsxs("div",{className:"flex flex-col items-stretch gap-2",children:[e.jsx(oe,{type:"number",min:"0",step:"0.1",className:"w-full h-[80px] px-4 py-3 text-lg font-semibold leading-tight text-center",placeholder:"용량 (mg)",value:U[t.id]??"",onChange:e=>Ke(t.id,e.target.value)}),e.jsx("div",{className:"flex",children:e.jsx(se,{className:"w-full h-[50px] px-4 py-3 text-sm font-semibold leading-tight",onClick:()=>Be(t.id),children:"확인"})})]})]})]})]})}),e.jsx("div",{className:"mb-8",children:e.jsx(Lo,{simulationData:[],showSimulation:x,currentPatientName:null==Ie?void 0:Ie.name,selectedDrug:u,chartTitle:`용법 조정 ${t.id}`,targetMin:yt().min,targetMax:yt().max,drugAdministrations:s,recentAUC:null==b?void 0:b.AUC_24_after,recentMax:null==b?void 0:b.CMAX_after,recentTrough:null==b?void 0:b.CTROUGH_after,predictedAUC:null==(n=De[t.id])?void 0:n.AUC_24_after,predictedMax:null==(r=De[t.id])?void 0:r.CMAX_after,predictedTrough:null==(a=De[t.id])?void 0:a.CTROUGH_after,ipredSeries:null==(o=Ce[t.id])?void 0:o.ipredSeries,predSeries:null==(l=Ce[t.id])?void 0:l.predSeries,observedSeries:null==(c=Ce[t.id])?void 0:c.observedSeries,currentMethodSeries:null==(m=Ce[t.id])?void 0:m.currentMethodSeries,chartColor:v?"pink":"green",isLoading:me[t.id]||!1,tdmIndication:$e((null==i?void 0:i.drugName)||u).indication,tdmTarget:$e((null==i?void 0:i.drugName)||u).target,tdmTargetValue:$e((null==i?void 0:i.drugName)||u).targetValue,originalAdministration:p,latestAdministration:(()=>{if(!p)return null;let e={...p};if(v&&L[t.id]){const n=parseFloat(L[t.id].replace(/[^0-9.]/g,""));isNaN(n)||(e.dose=n)}if(("interval"===t.type||"dosageAndInterval"===t.type)&&V[t.id]){const n=Fe(V[t.id]);"number"!=typeof n||Number.isNaN(n)||(e.intervalHours=n)}return e})(),steadyState:null==(f=De[t.id])?void 0:f.Steady_state,isEmptyChart:!ce[t.id]||!Se[t.id]&&!(null==(g=null==(h=Ce[t.id])?void 0:h.currentMethodSeries)?void 0:g.length)&&ge[t.id]&&(!pe[t.id]||0===pe[t.id].length),selectedButton:"interval"===t.type?V[t.id]:"dosageAndInterval"===t.type?`${L[t.id]||""} / ${V[t.id]||""}`:L[t.id]})})]},`adjustment-${t.id}`)}),!pt&&e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-lg p-6 mt-6",children:e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"용법 조정 시뮬레이션을 진행하시겠습니까?"}),gt&&e.jsx("div",{className:"text-sm text-red-600 mb-2",children:gt}),e.jsxs("div",{className:"flex justify-center gap-4 flex-wrap",children:[e.jsx(se,{onClick:async()=>{gt&&xt("");const e=A.length+1;E(t=>[...t,{id:e,type:"dosageV2"}]),ue(t=>({...t,[e]:!0})),X(t=>({...t,[e]:""})),xe(t=>({...t,[e]:!0})),be(t=>({...t,[e]:!1})),lt(e);try{if(!d||!u)return;const i=Ie;if(!i)return;const o=Me.find(e=>e.drugName===u)||Me[0];if(!o)return;let l=b;if(!l)try{const e=`tdmfriends:tdmResults:${d}:${u}`,t=window.localStorage.getItem(e);if(t){const e=[...JSON.parse(t)].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())[0];e&&e.data&&(l=e.data)}}catch(a){}if(!l)return void xe(t=>({...t,[e]:!1}));const c=ze(o.tdmTarget,o.tdmTargetValue,l.AUC_24_after??l.AUC_24_before??null,l.CMAX_after??l.CMAX_before??null,l.CTROUGH_after??l.CTROUGH_before??null,o.drugName),m=("boolean"==typeof l.Steady_state?l.Steady_state:String(l.Steady_state).toLowerCase(),Le(o.tdmTarget,l.AUC_24_after??l.AUC_24_before??null,l.CMAX_after??l.CMAX_before??null,l.CTROUGH_after??l.CTROUGH_before??null,o.drugName)),f=(()=>{if(!o.tdmTargetValue||!m.numericValue)return null;const e=o.tdmTargetValue.match(/(\d+(?:\.\d+)?)\s*-\s*(\d+(?:\.\d+)?)/);if(!e)return null;const t=parseFloat(e[1]),n=parseFloat(e[2]),r=m.numericValue;return r>n?"초과":r<t?"미달":"도달"})(),p=(o.drugName||"").toLowerCase();let h=10;if("cyclosporin"===p||"cyclosporine"===p){let e=null;try{const t=`tdmfriends:conditions:${i.id}`,n=window.localStorage.getItem(t);if(n){const t=JSON.parse(n).find(e=>"경구"===e.route||"oral"===e.route);e=(null==t?void 0:t.dosageForm)||null}}catch(a){}h=e&&"capsule/tablet"===e.toLowerCase()?25:10}const g=(s||[]).filter(e=>e.patientId===i.id&&e.drugName===o.drugName),x=g.length>0?[...g].sort((e,t)=>nt(e.date,e.time).getTime()-nt(t.date,t.time).getTime())[g.length-1]:void 0,v=Number((null==x?void 0:x.dose)||o.dosage||100),y=(o.tdmTargetValue||"").match(/\d+\.?\d*/g)||[],j=(y[0]&&parseFloat(y[0]),y[1]&&parseFloat(y[1]),async(e,a=7)=>{const l=Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:i.id,selectedDrugName:o.drugName,overrides:{amount:e}});try{const t=await qe({body:l,persist:!1,retries:a}),n=ze(o.tdmTarget,o.tdmTargetValue,t.AUC_24_after??t.AUC_24_before??null,t.CMAX_after??t.CMAX_before??null,t.CTROUGH_after??t.CTROUGH_before??null,o.drugName),r="boolean"==typeof t.Steady_state?t.Steady_state:"true"===String(t.Steady_state).toLowerCase();return{amt:e,resp:t,dataset:(null==l?void 0:l.dataset)||[],isTargetReached:n,isSteadyState:r}}catch(d){const t=d instanceof Error?d.message:String(d),n=d instanceof Error?d.name:"Unknown",r=t.toLowerCase(),a=r.includes("503")||r.includes("service unavailable"),i=r.includes("failed to fetch")||r.includes("networkerror")||r.includes("network error")||"TypeError"===n,s=r.includes("cors")||r.includes("access-control-allow-origin");if(a);else if(i||s){}return{amt:e,resp:null,dataset:(null==l?void 0:l.dataset)||[],isTargetReached:!1,isSteadyState:!1}}});let w=[],N=null;const D=A.find(e=>"dosageAndInterval"===e.type);if(D&&pe[D.id]&&pe[D.id].length>0){const t=pe[D.id].filter(e=>Math.abs(e-v)>=.01);if(t.length>=12){const n=t.slice(0,12),r=[v,...n.filter(e=>e!==v)];he(t=>({...t,[e]:r}));const a=we[D.id];a&&Ne(t=>{const n={...t||{}};return n[e]={...a},n});const i=`${Number(v).toLocaleString()} mg`;return F(t=>({...t,[e]:i})),void xe(t=>({...t,[e]:!1}))}}if(c){const t=A.find(e=>"dosageAndInterval"===e.type);if(t&&pe[t.id]&&pe[t.id].length>0){const n=pe[t.id];if(n.length>=6){const r=[...n];he(t=>({...t,[e]:r}));const a=we[t.id];a&&Ne(t=>{const n={...t||{}};return n[e]={...a},n});const i=`${Number(v).toLocaleString()} mg`;return F(t=>({...t,[e]:i})),void xe(t=>({...t,[e]:!1}))}}}if("미달"===f){let t=v,n=!1,r=0;for(N&&(t=N-h);!n&&t<=v+20*h;){if(t+=h,N&&Math.abs(t-N)<.01){const e=await j(t);if(e.resp&&e.isTargetReached){n=!0;break}N=null;continue}const e=await j(t);if(e.resp){if(r=0,e.isTargetReached){N=t,n=!0;break}}else{if(r++,r>=5)break;await new Promise(e=>setTimeout(e,2e3))}}if(N){const t=(o.tdmTargetValue||"").match(/\d+\.?\d*/g)||[],n=t[0]?parseFloat(t[0]):void 0,r=t[1]?parseFloat(t[1]):void 0,a=e=>{if(!n||!r)return null;const t=Le(o.tdmTarget,e.AUC_24_after??e.AUC_24_before??null,e.CMAX_after??e.CMAX_before??null,e.CTROUGH_after??e.CTROUGH_before??null,o.drugName);if(!t.numericValue)return null;const a=t.numericValue;return a>r?"초과":a<n?"미달":"도달"};let i=!1;for(let s=0;s<12&&!i;s++){const t=N+h*s,n=await j(t);if(!n.resp)continue;Ne(r=>{const a={...r||{}};return a[e]||(a[e]={}),a[e][t]={data:n.resp,dataset:n.dataset||[]},a});const r=a(n.resp);if(n.isTargetReached)w.push(t);else if("초과"===r){i=!0;break}}}else r>=5&&be(t=>({...t,[e]:!0}))}else if("초과"===f){let t=v,n=!1,r=0;for(N&&(t=N+h);!n&&t>=Math.max(1,v-20*h)&&(t-=h,!(t<1));){if(N&&Math.abs(t-N)<.01){const e=await j(t);if(e.resp&&e.isTargetReached){n=!0;break}N=null;continue}const e=await j(t);if(e.resp){if(r=0,e.isTargetReached){N=t,n=!0;break}}else{if(r++,r>=5)break;await new Promise(e=>setTimeout(e,2e3))}}if(N){const t=(o.tdmTargetValue||"").match(/\d+\.?\d*/g)||[],n=t[0]?parseFloat(t[0]):void 0,r=t[1]?parseFloat(t[1]):void 0,a=e=>{if(!n||!r)return null;const t=Le(o.tdmTarget,e.AUC_24_after??e.AUC_24_before??null,e.CMAX_after??e.CMAX_before??null,e.CTROUGH_after??e.CTROUGH_before??null,o.drugName);if(!t.numericValue)return null;const a=t.numericValue;return a>r?"초과":a<n?"미달":"도달"};let i=!1;for(let s=0;s<12&&!i;s++){const t=N-h*s;if(t<1)continue;const n=await j(t);if(!n.resp)continue;Ne(r=>{const a={...r||{}};return a[e]||(a[e]={}),a[e][t]={data:n.resp,dataset:n.dataset||[]},a});const r=a(n.resp);if(n.isTargetReached)w.push(t);else if("미달"===r){i=!0;break}}}else r>=5&&be(t=>({...t,[e]:!0}))}else if(c){const t=(o.tdmTargetValue||"").match(/\d+\.?\d*/g)||[],n=t[0]?parseFloat(t[0]):void 0,r=t[1]?parseFloat(t[1]):void 0,a=e=>{if(!n||!r)return null;const t=Le(o.tdmTarget,e.AUC_24_after??e.AUC_24_before??null,e.CMAX_after??e.CMAX_before??null,e.CTROUGH_after??e.CTROUGH_before??null,o.drugName);if(!t.numericValue)return null;const a=t.numericValue;return a>r?"초과":a<n?"미달":"도달"};let i=0,s=!1,l=!1;for(let o=6;o>=1&&!s;o--){const t=v-h*o;if(t<1)continue;const n=await j(t);if(!n.resp){if(i++,i>=5)break;await new Promise(e=>setTimeout(e,2e3));continue}i=0,Ne(r=>{const a={...r||{}};return a[e]||(a[e]={}),a[e][t]={data:n.resp,dataset:n.dataset},a});const r=a(n.resp);if(n.isTargetReached)w.push(t);else if("미달"===r){s=!0;break}}w.push(v);for(let o=1;o<=6&&!l;o++){const t=v+h*o,n=await j(t);if(!n.resp){if(i++,i>=5)break;await new Promise(e=>setTimeout(e,2e3));continue}i=0,Ne(r=>{const a={...r||{}};return a[e]||(a[e]={}),a[e][t]={data:n.resp,dataset:n.dataset},a});const r=a(n.resp);if(n.isTargetReached)w.push(t);else if("초과"===r){l=!0;break}}w.sort((e,t)=>e-t)}let k=[];if("미달"===f){const e=w.slice(0,12);k=[v,...e.filter(e=>e!==v)],k.sort((e,t)=>e-t)}else if("초과"===f){const e=w.slice(0,12);k=[v,...e.filter(e=>e!==v)],k.sort((e,t)=>t-e)}else if(c)k=w;else{const e=w.slice(0,12);k=[v,...e.filter(e=>e!==v)],k.sort((e,t)=>e-t)}he(t=>({...t,[e]:k}));const S=`${Number(v).toLocaleString()} mg`;F(t=>({...t,[e]:S}))}catch(a){const t=a instanceof Error?a.message:String(a);(t.toLowerCase().includes("failed to fetch")||t.toLowerCase().includes("networkerror")||a instanceof TypeError)&&alert("네트워크 오류가 발생했습니다.\n\n가능한 원인:\n- 인터넷 연결 문제\n- 서버가 일시적으로 사용 불가능한 상태\n- CORS 설정 문제\n\n잠시 후 다시 시도해주세요."),be(t=>({...t,[e]:!0}))}finally{xe(t=>({...t,[e]:!1}))}},className:"w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center hover:bg-gray-900 active:bg-gray-800 dark:bg-black dark:hover:bg-gray-800 dark:active:bg-gray-700",children:"용량 조정하기"}),e.jsx(se,{onClick:()=>{gt&&xt("");const e=A.length+1;E(t=>[...t,{id:e,type:"interval"}]),ue(t=>({...t,[e]:!1})),lt(e)},className:"w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center hover:bg-gray-900 active:bg-gray-800 dark:bg-black dark:hover:bg-gray-800 dark:active:bg-gray-700",children:"시간 조정하기"}),e.jsx(se,{onClick:async()=>{gt&&xt("");const e=A.length+1;E(t=>[...t,{id:e,type:"dosageAndInterval"}]),ue(t=>({...t,[e]:!0})),X(t=>({...t,[e]:""})),Q(t=>({...t,[e]:""})),xe(t=>({...t,[e]:!0})),be(t=>({...t,[e]:!1})),lt(e);try{if(!d||!u)return;const o=Ie;if(!o)return;const l=Me.find(e=>e.drugName===u)||Me[0];if(!l)return;let c=b;if(!c)try{const e=`tdmfriends:tdmResults:${d}:${u}`,t=window.localStorage.getItem(e);if(t){const e=[...JSON.parse(t)].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())[0];e&&e.data&&(c=e.data)}}catch(a){}if(!c)return void xe(t=>({...t,[e]:!1}));const m=ze(l.tdmTarget,l.tdmTargetValue,c.AUC_24_after??c.AUC_24_before??null,c.CMAX_after??c.CMAX_before??null,c.CTROUGH_after??c.CTROUGH_before??null,l.drugName),f=Le(l.tdmTarget,c.AUC_24_after??c.AUC_24_before??null,c.CMAX_after??c.CMAX_before??null,c.CTROUGH_after??c.CTROUGH_before??null,l.drugName),p=(()=>{if(!l.tdmTargetValue||!f.numericValue)return null;const e=l.tdmTargetValue.match(/(\d+(?:\.\d+)?)\s*-\s*(\d+(?:\.\d+)?)/);if(!e)return null;const t=parseFloat(e[1]),n=parseFloat(e[2]),r=f.numericValue;return r>n?"초과":r<t?"미달":"도달"})(),h=(l.drugName||"").toLowerCase();let g=10;if("cyclosporin"===h||"cyclosporine"===h){let e=null;try{const t=`tdmfriends:conditions:${o.id}`,n=window.localStorage.getItem(t);if(n){const t=JSON.parse(n).find(e=>"경구"===e.route||"oral"===e.route);e=(null==t?void 0:t.dosageForm)||null}}catch(a){}g=e&&"capsule/tablet"===e.toLowerCase()?25:10}const x=(s||[]).filter(e=>e.patientId===o.id&&e.drugName===l.drugName),v=x.length>0?[...x].sort((e,t)=>nt(e.date,e.time).getTime()-nt(t.date,t.time).getTime())[x.length-1]:void 0,y=Number((null==v?void 0:v.dose)||l.dosage||100),j=null==v?void 0:v.intervalHours,w=(l.tdmTargetValue||"").match(/\d+\.?\d*/g)||[],N=(w[0]&&parseFloat(w[0]),w[1]&&parseFloat(w[1]),async(e,a=5)=>{const d=(null==v?void 0:v.intervalHours)||((null==i?void 0:i.frequency)?(()=>{const e=i.frequency.match(/\d+/);return e?parseInt(e[0],10):12})():12),c=Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:o.id,selectedDrugName:l.drugName,overrides:{amount:e,tau:d}});try{const t=await qe({body:c,persist:!1,retries:a}),n=ze(l.tdmTarget,l.tdmTargetValue,t.AUC_24_after??t.AUC_24_before??null,t.CMAX_after??t.CMAX_before??null,t.CTROUGH_after??t.CTROUGH_before??null,l.drugName),r="boolean"==typeof t.Steady_state?t.Steady_state:"true"===String(t.Steady_state).toLowerCase();return{amt:e,resp:t,dataset:(null==c?void 0:c.dataset)||[],isTargetReached:n,isSteadyState:r}}catch(u){const t=u instanceof Error?u.message:String(u),n=u instanceof Error?u.name:"Unknown",r=t.toLowerCase(),a=r.includes("503")||r.includes("service unavailable"),i=r.includes("failed to fetch")||r.includes("networkerror")||r.includes("network error")||"TypeError"===n,s=r.includes("cors")||r.includes("access-control-allow-origin");if(a);else if(i||s){}return{amt:e,resp:null,dataset:(null==c?void 0:c.dataset)||[],isTargetReached:!1,isSteadyState:!1}}});let D=[],k=null;const S=A.find(e=>"dosageV2"===e.type);if(S&&pe[S.id]&&pe[S.id].length>0){const t=pe[S.id].filter(e=>Math.abs(e-y)>=.01);if(t.length>=12){const n=t.slice(0,12),r=[y,...n.filter(e=>e!==y)];he(t=>({...t,[e]:r}));const a=we[S.id];a&&Ne(t=>{const n={...t||{}};return n[e]={...a},n});const i=`${Number(y).toLocaleString()} mg`;if(F(t=>({...t,[e]:i})),j){const t=j,n=et.find(e=>Fe(e.label)===t);if(n)H(t=>({...t,[e]:n.label}));else{const n=Number.isInteger(t)&&t>=1?String(t):t.toString(),r=`직접 입력 (${n}시간)`;H(t=>({...t,[e]:r})),Q(t=>({...t,[e]:n}))}}return void xe(t=>({...t,[e]:!1}))}}if(m){const t=A.find(e=>"dosageV2"===e.type);if(t&&pe[t.id]&&pe[t.id].length>0){const n=pe[t.id];if(n.length>=6){const r=[...n];he(t=>({...t,[e]:r}));const a=we[t.id];a&&Ne(t=>{const n={...t||{}};return n[e]={...a},n});const i=`${Number(y).toLocaleString()} mg`;if(F(t=>({...t,[e]:i})),j){const t=j,n=et.find(e=>Fe(e.label)===t);if(n)H(t=>({...t,[e]:n.label}));else{const n=Number.isInteger(t)&&t>=1?String(t):t.toString(),r=`직접 입력 (${n}시간)`;H(t=>({...t,[e]:r})),Q(t=>({...t,[e]:n}))}}return void xe(t=>({...t,[e]:!1}))}}}if("미달"===p){let t=y,n=!1,r=0;for(k&&(t=k-g);!n&&t<=y+20*g;){if(t+=g,k&&Math.abs(t-k)<.01){const e=await N(t);if(e.resp&&e.isTargetReached){n=!0;break}k=null;continue}const e=await N(t);if(e.resp){if(r=0,e.isTargetReached){k=t,n=!0;break}}else{if(r++,r>=5)break;await new Promise(e=>setTimeout(e,2e3))}}if(k)for(let e=0;e<12;e++){const t=k+g*e;D.push(t)}else r>=5&&be(t=>({...t,[e]:!0}))}else if("초과"===p){let t=y,n=!1,r=0;for(k&&(t=k+g);!n&&t>=Math.max(1,y-20*g)&&(t-=g,!(t<1));){if(k&&Math.abs(t-k)<.01){const e=await N(t);if(e.resp&&e.isTargetReached){n=!0;break}k=null;continue}const e=await N(t);if(e.resp){if(r=0,e.isTargetReached){k=t,n=!0;break}}else{if(r++,r>=5)break;await new Promise(e=>setTimeout(e,2e3))}}if(k)for(let e=0;e<12;e++){const t=k-g*e;t>=1&&D.push(t)}else r>=5&&be(t=>({...t,[e]:!0}))}else if(m){const t=(l.tdmTargetValue||"").match(/\d+\.?\d*/g)||[],n=t[0]?parseFloat(t[0]):void 0,r=t[1]?parseFloat(t[1]):void 0,a=e=>{if(!n||!r)return null;const t=Le(l.tdmTarget,e.AUC_24_after??e.AUC_24_before??null,e.CMAX_after??e.CMAX_before??null,e.CTROUGH_after??e.CTROUGH_before??null,l.drugName);if(!t.numericValue)return null;const a=t.numericValue;return a>r?"초과":a<n?"미달":"도달"};let i=0,s=!1,o=!1;for(let l=6;l>=1&&!s;l--){const t=y-g*l;if(t<1)continue;const n=await N(t);if(!n.resp){if(i++,i>=5)break;await new Promise(e=>setTimeout(e,2e3));continue}i=0,Ne(r=>{const a={...r||{}};return a[e]||(a[e]={}),a[e][t]={data:n.resp,dataset:n.dataset},a});const r=a(n.resp);if(n.isTargetReached)D.push(t);else if("미달"===r){s=!0;break}}D.push(y);for(let l=1;l<=6&&!o;l++){const t=y+g*l,n=await N(t);if(!n.resp){if(i++,i>=5)break;await new Promise(e=>setTimeout(e,2e3));continue}i=0,Ne(r=>{const a={...r||{}};return a[e]||(a[e]={}),a[e][t]={data:n.resp,dataset:n.dataset},a});const r=a(n.resp);if(n.isTargetReached)D.push(t);else if("초과"===r){o=!0;break}}D.sort((e,t)=>e-t)}let T=[];if("미달"===p){const e=D.slice(0,12);T=[y,...e.filter(e=>e!==y)],T.sort((e,t)=>e-t)}else if("초과"===p){const e=D.slice(0,12);T=[y,...e.filter(e=>e!==y)],T.sort((e,t)=>t-e)}else if(m)T=D;else{const e=D.slice(0,12);T=[y,...e.filter(e=>e!==y)],T.sort((e,t)=>e-t)}he(t=>({...t,[e]:T}));const C=`${Number(y).toLocaleString()} mg`;if(F(t=>({...t,[e]:C})),j){const t=j,n=et.find(e=>Fe(e.label)===t);if(n)H(t=>({...t,[e]:n.label}));else{const n=Number.isInteger(t)&&t>=1?String(t):t.toString(),r=`직접 입력 (${n}시간)`;H(t=>({...t,[e]:r})),Q(t=>({...t,[e]:n}))}}}catch(a){const t=a instanceof Error?a.message:String(a);(t.toLowerCase().includes("failed to fetch")||t.toLowerCase().includes("networkerror")||a instanceof TypeError)&&alert("네트워크 오류가 발생했습니다.\n\n가능한 원인:\n- 인터넷 연결 문제\n- 서버가 일시적으로 사용 불가능한 상태\n- CORS 설정 문제\n\n잠시 후 다시 시도해주세요."),be(t=>({...t,[e]:!0}))}finally{xe(t=>({...t,[e]:!1}))}},className:"w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center hover:bg-gray-900 active:bg-gray-800 dark:bg-black dark:hover:bg-gray-800 dark:active:bg-gray-700",children:"용량&시간 조정하기"})]})]})}),e.jsx(W,{open:ee,onOpenChange:te,children:e.jsxs(z,{children:[e.jsxs(K,{children:[e.jsx(B,{children:"용법 조정 카드 삭제"}),e.jsx(G,{children:"이 용법 조정 카드를 삭제하시겠습니까? 삭제된 카드의 설정은 복구할 수 없습니다."})]}),e.jsxs(Y,{children:[e.jsx(q,{onClick:()=>{te(!1),de(null)},children:"취소"}),e.jsx(J,{onClick:()=>{null!==le&&(E(e=>e.filter(e=>e.id!==le)),F(e=>{const t={...e};return delete t[le],t}),X(e=>{const t={...e};return delete t[le],t}),H(e=>{const t={...e};return delete t[le],t}),ue(e=>{const t={...e};return delete t[le],t}),ke(e=>{const t={...e};return delete t[le],t}),Te(e=>{const t={...e};return delete t[le],t}),_e(e=>{const t={...e};return delete t[le],t}),be(e=>{const t={...e};return delete t[le],t}),setTimeout(()=>{0===A.filter(e=>e.id!==le).length&&Qe(d,u,!1)},0)),te(!1),de(null)},children:"삭제"})]})]})}),e.jsx(W,{open:ne,onOpenChange:re,children:e.jsxs(z,{children:[e.jsxs(K,{children:[e.jsx(B,{children:"차트 그리기 불가"}),e.jsx(G,{children:"데이터가 방대하여 차트를 그릴 수 없습니다."})]}),e.jsx(Y,{children:e.jsx(J,{onClick:()=>re(!1),children:"확인"})})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-muted-foreground",children:[e.jsx("p",{className:"text-lg font-semibold",children:"환자와 약물을 먼저 선택해 주세요."}),e.jsx("p",{className:"text-sm mt-2",children:"이전 단계에서 환자, TDM 약물, 혈액검사 정보를 모두 입력해야 시뮬레이션이 가능합니다."})]})},Ho=({patients:t,prescriptions:n,bloodTests:r,selectedPatient:a,selectedPrescription:i,drugAdministrations:s,onPrev:o})=>{const[l,d]=N.useState(null),[c,u]=N.useState(!1),[m,f]=N.useState(!1);N.useEffect(()=>{if(a)try{const e=window.localStorage.getItem(`tdmfriends:tdmResult:${a.id}`);d(e?JSON.parse(e):null)}catch{d(null)}else d(null)},[null==a?void 0:a.id]);const p=async()=>{var e;f(!0),await new Promise(e=>setTimeout(e,0));const t=document.getElementById("pk-simulation-content");if(!t)return f(!1),void alert("보고서 내용을 찾을 수 없습니다.");const n=document.documentElement.classList.contains("dark");try{const r=document.querySelector("[data-report-button]");r&&(r.disabled=!0,r.textContent="PDF 생성 중..."),n&&(document.documentElement.classList.remove("dark"),await new Promise(e=>setTimeout(e,100)));const s=t.querySelectorAll("div");let o=null;for(const t of Array.from(s)){const n=t.querySelector("h2");if(n&&(null==(e=n.textContent)?void 0:e.includes("용법 조정 시뮬레이션을 진행하시겠습니까?"))){o=t;break}}let l=null;o&&(l=o.style.display,o.style.display="none");const d=(new Date).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),c=`${(null==a?void 0:a.name)||"환자"} 환자의 ${(null==i?void 0:i.drugName)||"약품"} TDM분석 보고서 - ${d}`,u=document.createElement("div");u.style.cssText="\n        width: 100%;\n        padding: 12px 0;\n        margin-bottom: 16px;\n        font-size: 18px;\n        font-weight: bold;\n        text-align: center;\n        color: #000;\n        background-color: #ffffff;\n        border-bottom: 2px solid #000;\n      ",u.textContent=c,t.insertBefore(u,t.firstChild);const m=await et(t,{scale:1.5,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1,width:t.scrollWidth,height:t.scrollHeight,scrollX:0,scrollY:0});t.removeChild(u),o&&(o.style.display=l||"");m.toDataURL("image/png",.95);const f=15,p=210-2*f,h=297-2*f,g=m.width,x=m.height,v=p/g,b=p,y=x*v,j=h,w=Math.ceil(y/j),N=j/v,D=new tt({orientation:"portrait",unit:"mm",format:"a4"});for(let e=0;e<w;e++){e>0&&D.addPage();const t=e*N,n=Math.min(N,x-t),r=document.createElement("canvas");r.width=g,r.height=n;const a=r.getContext("2d");a&&a.drawImage(m,0,t,g,n,0,0,g,n);const i=r.toDataURL("image/png",.95),s=n*v;D.addImage(i,"PNG",f,f,b,s,void 0,"FAST")}const k=`${(null==a?void 0:a.name)||"환자"}_${(null==i?void 0:i.drugName)||"약품"}_TDM_분석보고서_${(new Date).toISOString().split("T")[0]}.pdf`;D.save(k),r&&(r.disabled=!1,r.textContent="TDM 분석 보고서 생성"),n&&document.documentElement.classList.add("dark")}catch(r){alert("PDF 생성 중 오류가 발생했습니다: "+(r instanceof Error?r.message:String(r)));const e=document.querySelector("[data-report-button]");e&&(e.disabled=!1,e.textContent="TDM 분석 보고서 생성"),n&&document.documentElement.classList.add("dark")}finally{f(!1)}};if(!a)return e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"TDM Simulation"]}),e.jsx(ae,{children:"시뮬레이션을 진행하려면 환자를 먼저 선택해주세요."})]}),e.jsx(ie,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(De,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold mb-2",children:"환자를 선택해주세요"}),e.jsx("p",{className:"text-muted-foreground",children:"환자 등록 및 선택 단계에서 환자를 선택한 후 시뮬레이션을 진행할 수 있습니다."})]})})]});n.filter(e=>e.patientId===a.id),!i||r.filter(e=>e.patientId===a.id&&e.drugName===i.drugName);const h=i?s.filter(e=>e.patientId===a.id&&e.drugName===i.drugName):[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"TDM Simulation",e.jsx(pe,{className:"h-5 w-5 text-green-600"})]}),e.jsxs(ae,{children:[a.name," 환자의 TDM 분석 결과를 확인하고 약물 요법을 직접 시뮬레이션 해보세요."]})]}),e.jsxs(ie,{children:[e.jsx("div",{id:"pk-simulation-content",children:e.jsx(Vo,{patients:t,prescriptions:n,bloodTests:r,selectedPatient:a,selectedPrescription:i,drugAdministrations:h,onDownloadPDF:p,forceExpandPatientDetails:m})}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsxs(se,{variant:"outline",onClick:o,className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"투약 기록"]}),e.jsxs(se,{onClick:()=>{u(!0)},className:"flex items-center gap-2","data-report-button":!0,children:[e.jsx(ke,{className:"h-4 w-4"}),"TDM 분석 보고서 생성"]})]})]})]}),e.jsx(W,{open:c,onOpenChange:u,children:e.jsxs(z,{children:[e.jsxs(K,{children:[e.jsx(B,{children:"TDM 분석 보고서를 생성하시겠습니까?"}),e.jsx(G,{children:"현재 화면의 TDM 분석 결과를 PDF 파일로 다운로드합니다. 환자 정보, 차트, 용법 조정 결과가 포함됩니다."})]}),e.jsxs(Y,{children:[e.jsx(q,{onClick:()=>{u(!1)},children:"취소"}),e.jsx(J,{onClick:async()=>{u(!1),await p()},className:"bg-black dark:bg-primary text-white dark:text-primary-foreground hover:bg-gray-800 dark:hover:bg-primary/90",children:"보고서 생성"})]})]})})]})},Uo=({row:t,onUpdate:n,isDarkMode:r,readOnly:a=!1})=>{if(a)return e.jsx("div",{style:{textAlign:"center",width:"100%",color:r?"#e0e6f0":void 0,minHeight:"24px",lineHeight:"24px"},children:t.injectionTime??"-"});const[i,s]=N.useState(t.injectionTime),[o,l]=N.useState(!1);N.useEffect(()=>{o||s(t.injectionTime)},[t.injectionTime,o]);return e.jsx("input",{type:"text",value:i,onChange:e=>{s(e.target.value)},onFocus:e=>{l(!0),e.target.setSelectionRange(e.target.value.length,e.target.value.length)},onBlur:e=>{l(!1),n(t.id,"injectionTime",e.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()},style:{border:"none",background:"transparent",textAlign:"center",width:"100%",color:r?"#e0e6f0":void 0}})},Wo=({row:t,onUpdate:n,isDarkMode:r})=>{const[a,i]=N.useState(t.timeStr),[s,o]=N.useState(!1);N.useEffect(()=>{s||i(t.timeStr)},[t.timeStr,s]);return e.jsx("input",{type:"text",value:a,onChange:e=>{i(e.target.value)},onFocus:e=>{o(!0),e.target.select()},onBlur:e=>{o(!1);let r=e.target.value.toString().replace(/undefined/g,"").trim();if(/^\d{12}$/.test(r)){const e=r.substring(0,4),t=r.substring(4,6),n=r.substring(6,8),a=r.substring(8,10),i=r.substring(10,12);r=`${e}-${t}-${n} ${a}:${i}`}else if(/^\d{11}$/.test(r)){const e=r.substring(0,4),t=r.substring(4,6),n=r.substring(6,8),a=r.substring(8,10),i=r.substring(10,11);r=`${e}-${t}-${n} ${a}:0${i}`}else if(/^\d{10}$/.test(r)){const e=r.substring(0,4),t=r.substring(4,6),n=r.substring(6,8),a=r.substring(8,10);r=`${e}-${t}-${n} ${a}:00`}else if(r.includes(" ")&&r.includes(":")&&!r.includes("-")){const e=r.split(" ");if(4===e.length){const[t,n,a,i]=e;r=`${t}-${n.padStart(2,"0")}-${a.padStart(2,"0")} ${i}`}}n(t.id,"timeStr",r)},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()},placeholder:"YYYY-MM-DD HH:MM",style:{border:"none",background:"transparent",textAlign:"center",width:"100%",color:r?"#e0e6f0":void 0}})};function zo(t){var n,r,a,i,s,o;const l=e=>"IV"===e?"정맥":"oral"===e?"경구":"subcutaneous"===e?"피하":"intramuscular"===e?"근육":e||"",[d,c]=N.useState({route:"",dosage:"",unit:"mg",intervalHours:"",injectionTime:"",dosageForm:"",firstDoseDate:"",firstDoseTime:"",totalDoses:""}),u=N.useCallback(()=>{var e;return t.selectedPatient&&(null==(e=t.tdmDrug)?void 0:e.drugName)?`tdmfriends:conditions:${t.selectedPatient.id}:${t.tdmDrug.drugName}`:null},[t.selectedPatient,null==(n=t.tdmDrug)?void 0:n.drugName]),m=N.useCallback(()=>{const e=u();if(!e)return null;try{const t=localStorage.getItem(e);if(t)return JSON.parse(t)}catch(t){}return null},[u]),f=N.useRef(null),[p,h]=N.useState(()=>m()||t.initialConditions||[]),[g,x]=N.useState(t.initialTableData||[]),[v,b]=N.useState(t.initialIsTableGenerated||!1),[y,j]=N.useState(!0),[w,D]=N.useState(null),[k,S]=N.useState(new Set);N.useState(null);const[T,C]=N.useState(!1),[_,I]=N.useState(null);N.useState("table");const[M,O]=N.useState(""),[$,P]=N.useState(!1),R=N.useRef(!1),A=N.useRef(t.onRecordsChange);N.useEffect(()=>{A.current=t.onRecordsChange},[t.onRecordsChange]);const E=N.useRef(t.onConditionsChange);N.useEffect(()=>{E.current=t.onConditionsChange},[t.onConditionsChange]);const L=N.useRef(null),F=N.useRef(null),V=N.useRef(null);N.useEffect(()=>{const e=()=>P(document.documentElement.classList.contains("dark"));return e(),window.addEventListener("transitionend",e),window.addEventListener("click",e),window.addEventListener("keydown",e),()=>{window.removeEventListener("transitionend",e),window.removeEventListener("click",e),window.removeEventListener("keydown",e)}},[]),N.useEffect(()=>{const e=t.initialAdministrations||[];if(e&&0!==e.length)try{const t={id:"title",round:"회차",time:"투약 시간",amount:"투약용량",route:"투약경로",injectionTime:"주입시간(분)",isTitle:!0},n=e.map((t,n)=>{const r=`${t.date} ${t.time}`,a=new Date(`${t.date}T${t.time}`),i=t.dosageForm||"";return{id:String(t.id||`${Date.now()}_${n}`),conditionId:null,doseIndex:n+1,totalDoses:e.length,time:a,timeStr:r,amount:`${t.dose} ${t.unit||"mg"}`,route:t.route,injectionTime:t.isIVInfusion?void 0!==t.infusionTime?String(t.infusionTime):"0":"-",dosageForm:"경구"===t.route||"oral"===t.route?i:"",isTitle:!1}}).sort((e,t)=>e.time-t.time);n.forEach((e,t)=>{e.round=`${t+1} 회차`}),R.current=!0,x([t,...n]),b(!0),setTimeout(()=>{R.current=!1},0)}catch{}},[t.initialAdministrations]),N.useEffect(()=>{if(!A.current)return;if(R.current)return void(R.current=!1);const e=g.filter(e=>!e.isTitle).map(e=>{const t=e.conditionId?p.find(t=>t.id===e.conditionId):null;return{timeStr:e.timeStr,amount:e.amount,route:e.route,injectionTime:e.injectionTime,conditionId:e.conditionId,intervalHours:t?Number(t.intervalHours):void 0}});try{const t=JSON.stringify(e);if(L.current===t)return;L.current=t}catch{}A.current(e)},[g,p]);const H=N.useRef({tableRowCount:0,conditionsTotalDoses:0}),[U,W]=N.useState(!1),z=N.useRef({tableRowCount:0,conditionsTotalDoses:0});N.useEffect(()=>{if(!v||0===p.length)return;if(R.current)return;const e=g.filter(e=>!e.isTitle).length,t=p.reduce((e,t)=>e+(parseInt(t.totalDoses)||0),0);H.current.tableRowCount===e&&H.current.conditionsTotalDoses===t?U&&e===t&&W(!1):(H.current={tableRowCount:e,conditionsTotalDoses:t},e!==t&&e>0?(W(!0),z.current={tableRowCount:e,conditionsTotalDoses:t}):W(!1))},[g,p,v,U]);const K=N.useCallback(()=>{if(!U)return!1;const e=z.current.tableRowCount;z.current.conditionsTotalDoses;const n=B(g,p);if(n&&n.length>0){if(R.current=!0,h(n),H.current={tableRowCount:e,conditionsTotalDoses:n.reduce((e,t)=>e+(parseInt(t.totalDoses)||0),0)},setTimeout(()=>{R.current=!1},0),W(!1),t.selectedPatient&&t.tdmDrug){const e=g.filter(e=>!e.isTitle&&e.timeStr).sort((e,t)=>{const n=new Date(e.timeStr);return new Date(t.timeStr).getTime()-n.getTime()});if(e.length>0){const r=e[0],a=n.find(e=>{if(!e.firstDoseDate||!e.firstDoseTime)return!1;const t=new Date(`${e.firstDoseDate}T${e.firstDoseTime}`),n=parseInt(e.intervalHours)||12,a=parseInt(e.totalDoses)||1,i=new Date(t.getTime()+(a-1)*n*60*60*1e3),s=new Date(r.timeStr);return s>=t&&s<=i})||n[n.length-1];if(a){const e=l(a.route),n="정맥"===e?1:2;nt(t.selectedPatient.id,t.tdmDrug.drugName,{amount:parseFloat(a.dosage)||0,tau:parseFloat(a.intervalHours)||12,cmt:n,route:e,infusionTime:parseFloat(a.injectionTime)||void 0})}}}return!0}return!1},[U,g,p,t.selectedPatient,t.tdmDrug]);N.useEffect(()=>{t.onUpdateNeeded&&t.onUpdateNeeded(U,z.current,K)},[U,K,t.onUpdateNeeded]);const B=(e,t)=>{const n=e.filter(e=>!e.isTitle&&e.timeStr);if(0===n.length)return t;const r=n.length;t.reduce((e,t)=>e+(parseInt(t.totalDoses)||0),0);const a=[...t].sort((e,t)=>{if(!(e.firstDoseDate&&e.firstDoseTime&&t.firstDoseDate&&t.firstDoseTime))return 0;const n=new Date(`${e.firstDoseDate}T${e.firstDoseTime}`),r=new Date(`${t.firstDoseDate}T${t.firstDoseTime}`);return n.getTime()-r.getTime()}),i=[...n].sort((e,t)=>{const n=new Date(e.timeStr),r=new Date(t.timeStr);return n.getTime()-r.getTime()}),s=a.map(e=>{if(!e.firstDoseDate||!e.firstDoseTime)return e;const t=new Date(`${e.firstDoseDate}T${e.firstDoseTime}`),n=parseInt(e.intervalHours)||12,r=parseInt(e.totalDoses)||1,a=new Date(t.getTime()+(r-1)*n*60*60*1e3),s=i.filter(e=>{const n=new Date(e.timeStr);return n>=t&&n<=a}).length;return s>0?{...e,totalDoses:String(s)}:e}),o=r-s.reduce((e,t)=>e+(parseInt(t.totalDoses)||0),0);if(0!==o&&s.length>0){const e=s[s.length-1],t=parseInt(e.totalDoses)||0,n=Math.max(1,t+o);s[s.length-1]={...e,totalDoses:String(n)}}return s};N.useEffect(()=>{const e=u();if(e){try{const t=localStorage.getItem(e);if(t){const e=JSON.parse(t);if(e&&e.length>0)return void h(e)}}catch(n){}t.initialConditions&&t.initialConditions.length>0&&h(t.initialConditions)}else t.initialConditions&&t.initialConditions.length>0?h(t.initialConditions):h([])},[null==(r=t.selectedPatient)?void 0:r.id,null==(a=t.tdmDrug)?void 0:a.drugName,u]),N.useEffect(()=>{const e=u();if(e)try{const t=localStorage.getItem(e),n=t?JSON.parse(t):null,r=JSON.stringify(p);if(n&&JSON.stringify(n)===r)return;localStorage.setItem(e,r)}catch(t){}},[p,u]),N.useEffect(()=>{E.current&&E.current(p)},[p]),N.useEffect(()=>{y&&j(!1)},[y]),N.useEffect(()=>{let e=!1;const n=u();if(n)try{const e=localStorage.getItem(n);if(e){const t=JSON.parse(e);if(t&&t.length>0)return}}catch(r){}if(t.initialConditions&&t.initialConditions.length>0&&(h(t.initialConditions),e=!0),t.initialTableData){R.current=!0;const n=t.initialTableData.map(e=>e.isTitle||"정맥"!==e.route||e.injectionTime&&"-"!==e.injectionTime?e.isTitle||"정맥"===e.route||"0"!==e.injectionTime?e:{...e,injectionTime:"-"}:{...e,injectionTime:"0"});x(n),e=!0}void 0!==t.initialIsTableGenerated&&(b(t.initialIsTableGenerated),e=!0),e&&setTimeout(()=>{R.current=!1},0)},[t.initialConditions,t.initialTableData,t.initialIsTableGenerated]);const G=[{value:"경구",label:"경구 (oral)",disabled:"vancomycin"===(null==(s=null==(i=t.tdmDrug)?void 0:i.drugName)?void 0:s.toLowerCase())},{value:"정맥",label:"정맥 (IV)"}],Y=e=>{var n;if(!e.firstDoseDate||!e.firstDoseTime)return"날짜와 시간을 입력해주세요";const r=(null==(n=t.tdmDrug)?void 0:n.drugName)||"약물",a=e.unit?e.unit:"mg",i=e.dosage?`${e.dosage} ${a}`:`0 ${a}`;let s="";if("경구"===e.route||"oral"===e.route){if(s="PO",e.dosageForm){s=`PO (${"capsule/tablet"===e.dosageForm?"Cap/Tab":"oral liquid"===e.dosageForm?"현탁/액제":e.dosageForm})`}}else"정맥"===e.route||"IV"===e.route?(s="IV",e.injectionTime&&"-"!==e.injectionTime&&""!==e.injectionTime&&(s=`IV (${e.injectionTime}분 주입)`)):s=e.route||"-";return`${r} ${i} | ${s} | ${e.intervalHours?`${e.intervalHours}h 간격`:"간격 정보 없음"} | ${e.totalDoses?`총 ${e.totalDoses}회`:"횟수 정보 없음"} (시작: ${`${e.firstDoseDate||"날짜 정보 없음"} ${e.firstDoseTime||""}`})`.trim()},q=(e,n)=>{c(r=>{var a,i,s;const o={...r,[e]:n};if("route"===e&&(null==(a=t.tdmDrug)?void 0:a.drugName)){"cyclosporin"!==(null==(i=t.tdmDrug.drugName)?void 0:i.toLowerCase())&&"cyclosporine"!==(null==(s=t.tdmDrug.drugName)?void 0:s.toLowerCase())||"경구"!==n&&"oral"!==n?o.dosageForm="":o.dosageForm||(o.dosageForm="capsule/tablet");const e=((e,t)=>{if(!e||!t)return"mg";const n=e.toLowerCase(),r=t.toLowerCase();if("vancomycin"===n)return"mg";if("cyclosporin"===n){if("정맥"===r||"iv"===r)return"mg";if("경구"===r||"oral"===r)return"mg"}return"mg"})(t.tdmDrug.drugName,n);e&&(o.unit=e)}return o})};N.useEffect(()=>{if(0===p.length)return F.current=null,void(V.current=null);if(p.some(e=>!(e=>{if(!(e.route&&e.dosage&&e.unit&&e.intervalHours&&e.firstDoseDate&&e.firstDoseTime&&e.totalDoses))return!1;if("정맥"===e.route||"IV"===e.route){const t=(e.injectionTime??"").toString().trim();if(!t||"-"===t)return!1}return!0})(e)))return;const e=(e=>{const t=e.map(e=>({id:String(e.id??""),route:e.route??"",dosage:e.dosage??"",unit:e.unit??"",intervalHours:e.intervalHours??"",injectionTime:"정맥"===e.route||"IV"===e.route?e.injectionTime??"":"",firstDoseDate:e.firstDoseDate??"",firstDoseTime:e.firstDoseTime??"",totalDoses:e.totalDoses??""}));return t.sort((e,t)=>e.id.localeCompare(t.id)),JSON.stringify(t)})(p);if(e===F.current)return;if(e===V.current&&e!==F.current)return;V.current=e;(()=>{var e;if(0===p.length)return alert("최소 1개의 조건을 추가해주세요!"),!1;for(let t of p){if(!(t.totalDoses&&t.intervalHours&&t.firstDoseDate&&t.firstDoseTime&&t.dosage&&t.route&&t.unit))return alert("모든 필드를 입력해주세요!"),!1;if("정맥"===t.route||"IV"===t.route){const n=null==(e=t.injectionTime)?void 0:e.trim();if(!n||""===n||"-"===n)return alert("정맥 투약 경로를 선택한 조건이 있습니다. 주입시간(분)을 반드시 입력해주세요.\n\nbolus 투여 시에는 0을 입력해주세요."),!1;const r=parseFloat(n);if(isNaN(r)||r<0)return alert("주입시간은 0 이상의 숫자로 입력해주세요.\n\nbolus 투여 시에는 0을 입력해주세요."),!1}}const n=p.map(e=>{const t=parseInt(e.totalDoses),n=parseInt(e.intervalHours),r=`${e.firstDoseDate}T${e.firstDoseTime}`,a=new Date(r),i=new Date(a.getTime()+(t-1)*n*60*60*1e3);return{start:a,end:i}});for(let t=0;t<n.length;t++)for(let e=t+1;e<n.length;e++)if(n[t].start<=n[e].end&&n[e].start<=n[t].end)return O("중복된 투약일정이 있습니다. 투약일시를 다시 확인해주세요."),!1;let r=[];r.push({id:"title",round:"회차",time:"투약 시간",amount:"투약용량",route:"투약경로",injectionTime:"주입시간",isTitle:!0});let a=[];p.forEach(e=>{const t=parseInt(e.totalDoses),n=parseInt(e.intervalHours),r=e.unit,i=`${e.firstDoseDate}T${e.firstDoseTime}`,s=new Date(i),o=e.route,l=e.injectionTime,d=e.dosageForm;for(let c=0;c<t;c++){const i=new Date(s.getTime()+c*n*60*60*1e3),u=("경구"===o||"oral"===o)&&d||"";a.push({id:`${e.id}_${c+1}`,conditionId:e.id,doseIndex:c+1,totalDoses:t,time:i,timeStr:`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")} ${String(i.getHours()).padStart(2,"0")}:${String(i.getMinutes()).padStart(2,"0")}`,amount:`${e.dosage} ${r}`,route:o,injectionTime:"정맥"===o&&l?l:"-",dosageForm:u,isTitle:!1})}});const i=new Set;for(const t of a){if(i.has(t.timeStr))return alert("중복된 투약일정이 있습니다. 투약일시를 다시 확인해주세요."),!1;i.add(t.timeStr)}if(a.sort((e,t)=>e.time-t.time),a.forEach((e,t)=>{e.round=`${t+1} 회차`}),r=[r[0],...a],a.length>0&&t.selectedPatient&&t.tdmDrug){const e=a[a.length-1],n=p.find(t=>t.id===e.conditionId);if(n){const e=l(n.route),r="정맥"===e?1:2;nt(t.selectedPatient.id,t.tdmDrug.drugName,{amount:parseFloat(n.dosage)||0,tau:parseFloat(n.intervalHours)||12,cmt:r,route:e,infusionTime:parseFloat(n.injectionTime)||void 0})}}if(x(r),b(!0),t.onTableGenerated&&t.onTableGenerated(),S(new Set),t.onSaveRecords&&!y){const e=r.filter(e=>!e.isTitle).map(e=>{const t=p.find(t=>t.id===e.conditionId);return{timeStr:e.timeStr,amount:e.amount,route:e.route,injectionTime:e.injectionTime,conditionId:e.conditionId,intervalHours:t?Number(t.intervalHours):void 0}});t.onSaveRecords(e)}return!0})()&&(F.current=e)},[p]);const J=(e,n,r)=>{x(a=>a.map(a=>{var i,s;if(a.id===e){const e={...a,[n]:r};if("timeStr"===n&&r){let t=r.toString().replace(/undefined/g,"").trim();if(/^\d{12}$/.test(t)){const e=t.substring(0,4),n=t.substring(4,6),r=t.substring(6,8),a=t.substring(8,10),i=t.substring(10,12);t=`${e}-${n}-${r} ${a}:${i}`}else if(/^\d{11}$/.test(t)){const e=t.substring(0,4),n=t.substring(4,6),r=t.substring(6,8),a=t.substring(8,10),i=t.substring(10,11);t=`${e}-${n}-${r} ${a}:0${i}`}else if(/^\d{10}$/.test(t)){const e=t.substring(0,4),n=t.substring(4,6),r=t.substring(6,8),a=t.substring(8,10);t=`${e}-${n}-${r} ${a}:00`}else if(t.includes(" ")&&t.includes(":")&&!t.includes("-")){const e=t.split(" ");if(4===e.length){const[n,r,a,i]=e;t=`${n}-${r.padStart(2,"0")}-${a.padStart(2,"0")} ${i}`}}if(t.includes(" ")&&t.includes("-")&&t.includes(":")){const n=t.split(" ");2===n.length&&(e.date=n[0],e.time=n[1])}else t.includes(":")&&(e.time=t,e.date||(e.date=(new Date).toISOString().split("T")[0]));e.timeStr=t}if("route"===n){if("vancomycin"===(null==(s=null==(i=t.tdmDrug)?void 0:i.drugName)?void 0:s.toLowerCase())&&("경구"===r||"oral"===r))return alert("반코마이신은 현재 정맥 투약 모델만 지원합니다.\n정맥 투약 경로를 선택해주세요."),a;"정맥"===r||"IV"===r?e.injectionTime&&"-"!==e.injectionTime||(e.injectionTime=""):e.injectionTime="-"}return e}return a}))},X=(e,t)=>{x(n=>n.map(n=>{if(n.id===e&&!n.isTitle){let e,r,a=n.timeStr||"";if(a=a.toString().replace(/undefined/g,"").trim(),a.includes(" ")&&a.includes("-")&&a.includes(":")){const t=a.split(" ");2===t.length&&(e=t[0],r=t[1])}else a.includes(":")?(r=a,e=n.date||(new Date).toISOString().split("T")[0]):(e=(new Date).toISOString().split("T")[0],r="09:00");const i=r.split(":");if(i.length>=2){parseInt(i[0],10),parseInt(i[1],10);const a=new Date(new Date(`${e}T${r}`));a.setMinutes(a.getMinutes()+("plus"===t?1:-1));const s=`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`,o=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`,l=`${s} ${o}`;return{...n,timeStr:l,date:s,time:o}}{const e=(new Date).toISOString().split("T")[0],t="09:00";return{...n,timeStr:`${e} ${t}`,date:e,time:t}}}return n}))},Z=e=>{e.preventDefault()};return(new Date).toISOString().slice(0,10),e.jsxs("div",{style:{padding:"0",fontFamily:"Arial, sans-serif",color:$?"#e0e6f0":"#333"},children:[e.jsx("div",{style:{width:"100%",margin:0,padding:"0 0 40px 0"},children:e.jsxs("div",{children:[e.jsxs("div",{style:{padding:"20px",borderRadius:"8px",marginBottom:"30px",border:$?"1px solid #334155":"1px solid #dee2e6"},children:[e.jsx("h1",{style:{marginBottom:20,color:$?"#e0e6f0":"#111827",fontSize:"24px",fontWeight:700,letterSpacing:"-0.02em"},children:"STEP 1: 처방 내역을 입력하세요"}),e.jsxs("div",{style:{marginBottom:20,color:$?"#9ca3af":"#6b7280",fontSize:"14px",lineHeight:"1.5"},children:[e.jsx("div",{style:{marginBottom:"8px"},children:"• 처방 내역을 입력하면 하단에 ‘상세 투약 기록’ 테이블이 자동으로 생성됩니다."}),e.jsx("div",{style:{marginBottom:"8px"},children:"• 처방 내역 변경이 있었다면 실제 처방에 일치하도록 새로운 처방 내역을 입력해야 합니다. (예: 1월 4일은 경구 투약, 1월 5일부터는 정맥 주입한 경우 처방 내역을 2개 등록)"}),e.jsx("div",{children:"• Vancomycin은 현재 정맥(IV) 투약 모델만 지원됩니다."})]}),e.jsx("div",{style:{padding:"20px",marginBottom:"20px",borderRadius:"8px",background:$?"#23293a":"white"},children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"15px",marginBottom:"15px",alignItems:"flex-end"},children:[e.jsxs("div",{style:{flex:"1 1 120px",minWidth:"100px",maxWidth:"100%"},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:$?"#e0e6f0":"#495057",fontSize:"13px"},children:"투약 경로"}),e.jsxs("select",{value:d.route,onChange:e=>q("route",e.target.value),style:{width:"100%",padding:"8px 12px",border:$?"1px solid #334155":"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:$?"#1e293b":"#fff",height:"40px",boxSizing:"border-box",color:$?"#e0e6f0":"#495057"},children:[e.jsx("option",{value:"",children:"투약 경로 선택"}),G.map(t=>e.jsx("option",{value:t.value,disabled:t.disabled,style:{backgroundColor:t.disabled?$?"#374151":"#e5e7eb":$?"#1e293b":"#fff",color:t.disabled?$?"#6b7280":"#9ca3af":$?"#e0e6f0":"#495057"},children:t.label},t.value))]})]}),(null==(o=t.tdmDrug)?void 0:o.drugName)&&("cyclosporin"===t.tdmDrug.drugName.toLowerCase()||"cyclosporine"===t.tdmDrug.drugName.toLowerCase())&&("경구"===d.route||"oral"===d.route)&&e.jsxs("div",{style:{flex:"1 1 120px",minWidth:"100px",maxWidth:"100%"},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:$?"#e0e6f0":"#495057",fontSize:"13px"},children:"제형"}),e.jsxs("select",{value:d.dosageForm,onChange:e=>q("dosageForm",e.target.value),style:{width:"100%",padding:"8px 12px",border:$?"1px solid #334155":"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:$?"#1e293b":"#fff",height:"40px",boxSizing:"border-box",color:$?"#e0e6f0":"#495057"},children:[e.jsx("option",{value:"",children:"제형 선택"}),e.jsx("option",{value:"capsule/tablet",children:"캡슐/정제"}),e.jsx("option",{value:"oral liquid",children:"현탁/액제"})]})]}),e.jsxs("div",{style:{flex:"1 1 120px",minWidth:"100px",maxWidth:"100%"},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:$?"#e0e6f0":"#495057",fontSize:"13px"},children:"투약 용량"}),e.jsx("input",{type:"number",value:d.dosage,onChange:e=>q("dosage",e.target.value),placeholder:"예: 500",style:{width:"100%",padding:"8px 12px",border:$?"1px solid #334155":"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:$?"#1e293b":"#fff",height:"40px",boxSizing:"border-box",color:$?"#e0e6f0":"#495057"}})]}),e.jsxs("div",{style:{flex:"1 1 120px",minWidth:"100px",maxWidth:"100%"},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:$?"#e0e6f0":"#495057",fontSize:"13px"},children:"단위"}),e.jsx("select",{value:d.unit,onChange:e=>q("unit",e.target.value),style:{width:"100%",padding:"8px 12px",border:$?"1px solid #334155":"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:$?"#1e293b":"#fff",height:"40px",boxSizing:"border-box",color:$?"#e0e6f0":"#495057"},children:["mg","g","mcg"].map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{style:{flex:"1 1 120px",minWidth:"100px",maxWidth:"100%"},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:$?"#e0e6f0":"#495057",fontSize:"13px"},children:"투약 간격(시간)"}),e.jsx("input",{type:"number",value:d.intervalHours,onChange:e=>q("intervalHours",e.target.value),placeholder:"예: 8",style:{width:"100%",padding:"8px 12px",border:$?"1px solid #334155":"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:$?"#1e293b":"#fff",height:"40px",boxSizing:"border-box",color:$?"#e0e6f0":"#495057"}})]}),"정맥"===d.route&&e.jsxs("div",{style:{flex:"1 1 120px",minWidth:"100px",maxWidth:"100%"},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:$?"#e0e6f0":"#495057",fontSize:"13px"},children:"주입시간 (분)"}),e.jsx("input",{type:"text",value:d.injectionTime,onChange:e=>q("injectionTime",e.target.value),placeholder:"bolus 투여 시 0 입력",style:{width:"100%",padding:"8px 12px",border:$?"1px solid #334155":"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:$?"#1e293b":"#fff",height:"40px",boxSizing:"border-box",color:$?"#e0e6f0":"#495057"}})]}),e.jsxs("div",{style:{flex:"1 1 120px",minWidth:"100px",maxWidth:"100%"},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:$?"#e0e6f0":"#495057",fontSize:"13px"},children:"총 투약 횟수"}),e.jsx("input",{type:"number",value:d.totalDoses,onChange:e=>q("totalDoses",e.target.value),placeholder:"예: 10",style:{width:"100%",padding:"8px 12px",border:$?"1px solid #334155":"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:$?"#1e293b":"#fff",height:"40px",boxSizing:"border-box",color:$?"#e0e6f0":"#495057"}})]}),e.jsxs("div",{style:{flex:"1 1 180px",minWidth:"180px",maxWidth:"100%"},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:$?"#e0e6f0":"#495057",fontSize:"13px"},children:"최초 투약 날짜/시간"}),e.jsx("div",{ref:f,style:{width:"100%",height:"40px",position:"relative",overflow:"visible"},onClick:()=>(e=>{if(!(null==e?void 0:e.current))return;const t=e.current.querySelector("input");t&&t.focus()})(f),children:e.jsx(Ao,{onChange:e=>{if(!e)return void c(e=>({...e,firstDoseDate:"",firstDoseTime:""}));const t=e instanceof Date?e:new Date(e);if(isNaN(t.getTime()))return;const n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0"),o=`${n}-${r}-${a}`,l=`${i}:${s}`;c(e=>({...e,firstDoseDate:o,firstDoseTime:l}))},value:d.firstDoseDate&&d.firstDoseTime?new Date(`${d.firstDoseDate}T${d.firstDoseTime}`):null,format:"y-MM-dd HH:mm",maxDate:new Date,disableClock:!1,clearIcon:null,calendarIcon:null,className:$?"dark-datetime-picker":"",style:{width:"100%",height:"40px"},yearPlaceholder:"연도",monthPlaceholder:"월",dayPlaceholder:"일",hourPlaceholder:"시",minutePlaceholder:"분"})}),e.jsx("style",{children:`\n                    .react-datetime-picker {\n                      width: 100%;\n                      height: 40px;\n                    }\n                    .react-datetime-picker__wrapper {\n                      width: 100%;\n                      height: 40px;\n                      padding: 8px 12px;\n                      border: ${$?"1px solid #334155":"1px solid #ced4da"};\n                      border-radius: 6px;\n                      background-color: ${$?"#1e293b":"#fff"};\n                      color: ${$?"#e0e6f0":"#495057"};\n                      font-size: 14px;\n                    }\n                    .react-datetime-picker__inputGroup {\n                      color: ${$?"#e0e6f0":"#495057"};\n                    }\n                    .react-datetime-picker__inputGroup__input {\n                      color: ${$?"#e0e6f0":"#495057"};\n                    }\n                    .react-datetime-picker__inputGroup__input::placeholder {\n                      color: ${$?"#6b7280":"#9ca3af"};\n                      opacity: 0.7;\n                    }\n                    .react-datetime-picker__button {\n                      color: ${$?"#e0e6f0":"#495057"};\n                    }\n                    .react-datetime-picker__button:hover {\n                      background-color: ${$?"#334155":"#f8f9fa"};\n                    }\n                    .react-datetime-picker__calendar {\n                      z-index: 1000;\n                    }\n                    .react-datetime-picker__clock {\n                      z-index: 1000;\n                    }\n                    .react-calendar {\n                      background-color: ${$?"#1e293b":"#fff"};\n                      color: ${$?"#e0e6f0":"#495057"};\n                      border: ${$?"1px solid #334155":"1px solid #ced4da"};\n                      max-height: 300px;\n                    }\n                    .react-calendar__tile {\n                      color: ${$?"#e0e6f0":"#495057"};\n                    }\n                    .react-clock {\n                      max-height: 200px;\n                    }\n                    .react-clock__face {\n                      max-height: 200px;\n                    }\n                    .react-calendar__tile:enabled:hover {\n                      background-color: ${$?"#334155":"#f0f0f0"};\n                    }\n                    .react-calendar__tile--active {\n                      background-color: ${$?"#0f172a":"#000"};\n                      color: #fff;\n                    }\n                    .react-clock {\n                      background-color: ${$?"#1e293b":"#fff"};\n                      border: ${$?"1px solid #334155":"1px solid #ced4da"};\n                    }\n                    .react-clock__face {\n                      stroke: ${$?"#334155":"#ced4da"};\n                    }\n                    .react-clock__hand {\n                      stroke: ${$?"#e0e6f0":"#495057"};\n                    }\n                    .react-clock__mark {\n                      stroke: ${$?"#e0e6f0":"#495057"};\n                    }\n                  `})]}),e.jsx("div",{style:{flex:"0 0 60px",minWidth:"60px",marginLeft:"auto",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{onClick:()=>{var e,n,r,a,i,s;if(!d.route||""===d.route.trim())return void alert("투약 경로를 선택해주세요.");if(!d.dosage||""===d.dosage.trim())return void alert("투약 용량을 입력해주세요.");const o=parseFloat(d.dosage);if(isNaN(o)||o<=0)return void alert("투약 용량은 0보다 큰 숫자로 입력해주세요.");if(!d.unit||""===d.unit.trim())return void alert("단위를 선택해주세요.");if(!d.intervalHours||""===d.intervalHours.trim())return void alert("투약 간격(시간)을 입력해주세요.");const l=parseFloat(d.intervalHours);if(isNaN(l)||l<=0)return void alert("투약 간격은 0보다 큰 숫자로 입력해주세요.");if(!d.totalDoses||""===d.totalDoses.trim())return void alert("총 투약 횟수를 입력해주세요.");const u=parseInt(d.totalDoses);if(isNaN(u)||u<=0)return void alert("총 투약 횟수는 1 이상의 정수로 입력해주세요.");const m=(d.firstDoseDate||"").trim(),f=(d.firstDoseTime||"").trim();if(!m||!f)return void alert("최초 투약 날짜와 시간을 모두 입력해주세요.");const p=new Date(`${m}T${f}`);if(Number.isNaN(p.getTime()))return void alert("날짜와 시간 형식이 올바르지 않습니다.");if(p>new Date)return void alert("투약 날짜/시간은 현재 시각 이후로 입력할 수 없습니다.");const g={...d,firstDoseDate:m,firstDoseTime:f};if("정맥"===g.route||"IV"===g.route){const t=null==(e=g.injectionTime)?void 0:e.trim();if(!t||""===t||"-"===t)return void alert("정맥 투약 경로를 선택하셨습니다. 주입시간(분)을 반드시 입력해주세요.\n\nbolus 투여 시에는 0을 입력해주세요.");const n=parseFloat(t);if(isNaN(n)||n<0)return void alert("주입시간은 0 이상의 숫자로 입력해주세요.\n\nbolus 투여 시에는 0을 입력해주세요.")}if(!("경구"!==g.route&&"oral"!==g.route||"cyclosporin"!==(null==(r=null==(n=t.tdmDrug)?void 0:n.drugName)?void 0:r.toLowerCase())&&"cyclosporine"!==(null==(i=null==(a=t.tdmDrug)?void 0:a.drugName)?void 0:i.toLowerCase()))){const e=null==(s=g.dosageForm)?void 0:s.trim();if(!e||""===e)return void alert("경구 투약 경로를 선택하셨습니다. 제형정보를 반드시 선택해주세요.")}if(T)h(e=>e.map(e=>e.id===_?{...g,id:_}:e)),C(!1),I(null);else{const e={id:Date.now(),...g};h(t=>[...t,e])}c({route:"",dosage:"",unit:"mg",intervalHours:"",injectionTime:"",dosageForm:"",firstDoseDate:"",firstDoseTime:"",totalDoses:""})},style:{width:"60px",height:"40px",backgroundColor:T?$?"#1e3a8a":"#1e40af":$?"#0f172a":"#000",color:"#fff",border:"none",borderRadius:"10px",fontWeight:400,fontSize:"13px",cursor:"pointer",transition:"background-color 0.2s, opacity 0.2s"},onMouseOver:e=>{e.target.style.backgroundColor=T?$?"#2563eb":"#3b82f6":$?"#1f2937":"#111827"},onMouseOut:e=>{e.target.style.backgroundColor=T?$?"#1e3a8a":"#1e40af":$?"#0f172a":"#000"},children:T?"수정":"확인"})})]})}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("h3",{style:{marginBottom:"10px",color:$?"#e0e6f0":"#1f2937",fontSize:"18px",fontWeight:600,letterSpacing:"-0.01em"},children:"처방 내역 summary"}),e.jsx("div",{style:{border:$?"1px solid #334155":"1px solid #8EC5FF",borderRadius:"8px",padding:"15px",background:$?"#1f2a37":"#EFF6FF",maxHeight:"200px",overflowY:"auto"},children:0===p.length?e.jsx("div",{style:{color:$?"#9ca3af":"#6c757d",fontStyle:"italic"},children:"처방 내역을 추가해주세요."}):p.map((t,n)=>e.jsx("div",{style:{borderBottom:p.length>1&&n!==p.length-1?$?"1px dashed #1f2937":"1px dashed #94a3b8":"none",paddingBottom:p.length>1&&n!==p.length-1?"10px":"0",marginBottom:p.length>1&&n!==p.length-1?"10px":"0",fontSize:"13px",color:$?"#9ca3af":"#6c757d"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",flex:1},children:[e.jsxs("span",{style:{fontWeight:"bold",color:$?"#60a5fa":"#007bff"},children:["기록 ",n+1,":"]}),e.jsx("span",{style:{fontSize:"16px",fontWeight:700,color:$?"#f3f4f6":"#000000"},children:Y(t)})]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:()=>(e=>{const t=p.find(t=>t.id===e);t&&(c({route:t.route,dosage:t.dosage,unit:t.unit,intervalHours:t.intervalHours,injectionTime:t.injectionTime,dosageForm:t.dosageForm||"",firstDoseDate:t.firstDoseDate,firstDoseTime:t.firstDoseTime,totalDoses:t.totalDoses}),C(!0),I(e))})(t.id),style:{padding:"4px 8px",backgroundColor:$?"#0f172a":"#000",color:"#fff",border:"1px solid",borderColor:$?"#1f2937":"#000",borderRadius:"4px",cursor:"pointer",fontSize:"11px"},onMouseOver:e=>{e.target.style.backgroundColor=$?"#1f2937":"#111827"},onMouseOut:e=>{e.target.style.backgroundColor=$?"#0f172a":"#000"},children:"수정"}),e.jsx("button",{onClick:()=>((e,t)=>{if(!window.confirm(`처방 내역 summary 중 기록 ${t+1}을 삭제하시겠습니까?\n기록을 삭제하면 전체 투약 기록 데이터에서도 삭제됩니다.`))return;const n=1===p.length;h(t=>t.filter(t=>t.id!==e));let r=[],a=!1;x(t=>{if(!t||0===t.length)return t;if(n)return r=t.filter(e=>!e.isTitle).map(e=>e.id),[];const i=t.filter(t=>(!t.isTitle&&t.conditionId===e&&r.push(t.id),t.isTitle||t.conditionId!==e)),s=i.find(e=>e.isTitle),o=i.filter(e=>!e.isTitle).map((e,t)=>({...e,round:`${t+1} 회차`}));return a=o.length>0,s?[s,...o]:o}),!n&&a||b(!1),r.length>0&&S(e=>{const t=new Set(e);return r.forEach(e=>t.delete(e)),t})})(t.id,n),style:{padding:"4px 8px",backgroundColor:$?"#4b5563":"#fff",color:$?"#fff":"#111827",border:"1px solid",borderColor:$?"#6b7280":"#000",borderRadius:"4px",cursor:"pointer",fontSize:"11px"},onMouseOver:e=>{e.target.style.backgroundColor=$?"#6b7280":"#f3f4f6"},onMouseOut:e=>{e.target.style.backgroundColor=$?"#4b5563":"#fff"},children:"삭제"})]})]})},t.id))})]})]}),e.jsxs("div",{style:{background:$?"#23293a":"white",padding:"20px",borderRadius:"8px",border:$?"1px solid #334155":"1px solid #dee2e6"},children:[e.jsx("h1",{style:{marginBottom:20,color:$?"#e0e6f0":"#111827",fontSize:"24px",fontWeight:700,letterSpacing:"-0.02em"},children:"STEP 2: 투약 기록을 확인하세요"}),e.jsxs("div",{style:{marginBottom:20,color:$?"#9ca3af":"#6b7280",fontSize:"14px",lineHeight:"1.5"},children:[e.jsx("div",{style:{marginBottom:"8px"},children:"• 투약 기록 정보를 정확히 입력할 수록 분석의 정확도가 높아집니다."}),e.jsx("div",{children:"• 투약 시간을 선택해서 정확한 시간으로 수정할 수 있습니다."})]}),e.jsx("div",{style:{overflowX:"auto"},children:(()=>{const t=g.some(e=>!e.isTitle&&("정맥"===e.route||"IV"===e.route));return e.jsx("table",{style:{width:"100%",borderCollapse:"collapse",border:$?"1px solid #334155":"1px solid #dee2e6",tableLayout:"fixed",background:$?"#23293a":"white"},children:e.jsx("tbody",{children:g.length>0?g.map(n=>e.jsxs("tr",{draggable:!n.isTitle,onDragStart:e=>{return!n.isTitle&&(t=n.id,void D(t));var t},onDragOver:Z,onDrop:e=>!n.isTitle&&((e,t)=>{if(e.preventDefault(),w===t||"title"===w)return;const n=g.findIndex(e=>e.id===w),r=g.findIndex(e=>e.id===t);if(-1===n||-1===r)return;const a=[...g],i=a[n];a.splice(n,1),a.splice(r,0,i),a.forEach((e,t)=>{e.isTitle||(e.round=`${t+1}`)}),x(a),D(null)})(e,n.id),style:{backgroundColor:n.isTitle?$?"#2d3650":"#e9ecef":$?"#23293a":"white",fontWeight:n.isTitle?"bold":"normal",cursor:n.isTitle?"default":"grab",color:$?"#e0e6f0":void 0},children:[e.jsx("td",{style:{padding:"12px",border:$?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"12%",color:$?"#e0e6f0":void 0,background:$&&n.isTitle?"#2d3650":void 0},children:n.isTitle?n.round:e.jsx("div",{style:{textAlign:"center",width:"100%",color:$?"#e0e6f0":void 0},children:n.round})}),e.jsx("td",{style:{padding:"12px",border:$?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"25%",color:$?"#e0e6f0":void 0,background:$&&n.isTitle?"#2d3650":void 0},children:n.isTitle?n.time:e.jsxs("div",{style:{display:"flex",gap:"2px",alignItems:"center"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(Wo,{row:n,onUpdate:J,isDarkMode:$})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1px"},children:[e.jsx("button",{type:"button",onClick:()=>X(n.id,"plus"),style:{width:"20px",height:"14px",border:"1px solid #d1d5db",borderRadius:"2px 2px 0 0",background:$?"#374151":"#f9fafb",color:$?"#e0e6f0":"#374151",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"bold",padding:"0"},onMouseOver:e=>{e.target.style.background=$?"#4b5563":"#e5e7eb"},onMouseOut:e=>{e.target.style.background=$?"#374151":"#f9fafb"},children:"▲"}),e.jsx("button",{type:"button",onClick:()=>X(n.id,"minus"),style:{width:"20px",height:"14px",border:"1px solid #d1d5db",borderRadius:"0 0 2px 2px",background:$?"#374151":"#f9fafb",color:$?"#e0e6f0":"#374151",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"bold",padding:"0"},onMouseOver:e=>{e.target.style.background=$?"#4b5563":"#e5e7eb"},onMouseOut:e=>{e.target.style.background=$?"#374151":"#f9fafb"},children:"▼"})]})]})}),e.jsx("td",{style:{padding:"12px",border:$?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"18%",color:$?"#e0e6f0":void 0,background:$&&n.isTitle?"#2d3650":void 0},children:n.isTitle?n.amount:e.jsx("div",{style:{textAlign:"center",width:"100%",color:$?"#e0e6f0":void 0},children:n.amount})}),e.jsx("td",{style:{padding:"12px",border:$?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"18%",color:$?"#e0e6f0":void 0,background:$&&n.isTitle?"#2d3650":void 0},children:n.isTitle?n.route:e.jsx("div",{style:{textAlign:"center",width:"100%",color:$?"#e0e6f0":void 0},children:(()=>{const e=n.route||"";let t=n.dosageForm;if(!t&&n.conditionId){const r=p.find(e=>e.id===n.conditionId);!r||"경구"!==e&&"oral"!==e||(t=r.dosageForm)}if(!(t||n.conditionId||"경구"!==e&&"oral"!==e)){const r=p.find(t=>{if(!t.firstDoseDate||!t.firstDoseTime||t.route!==e)return!1;const r=new Date(`${t.firstDoseDate}T${t.firstDoseTime}`),a=parseInt(t.intervalHours)||12,i=parseInt(t.totalDoses)||1,s=new Date(r.getTime()+(i-1)*a*60*60*1e3),o=new Date(n.timeStr);return o>=r&&o<=s});r&&r.dosageForm&&(t=r.dosageForm)}if(("경구"===e||"oral"===e)&&t&&"string"==typeof t&&""!==t.trim()){return`${e} (${"capsule/tablet"===t?"캡슐/정제":"oral liquid"===t?"현탁/액제":t})`}return e})()})}),t&&e.jsx("td",{style:{padding:"12px",border:$?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"18%",color:$?"#e0e6f0":void 0,background:$&&n.isTitle?"#2d3650":void 0},children:n.isTitle?n.injectionTime:"정맥"===n.route||"IV"===n.route?e.jsx(Uo,{row:n,onUpdate:J,isDarkMode:$,readOnly:!0}):e.jsx("div",{style:{textAlign:"center",width:"100%",color:$?"#e0e6f0":void 0,minHeight:"24px",lineHeight:"24px"},children:"-"})}),e.jsx("td",{style:{padding:"12px",border:$?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"10%",color:$?"#e0e6f0":void 0,background:$&&n.isTitle?"#2d3650":void 0},children:n.isTitle?"삭제":e.jsx("input",{type:"checkbox",checked:k.has(n.id),onChange:()=>{return e=n.id,void S(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n});var e},style:{width:"16px",height:"16px",cursor:"pointer",accentColor:$?"#1B44C8":void 0}})})]},n.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:t?"6":"5",style:{padding:"40px",textAlign:"center",color:"#6b7280",fontStyle:"italic"},children:"처방 내역을 입력하면 ‘상세 투약 기록’ 테이블이 자동으로 생성됩니다."})})})})})()}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"15px"},children:[e.jsx("button",{onClick:()=>{if(window.confirm("투약 기록 테이블과 처방 내역 summary를 모두 삭제하시겠습니까?")){x([]),h([]),b(!1),S(new Set),c({route:"",dosage:"",unit:"mg",intervalHours:"",injectionTime:"",firstDoseDate:"",firstDoseTime:"",totalDoses:""}),C(!1),I(null);const t=u();if(t)try{localStorage.removeItem(t)}catch(e){}}},style:{padding:"8px 16px",backgroundColor:$?"#23293a":"#fff",color:$?"#ef4444":"#dc2626",border:$?"1px solid #7f1d1d":"1px solid #fecaca",borderRadius:"8px",cursor:"pointer",fontWeight:400,fontSize:"15px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{e.target.style.backgroundColor=$?"#7f1d1d":"#fef2f2"},onMouseOut:e=>{e.target.style.backgroundColor=$?"#23293a":"#fff"},children:"🗑️ 전체 삭제"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>{const e=Math.max(0,...g.filter(e=>!e.isTitle).map(e=>parseInt(e.id)||0))+1,t=g.filter(e=>!e.isTitle&&e.timeStr).sort((e,t)=>{if(e.timeStr&&t.timeStr){const n=new Date(e.timeStr);return new Date(t.timeStr).getTime()-n.getTime()}return 0})[0],n=p.length>0?[...p].sort((e,t)=>{if(!(e.firstDoseDate&&e.firstDoseTime&&t.firstDoseDate&&t.firstDoseTime))return 0;const n=new Date(`${e.firstDoseDate}T${e.firstDoseTime}`);return new Date(`${t.firstDoseDate}T${t.firstDoseTime}`).getTime()-n.getTime()})[0]:null;let r,a=12;if(t&&t.timeStr){n&&n.intervalHours&&(a=parseInt(n.intervalHours)||12);const e=new Date(t.timeStr);r=new Date(e.getTime()+60*a*60*1e3)}else r=new Date,r.setHours(9,0,0,0);const i=r.toISOString().split("T")[0],s=r.toTimeString().slice(0,5),o=g.filter(e=>!e.isTitle&&e.amount&&"0"!==e.amount).map(e=>e.amount);let d="500 mg";if(o.length>0){const e={};o.forEach(t=>{e[t]=(e[t]||0)+1});d=Object.keys(e).reduce((t,n)=>e[t]>e[n]?t:n)}else n&&n.dosage&&n.unit&&(d=`${n.dosage} ${n.unit}`);let c="경구";if(n&&n.route)c=l(n.route);else{const e=g.filter(e=>!e.isTitle&&e.route).map(e=>e.route);if(e.length>0){const t={};e.forEach(e=>{t[e]=(t[e]||0)+1});c=Object.keys(t).reduce((e,n)=>t[e]>t[n]?e:n)}}let u="-";if("정맥"===c)if(n&&n.injectionTime)u=String(n.injectionTime);else{const e=g.filter(e=>!e.isTitle&&"정맥"===e.route&&e.injectionTime&&"-"!==e.injectionTime).map(e=>e.injectionTime);if(e.length>0){const t={};e.forEach(e=>{t[e]=(t[e]||0)+1});u=Object.keys(t).reduce((e,n)=>t[e]>t[n]?e:n)}}let m="";if("경구"===c||"oral"===c)if(n&&n.dosageForm)m=n.dosageForm;else{const e=g.filter(e=>!e.isTitle&&("경구"===e.route||"oral"===e.route)&&e.dosageForm).map(e=>e.dosageForm);if(e.length>0){const t={};e.forEach(e=>{t[e]=(t[e]||0)+1});m=Object.keys(t).reduce((e,n)=>t[e]>t[n]?e:n)}}const f={id:String(e),round:`${e}회차`,date:i,time:s,timeStr:`${i} ${s}`,amount:d,route:c,injectionTime:u,dosageForm:m,isTitle:!1,conditionId:(null==n?void 0:n.id)||null};x(e=>[...e,f])},style:{padding:"8px 16px",backgroundColor:$?"#23293a":"#fff",color:$?"#e0e6f0":"#222",border:$?"1px solid #334155":"1px solid #dee2e6",borderRadius:"8px",cursor:"pointer",fontWeight:400,fontSize:"15px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{e.target.style.backgroundColor=$?"#334155":"#f4f6fa"},onMouseOut:e=>{e.target.style.backgroundColor=$?"#23293a":"#fff"},children:"+ 행추가"}),e.jsx("button",{onClick:()=>{0!==k.size?window.confirm(`선택된 ${k.size}개 행을 삭제하시겠습니까?`)&&(x(e=>e.filter(e=>!k.has(e.id))),S(new Set)):alert("삭제할 행을 선택해주세요!")},style:{padding:"8px 16px",backgroundColor:$?"#23293a":"#fff",color:$?"#f87171":"#fb7185",border:$?"1px solid #7f1d1d":"1px solid #ffe4e6",borderRadius:"8px",cursor:"pointer",fontWeight:400,fontSize:"15px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{e.target.style.backgroundColor=$?"#7f1d1d":"#f4f6fa"},onMouseOut:e=>{e.target.style.backgroundColor=$?"#23293a":"#fff"},children:"선택 삭제"})]})]})]})]})}),M&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.3)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px 32px",boxShadow:"0 4px 24px #0002",minWidth:"320px",textAlign:"center",border:"1.5px solid #222",color:"#222",fontWeight:600},children:[e.jsx("div",{style:{fontSize:"17px",marginBottom:"18px",whiteSpace:"pre-line"},children:"중복된 투약일정이 있습니다.\n투약일시를 다시 확인해주세요."}),e.jsx("button",{onClick:()=>O(""),style:{background:"#222",color:"white",border:"none",borderRadius:"6px",padding:"8px 28px",fontSize:"15px",fontWeight:600,cursor:"pointer"},children:"확인"})]})})]})}const Ko=({patients:t,prescriptions:n,selectedPatient:r,selectedPrescription:a,onAddDrugAdministration:i,setDrugAdministrations:s,drugAdministrations:o,bloodTests:l,onNext:d,onPrev:c,isCompleted:u})=>{const m=a;N.useState({drugName:(null==m?void 0:m.drugName)||"",route:"",date:"",time:"",dose:0,unit:"mg",infusionTime:void 0});const[f,p]=N.useState(!1),[h,g]=N.useState(!1),[x,v]=N.useState([]),b=N.useRef(null);dn().format("YYYY-MM-DD");const y=r&&m?o.filter(e=>e.patientId===r.id&&e.drugName===m.drugName):[],j=N.useCallback(()=>r&&(null==m?void 0:m.drugName)?`tdmfriends:conditions:${r.id}:${m.drugName}`:null,[r,null==m?void 0:m.drugName]);return N.useEffect(()=>{if(!r)return;const e=j();if(e)try{const t=localStorage.getItem(e);if(t){const e=JSON.parse(t);v(e)}}catch(t){}},[r,null==m?void 0:m.drugName,j]),N.useEffect(()=>{if(!r)return;const e=j();if(e)try{localStorage.setItem(e,JSON.stringify(x))}catch(t){}},[x,r,null==m?void 0:m.drugName,j]),N.useEffect(()=>{},[]),e.jsx("div",{className:"space-y-6",children:e.jsxs(te,{className:"bg-white dark:bg-slate-900 border dark:border-slate-700 text-slate-900 dark:text-slate-200",children:[e.jsxs(ne,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"4단계: 투약기록",u&&e.jsx(pe,{className:"h-5 w-5 text-green-600"})]}),e.jsx(ae,{children:"2단계에서 입력한 TDM 약물에 대해 7반감기 이내의 투약력을 입력하세요."})]}),e.jsxs(ie,{className:"space-y-6",children:[m&&r&&e.jsxs("div",{className:"py-3 px-4 rounded bg-muted dark:bg-slate-800 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"나이:"})," ",r.age]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"성별:"})," ","male"===r.gender?"남성":"female"===r.gender?"여성":"-"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"몸무게:"})," ",r.weight,"kg"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"키:"})," ",r.height,"cm"]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"약품명:"}),e.jsx("span",{className:"ml-2 font-semibold",children:m.drugName})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"적응증:"}),e.jsx("span",{className:"ml-2",children:m.indication})]})]})]}),(!m||!r)&&e.jsx("div",{className:"py-2 px-3 rounded bg-muted dark:bg-slate-800 text-base font-semibold mb-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"TDM 내역:"})," ",(null==m?void 0:m.drugName)||"-",", ",(null==m?void 0:m.indication)||"-"]})}),e.jsx(zo,{selectedPatient:r,tdmDrug:m,onComplete:d,onTableGenerated:()=>p(!0),initialAdministrations:y,initialConditions:x,onConditionsChange:v,onUpdateNeeded:(e,t,n)=>{b.current={needsUpdate:e,updateInfo:t,performUpdate:n}},onSaveRecords:e=>{if(r&&m){const t=e.map((e,t)=>{const n=void 0!==e.intervalHours?Number(e.intervalHours):x.length>0?Number(x[0].intervalHours):void 0;return{id:`${Date.now()}_${t}`,patientId:r.id,drugName:m.drugName,route:e.route,date:e.timeStr.split(" ")[0],time:e.timeStr.split(" ")[1],dose:Number(e.amount.split(" ")[0]),unit:e.amount.split(" ")[1]||"mg",isIVInfusion:"정맥"===e.route,infusionTime:e.injectionTime&&"-"!==e.injectionTime?parseInt(String(e.injectionTime).replace(/[^0-9]/g,"")):void 0,administrationTime:void 0,intervalHours:n}}),n=[...o.filter(e=>!(e.patientId===r.id&&e.drugName===(null==m?void 0:m.drugName))),...t];s(n)}},onRecordsChange:e=>{if(r&&m){const t=e.map((e,t)=>{const n=void 0!==e.intervalHours?Number(e.intervalHours):x.length>0?Number(x[0].intervalHours):void 0;return{id:`${Date.now()}_${t}`,patientId:r.id,drugName:m.drugName,route:e.route,date:e.timeStr.split(" ")[0],time:e.timeStr.split(" ")[1],dose:Number(e.amount.split(" ")[0]),unit:e.amount.split(" ")[1]||"mg",isIVInfusion:"정맥"===e.route,infusionTime:e.injectionTime&&"-"!==e.injectionTime?parseInt(String(e.injectionTime).replace(/[^0-9]/g,"")):"정맥"===e.route?0:void 0,administrationTime:void 0,intervalHours:n}}),n=[...o.filter(e=>!(e.patientId===r.id&&e.drugName===(null==m?void 0:m.drugName))),...t];s(n)}}}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsxs(se,{variant:"outline",type:"button",onClick:c,className:"flex items-center gap-2 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-200",children:[e.jsx(je,{className:"h-4 w-4"}),"Lab"]}),u&&e.jsxs(se,{onClick:async()=>{var e;if(r){if(null==(e=b.current)?void 0:e.needsUpdate){const e=b.current.updateInfo,t=`변경된 투약 기록으로 시뮬레이션을 진행합니다.\n(투약 횟수 ${e.conditionsTotalDoses}회 → ${e.tableRowCount}회)`;if(!window.confirm(t))return;b.current.performUpdate()}g(!0);try{const e=Ye({patients:t,prescriptions:n,bloodTests:l,drugAdministrations:o,selectedPatientId:r.id,selectedDrugName:null==m?void 0:m.drugName});if(!e)return alert("TDM 요청 데이터를 생성할 수 없습니다. 환자 정보와 처방 정보를 확인해주세요."),void g(!1);await qe({body:e,persist:!0,patientId:r.id,drugName:null==m?void 0:m.drugName}),g(!1),d()}catch(a){const e=a instanceof Error?a.message:"알 수 없는 오류",t=a instanceof Error?a.name:"Unknown",n=e.includes("CORS 오류")||e.includes("cors"),r=e.includes("네트워크 오류")||e.includes("failed to fetch"),i=e.includes("503")||e.includes("일시적");let s="TDM 분석 중 오류가 발생했습니다.\n\n";n||r?(s+="서버 접근 오류가 발생했습니다.\n",s+=`오류 유형: ${t}\n`,s+=`오류 메시지: ${e.split("\n")[0]}\n\n`,s+="서버 관리자에게 문의하거나 잠시 후 다시 시도해주세요."):i?(s+="서버 일시적 오류 (503): 서버가 일시적으로 사용 불가능한 상태입니다.\n",s+="잠시 후 다시 시도해주세요."):(s+=`오류 유형: ${t}\n`,s+=`오류 메시지: ${e}`),alert(s),g(!1)}}else d()},disabled:h,className:"flex items-center gap-2 w-[300px] bg-black dark:bg-blue-700 text-white font-bold text-lg py-3 px-6 justify-center dark:hover:bg-blue-800 disabled:opacity-60",children:[h?"처리 중...":"TDM Simulation",e.jsx(xe,{className:"h-4 w-4"})]})]})]})]})})},Bo=({patients:t,prescriptions:n,bloodTests:r,selectedPatient:a,setSelectedPatient:i,onAddPatient:s,onUpdatePatient:o,onDeletePatient:l,onAddPrescription:c,setPrescriptions:u,onAddBloodTest:m,onDeleteBloodTest:f,setBloodTests:p,onAddDrugAdministration:h,drugAdministrations:g,setDrugAdministrations:x,onResetWorkflow:v})=>{const[b,y]=N.useState(null),[j,w]=N.useState(1),[D,k]=N.useState(!1),[S,T]=N.useState(!1);N.useEffect(()=>{if(a)try{const e=window.localStorage.getItem(`tdmfriends:prescription:${a.id}`);if(!e)return;const t=JSON.parse(e),r=t.selectedTdmId||t.newlyAddedTdmId;if(!r)return;const i=n.find(e=>e.id===r&&e.patientId===a.id)||null;i&&y(i)}catch(e){}else y(null)},[a,null==a?void 0:a.id,n]);const C=[{id:1,title:"환자 등록 및 선택",icon:ge,description:"환자를 선택하거나 신규 등록해주세요."},{id:2,title:"TDM 선택",icon:be,description:"TDM 약물 정보를 입력합니다."},{id:3,title:"Lab",icon:Ne,description:"신기능 및 혈중 약물 농도 정보를 입력합니다."},{id:4,title:"투약 기록",icon:Se,description:"투약 기록을 입력합니다."},{id:5,title:"Let's TDM",icon:De,description:"정밀의료 시뮬레이션 결과를 확인해보세요."}];!a||n.filter(e=>e.patientId===a.id),!a||r.filter(e=>e.patientId===a.id);const _=a&&b?r.filter(e=>e.patientId===a.id&&e.drugName===b.drugName):[],I=a&&b?g.filter(e=>e.patientId===a.id&&e.drugName===b.drugName):[],M=e=>{switch(e){case 1:return null!==a;case 2:return a&&null!==b;case 3:return a&&b&&_.length>0;case 4:return a&&b&&I.length>0;case 5:return a&&b&&_.length>0&&I.length>0;default:return!1}},O=()=>{j<5&&w(j+1)},$=()=>{j>1&&w(j-1)},P=()=>{if(a){const e=r.filter(e=>e.patientId!==a.id);p(e);const t=g.filter(e=>e.patientId!==a.id);x(t)}},R=C.filter(e=>M(e.id)).length,A=R/C.length*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"TDM 분석 워크플로우"]}),e.jsxs(ae,{children:["각 단계를 순서대로 진행해 주세요",a&&` (${a.name} 환자)`]})]}),e.jsx(ie,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["진행률: ",R," / ",C.length,"단계 완료"]}),e.jsxs("span",{children:[Math.round(A),"%"]})]}),e.jsx(Cn,{value:A,className:"w-full"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:C.map(i=>{const s=i.icon,o=M(i.id),l=j===i.id,c=1===(u=i.id)||(2===u?M(1):3===u?M(2):4===u?a&&b&&_.length>0:5===u&&M(4));var u;return e.jsxs(se,{variant:l?"default":o?"secondary":"outline",className:d("flex flex-col items-center gap-1 h-auto py-3",!c&&"opacity-50 cursor-not-allowed"),disabled:!c||5===i.id&&D,onClick:async()=>{if(c)if(5===i.id&&a&&b){if(rt(a.id,b.drugName))return void T(!0);k(!0);let s=!1;try{const e=Ye({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:g,selectedPatientId:a.id,selectedDrugName:b.drugName});e?(await qe({body:e,persist:!0,patientId:a.id,drugName:b.drugName}),s=!0):alert("TDM 요청 데이터를 생성할 수 없습니다. 환자 정보와 처방 정보를 확인해주세요.")}catch(e){const t=e instanceof Error?e.message:"알 수 없는 오류",n=e instanceof Error?e.name:"Unknown",r=t.includes("CORS 오류")||t.includes("cors"),a=t.includes("네트워크 오류")||t.includes("failed to fetch"),i=t.includes("503")||t.includes("일시적");let s="TDM 분석 중 오류가 발생했습니다.\n\n";t.includes("반코마이신은 현재 정맥 투약 모델만 지원됩니다")||t.includes("투약 경로를 정맥으로 변경")?s=t:r||a?(s+="서버 접근 오류가 발생했습니다.\n",s+=`오류 유형: ${n}\n`,s+=`오류 메시지: ${t.split("\n")[0]}\n\n`,s+="서버 관리자에게 문의하거나 잠시 후 다시 시도해주세요.\n\n",s+="이전에 저장된 결과가 있다면 그것을 표시합니다."):i?(s+="서버 일시적 오류 (503): 서버가 일시적으로 사용 불가능한 상태입니다.\n",s+="잠시 후 다시 시도해주세요.\n\n",s+="이전에 저장된 결과가 있다면 그것을 표시합니다."):(s+=`오류 유형: ${n}\n`,s+=`오류 메시지: ${t}\n\n`,s+="이전에 저장된 결과가 있다면 그것을 표시합니다."),alert(s)}finally{k(!1)}s&&w(i.id)}else w(i.id)},children:[e.jsx("div",{className:"flex items-center gap-1",children:o?e.jsx(pe,{className:"h-4 w-4"}):e.jsx(s,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-xs text-center leading-tight",children:5===i.id&&D?"처리 중...":i.title})]},i.id)})})]})})]}),e.jsxs("div",{className:"min-h-[600px]",children:[1===j&&e.jsx(_n,{patients:t,selectedPatient:a,setSelectedPatient:i,onAddPatient:s,onUpdatePatient:o,onDeletePatient:l,onNext:O,isCompleted:M(1)}),2===j&&e.jsx(ir,{patients:t,prescriptions:n,selectedPatient:a,selectedPrescription:b,setSelectedPrescription:y,onAddPrescription:(e,t)=>{e?(c(e),y(e)):u(t)},onNext:O,onPrev:$,isCompleted:M(2),bloodTests:r,setBloodTests:p,drugAdministrations:g,setDrugAdministrations:x,onClearLaterStepData:P,onResetWorkflow:()=>{P(),v()}}),3===j&&e.jsx(Eo,{patients:t,bloodTests:r,selectedPatient:a,selectedPrescription:b,onAddBloodTest:m,onDeleteBloodTest:f,onNext:O,onPrev:$,isCompleted:M(3),prescriptions:n}),4===j&&e.jsx(Ko,{patients:t,prescriptions:n,selectedPatient:a,selectedPrescription:b,onAddDrugAdministration:h,setDrugAdministrations:x,drugAdministrations:g,bloodTests:r,onNext:O,onPrev:$,isCompleted:M(4)}),5===j&&e.jsx(Ho,{patients:t,prescriptions:n,bloodTests:r,selectedPatient:a,selectedPrescription:b,drugAdministrations:g,onPrev:$})]}),e.jsx(W,{open:S,onOpenChange:T,children:e.jsxs(z,{children:[e.jsxs(K,{children:[e.jsx(B,{children:"TDM Workflow 완료 안내"}),e.jsx(G,{children:"TDM Workflow를 완료한 상태입니다. 새로운 예측 결과를 확인하시려면 투약 기록 단계에서 하단의 TDM Simulation 버튼을 선택해 주세요."})]}),e.jsxs(Y,{children:[e.jsx(q,{onClick:()=>T(!1),children:"취소"}),e.jsx(J,{onClick:()=>{T(!1),w(5)},children:"결과 보기"})]})]})})]})};var Go="Switch",[Yo,qo]=o(Go),[Jo,Xo]=Yo(Go),Zo=N.forwardRef((t,a)=>{const{__scopeSwitch:o,name:l,checked:d,defaultChecked:c,required:u,disabled:m,value:f="on",onCheckedChange:p,form:h,...g}=t,[x,v]=N.useState(null),b=n(a,e=>v(e)),y=N.useRef(!1),j=!x||(h||!!x.closest("form")),[w=!1,D]=r({prop:d,defaultProp:c,onChange:p});return e.jsxs(Jo,{scope:o,checked:w,disabled:m,children:[e.jsx(i.button,{type:"button",role:"switch","aria-checked":w,"aria-required":u,"data-state":nl(w),"data-disabled":m?"":void 0,disabled:m,value:f,...g,ref:b,onClick:s(t.onClick,e=>{D(e=>!e),j&&(y.current=e.isPropagationStopped(),y.current||e.stopPropagation())})}),j&&e.jsx(tl,{control:x,bubbles:!y.current,name:l,value:f,checked:w,required:u,disabled:m,form:h,style:{transform:"translateX(-100%)"}})]})});Zo.displayName=Go;var Qo="SwitchThumb",el=N.forwardRef((t,n)=>{const{__scopeSwitch:r,...a}=t,s=Xo(Qo,r);return e.jsx(i.span,{"data-state":nl(s.checked),"data-disabled":s.disabled?"":void 0,...a,ref:n})});el.displayName=Qo;var tl=t=>{const{control:n,checked:r,bubbles:a=!0,...i}=t,s=N.useRef(null),o=at(r),l=u(n);return N.useEffect(()=>{const e=s.current,t=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(t,"checked").set;if(o!==r&&n){const t=new Event("click",{bubbles:a});n.call(e,r),e.dispatchEvent(t)}},[o,r,a]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...i,tabIndex:-1,ref:s,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function nl(e){return e?"checked":"unchecked"}var rl=Zo,al=el;const il=N.forwardRef(({className:t,...n},r)=>e.jsx(rl,{className:d("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...n,ref:r,children:e.jsx(al,{className:d("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));il.displayName=rl.displayName;var sl=["Enter"," "],ol=["ArrowUp","PageDown","End"],ll=["ArrowDown","PageUp","Home",...ol],dl={ltr:[...sl,"ArrowRight"],rtl:[...sl,"ArrowLeft"]},cl={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ul="Menu",[ml,fl,pl]=t(ul),[hl,gl]=o(ul,[pl,m,ft]),xl=m(),vl=ft(),[bl,yl]=hl(ul),[jl,wl]=hl(ul),Nl=t=>{const{__scopeMenu:n,open:r=!1,children:i,dir:s,onOpenChange:o,modal:l=!0}=t,d=xl(n),[c,u]=N.useState(null),m=N.useRef(!1),f=a(o),p=T(s);return N.useEffect(()=>{const e=()=>{m.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>m.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),e.jsx(y,{...d,children:e.jsx(bl,{scope:n,open:r,onOpenChange:f,content:c,onContentChange:u,children:e.jsx(jl,{scope:n,onClose:N.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:m,dir:p,modal:l,children:i})})})};Nl.displayName=ul;var Dl=N.forwardRef((t,n)=>{const{__scopeMenu:r,...a}=t,i=xl(r);return e.jsx(f,{...i,...a,ref:n})});Dl.displayName="MenuAnchor";var kl="MenuPortal",[Sl,Tl]=hl(kl,{forceMount:void 0}),Cl=t=>{const{__scopeMenu:n,forceMount:r,children:a,container:i}=t,s=yl(kl,n);return e.jsx(Sl,{scope:n,forceMount:r,children:e.jsx(l,{present:r||s.open,children:e.jsx(j,{asChild:!0,container:i,children:a})})})};Cl.displayName=kl;var _l="MenuContent",[Il,Ml]=hl(_l),Ol=N.forwardRef((t,n)=>{const r=Tl(_l,t.__scopeMenu),{forceMount:a=r.forceMount,...i}=t,s=yl(_l,t.__scopeMenu),o=wl(_l,t.__scopeMenu);return e.jsx(ml.Provider,{scope:t.__scopeMenu,children:e.jsx(l,{present:a||s.open,children:e.jsx(ml.Slot,{scope:t.__scopeMenu,children:o.modal?e.jsx($l,{...i,ref:n}):e.jsx(Pl,{...i,ref:n})})})})}),$l=N.forwardRef((t,r)=>{const a=yl(_l,t.__scopeMenu),i=N.useRef(null),o=n(r,i);return N.useEffect(()=>{const e=i.current;if(e)return X(e)},[]),e.jsx(Rl,{...t,ref:o,trapFocus:a.open,disableOutsidePointerEvents:a.open,disableOutsideScroll:!0,onFocusOutside:s(t.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>a.onOpenChange(!1)})}),Pl=N.forwardRef((t,n)=>{const r=yl(_l,t.__scopeMenu);return e.jsx(Rl,{...t,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),Rl=N.forwardRef((t,r)=>{const{__scopeMenu:a,loop:i=!1,trapFocus:o,onOpenAutoFocus:l,onCloseAutoFocus:d,disableOutsidePointerEvents:c,onEntryFocus:u,onEscapeKeyDown:m,onPointerDownOutside:f,onFocusOutside:g,onInteractOutside:x,onDismiss:b,disableOutsideScroll:y,...j}=t,w=yl(_l,a),D=wl(_l,a),k=xl(a),S=vl(a),T=fl(a),[C,_]=N.useState(null),I=N.useRef(null),M=n(r,I,w.onContentChange),O=N.useRef(0),$=N.useRef(""),P=N.useRef(0),R=N.useRef(null),A=N.useRef("right"),E=N.useRef(0),L=y?ee:N.Fragment,F=y?{as:v,allowPinchZoom:!0}:void 0,V=e=>{var t,n;const r=$.current+e,a=T().filter(e=>!e.disabled),i=document.activeElement,s=null==(t=a.find(e=>e.ref.current===i))?void 0:t.textValue,o=function(e,t,n){const r=t.length>1&&Array.from(t).every(e=>e===t[0]),a=r?t[0]:t,i=n?e.indexOf(n):-1;let s=(o=e,l=Math.max(i,0),o.map((e,t)=>o[(l+t)%o.length]));var o,l;1===a.length&&(s=s.filter(e=>e!==n));const d=s.find(e=>e.toLowerCase().startsWith(a.toLowerCase()));return d!==n?d:void 0}(a.map(e=>e.textValue),r,s),l=null==(n=a.find(e=>e.textValue===o))?void 0:n.ref.current;!function e(t){$.current=t,window.clearTimeout(O.current),""!==t&&(O.current=window.setTimeout(()=>e(""),1e3))}(r),l&&setTimeout(()=>l.focus())};N.useEffect(()=>()=>window.clearTimeout(O.current),[]),Z();const H=N.useCallback(e=>{var t,n;return A.current===(null==(t=R.current)?void 0:t.side)&&function(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return function(e,t){const{x:n,y:r}=e;let a=!1;for(let i=0,s=t.length-1;i<t.length;s=i++){const e=t[i].x,o=t[i].y,l=t[s].x,d=t[s].y;o>r!=d>r&&n<(l-e)*(r-o)/(d-o)+e&&(a=!a)}return a}(n,t)}(e,null==(n=R.current)?void 0:n.area)},[]);return e.jsx(Il,{scope:a,searchRef:$,onItemEnter:N.useCallback(e=>{H(e)&&e.preventDefault()},[H]),onItemLeave:N.useCallback(e=>{var t;H(e)||(null==(t=I.current)||t.focus(),_(null))},[H]),onTriggerLeave:N.useCallback(e=>{H(e)&&e.preventDefault()},[H]),pointerGraceTimerRef:P,onPointerGraceIntentChange:N.useCallback(e=>{R.current=e},[]),children:e.jsx(L,{...F,children:e.jsx(Q,{asChild:!0,trapped:o,onMountAutoFocus:s(l,e=>{var t;e.preventDefault(),null==(t=I.current)||t.focus({preventScroll:!0})}),onUnmountAutoFocus:d,children:e.jsx(p,{asChild:!0,disableOutsidePointerEvents:c,onEscapeKeyDown:m,onPointerDownOutside:f,onFocusOutside:g,onInteractOutside:x,onDismiss:b,children:e.jsx(wt,{asChild:!0,...S,dir:D.dir,orientation:"vertical",loop:i,currentTabStopId:C,onCurrentTabStopIdChange:_,onEntryFocus:s(u,e=>{D.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(h,{role:"menu","aria-orientation":"vertical","data-state":od(w.open),"data-radix-menu-content":"",dir:D.dir,...k,...j,ref:M,style:{outline:"none",...j.style},onKeyDown:s(j.onKeyDown,e=>{const t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,r=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&r&&V(e.key));const a=I.current;if(e.target!==a)return;if(!ll.includes(e.key))return;e.preventDefault();const i=T().filter(e=>!e.disabled).map(e=>e.ref.current);ol.includes(e.key)&&i.reverse(),function(e){const t=document.activeElement;for(const n of e){if(n===t)return;if(n.focus(),document.activeElement!==t)return}}(i)}),onBlur:s(t.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(O.current),$.current="")}),onPointerMove:s(t.onPointerMove,cd(e=>{const t=e.target,n=E.current!==e.clientX;if(e.currentTarget.contains(t)&&n){const t=e.clientX>E.current?"right":"left";A.current=t,E.current=e.clientX}}))})})})})})})});Ol.displayName=_l;var Al=N.forwardRef((t,n)=>{const{__scopeMenu:r,...a}=t;return e.jsx(i.div,{role:"group",...a,ref:n})});Al.displayName="MenuGroup";var El=N.forwardRef((t,n)=>{const{__scopeMenu:r,...a}=t;return e.jsx(i.div,{...a,ref:n})});El.displayName="MenuLabel";var Ll="MenuItem",Fl="menu.itemSelect",Vl=N.forwardRef((t,r)=>{const{disabled:a=!1,onSelect:i,...o}=t,l=N.useRef(null),d=wl(Ll,t.__scopeMenu),c=Ml(Ll,t.__scopeMenu),u=n(r,l),m=N.useRef(!1);return e.jsx(Hl,{...o,ref:u,disabled:a,onClick:s(t.onClick,()=>{const e=l.current;if(!a&&e){const t=new CustomEvent(Fl,{bubbles:!0,cancelable:!0});e.addEventListener(Fl,e=>null==i?void 0:i(e),{once:!0}),b(e,t),t.defaultPrevented?m.current=!1:d.onClose()}}),onPointerDown:e=>{var n;null==(n=t.onPointerDown)||n.call(t,e),m.current=!0},onPointerUp:s(t.onPointerUp,e=>{var t;m.current||null==(t=e.currentTarget)||t.click()}),onKeyDown:s(t.onKeyDown,e=>{const t=""!==c.searchRef.current;a||t&&" "===e.key||sl.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});Vl.displayName=Ll;var Hl=N.forwardRef((t,r)=>{const{__scopeMenu:a,disabled:o=!1,textValue:l,...d}=t,c=Ml(Ll,a),u=vl(a),m=N.useRef(null),f=n(r,m),[p,h]=N.useState(!1),[g,x]=N.useState("");return N.useEffect(()=>{const e=m.current;e&&x((e.textContent??"").trim())},[d.children]),e.jsx(ml.ItemSlot,{scope:a,disabled:o,textValue:l??g,children:e.jsx(Nt,{asChild:!0,...u,focusable:!o,children:e.jsx(i.div,{role:"menuitem","data-highlighted":p?"":void 0,"aria-disabled":o||void 0,"data-disabled":o?"":void 0,...d,ref:f,onPointerMove:s(t.onPointerMove,cd(e=>{if(o)c.onItemLeave(e);else if(c.onItemEnter(e),!e.defaultPrevented){e.currentTarget.focus({preventScroll:!0})}})),onPointerLeave:s(t.onPointerLeave,cd(e=>c.onItemLeave(e))),onFocus:s(t.onFocus,()=>h(!0)),onBlur:s(t.onBlur,()=>h(!1))})})})}),Ul=N.forwardRef((t,n)=>{const{checked:r=!1,onCheckedChange:a,...i}=t;return e.jsx(Jl,{scope:t.__scopeMenu,checked:r,children:e.jsx(Vl,{role:"menuitemcheckbox","aria-checked":ld(r)?"mixed":r,...i,ref:n,"data-state":dd(r),onSelect:s(i.onSelect,()=>null==a?void 0:a(!!ld(r)||!r),{checkForDefaultPrevented:!1})})})});Ul.displayName="MenuCheckboxItem";var Wl="MenuRadioGroup",[zl,Kl]=hl(Wl,{value:void 0,onValueChange:()=>{}}),Bl=N.forwardRef((t,n)=>{const{value:r,onValueChange:i,...s}=t,o=a(i);return e.jsx(zl,{scope:t.__scopeMenu,value:r,onValueChange:o,children:e.jsx(Al,{...s,ref:n})})});Bl.displayName=Wl;var Gl="MenuRadioItem",Yl=N.forwardRef((t,n)=>{const{value:r,...a}=t,i=Kl(Gl,t.__scopeMenu),o=r===i.value;return e.jsx(Jl,{scope:t.__scopeMenu,checked:o,children:e.jsx(Vl,{role:"menuitemradio","aria-checked":o,...a,ref:n,"data-state":dd(o),onSelect:s(a.onSelect,()=>{var e;return null==(e=i.onValueChange)?void 0:e.call(i,r)},{checkForDefaultPrevented:!1})})})});Yl.displayName=Gl;var ql="MenuItemIndicator",[Jl,Xl]=hl(ql,{checked:!1}),Zl=N.forwardRef((t,n)=>{const{__scopeMenu:r,forceMount:a,...s}=t,o=Xl(ql,r);return e.jsx(l,{present:a||ld(o.checked)||!0===o.checked,children:e.jsx(i.span,{...s,ref:n,"data-state":dd(o.checked)})})});Zl.displayName=ql;var Ql=N.forwardRef((t,n)=>{const{__scopeMenu:r,...a}=t;return e.jsx(i.div,{role:"separator","aria-orientation":"horizontal",...a,ref:n})});Ql.displayName="MenuSeparator";var ed=N.forwardRef((t,n)=>{const{__scopeMenu:r,...a}=t,i=xl(r);return e.jsx(g,{...i,...a,ref:n})});ed.displayName="MenuArrow";var[td,nd]=hl("MenuSub"),rd="MenuSubTrigger",ad=N.forwardRef((t,n)=>{const r=yl(rd,t.__scopeMenu),a=wl(rd,t.__scopeMenu),i=nd(rd,t.__scopeMenu),o=Ml(rd,t.__scopeMenu),l=N.useRef(null),{pointerGraceTimerRef:d,onPointerGraceIntentChange:c}=o,u={__scopeMenu:t.__scopeMenu},m=N.useCallback(()=>{l.current&&window.clearTimeout(l.current),l.current=null},[]);return N.useEffect(()=>m,[m]),N.useEffect(()=>{const e=d.current;return()=>{window.clearTimeout(e),c(null)}},[d,c]),e.jsx(Dl,{asChild:!0,...u,children:e.jsx(Hl,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":i.contentId,"data-state":od(r.open),...t,ref:x(n,i.onTriggerChange),onClick:e=>{var n;null==(n=t.onClick)||n.call(t,e),t.disabled||e.defaultPrevented||(e.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:s(t.onPointerMove,cd(e=>{o.onItemEnter(e),e.defaultPrevented||t.disabled||r.open||l.current||(o.onPointerGraceIntentChange(null),l.current=window.setTimeout(()=>{r.onOpenChange(!0),m()},100))})),onPointerLeave:s(t.onPointerLeave,cd(e=>{var t,n;m();const a=null==(t=r.content)?void 0:t.getBoundingClientRect();if(a){const t=null==(n=r.content)?void 0:n.dataset.side,i="right"===t,s=i?-5:5,l=a[i?"left":"right"],c=a[i?"right":"left"];o.onPointerGraceIntentChange({area:[{x:e.clientX+s,y:e.clientY},{x:l,y:a.top},{x:c,y:a.top},{x:c,y:a.bottom},{x:l,y:a.bottom}],side:t}),window.clearTimeout(d.current),d.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(e),e.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:s(t.onKeyDown,e=>{var n;const i=""!==o.searchRef.current;t.disabled||i&&" "===e.key||dl[a.dir].includes(e.key)&&(r.onOpenChange(!0),null==(n=r.content)||n.focus(),e.preventDefault())})})})});ad.displayName=rd;var id="MenuSubContent",sd=N.forwardRef((t,r)=>{const a=Tl(_l,t.__scopeMenu),{forceMount:i=a.forceMount,...o}=t,d=yl(_l,t.__scopeMenu),c=wl(_l,t.__scopeMenu),u=nd(id,t.__scopeMenu),m=N.useRef(null),f=n(r,m);return e.jsx(ml.Provider,{scope:t.__scopeMenu,children:e.jsx(l,{present:i||d.open,children:e.jsx(ml.Slot,{scope:t.__scopeMenu,children:e.jsx(Rl,{id:u.contentId,"aria-labelledby":u.triggerId,...o,ref:f,align:"start",side:"rtl"===c.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;c.isUsingKeyboardRef.current&&(null==(t=m.current)||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:s(t.onFocusOutside,e=>{e.target!==u.trigger&&d.onOpenChange(!1)}),onEscapeKeyDown:s(t.onEscapeKeyDown,e=>{c.onClose(),e.preventDefault()}),onKeyDown:s(t.onKeyDown,e=>{var t;const n=e.currentTarget.contains(e.target),r=cl[c.dir].includes(e.key);n&&r&&(d.onOpenChange(!1),null==(t=u.trigger)||t.focus(),e.preventDefault())})})})})})});function od(e){return e?"open":"closed"}function ld(e){return"indeterminate"===e}function dd(e){return ld(e)?"indeterminate":e?"checked":"unchecked"}function cd(e){return t=>"mouse"===t.pointerType?e(t):void 0}sd.displayName=id;var ud=Nl,md=Dl,fd=Cl,pd=Ol,hd=Al,gd=El,xd=Vl,vd=Ul,bd=Bl,yd=Yl,jd=Zl,wd=Ql,Nd=ed,Dd=ad,kd=sd,Sd="DropdownMenu",[Td,Cd]=o(Sd,[gl]),_d=gl(),[Id,Md]=Td(Sd),Od=t=>{const{__scopeDropdownMenu:n,children:a,dir:i,open:s,defaultOpen:o,onOpenChange:l,modal:d=!0}=t,c=_d(n),u=N.useRef(null),[m=!1,f]=r({prop:s,defaultProp:o,onChange:l});return e.jsx(Id,{scope:n,triggerId:C(),triggerRef:u,contentId:C(),open:m,onOpenChange:f,onOpenToggle:N.useCallback(()=>f(e=>!e),[f]),modal:d,children:e.jsx(ud,{...c,open:m,onOpenChange:f,dir:i,modal:d,children:a})})};Od.displayName=Sd;var $d="DropdownMenuTrigger",Pd=N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,disabled:a=!1,...o}=t,l=Md($d,r),d=_d(r);return e.jsx(md,{asChild:!0,...d,children:e.jsx(i.button,{type:"button",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":l.open?l.contentId:void 0,"data-state":l.open?"open":"closed","data-disabled":a?"":void 0,disabled:a,...o,ref:x(n,l.triggerRef),onPointerDown:s(t.onPointerDown,e=>{a||0!==e.button||!1!==e.ctrlKey||(l.onOpenToggle(),l.open||e.preventDefault())}),onKeyDown:s(t.onKeyDown,e=>{a||(["Enter"," "].includes(e.key)&&l.onOpenToggle(),"ArrowDown"===e.key&&l.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});Pd.displayName=$d;var Rd=t=>{const{__scopeDropdownMenu:n,...r}=t,a=_d(n);return e.jsx(fd,{...a,...r})};Rd.displayName="DropdownMenuPortal";var Ad="DropdownMenuContent",Ed=N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...a}=t,i=Md(Ad,r),o=_d(r),l=N.useRef(!1);return e.jsx(pd,{id:i.contentId,"aria-labelledby":i.triggerId,...o,...a,ref:n,onCloseAutoFocus:s(t.onCloseAutoFocus,e=>{var t;l.current||null==(t=i.triggerRef.current)||t.focus(),l.current=!1,e.preventDefault()}),onInteractOutside:s(t.onInteractOutside,e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;i.modal&&!r||(l.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ed.displayName=Ad;N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...a}=t,i=_d(r);return e.jsx(hd,{...i,...a,ref:n})}).displayName="DropdownMenuGroup";var Ld=N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...a}=t,i=_d(r);return e.jsx(gd,{...i,...a,ref:n})});Ld.displayName="DropdownMenuLabel";var Fd=N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...a}=t,i=_d(r);return e.jsx(xd,{...i,...a,ref:n})});Fd.displayName="DropdownMenuItem";var Vd=N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...a}=t,i=_d(r);return e.jsx(vd,{...i,...a,ref:n})});Vd.displayName="DropdownMenuCheckboxItem";N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...a}=t,i=_d(r);return e.jsx(bd,{...i,...a,ref:n})}).displayName="DropdownMenuRadioGroup";var Hd=N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...a}=t,i=_d(r);return e.jsx(yd,{...i,...a,ref:n})});Hd.displayName="DropdownMenuRadioItem";var Ud=N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...a}=t,i=_d(r);return e.jsx(jd,{...i,...a,ref:n})});Ud.displayName="DropdownMenuItemIndicator";var Wd=N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...a}=t,i=_d(r);return e.jsx(wd,{...i,...a,ref:n})});Wd.displayName="DropdownMenuSeparator";N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...a}=t,i=_d(r);return e.jsx(Nd,{...i,...a,ref:n})}).displayName="DropdownMenuArrow";var zd=N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...a}=t,i=_d(r);return e.jsx(Dd,{...i,...a,ref:n})});zd.displayName="DropdownMenuSubTrigger";var Kd=N.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...a}=t,i=_d(r);return e.jsx(kd,{...i,...a,ref:n,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Kd.displayName="DropdownMenuSubContent";var Bd=Od,Gd=Pd,Yd=Rd,qd=Ed,Jd=Ld,Xd=Fd,Zd=Vd,Qd=Hd,ec=Ud,tc=Wd,nc=zd,rc=Kd;const ac=N.forwardRef(({modal:t=!1,...n},r)=>e.jsx(Bd,{ref:r,modal:t,...n}));ac.displayName="DropdownMenu";const ic=Gd;N.forwardRef(({className:t,inset:n,children:r,...a},i)=>e.jsxs(nc,{ref:i,className:d("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",t),...a,children:[r,e.jsx(Te,{className:"ml-auto h-4 w-4"})]})).displayName=nc.displayName;N.forwardRef(({className:t,...n},r)=>e.jsx(rc,{ref:r,className:d("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})).displayName=rc.displayName;const sc=N.forwardRef(({className:t,sideOffset:n=4,...r},a)=>e.jsx(Yd,{children:e.jsx(qd,{ref:a,sideOffset:n,className:d("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));sc.displayName=qd.displayName;const oc=N.forwardRef(({className:t,inset:n,...r},a)=>e.jsx(Xd,{ref:a,className:d("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",t),...r}));oc.displayName=Xd.displayName;N.forwardRef(({className:t,children:n,checked:r,...a},i)=>e.jsxs(Zd,{ref:i,className:d("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ec,{children:e.jsx(Ce,{className:"h-4 w-4"})})}),n]})).displayName=Zd.displayName;N.forwardRef(({className:t,children:n,...r},a)=>e.jsxs(Qd,{ref:a,className:d("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ec,{children:e.jsx(ve,{className:"h-2 w-2 fill-current"})})}),n]})).displayName=Qd.displayName;const lc=N.forwardRef(({className:t,inset:n,...r},a)=>e.jsx(Jd,{ref:a,className:d("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",t),...r}));lc.displayName=Jd.displayName;const dc=N.forwardRef(({className:t,...n},r)=>e.jsx(tc,{ref:r,className:d("-mx-1 my-1 h-px bg-muted",t),...n}));dc.displayName=tc.displayName;var cc="Avatar",[uc,mc]=o(cc),[fc,pc]=uc(cc),hc=N.forwardRef((t,n)=>{const{__scopeAvatar:r,...a}=t,[s,o]=N.useState("idle");return e.jsx(fc,{scope:r,imageLoadingStatus:s,onImageLoadingStatusChange:o,children:e.jsx(i.span,{...a,ref:n})})});hc.displayName=cc;var gc="AvatarImage",xc=N.forwardRef((t,n)=>{const{__scopeAvatar:r,src:s,onLoadingStatusChange:o=()=>{},...l}=t,d=pc(gc,r),c=function(e,t){const[n,r]=N.useState("idle");return w(()=>{if(!e)return void r("error");let n=!0;const a=new window.Image,i=e=>()=>{n&&r(e)};return r("loading"),a.onload=i("loaded"),a.onerror=i("error"),a.src=e,t&&(a.referrerPolicy=t),()=>{n=!1}},[e,t]),n}(s,l.referrerPolicy),u=a(e=>{o(e),d.onImageLoadingStatusChange(e)});return w(()=>{"idle"!==c&&u(c)},[c,u]),"loaded"===c?e.jsx(i.img,{...l,ref:n,src:s}):null});xc.displayName=gc;var vc="AvatarFallback",bc=N.forwardRef((t,n)=>{const{__scopeAvatar:r,delayMs:a,...s}=t,o=pc(vc,r),[l,d]=N.useState(void 0===a);return N.useEffect(()=>{if(void 0!==a){const e=window.setTimeout(()=>d(!0),a);return()=>window.clearTimeout(e)}},[a]),l&&"loaded"!==o.imageLoadingStatus?e.jsx(i.span,{...s,ref:n}):null});bc.displayName=vc;var yc=hc,jc=xc,wc=bc;const Nc=N.forwardRef(({className:t,...n},r)=>e.jsx(yc,{ref:r,className:d("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...n}));Nc.displayName=yc.displayName;const Dc=N.forwardRef(({className:t,...n},r)=>e.jsx(jc,{ref:r,className:d("aspect-square h-full w-full",t),...n}));Dc.displayName=jc.displayName;const kc=N.forwardRef(({className:t,...n},r)=>e.jsx(wc,{ref:r,className:d("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...n}));kc.displayName=wc.displayName;const Sc=({open:t,onOpenChange:n})=>{const[r,a]=N.useState({name:"사용자",email:"user@pk-friends.com",phone:"",organization:"PK 프렌즈 대학병원",role:"doctor"}),[i,s]=N.useState({name:"사용자",email:"user@pk-friends.com",phone:"",organization:"PK 프렌즈 대학병원",role:"doctor"}),[o,l]=N.useState(!1),[d,c]=N.useState(null),[u,m]=N.useState(null),f=["앳플로우"],p=(()=>{const e=new Set(f);return i.organization&&""!==i.organization.trim()&&e.add(i.organization),Array.from(e)})();N.useEffect(()=>{t&&h()},[t]);const h=()=>{const e=Ae.getJSON(Ee.userProfile);e&&(a(e),s(e),e.profileImage?(c(e.profileImage),m(e.profileImage)):(c(null),m(null)))},g=e=>{if(!e||""===e.trim())return null;const t=/[가-힣]/.test(e),n=/[a-zA-Z]/.test(e);if(/^[ㄱ-ㅎㅏ-ㅣ]+$/.test(e))return"완성된 한글만 입력 가능합니다. (자음/모음만 입력 불가)";if(t&&n)return"이름은 한글 또는 영문으로만 입력해 주세요. (혼용 불가)";if(t){if(e.length<2)return"한글 이름은 2자 이상 입력해 주세요.";if(e.length>10)return"한글 이름은 2~10자까지 입력 가능합니다.";if(/[\s0-9]/.test(e)||/[^가-힣]/.test(e))return"한글 이름은 한글만 입력 가능합니다. (띄어쓰기, 숫자, 특수문자 불가)"}if(n){if(e.length<2)return"영문 이름은 2자 이상 입력해 주세요.";if(e.length>50)return"영문 이름은 2~50자까지 입력 가능합니다.";if(/[0-9]/.test(e))return"영문 이름에는 숫자를 입력할 수 없습니다.";if(/[^a-zA-Z\s,\-]/.test(e))return"영문 이름은 영문, 띄어쓰기, comma(,), dash(-)만 입력 가능합니다."}return!t&&!n&&e.length>0?"이름은 한글 또는 영문으로 입력해 주세요.":null},x=e=>{if(o)return void s({...i,name:e.target.value});const t=i.name,n=((e,t)=>{if(""===e)return{value:"",shouldShowToast:!1};const n=/[가-힣]/.test(e),r=/[a-zA-Z]/.test(e),a=/[가-힣]/.test(t),i=/[a-zA-Z]/.test(t);if(n&&r&&(!a||!i))return{value:t,shouldShowToast:!0};let s=e,o=!1;if(n){if(/^[ㄱ-ㅎㅏ-ㅣ]+$/.test(e))return{value:t,shouldShowToast:!0};if(s=e.replace(/[^가-힣]/g,""),s=s.replace(/[ㄱ-ㅎㅏ-ㅣ]/g,""),s!==e&&(o=s!==t&&e!==t),s.length>10){const e=t.length<=10&&s.length>10;s=s.slice(0,10),o=o||e}}else if(r){if(/^[a-zA-Z\s,\-]*$/.test(e)||(s=e.replace(/[^a-zA-Z\s,\-]/g,""),o=s!==t&&e!==t),s.length>50){const e=t.length<=50&&s.length>50;s=s.slice(0,50),o=o||e}}else s="",o=e!==t;return{value:s,shouldShowToast:o}})(e.target.value,t);s({...i,name:n.value})};return e.jsx(e.Fragment,{children:e.jsx(Zt,{open:t,onOpenChange:n,children:e.jsxs(nn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto [&>button]:h-10 [&>button]:w-10 [&>button_svg]:h-6 [&>button_svg]:w-6",children:[e.jsxs(rn,{children:[e.jsx(sn,{children:"프로필 설정"}),e.jsx(on,{children:"사용자 정보를 확인하고 프로필을 관리할 수 있습니다."})]}),e.jsx("div",{className:"space-y-6 py-4",children:e.jsx(te,{children:e.jsx(ie,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(Nc,{className:"h-32 w-32",children:[e.jsx(Dc,{src:u||i.profileImage,alt:i.name}),e.jsx(kc,{className:"text-3xl",children:i.name.charAt(0)})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx(E,{htmlFor:"profile-image",className:"cursor-pointer",children:e.jsx(se,{variant:"outline",asChild:!0,className:"w-full",children:e.jsxs("span",{children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"사진 변경"]})})}),e.jsx(oe,{id:"profile-image",type:"file",accept:"image/*",onChange:e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];if(n){if(n.size>5242880)return void alert("파일 크기는 5MB 이하여야 합니다.");if(!n.type.startsWith("image/"))return void alert("이미지 파일만 업로드 가능합니다.");const e=new FileReader;e.onloadend=()=>{const t=e.result;m(t)},e.readAsDataURL(n)}},className:"hidden"}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"JPG, PNG, BMP 형식 지원 (최대 5MB)"})]})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"이름"}),e.jsx(oe,{type:"text",value:i.name,onChange:x,onCompositionStart:()=>{l(!0)},onCompositionEnd:e=>{l(!1),x(e)},maxLength:100}),g(i.name)&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:g(i.name)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"전화번호"}),e.jsx(oe,{value:i.phone||"",disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"전화번호 변경은 고객센터로 문의주세요."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"소속기관"}),e.jsxs(L,{value:i.organization,onValueChange:e=>{s({...i,organization:e})},children:[e.jsx(F,{children:e.jsx(V,{placeholder:"소속기관을 선택하세요"})}),e.jsx(H,{children:p.map(t=>e.jsx(U,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"직무"}),e.jsxs(L,{value:(e=>{switch(e){case"doctor":return"의사";case"nurse":return"간호사";case"other":return"기타";default:return e}})(i.role),onValueChange:e=>{s({...i,role:{"의사":"doctor","간호사":"nurse","기타":"other"}[e]||"other"})},children:[e.jsx(F,{children:e.jsx(V,{placeholder:"직무를 선택하세요"})}),e.jsxs(H,{children:[e.jsx(U,{value:"의사",children:"의사"}),e.jsx(U,{value:"간호사",children:"간호사"}),e.jsx(U,{value:"기타",children:"기타"})]})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx(se,{onClick:()=>{if(g(i.name))return;const e={...i,profileImage:u||void 0};a(e),c(u),Ae.setJSON(Ee.userProfile,e),n(!1)},disabled:!(i.name!==r.name||i.organization!==r.organization||i.role!==r.role||u!==(r.profileImage||null))||!!g(i.name),className:"w-full",children:"저장"})})]})})]})})})})]})})})},Tc=N.forwardRef(({className:t,...n},r)=>e.jsx("textarea",{className:d("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...n}));Tc.displayName="Textarea";const Cc=Ie("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function _c({className:t,variant:n,...r}){return e.jsx("div",{className:d(Cc({variant:n}),t),...r})}var Ic="horizontal",Mc=["horizontal","vertical"],Oc=N.forwardRef((t,n)=>{const{decorative:r,orientation:a=Ic,...s}=t,o=function(e){return Mc.includes(e)}(a)?a:Ic,l=r?{role:"none"}:{"aria-orientation":"vertical"===o?o:void 0,role:"separator"};return e.jsx(i.div,{"data-orientation":o,...l,...s,ref:n})});Oc.displayName="Separator";var $c=Oc;const Pc=N.forwardRef(({className:t,orientation:n="horizontal",decorative:r=!0,...a},i)=>e.jsx($c,{ref:i,decorative:r,orientation:n,className:d("shrink-0 bg-border","horizontal"===n?"h-[1px] w-full":"h-full w-[1px]",t),...a}));Pc.displayName=$c.displayName;const Rc=({open:t,onOpenChange:n})=>{const[r,a]=N.useState([]),[i,s]=N.useState(""),[o,l]=N.useState(""),[d,c]=N.useState(""),[u,m]=N.useState([]),[f,p]=N.useState([]),[h,g]=N.useState(null);N.useEffect(()=>{t&&x()},[t]);const x=()=>{const e=Ae.getJSON(Ee.inquiries,[]),t=(e||[]).map(e=>"pending"===e.status||"in_progress"===e.status?{...e,status:"received"}:"resolved"===e.status?{...e,status:"answered"}:e);a(t),e&&e.some(e=>"pending"===e.status||"in_progress"===e.status||"resolved"===e.status)&&Ae.setJSON(Ee.inquiries,t)},v=t=>{switch(t){case"received":return e.jsxs(_c,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(Re,{className:"h-3 w-3 mr-1"}),"접수완료"]});case"answered":return e.jsxs(_c,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),"답변완료"]});default:return null}},b=e=>{switch(e){case"received":return"문의가 접수되었습니다. 빠른 시일 내에 답변드리겠습니다.";case"answered":return"문의에 대한 답변이 완료되었습니다.";default:return""}};return e.jsx(Zt,{open:t,onOpenChange:n,children:e.jsxs(nn,{className:"max-w-4xl h-[85vh] flex flex-col [&>button]:h-10 [&>button]:w-10 [&>button_svg]:h-6 [&>button_svg]:w-6",children:[e.jsxs(rn,{children:[e.jsx(sn,{children:"고객센터"}),e.jsx(on,{children:"문의사항을 등록하거나 처리 내역을 확인할 수 있습니다."})]}),e.jsxs(Ut,{defaultValue:"inquiry",className:"w-full flex-1 flex flex-col min-h-0",children:[e.jsxs(Wt,{className:"grid w-full grid-cols-2",children:[e.jsx(zt,{value:"inquiry",children:"문의하기"}),e.jsx(zt,{value:"history",children:"처리내역"})]}),e.jsx(Kt,{value:"inquiry",className:"space-y-4 flex-1 overflow-y-auto mt-4",children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(re,{className:"text-lg",children:"문의 등록"}),e.jsx(ae,{children:"문의사항을 작성해주세요. 빠른 시일 내에 답변드리겠습니다."})]}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"title",children:"문의 제목 *"}),e.jsx(oe,{id:"title",value:i,onChange:e=>s(e.target.value),placeholder:"문의 제목을 입력해주세요",maxLength:60}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.length,"/60자"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"error-type",children:"오류 유형 *"}),e.jsxs(L,{value:o,onValueChange:l,children:[e.jsx(F,{id:"error-type",children:e.jsx(V,{placeholder:"오류 유형을 선택해주세요"})}),e.jsxs(H,{children:[e.jsx(U,{value:"bug",children:"버그/오류"}),e.jsx(U,{value:"feature",children:"기능 개선 요청"}),e.jsx(U,{value:"usage",children:"사용법 문의"}),e.jsx(U,{value:"account",children:"계정 관련"}),e.jsx(U,{value:"other",children:"기타"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"content",children:"문의 내용 *"}),e.jsx(Tc,{id:"content",value:d,onChange:e=>{const t=e.target.value,n=t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<[^>]*>/g,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").replace(/data:/gi,"");n!==t&&alert("입력할 수 없는 문자가 포함되어 있습니다."),c(n)},placeholder:"문의 내용을 상세히 작성해주세요",rows:6,maxLength:1e3}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.length,"/1000자"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"images",children:"이미지 첨부 (최대 5장)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{htmlFor:"image-upload",className:"cursor-pointer",children:e.jsx(se,{variant:"outline",asChild:!0,children:e.jsxs("span",{children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"이미지 선택"]})})}),e.jsx(oe,{id:"image-upload",type:"file",accept:"image/jpeg,image/jpg,image/png,image/bmp",multiple:!0,onChange:e=>{const t=Array.from(e.target.files||[]);if(u.length+t.length>5)return void alert("이미지는 최대 5장까지 업로드 가능합니다.");const n=[],r=[];t.forEach(e=>{if(!["image/jpeg","image/jpg","image/png","image/bmp"].includes(e.type))return void alert(`${e.name}은(는) 지원하지 않는 형식입니다. (JPG, PNG, BMP만 가능)`);if(e.size>5242880)return void alert(`${e.name}의 크기가 5MB를 초과합니다.`);n.push(e);const t=new Promise(t=>{const n=new FileReader;n.onloadend=()=>{t(n.result)},n.readAsDataURL(e)});r.push(t)}),Promise.all(r).then(e=>{m([...u,...n]),p([...f,...e])}),e.target.value=""},className:"hidden"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"JPG, PNG, BMP 형식 지원 (각 파일 최대 5MB)"})]}),f.length>0&&e.jsx("div",{className:"grid grid-cols-5 gap-2 mt-2",children:f.map((t,n)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`미리보기 ${n+1}`,className:"w-full h-24 object-cover rounded border"}),e.jsx(se,{variant:"destructive",size:"icon",className:"absolute top-1 right-1 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>(e=>{const t=u.filter((t,n)=>n!==e),n=f.filter((t,n)=>n!==e);m(t),p(n)})(n),children:e.jsx(le,{className:"h-3 w-3"})})]},n))})]}),e.jsx(se,{onClick:()=>{if(!i.trim())return void alert("문의 제목을 입력해주세요.");if(i.length>60)return void alert("문의 제목은 최대 60자까지 입력 가능합니다.");if(!o)return void alert("오류 유형을 선택해주세요.");if(!d.trim())return void alert("문의 내용을 입력해주세요.");if(d.length>1e3)return void alert("문의 내용은 최대 1000자까지 입력 가능합니다.");const e=u.map(e=>new Promise(t=>{const n=new FileReader;n.onloadend=()=>{t(n.result)},n.readAsDataURL(e)}));Promise.all(e).then(e=>{const t=[{id:`inquiry-${Date.now()}`,title:i,errorType:o,content:d,images:e,status:"received",createdAt:(new Date).toISOString()},...r];var n;a(n=t),Ae.setJSON(Ee.inquiries,n),s(""),l(""),c(""),m([]),p([]),alert("문의가 등록되었습니다.")})},className:"w-full",children:"문의 등록"})]})]})}),e.jsx(Kt,{value:"history",className:"space-y-4 flex-1 overflow-y-auto mt-4",children:0===r.length?e.jsx(te,{children:e.jsx(ie,{className:"py-8 text-center text-muted-foreground",children:"등록된 문의가 없습니다."})}):e.jsx("div",{className:"space-y-4",children:r.map(t=>{const n=h===t.id;return e.jsxs(te,{className:"cursor-pointer hover:shadow-md transition-all",onClick:()=>{g(n?null:t.id)},children:[e.jsx(ne,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(re,{className:"text-base truncate",children:t.title.length>45?`${t.title.substring(0,45)}...`:t.title}),e.jsx(ae,{className:"mt-1",children:new Date(t.createdAt).toLocaleString("ko-KR")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v(t.status),e.jsx(Oe,{className:"h-4 w-4 text-muted-foreground transition-transform duration-200 "+(n?"rotate-180":"")})]})]})}),!n&&e.jsxs(ie,{children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.content}),t.images.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx($e,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["이미지 ",t.images.length,"장"]})]})]}),n&&e.jsxs(ie,{className:"space-y-4 pt-0",children:[e.jsx(Pc,{}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-semibold",children:"오류 유형"}),e.jsx("p",{className:"mt-1 text-sm",children:"bug"===t.errorType?"버그/오류":"feature"===t.errorType?"기능 개선 요청":"usage"===t.errorType?"사용법 문의":"account"===t.errorType?"계정 관련":"기타"})]}),e.jsx(Pc,{}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-semibold",children:"문의 내용"}),e.jsx("p",{className:"mt-1 text-sm whitespace-pre-wrap",children:t.content})]}),t.images.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Pc,{}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-semibold",children:"첨부 이미지"}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:t.images.map((t,n)=>e.jsx("img",{src:t,alt:`첨부 이미지 ${n+1}`,className:"w-full h-32 object-cover rounded border"},n))})]})]}),e.jsx(Pc,{}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-semibold",children:"처리 현황"}),e.jsx("div",{className:"mt-2 p-3 bg-muted rounded-md",children:e.jsx("p",{className:"text-sm",children:b(t.status)})})]}),t.response&&e.jsxs(e.Fragment,{children:[e.jsx(Pc,{}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-semibold",children:"처리 답변"}),e.jsxs("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-950 rounded-md",children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.response}),t.respondedAt&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:new Date(t.respondedAt).toLocaleString("ko-KR")})]})]})]})]})]},t.id)})})})]})]})})},Ac=({onLogout:t})=>{const[n,r]=N.useState([]),[a,i]=N.useState([]),[s,o]=N.useState([]),[l,d]=N.useState([]),[c,u]=N.useState(null),[m,f]=N.useState(!1),[p,h]=N.useState(!1),[g,x]=N.useState(!1),[v,b]=N.useState("workflow"),[y,j]=N.useState(!1),[w,D]=N.useState(null),[k,S]=N.useState(!1),[T,C]=N.useState(!1);N.useEffect(()=>{const e=window.document.documentElement;m?e.classList.add("dark"):e.classList.remove("dark")},[m]),N.useEffect(()=>{const e=(Ae.getJSON(Ee.patients,[])||[]).map(e=>({...e,createdAt:e.createdAt?new Date(e.createdAt):new Date}));r(e);const t=(Ae.getJSON(Ee.prescriptions,[])||[]).map(e=>({...e,startDate:e.startDate?new Date(e.startDate):new Date,endDate:e.endDate?new Date(e.endDate):void 0}));i(t);const n=(Ae.getJSON(Ee.bloodTests,[])||[]).map(e=>({...e,testDate:e.testDate?new Date(e.testDate):new Date}));o(n);const a=Ae.getJSON(Ee.drugAdministrations,[]);d(a||[]);const s=Ae.getJSON(Ee.selectedPatientId,null);if(s){const t=e.find(e=>e.id===s)||null;u(t)}const l=Ae.getJSON(Ee.userProfile);l&&D(l),h(!0)},[]),N.useEffect(()=>{p&&Ae.setJSON(Ee.patients,n)},[p,n]),N.useEffect(()=>{p&&Ae.setJSON(Ee.prescriptions,a)},[p,a]),N.useEffect(()=>{p&&Ae.setJSON(Ee.bloodTests,s)},[p,s]),N.useEffect(()=>{p&&Ae.setJSON(Ee.drugAdministrations,l)},[p,l]),N.useEffect(()=>{p&&((null==c?void 0:c.id)?Ae.setJSON(Ee.selectedPatientId,c.id):Ae.remove(Ee.selectedPatientId))},[p,c]);const _=e=>{r([...n,e])};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950",children:[e.jsx("header",{className:"bg-white dark:bg-slate-900 shadow-sm border-b border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(De,{className:"h-8 w-8 text-blue-600 dark:text-blue-300"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"TDM Friends"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Precision Medicine의 시작"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:["등록된 환자 수: ",n.length]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:["선택된 환자:"," ",e.jsx("span",{title:(null==c?void 0:c.name)||"None",children:(null==c?void 0:c.name)&&c.name.length>5?`${c.name.slice(0,4)}...`:(null==c?void 0:c.name)||"None"})]})]}),e.jsxs(ac,{children:[e.jsx(ic,{asChild:!0,children:e.jsxs(se,{variant:"ghost",className:"flex items-center gap-2",children:[e.jsxs(Nc,{className:"h-9 w-9",children:[e.jsx(Dc,{src:null==w?void 0:w.profileImage,alt:"User"}),e.jsx(kc,{children:(null==w?void 0:w.name)?w.name.charAt(0):"사용자"})]}),e.jsx("span",{className:"font-medium whitespace-nowrap",title:(null==w?void 0:w.name)||"사용자",children:(null==w?void 0:w.name)&&w.name.length>5?`${w.name.slice(0,4)}...`:(null==w?void 0:w.name)||"사용자"})]})}),e.jsxs(sc,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(lc,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none truncate",style:{maxWidth:"13em"},title:(null==w?void 0:w.name)||"사용자",children:(null==w?void 0:w.name)&&w.name.length>13?`${w.name.slice(0,13)}...`:(null==w?void 0:w.name)||"사용자"}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:(null==w?void 0:w.email)||(null==w?void 0:w.phone)||"정보 없음"}),e.jsxs("p",{className:"text-xs leading-none text-muted-foreground pt-1",children:["소속: ",(null==w?void 0:w.organization)||"정보 없음"]})]})}),e.jsx(dc,{}),e.jsx(oc,{onSelect:e=>e.preventDefault(),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:m?"다크 모드":"라이트 모드"}),e.jsx(il,{checked:m,onCheckedChange:f,className:"ml-4"})]})}),e.jsx(oc,{onClick:()=>x(!0),children:"프로필 설정"}),e.jsx(dc,{}),e.jsx(oc,{onClick:()=>C(!0),children:"고객센터"}),e.jsx(oc,{onClick:()=>S(!0),children:"계정삭제"}),e.jsx(dc,{}),e.jsx(oc,{onClick:t,children:"로그아웃"})]})]})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(Ut,{value:v,onValueChange:e=>{if("workflow"===e&&"workflow"!==v&&c){const e=a.filter(e=>e.patientId===c.id);if(e.length>0){const t=e[0];if(rt(c.id,t.drugName))return void j(!0)}}b(e)},className:"space-y-6",children:[e.jsxs(Wt,{className:"grid w-full grid-cols-4 bg-white dark:bg-slate-800 border dark:border-slate-700 shadow-sm h-[52px]",children:[e.jsxs(zt,{value:"workflow",className:"flex items-center justify-center col-span-3 rounded-l-xl px-6 h-[52px] min-h-[52px] max-h-[52px] text-slate-900 dark:text-slate-200 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white dark:data-[state=inactive]:bg-slate-800 dark:data-[state=inactive]:text-slate-400 dark:focus:bg-slate-700 dark:focus:text-white dark:hover:bg-slate-700 dark:hover:text-white border-r border-slate-200 dark:border-slate-700 leading-none",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Let's TDM"]}),e.jsxs(zt,{value:"management",className:"flex items-center justify-center col-span-1 rounded-r-xl px-6 h-[52px] min-h-[52px] max-h-[52px] text-slate-900 dark:text-slate-200 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white dark:data-[state=inactive]:bg-slate-800 dark:data-[state=inactive]:text-slate-400 dark:focus:bg-slate-700 dark:focus:text-white dark:hover:bg-slate-700 dark:hover:text-white border-l border-slate-200 dark:border-slate-700 leading-none",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"환자 관리"]})]}),e.jsx(Kt,{value:"workflow",children:e.jsx(Bo,{patients:n,prescriptions:a,bloodTests:s,selectedPatient:c,setSelectedPatient:u,onAddPatient:_,onAddPrescription:(e,t)=>{t?i(e?[...t,e]:t):e&&i([e,...a])},setPrescriptions:i,onAddBloodTest:e=>{o([...s,e])},onDeleteBloodTest:e=>{o(s.filter(t=>t.id!==e))},setBloodTests:o,onAddDrugAdministration:e=>{d([...l,e])},drugAdministrations:l,setDrugAdministrations:d,onUpdatePatient:e=>{r(n.map(t=>t.id===e.id?e:t))},onDeletePatient:e=>{r(n.filter(t=>t.id!==e))},onResetWorkflow:()=>{i([]),o([]),d([])}})}),e.jsx(Kt,{value:"management",children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"환자 관리"]}),e.jsx(ae,{children:"환자 관리 및 히스토리 조회"})]}),e.jsx(ie,{children:e.jsx(un,{onAddPatient:_,onUpdatePatient:e=>r(t=>t.map(t=>t.id===e.id?e:t)),onDeletePatient:e=>r(t=>t.filter(t=>t.id!==e)),patients:n,selectedPatient:c,setSelectedPatient:u})})]})})]})}),e.jsx(Sc,{open:g,onOpenChange:e=>{if(x(e),!e){const e=Ae.getJSON(Ee.userProfile);e&&D(e)}}}),e.jsx(W,{open:k,onOpenChange:S,children:e.jsxs(z,{children:[e.jsxs(K,{children:[e.jsx(B,{children:"계정 삭제 안내"}),e.jsxs(G,{className:"space-y-3",children:[e.jsx("p",{children:"TDM friends는 계정 삭제 전 데이터 위임 및 이관 확인 절차를 거치고 있습니다. 번거로우시더라도 관리자에게 문의해 주시면 안전하게 처리를 도와드리겠습니다."}),e.jsx("p",{className:"font-semibold text-destructive",children:"⚠️ 주의: 계정 삭제 시 등록된 모든 환자 정보와 TDM 분석 데이터는 소속 기관 내 다른 관리자에게 위임되어야 합니다."}),e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("p",{className:"font-medium",children:"시스템 관리자 연락처"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"이메일: admin@tdmfriends.com"})]})]})]}),e.jsx(Y,{children:e.jsx(q,{children:"확인"})})]})}),e.jsx(Rc,{open:T,onOpenChange:C}),e.jsx(W,{open:y,onOpenChange:j,children:e.jsxs(z,{children:[e.jsxs(K,{children:[e.jsx(B,{children:"TDM Workflow 완료 안내"}),e.jsx(G,{children:"이미 TDM Workflow를 완료한 상태입니다. 데이터를 수정한 후 새로운 예측 결과 확인을 원하실 경우, 하단의 TDM Simulation 버튼을 선택하고 새로 결과를 확인할 수 있습니다."})]}),e.jsx(Y,{children:e.jsx(J,{onClick:()=>j(!1),children:"확인"})})]})})]})};export{Ac as default};
