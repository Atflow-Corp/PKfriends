import{j as e,c as t,u as n,a as r,b as s,P as i,d as a,e as o,f as l,g as d,h as c,i as u,A as m,D as p,C as f,k as h,l as g,S as x,m as v,R as b,n as j,o as N}from"./index-396gXgBP.js";import{r as y,c as w,g as D}from"./react-vendor-B8CcSR15.js";import{u as C,a as T,O as S,C as k,b as I,T as M,D as R,R as P,c as $,P as _,L as E,S as A,d as O,e as F,f as L,g as V,A as H,h as B,i as K,j as z,k as U,l as G,m as Y,n as W,o as J,p as q,F as X,q as Z}from"./alert-dialog-Bj6Yny2m.js";import{C as Q,a as ee,b as te,c as ne,d as re}from"./card-CzdixgTf.js";import{B as se}from"./button-DmAozKFU.js";import{I as ie}from"./input-BKQL6UU2.js";import{X as ae,U as oe,T as le,E as de,F as ce,S as ue,b as me,d as pe,C as fe,A as he,P as ge,e as xe,f as ve,g as be,h as je,i as Ne,H as ye,j as we,k as De,l as Ce}from"./ui-vendor-zUX6a0wC.js";import{s as Te,S as Se,m as ke,c as Ie,a as Me,b as Re,g as Pe,i as $e,T as _e,d as Ee,P as Ae,h as Oe,E as Fe}from"./html2canvas.esm-D_JZ-wCp.js";import{C as Le}from"./checkbox-7wTcup0X.js";import{u as Ve}from"./index-CtqvmGU1.js";function He(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const r=n.reduce((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]}),{});return y.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}var Be="rovingFocusGroup.onEntryFocus",Ke={bubbles:!1,cancelable:!0},ze="RovingFocusGroup",[Ue,Ge,Ye]=t(ze),[We,Je]=function(t,n=[]){let r=[];const s=()=>{const e=r.map(e=>y.createContext(e));return function(n){const r=(null==n?void 0:n[t])||e;return y.useMemo(()=>({[`__scope${t}`]:{...n,[t]:r}}),[n,r])}};return s.scopeName=t,[function(n,s){const i=y.createContext(s),a=r.length;function o(n){const{scope:r,children:s,...o}=n,l=(null==r?void 0:r[t][a])||i,d=y.useMemo(()=>o,Object.values(o));return e.jsx(l.Provider,{value:d,children:s})}return r=[...r,s],o.displayName=n+"Provider",[o,function(e,r){const o=(null==r?void 0:r[t][a])||i,l=y.useContext(o);if(l)return l;if(void 0!==s)return s;throw new Error(`\`${e}\` must be used within \`${n}\``)}]},He(s,...n)]}(ze,[Ye]),[qe,Xe]=We(ze),Ze=y.forwardRef((t,n)=>e.jsx(Ue.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Ue.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Qe,{...t,ref:n})})}));Ze.displayName=ze;var Qe=y.forwardRef((t,o)=>{const{__scopeRovingFocusGroup:l,orientation:d,loop:c=!1,dir:u,currentTabStopId:m,defaultCurrentTabStopId:p,onCurrentTabStopIdChange:f,onEntryFocus:h,preventScrollOnEntryFocus:g=!1,...x}=t,v=y.useRef(null),b=n(o,v),j=C(u),[N=null,w]=r({prop:m,defaultProp:p,onChange:f}),[D,T]=y.useState(!1),S=s(h),k=Ge(l),I=y.useRef(!1),[M,R]=y.useState(0);return y.useEffect(()=>{const e=v.current;if(e)return e.addEventListener(Be,S),()=>e.removeEventListener(Be,S)},[S]),e.jsx(qe,{scope:l,orientation:d,dir:j,loop:c,currentTabStopId:N,onItemFocus:y.useCallback(e=>w(e),[w]),onItemShiftTab:y.useCallback(()=>T(!0),[]),onFocusableItemAdd:y.useCallback(()=>R(e=>e+1),[]),onFocusableItemRemove:y.useCallback(()=>R(e=>e-1),[]),children:e.jsx(i.div,{tabIndex:D||0===M?-1:0,"data-orientation":d,...x,ref:b,style:{outline:"none",...t.style},onMouseDown:a(t.onMouseDown,()=>{I.current=!0}),onFocus:a(t.onFocus,e=>{const t=!I.current;if(e.target===e.currentTarget&&t&&!D){const t=new CustomEvent(Be,Ke);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=k().filter(e=>e.focusable);rt([e.find(e=>e.active),e.find(e=>e.id===N),...e].filter(Boolean).map(e=>e.ref.current),g)}}I.current=!1}),onBlur:a(t.onBlur,()=>T(!1))})})}),et="RovingFocusGroupItem",tt=y.forwardRef((t,n)=>{const{__scopeRovingFocusGroup:r,focusable:s=!0,active:o=!1,tabStopId:l,...d}=t,c=T(),u=l||c,m=Xe(et,r),p=m.currentTabStopId===u,f=Ge(r),{onFocusableItemAdd:h,onFocusableItemRemove:g}=m;return y.useEffect(()=>{if(s)return h(),()=>g()},[s,h,g]),e.jsx(Ue.ItemSlot,{scope:r,id:u,focusable:s,active:o,children:e.jsx(i.span,{tabIndex:p?0:-1,"data-orientation":m.orientation,...d,ref:n,onMouseDown:a(t.onMouseDown,e=>{s?m.onItemFocus(u):e.preventDefault()}),onFocus:a(t.onFocus,()=>m.onItemFocus(u)),onKeyDown:a(t.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void m.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,n){const r=function(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,n);return"vertical"===t&&["ArrowLeft","ArrowRight"].includes(r)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(r)?void 0:nt[r]}(e,m.orientation,m.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let s=f().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)s.reverse();else if("prev"===t||"next"===t){"prev"===t&&s.reverse();const i=s.indexOf(e.currentTarget);s=m.loop?(r=i+1,(n=s).map((e,t)=>n[(r+t)%n.length])):s.slice(i+1)}setTimeout(()=>rt(s))}var n,r})})})});tt.displayName=et;var nt={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function rt(e,t=!1){const n=document.activeElement;for(const r of e){if(r===n)return;if(r.focus({preventScroll:t}),document.activeElement!==n)return}}var st=Ze,it=tt,at="Tabs",[ot,lt]=o(at,[Je]),dt=Je(),[ct,ut]=ot(at),mt=y.forwardRef((t,n)=>{const{__scopeTabs:s,value:a,onValueChange:o,defaultValue:l,orientation:d="horizontal",dir:c,activationMode:u="automatic",...m}=t,p=C(c),[f,h]=r({prop:a,onChange:o,defaultProp:l});return e.jsx(ct,{scope:s,baseId:T(),value:f,onValueChange:h,orientation:d,dir:p,activationMode:u,children:e.jsx(i.div,{dir:p,"data-orientation":d,...m,ref:n})})});mt.displayName=at;var pt="TabsList",ft=y.forwardRef((t,n)=>{const{__scopeTabs:r,loop:s=!0,...a}=t,o=ut(pt,r),l=dt(r);return e.jsx(st,{asChild:!0,...l,orientation:o.orientation,dir:o.dir,loop:s,children:e.jsx(i.div,{role:"tablist","aria-orientation":o.orientation,...a,ref:n})})});ft.displayName=pt;var ht="TabsTrigger",gt=y.forwardRef((t,n)=>{const{__scopeTabs:r,value:s,disabled:o=!1,...l}=t,d=ut(ht,r),c=dt(r),u=bt(d.baseId,s),m=jt(d.baseId,s),p=s===d.value;return e.jsx(it,{asChild:!0,...c,focusable:!o,active:p,children:e.jsx(i.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":m,"data-state":p?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:u,...l,ref:n,onMouseDown:a(t.onMouseDown,e=>{o||0!==e.button||!1!==e.ctrlKey?e.preventDefault():d.onValueChange(s)}),onKeyDown:a(t.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&d.onValueChange(s)}),onFocus:a(t.onFocus,()=>{const e="manual"!==d.activationMode;p||o||!e||d.onValueChange(s)})})})});gt.displayName=ht;var xt="TabsContent",vt=y.forwardRef((t,n)=>{const{__scopeTabs:r,value:s,forceMount:a,children:o,...d}=t,c=ut(xt,r),u=bt(c.baseId,s),m=jt(c.baseId,s),p=s===c.value,f=y.useRef(p);return y.useEffect(()=>{const e=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(e)},[]),e.jsx(l,{present:a||p,children:({present:r})=>e.jsx(i.div,{"data-state":p?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":u,hidden:!r,id:m,tabIndex:0,...d,ref:n,style:{...t.style,animationDuration:f.current?"0s":void 0},children:r&&o})})});function bt(e,t){return`${e}-trigger-${t}`}function jt(e,t){return`${e}-content-${t}`}vt.displayName=xt;var Nt=ft,yt=gt,wt=vt;const Dt=mt,Ct=y.forwardRef(({className:t,...n},r)=>e.jsx(Nt,{ref:r,className:d("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...n}));Ct.displayName=Nt.displayName;const Tt=y.forwardRef(({className:t,...n},r)=>e.jsx(yt,{ref:r,className:d("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm","data-[state=active]:bg-primary/90 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:border data-[state=active]:border-primary dark:data-[state=active]:bg-primary/80 dark:data-[state=active]:text-primary-foreground dark:data-[state=active]:border-primary",t),...n}));Tt.displayName=yt.displayName;const St=y.forwardRef(({className:t,...n},r)=>e.jsx(wt,{ref:r,className:d("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...n}));St.displayName=wt.displayName;const kt=y.forwardRef(({className:t,...n},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:d("w-full caption-bottom text-sm",t),...n})}));kt.displayName="Table";const It=y.forwardRef(({className:t,...n},r)=>e.jsx("thead",{ref:r,className:d("[&_tr]:border-b",t),...n}));It.displayName="TableHeader";const Mt=y.forwardRef(({className:t,...n},r)=>e.jsx("tbody",{ref:r,className:d("[&_tr:last-child]:border-0",t),...n}));Mt.displayName="TableBody";y.forwardRef(({className:t,...n},r)=>e.jsx("tfoot",{ref:r,className:d("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...n})).displayName="TableFooter";const Rt=y.forwardRef(({className:t,...n},r)=>e.jsx("tr",{ref:r,className:d("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...n}));Rt.displayName="TableRow";const Pt=y.forwardRef(({className:t,...n},r)=>e.jsx("th",{ref:r,className:d("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...n}));Pt.displayName="TableHead";const $t=y.forwardRef(({className:t,...n},r)=>e.jsx("td",{ref:r,className:d("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...n}));$t.displayName="TableCell";y.forwardRef(({className:t,...n},r)=>e.jsx("caption",{ref:r,className:d("mt-4 text-sm text-muted-foreground",t),...n})).displayName="TableCaption";const _t=P,Et=$,At=_,Ot=y.forwardRef(({className:t,...n},r)=>e.jsx(S,{ref:r,className:d("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n}));Ot.displayName=S.displayName;const Ft=y.forwardRef(({className:t,children:n,...r},s)=>e.jsxs(At,{children:[e.jsx(Ot,{}),e.jsxs(k,{ref:s,className:d("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[n,e.jsxs(I,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ft.displayName=k.displayName;const Lt=({className:t,...n})=>e.jsx("div",{className:d("flex flex-col space-y-1.5 text-center sm:text-left",t),...n});Lt.displayName="DialogHeader";const Vt=y.forwardRef(({className:t,...n},r)=>e.jsx(M,{ref:r,className:d("text-lg font-semibold leading-none tracking-tight",t),...n}));Vt.displayName=M.displayName;const Ht=y.forwardRef(({className:t,...n},r)=>e.jsx(R,{ref:r,className:d("text-sm text-muted-foreground",t),...n}));Ht.displayName=R.displayName;var Bt={exports:{}};const Kt=D(Bt.exports=function(){var e=1e3,t=6e4,n=36e5,r="millisecond",s="second",i="minute",a="hour",o="day",l="week",d="month",c="quarter",u="year",m="date",p="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},x=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},v={s:x,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),s=n%60;return(t<=0?"+":"-")+x(r,2,"0")+":"+x(s,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),s=t.clone().add(r,d),i=n-s<0,a=t.clone().add(r+(i?-1:1),d);return+(-(r+(n-s)/(i?s-a:a-s))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:d,y:u,w:l,d:o,D:m,h:a,m:i,s:s,ms:r,Q:c}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},b="en",j={};j[b]=g;var N="$isDayjsObject",y=function(e){return e instanceof T||!(!e||!e[N])},w=function e(t,n,r){var s;if(!t)return b;if("string"==typeof t){var i=t.toLowerCase();j[i]&&(s=i),n&&(j[i]=n,s=i);var a=t.split("-");if(!s&&a.length>1)return e(a[0])}else{var o=t.name;j[o]=t,s=o}return!r&&s&&(b=s),s||!r&&b},D=function(e,t){if(y(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new T(n)},C=v;C.l=w,C.i=y,C.w=function(e,t){return D(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var T=function(){function g(e){this.$L=w(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[N]=!0}var x=g.prototype;return x.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(C.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(f);if(r){var s=r[2]-1||0,i=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],s,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)):new Date(r[1],s,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)}}return new Date(t)}(e),this.init()},x.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},x.$utils=function(){return C},x.isValid=function(){return!(this.$d.toString()===p)},x.isSame=function(e,t){var n=D(e);return this.startOf(t)<=n&&n<=this.endOf(t)},x.isAfter=function(e,t){return D(e)<this.startOf(t)},x.isBefore=function(e,t){return this.endOf(t)<D(e)},x.$g=function(e,t,n){return C.u(e)?this[t]:this.set(n,e)},x.unix=function(){return Math.floor(this.valueOf()/1e3)},x.valueOf=function(){return this.$d.getTime()},x.startOf=function(e,t){var n=this,r=!!C.u(t)||t,c=C.p(e),p=function(e,t){var s=C.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?s:s.endOf(o)},f=function(e,t){return C.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},h=this.$W,g=this.$M,x=this.$D,v="set"+(this.$u?"UTC":"");switch(c){case u:return r?p(1,0):p(31,11);case d:return r?p(1,g):p(0,g+1);case l:var b=this.$locale().weekStart||0,j=(h<b?h+7:h)-b;return p(r?x-j:x+(6-j),g);case o:case m:return f(v+"Hours",0);case a:return f(v+"Minutes",1);case i:return f(v+"Seconds",2);case s:return f(v+"Milliseconds",3);default:return this.clone()}},x.endOf=function(e){return this.startOf(e,!1)},x.$set=function(e,t){var n,l=C.p(e),c="set"+(this.$u?"UTC":""),p=(n={},n[o]=c+"Date",n[m]=c+"Date",n[d]=c+"Month",n[u]=c+"FullYear",n[a]=c+"Hours",n[i]=c+"Minutes",n[s]=c+"Seconds",n[r]=c+"Milliseconds",n)[l],f=l===o?this.$D+(t-this.$W):t;if(l===d||l===u){var h=this.clone().set(m,1);h.$d[p](f),h.init(),this.$d=h.set(m,Math.min(this.$D,h.daysInMonth())).$d}else p&&this.$d[p](f);return this.init(),this},x.set=function(e,t){return this.clone().$set(e,t)},x.get=function(e){return this[C.p(e)]()},x.add=function(r,c){var m,p=this;r=Number(r);var f=C.p(c),h=function(e){var t=D(p);return C.w(t.date(t.date()+Math.round(e*r)),p)};if(f===d)return this.set(d,this.$M+r);if(f===u)return this.set(u,this.$y+r);if(f===o)return h(1);if(f===l)return h(7);var g=(m={},m[i]=t,m[a]=n,m[s]=e,m)[f]||1,x=this.$d.getTime()+r*g;return C.w(x,this)},x.subtract=function(e,t){return this.add(-1*e,t)},x.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||p;var r=e||"YYYY-MM-DDTHH:mm:ssZ",s=C.z(this),i=this.$H,a=this.$m,o=this.$M,l=n.weekdays,d=n.months,c=n.meridiem,u=function(e,n,s,i){return e&&(e[n]||e(t,r))||s[n].slice(0,i)},m=function(e){return C.s(i%12||12,e,"0")},f=c||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(h,function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return C.s(t.$y,4,"0");case"M":return o+1;case"MM":return C.s(o+1,2,"0");case"MMM":return u(n.monthsShort,o,d,3);case"MMMM":return u(d,o);case"D":return t.$D;case"DD":return C.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return u(n.weekdaysMin,t.$W,l,2);case"ddd":return u(n.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(i);case"HH":return C.s(i,2,"0");case"h":return m(1);case"hh":return m(2);case"a":return f(i,a,!0);case"A":return f(i,a,!1);case"m":return String(a);case"mm":return C.s(a,2,"0");case"s":return String(t.$s);case"ss":return C.s(t.$s,2,"0");case"SSS":return C.s(t.$ms,3,"0");case"Z":return s}return null}(e)||s.replace(":","")})},x.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},x.diff=function(r,m,p){var f,h=this,g=C.p(m),x=D(r),v=(x.utcOffset()-this.utcOffset())*t,b=this-x,j=function(){return C.m(h,x)};switch(g){case u:f=j()/12;break;case d:f=j();break;case c:f=j()/3;break;case l:f=(b-v)/6048e5;break;case o:f=(b-v)/864e5;break;case a:f=b/n;break;case i:f=b/t;break;case s:f=b/e;break;default:f=b}return p?f:C.a(f)},x.daysInMonth=function(){return this.endOf(d).$D},x.$locale=function(){return j[this.$L]},x.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=w(e,t,!0);return r&&(n.$L=r),n},x.clone=function(){return C.w(this.$d,this)},x.toDate=function(){return new Date(this.valueOf())},x.toJSON=function(){return this.isValid()?this.toISOString():null},x.toISOString=function(){return this.$d.toISOString()},x.toString=function(){return this.$d.toUTCString()},g}(),S=T.prototype;return D.prototype=S,[["$ms",r],["$s",s],["$m",i],["$H",a],["$W",o],["$M",d],["$y",u],["$D",m]].forEach(function(e){S[e[1]]=function(t){return this.$g(t,e[0],e[1])}}),D.extend=function(e,t){return e.$i||(e(t,T,D),e.$i=!0),D},D.locale=w,D.isDayjs=y,D.unix=function(e){return D(1e3*e)},D.en=j[b],D.Ls=j,D.p={},D}()),zt=y.forwardRef(({onAddPatient:t,onUpdatePatient:n,onDeletePatient:r,patients:s,selectedPatient:i,setSelectedPatient:a,showHeader:o=!0},l)=>{const[d,c]=y.useState({patientNo:"",name:"",gender:"",birth:"",age:"",weight:"",height:"",medicalHistory:"",allergies:""}),[u,m]=y.useState(!1),[p,f]=y.useState(!1),[h,g]=y.useState(!1),[x,v]=y.useState(null),[b,j]=y.useState(""),[N,w]=y.useState([]),[D,C]=y.useState(null),T=e=>{c({patientNo:e.id,name:e.name,gender:e.gender,birth:e.birthDate,age:e.age.toString(),weight:e.weight.toString(),height:e.height.toString(),medicalHistory:e.medicalHistory,allergies:e.allergies}),a(e),m(!0),f(!0)},S=e=>{v(e),(e=>{try{const t=Te.getJSON(Se.prescriptions,[]).filter(t=>t.patientId===e).sort((e,t)=>{const n=new Date(e.startDate||e.id);return new Date(t.startDate||t.id).getTime()-n.getTime()});w(t)}catch(t){w([])}})(e.id),g(!0)},k=()=>{c({patientNo:"",name:"",gender:"",birth:"",age:"",weight:"",height:"",medicalHistory:"",allergies:""}),m(!1),a(null),f(!1)},I=()=>{c({patientNo:"",name:"",gender:"",birth:"",age:"",weight:"",height:"",medicalHistory:"",allergies:""}),m(!1),a(null),f(!0)},M=e=>{T(e)},R=e=>{S(e)},P=s.filter(e=>e.name.toLowerCase().includes(b.toLowerCase())||e.id.includes(b));return y.useImperativeHandle(l,()=>({openRegistrationModal:I,openEditModalForPatient:M,openViewModalForPatient:R})),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[o&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"환자 정보 관리"}),e.jsx("p",{className:"text-muted-foreground",children:"환자 등록, 수정, 조회를 관리합니다"})]}),!o&&e.jsx("div",{}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(_t,{open:p,onOpenChange:f,children:[e.jsx(Et,{asChild:!0,children:e.jsxs(se,{onClick:()=>{c({patientNo:"",name:"",gender:"",birth:"",age:"",weight:"",height:"",medicalHistory:"",allergies:""}),m(!1),a(null),f(!0)},className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"신규 환자 등록"]})}),e.jsxs(Ft,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Lt,{children:[e.jsxs(Vt,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5"}),u?"환자 정보 수정":"신규 환자 등록"]}),e.jsx(Ht,{children:u?"환자 정보를 수정합니다":"환자 정보를 입력해 등록하세요"})]}),e.jsxs("form",{onSubmit:u?e=>{if(e.preventDefault(),!i)return;const t={...i,name:d.name,age:parseInt(d.age),weight:parseFloat(d.weight),height:parseFloat(d.height),gender:d.gender,medicalHistory:d.medicalHistory,allergies:d.allergies};n(t),k(),f(!1)}:e=>{e.preventDefault();const n={id:Date.now().toString(),name:d.name,age:parseInt(d.age),weight:parseFloat(d.weight),height:parseFloat(d.height),gender:d.gender,medicalHistory:d.medicalHistory,allergies:d.allergies,birthDate:d.birth,createdAt:new Date};t(n),k(),f(!1)},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"patientNo",children:"환자 번호 *"}),e.jsx(ie,{id:"patientNo",value:d.patientNo,onChange:e=>c({...d,patientNo:e.target.value}),placeholder:"환자 번호 입력",required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"name",children:"이름 *"}),e.jsx(ie,{id:"name",value:d.name,onChange:e=>c({...d,name:e.target.value}),placeholder:"이름 입력",required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"gender",children:"성별 *"}),e.jsxs(A,{value:d.gender,onValueChange:e=>c({...d,gender:e}),required:!0,children:[e.jsx(O,{children:e.jsx(F,{placeholder:"성별 선택"})}),e.jsxs(L,{children:[e.jsx(V,{value:"male",children:"남성"}),e.jsx(V,{value:"female",children:"여성"}),e.jsx(V,{value:"other",children:"기타"})]})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"birth",children:"생년월일 *"}),e.jsx(ie,{id:"birth",type:"date",value:d.birth,onChange:e=>{return t=e.target.value,void c(e=>{let n="";if(t){const e=Kt(),r=Kt(t);n=e.diff(r,"year").toString()}return{...e,birth:t,age:n}});var t},required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"weight",children:"체중(kg) *"}),e.jsx(ie,{id:"weight",type:"number",step:"0.1",value:d.weight,onChange:e=>c({...d,weight:e.target.value}),placeholder:"체중(kg)",min:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"height",children:"신장(cm) *"}),e.jsx(ie,{id:"height",type:"number",value:d.height,onChange:e=>c({...d,height:e.target.value}),placeholder:"신장(cm)",min:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"age",children:"나이"}),e.jsx(ie,{id:"age",value:d.age,readOnly:!0,placeholder:"생년월일 입력 시 자동 계산"})]}),e.jsxs("div",{children:[e.jsx(E,{children:"BMI"}),e.jsx(ie,{value:(()=>{const e=parseFloat(d.weight),t=parseFloat(d.height);return e&&t?(e/Math.pow(t/100,2)).toFixed(1):""})(),readOnly:!0,placeholder:"자동 계산"})]}),e.jsxs("div",{children:[e.jsx(E,{children:"BSA"}),e.jsx(ie,{value:(()=>{const e=parseFloat(d.weight),t=parseFloat(d.height);return e&&t?Math.sqrt(e*t/3600).toFixed(2):""})(),readOnly:!0,placeholder:"자동 계산"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[u&&e.jsx(se,{type:"button",variant:"destructive",onClick:()=>{i&&(r(i.id),k(),f(!1))},className:"w-fit p-2",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(se,{type:"submit",className:"flex-1",children:u?"수정하기":"등록하기"}),e.jsx(se,{type:"button",variant:"outline",onClick:k,children:"취소"})]})]})]})]})})]}),e.jsx(_t,{open:h,onOpenChange:g,children:e.jsxs(Ft,{className:"min-w-[1000px] min-h-[500px] max-h-[80vh] p-0",children:[e.jsxs(Lt,{className:"px-6 pt-6 pb-0",children:[e.jsxs(Vt,{children:[null==x?void 0:x.name," 환자의 Report 조회"]}),e.jsx(Ht,{children:"TDM 분석 내역을 선택하면 해당 분석의 Report를 조회하고 다운로드할 수 있습니다."})]}),x&&e.jsx("div",{className:"px-6 pb-6",children:N.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(kt,{children:[e.jsx(It,{children:e.jsxs(Rt,{children:[e.jsx(Pt,{className:"w-[120px]",children:"등록일"}),e.jsx(Pt,{className:"w-[150px]",children:"약물명"}),e.jsx(Pt,{className:"w-[200px]",children:"적응증"}),e.jsx(Pt,{className:"w-[200px]",children:"추가정보"}),e.jsx(Pt,{className:"w-[200px]",children:"TDM 목표치"}),e.jsx(Pt,{className:"w-[100px]",children:"액션"})]})}),e.jsx(Mt,{children:N.map((t,n)=>e.jsxs(Rt,{className:"cursor-pointer hover:bg-blue-50/50 "+((null==D?void 0:D.id)===t.id?"bg-blue-50":""),onClick:()=>C(t),children:[e.jsx($t,{className:"align-top",children:Kt(t.startDate||t.id).format("YYYY.M.D")}),e.jsx($t,{className:"font-medium align-top",children:t.drugName}),e.jsx($t,{className:"align-top",children:t.indication||"-"}),e.jsx($t,{className:"align-top",children:t.additionalInfo||"-"}),e.jsx($t,{className:"align-top",children:t.tdmTargetValue||"-"}),e.jsx($t,{className:"align-top",children:e.jsxs(se,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),(e=>{if(!x)return;window.localStorage.setItem(`tdmfriends:selectedDrug:${x.id}`,e.drugName);const t=`${window.location.origin}${window.location.pathname}report?patientId=${x.id}`;window.open(t,"_blank"),g(!1)})(t)},className:"flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),"조회"]})})]},t.id))})]})}):e.jsxs("div",{className:"text-center py-8 px-6",children:[e.jsx(ce,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"등록된 TDM 분석 내역이 없습니다."})]})})]})}),e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs(te,{children:["등록된 환자 (",s.length,")"]}),e.jsx(ne,{children:"환자를 클릭하면 상세 정보 확인 및 수정이 가능합니다"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ie,{placeholder:"환자 검색...",value:b,onChange:e=>j(e.target.value),className:"pl-8 w-64"})]})})]})}),e.jsx(re,{children:P.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(kt,{children:[e.jsx(It,{children:e.jsxs(Rt,{children:[e.jsx(Pt,{children:"이름"}),e.jsx(Pt,{children:"나이"}),e.jsx(Pt,{children:"성별"}),e.jsx(Pt,{children:"체중"}),e.jsx(Pt,{children:"신장"}),e.jsx(Pt,{children:"등록일"}),e.jsx(Pt,{children:"수정과 조회"})]})}),e.jsx(Mt,{children:P.map(t=>e.jsxs(Rt,{className:"cursor-pointer hover:bg-muted/50 "+((null==i?void 0:i.id)===t.id?"bg-muted":""),onClick:()=>a(t),children:[e.jsx($t,{className:"font-medium",children:t.name}),e.jsx($t,{children:t.age}),e.jsx($t,{className:"capitalize",children:t.gender}),e.jsxs($t,{children:[t.weight," kg"]}),e.jsxs($t,{children:[t.height," cm"]}),e.jsx($t,{children:t.createdAt.toLocaleDateString()}),e.jsx($t,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(se,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),T(t)},children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(se,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),S(t)},children:e.jsx(ce,{className:"h-4 w-4"})})]})})]},t.id))})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:b?"검색 결과가 없습니다":"아직 등록된 환자가 없습니다"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:b?"다른 검색어를 시도해보세요":"위 버튼을 통해 첫 환자를 등록하세요"})]})})]})]})}),Ut=({onAddPatient:t,onUpdatePatient:n,onDeletePatient:r,patients:s,selectedPatient:i,setSelectedPatient:a})=>e.jsx(zt,{onAddPatient:t,onUpdatePatient:n,onDeletePatient:r,patients:s,selectedPatient:i,setSelectedPatient:a,showHeader:!1});function Gt(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const r=n.reduce((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]}),{});return y.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}var Yt="Progress",[Wt,Jt]=function(t,n=[]){let r=[];const s=()=>{const e=r.map(e=>y.createContext(e));return function(n){const r=(null==n?void 0:n[t])||e;return y.useMemo(()=>({[`__scope${t}`]:{...n,[t]:r}}),[n,r])}};return s.scopeName=t,[function(n,s){const i=y.createContext(s),a=r.length;function o(n){const{scope:r,children:s,...o}=n,l=(null==r?void 0:r[t][a])||i,d=y.useMemo(()=>o,Object.values(o));return e.jsx(l.Provider,{value:d,children:s})}return r=[...r,s],o.displayName=n+"Provider",[o,function(e,r){const o=(null==r?void 0:r[t][a])||i,l=y.useContext(o);if(l)return l;if(void 0!==s)return s;throw new Error(`\`${e}\` must be used within \`${n}\``)}]},Gt(s,...n)]}(Yt),[qt,Xt]=Wt(Yt),Zt=y.forwardRef((t,n)=>{const{__scopeProgress:r,value:s=null,max:a,getValueLabel:o=tn,...l}=t;(a||0===a)&&sn(a);const d=sn(a)?a:100;null!==s&&an(s,d);const c=an(s,d)?s:null,u=rn(c)?o(c,d):void 0;return e.jsx(qt,{scope:r,value:c,max:d,children:e.jsx(i.div,{"aria-valuemax":d,"aria-valuemin":0,"aria-valuenow":rn(c)?c:void 0,"aria-valuetext":u,role:"progressbar","data-state":nn(c,d),"data-value":c??void 0,"data-max":d,...l,ref:n})})});Zt.displayName=Yt;var Qt="ProgressIndicator",en=y.forwardRef((t,n)=>{const{__scopeProgress:r,...s}=t,a=Xt(Qt,r);return e.jsx(i.div,{"data-state":nn(a.value,a.max),"data-value":a.value??void 0,"data-max":a.max,...s,ref:n})});function tn(e,t){return`${Math.round(e/t*100)}%`}function nn(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function rn(e){return"number"==typeof e}function sn(e){return rn(e)&&!isNaN(e)&&e>0}function an(e,t){return rn(e)&&!isNaN(e)&&e<=t&&e>=0}en.displayName=Qt;var on=Zt,ln=en;const dn=y.forwardRef(({className:t,value:n,...r},s)=>e.jsx(on,{ref:s,className:d("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...r,children:e.jsx(ln,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(n||0)}%)`}})}));dn.displayName=on.displayName;const cn=({patients:t,selectedPatient:n,setSelectedPatient:r,onAddPatient:s,onUpdatePatient:i,onDeletePatient:a,onNext:o,isCompleted:l})=>e.jsx("div",{className:"space-y-6",children:e.jsxs(Q,{children:[e.jsxs(ee,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),"1단계: 환자 선택",l&&e.jsx(fe,{className:"h-5 w-5 text-green-600"})]}),e.jsx(ne,{children:"기존 환자를 선택하거나 신규 환자를 등록하세요."})]}),e.jsxs(re,{className:"space-y-6",children:[e.jsx(zt,{onAddPatient:s,onUpdatePatient:i,onDeletePatient:a,patients:t,selectedPatient:n,setSelectedPatient:r,showHeader:!1}),n&&e.jsxs(Q,{className:"border-green-200 bg-green-50",children:[e.jsx(ee,{children:e.jsx(te,{className:"text-green-800",children:"Selected Patient"})}),e.jsx(re,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"이름"}),e.jsx("p",{className:"text-sm",children:n.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"생년월일"}),e.jsx("p",{className:"text-sm",children:n.birthDate})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"나이"}),e.jsxs("p",{className:"text-sm",children:[n.age,"세"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"성별"}),e.jsx("p",{className:"text-sm",children:"male"===n.gender?"남성":"female"===n.gender?"여성":"기타"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"체중"}),e.jsxs("p",{className:"text-sm",children:[n.weight," kg"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"신장"}),e.jsxs("p",{className:"text-sm",children:[n.height," cm"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"BMI"}),e.jsx("p",{className:"text-sm",children:n.weight&&n.height?(n.weight/Math.pow(n.height/100,2)).toFixed(1):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"BSA"}),e.jsxs("p",{className:"text-sm",children:[n.weight&&n.height?Math.sqrt(n.weight*n.height/3600).toFixed(2):"-"," m²"]})]})]})})]}),l&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(se,{onClick:o,className:"flex items-center gap-2 w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center",children:["TDM 선택",e.jsx(he,{className:"h-4 w-4"})]})})]})]})}),un=[{name:"Vancomycin",indications:["Not specified/Korean","Neurosurgical patients/Korean"],additionalInfo:{default:["신기능","체중","나이","감염 부위","미생물 민감도"],"Neurosurgical patients/Korean":["복용 중인 약물 없음","Nephrotoxic drugs including aminoglycosides (amikacin and tobramycin)","Liposomal amphotericin B","Antiviral agents (acyclovir, famciclovir and ganciclovir)","Colistimethate","Cytotoxic agents (cytosine arabinoside, fludarabine and idarubicin)","Cyclosporin","Tacrolimus","Non-steroidal anti-inflammatory agents (aceclofenac, ibuprofen, ketoprofen, ketorolac and zaltoprofen)","Trimethoprim/sulfamethoxazole","기타"]},targets:[{type:"Trough Concentration",value:"10-20 mg/L"},{type:"Peak Concentration",value:"25-40 mg/L"},{type:"AUC",value:"400-600 mg·h/L"}],defaultTargets:{"Not specified/Korean":{type:"AUC",value:"400-600 mg·h/L"},"Neurosurgical patients/Korean":{type:"AUC",value:"400-600 mg·h/L"}}},{name:"Cyclosporin",indications:["Renal transplant recipients/Korean","Allo-HSCT/Korean","Thoracic transplant recipients/European"],additionalInfo:{default:["신기능","간기능","혈압","약물상호작용","이식 후 경과"],"Renal transplant recipients/Korean":["POD ~2","POD 3~6","POD 7~"]},targets:[{type:"Trough Concentration",value:"100-400 ng/mL"},{type:"Peak Concentration",value:"800-1200 ng/mL"},{type:"C2 Concentration",value:"1200-1700 ng/mL"}],defaultTargets:{"Allo-HSCT/Korean":{type:"Trough Concentration",value:"150-400 ng/mL"},"Thoracic transplant recipients/European":{type:"Trough Concentration",value:"170-230 ng/mL"},"Renal transplant recipients/Korean":{type:"Trough Concentration",value:"300-350 ng/mL"}}}],mn=({patients:t,prescriptions:n,selectedPatient:r,selectedPrescription:s,setSelectedPrescription:i,onAddPrescription:a,onNext:o,onPrev:l,isCompleted:d,bloodTests:c,setBloodTests:u,drugAdministrations:m,setDrugAdministrations:p,onClearLaterStepData:f,onResetWorkflow:h})=>{const[g,x]=y.useState({drugName:"",indication:"",additionalInfo:"",tdmTarget:"",tdmTargetValue:""}),[v,b]=y.useState(null),[j,N]=y.useState(null),w=e=>e.startsWith("temp"),D=e=>!w(e);y.useEffect(()=>{if(!r)return;const e=`tdmfriends:prescription:${r.id}`;try{const t=localStorage.getItem(e);if(t){const e=JSON.parse(t);if(e.selectedTdmId){b(e.selectedTdmId);const t=n.find(t=>t.id===e.selectedTdmId&&t.patientId===r.id);t&&i(t)}e.newlyAddedTdmId&&N(e.newlyAddedTdmId)}}catch(t){}},[r,n,i,null==r?void 0:r.id]),y.useEffect(()=>{if(!r)return;const e=`tdmfriends:prescription:${r.id}`;try{const t={selectedTdmId:v,newlyAddedTdmId:j,formData:g};localStorage.setItem(e,JSON.stringify(t))}catch(t){}},[v,j,g,r,null==r?void 0:r.id]),y.useEffect(()=>{if(!r||!v)return;const e=n.find(e=>e.id===v&&e.patientId===r.id);e&&i(e)},[v,n,r,null==r?void 0:r.id,i]),y.useEffect(()=>{if(r&&j&&v!==j){n.find(e=>e.id===j&&e.patientId===r.id)&&b(j)}},[n,j,r,null==r?void 0:r.id,v]);const C=r?n.filter(e=>e.patientId===r.id):[],T=un.find(e=>e.name===g.drugName),S=T?T.targets:[],k=(()=>{if(!T||!g.indication)return[];if("object"==typeof T.additionalInfo&&!Array.isArray(T.additionalInfo)){const e=T.additionalInfo[g.indication];if(e)return e;const t=T.additionalInfo.default;if(t)return t}return Array.isArray(T.additionalInfo)?T.additionalInfo:[]})(),I=()=>"Vancomycin"===(null==T?void 0:T.name)&&"Neurosurgical patients/Korean"===g.indication||"Cyclosporin"===(null==T?void 0:T.name)&&"Renal transplant recipients/Korean"===g.indication,M=()=>{if(!r)return!1;const e=c.some(e=>e.patientId===r.id),t=m.some(e=>e.patientId===r.id);return e||t};return r?e.jsx("div",{className:"space-y-6",children:e.jsxs(Q,{children:[e.jsxs(ee,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"2단계: TDM 선택",d&&e.jsx(fe,{className:"h-5 w-5 text-green-600"})]}),e.jsx(ne,{children:r?`${r.name} 환자의 TDM 약물 정보를 입력하세요.`:"TDM 약물 정보를 입력하세요."})]}),e.jsxs(re,{className:"space-y-6",children:[C.length>0&&e.jsxs(Q,{children:[e.jsxs(ee,{children:[e.jsxs(te,{children:["TDM 내역 (",C.length,")"]}),e.jsx(ne,{children:"기 수행된 TDM의 F/U TDM을 진행하신다면 아래 내역 중 선택해 주세요."})]}),e.jsx(re,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(kt,{children:[e.jsx(It,{children:e.jsxs(Rt,{children:[e.jsx(Pt,{children:"분석일"}),e.jsx(Pt,{children:"약물명"}),e.jsx(Pt,{children:"적응증"}),e.jsx(Pt,{children:"추가정보"}),e.jsx(Pt,{children:"TDM 목표치"}),e.jsx(Pt,{children:"삭제"})]})}),e.jsx(Mt,{children:C.map(t=>e.jsxs(Rt,{className:"cursor-pointer hover:bg-blue-50/50 "+(v===t.id?"bg-blue-50":""),onClick:()=>(e=>{b(e.id),i(e),e.id!==j&&N(null);const t={drugName:e.drugName||"",indication:e.indication||"",additionalInfo:e.additionalInfo||"",tdmTarget:e.tdmTarget||"Trough Concentration",tdmTargetValue:e.tdmTargetValue||""};x(t)})(t),children:[e.jsx($t,{children:D(t.id)?"진행 중":t.startDate?new Date(t.startDate).toLocaleDateString("ko-KR"):"-"}),e.jsx($t,{className:"font-medium",children:t.drugName}),e.jsx($t,{children:t.indication||"-"}),e.jsx($t,{children:t.additionalInfo||"-"}),e.jsx($t,{children:t.tdmTarget&&t.tdmTargetValue?`${t.tdmTarget}: ${t.tdmTargetValue}`:t.tdmTargetValue||"-"}),e.jsx($t,{children:D(t.id)&&e.jsxs(se,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),(e=>{if(!r)return;if(!D(e))return;const t=n.find(t=>t.id===e&&t.patientId===r.id);if(!t)return;if(!window.confirm(`${t.drugName} TDM이 진행 중입니다.\n\n해당 TDM 내역을 삭제 시 관련된 Lab정보와 투약 기록, 시뮬레이션 데이터가 초기화 됩니다.\n\n삭제하시겠습니까?`))return;const s=t.drugName,o=n.filter(t=>!(t.id===e&&t.patientId===r.id));a(void 0,o);const l=c.filter(e=>!(e.patientId===r.id&&e.drugName===s));u(l);const d=m.filter(e=>!(e.patientId===r.id&&e.drugName===s));p(d);try{localStorage.removeItem(`tdmfriends:renal:${r.id}:${s}`)}catch(h){}const f=o.filter(e=>e.patientId===r.id);if(f.length>0){const e=f.sort((e,t)=>{const n=parseInt(e.id);return parseInt(t.id)-n})[0];b(e.id),i(e),D(e.id)?N(e.id):N(null);const t={drugName:e.drugName||"",indication:e.indication||"",additionalInfo:e.additionalInfo||"",tdmTarget:e.tdmTarget||"Trough Concentration",tdmTargetValue:e.tdmTargetValue||""};x(t)}else b(null),i(null);e===j&&N(null)})(t.id)},children:[e.jsx("span",{className:"sr-only",children:"삭제"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})]})})]},t.id))})]})})})]}),e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"신규 TDM 추가",v&&(()=>{const t=C.find(e=>e.id===v);if(!t)return null;if("existing"!==(w(t.id)?"existing":"newly-added"))return null;const n=t.startDate?new Date(t.startDate).toLocaleDateString("ko-KR"):"";return e.jsxs("span",{className:"text-sm text-blue-600 font-normal",children:["(",n,"에 진행한 TDM을 F/U합니다)"]})})()]})}),e.jsx(re,{children:e.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!r)return;if(n.filter(e=>e.patientId===r.id&&e.drugName===g.drugName&&D(e.id)).length>0){if(!window.confirm(`${g.drugName}에 대한 신규 TDM이 이미 등록되어 있습니다. 삭제 후 새로운 TDM을 추가하시겠습니까?`))return;const e=n.filter(e=>{if(e.patientId!==r.id)return!0;if(e.drugName!==g.drugName)return!0;return!D(e.id)}),t={id:Date.now().toString(),patientId:r.id,drugName:g.drugName,dosage:0,unit:"",frequency:"",startDate:new Date,route:"",prescribedBy:"",indication:g.indication,tdmTarget:g.tdmTarget,tdmTargetValue:g.tdmTargetValue,additionalInfo:g.additionalInfo},s=[...e,t];return a(void 0,s),N(t.id),b(t.id),void x({drugName:"",indication:"",additionalInfo:"",tdmTarget:"",tdmTargetValue:""})}if("Vancomycin"===g.drugName&&"Neurosurgical patients/Korean"===g.indication&&!g.additionalInfo)return void alert(`${g.indication}의 경우 복용 중인 약물 정보를 입력해주세요.`);if("Cyclosporin"===g.drugName&&"Renal transplant recipients/Korean"===g.indication&&!g.additionalInfo)return void alert(`${g.indication}의 경우 POD 정보를 입력해주세요.`);const t={id:Date.now().toString(),patientId:r.id,drugName:g.drugName,dosage:0,unit:"",frequency:"",startDate:new Date,route:"",prescribedBy:"",indication:g.indication,tdmTarget:g.tdmTarget,tdmTargetValue:g.tdmTargetValue,additionalInfo:g.additionalInfo},s=n.filter(e=>e.patientId!==r.id);a(t,s),N(t.id),b(t.id),x({drugName:"",indication:"",additionalInfo:"",tdmTarget:"",tdmTargetValue:""})},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"drugName",children:"약물명 *"}),e.jsxs(A,{value:g.drugName,onValueChange:e=>{var t,n;if(C.length>0&&C[0].drugName!==e){M()&&f()}const r=un.find(t=>t.name===e),s=(null==r?void 0:r.indications[0])||"",i=null==(t=null==r?void 0:r.defaultTargets)?void 0:t[s];x({drugName:e,indication:s,additionalInfo:"",tdmTarget:(null==i?void 0:i.type)||"Trough Concentration",tdmTargetValue:(null==i?void 0:i.value)||(null==(n=null==r?void 0:r.targets.find(e=>"Trough Concentration"===e.type))?void 0:n.value)||""})},required:!0,children:[e.jsx(O,{id:"drugName",children:e.jsx(F,{placeholder:"TDM 약물 선택"})}),e.jsx(L,{children:un.map(t=>e.jsx(V,{value:t.name,children:t.name},t.name))})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"indication",children:"적응증/Demographic *"}),e.jsxs(A,{value:g.indication,onValueChange:e=>{var t;const n=null==(t=null==T?void 0:T.defaultTargets)?void 0:t[e];x(t=>({...t,indication:e,additionalInfo:v?t.additionalInfo:"",tdmTarget:(null==n?void 0:n.type)||t.tdmTarget,tdmTargetValue:(null==n?void 0:n.value)||t.tdmTargetValue}))},required:!0,disabled:!g.drugName,children:[e.jsx(O,{id:"indication",children:e.jsx(F,{placeholder:"적응증 선택"})}),e.jsx(L,{children:null==T?void 0:T.indications.map(t=>e.jsx(V,{value:t,children:t},t))})]})]}),!(!T||!g.indication)&&("Vancomycin"===T.name&&"Neurosurgical patients/Korean"===g.indication||"Cyclosporin"===T.name&&"Renal transplant recipients/Korean"===g.indication)&&e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"additionalInfo",children:[T&&g.indication?"Vancomycin"===T.name&&"Neurosurgical patients/Korean"===g.indication?"복용 중인 약물":"Cyclosporin"===T.name&&"Renal transplant recipients/Korean"===g.indication?"POD":"추가정보":"추가정보"," ",I()?"*":""]}),e.jsxs(A,{value:g.additionalInfo,onValueChange:e=>x(t=>({...t,additionalInfo:e})),required:I(),children:[e.jsx(O,{id:"additionalInfo",children:e.jsx(F,{placeholder:"Renal transplant recipients/Korean"===g.indication?"POD를 선택하세요":"약물명 선택"})}),e.jsx(L,{children:k.map(t=>e.jsx(V,{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"tdmTarget",children:"TDM 목표 *"}),e.jsxs(A,{value:g.tdmTarget,onValueChange:e=>{const t=S.find(t=>t.type===e);x(n=>({...n,tdmTarget:e,tdmTargetValue:(null==t?void 0:t.value)||""}))},required:!0,disabled:!g.drugName,children:[e.jsx(O,{id:"tdmTarget",children:e.jsx(F,{placeholder:"TDM 목표 선택"})}),e.jsx(L,{children:S.map(t=>e.jsx(V,{value:t.type,children:t.type},t.type))})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"tdmTargetValue",children:"TDM 목표치 *"}),e.jsx(ie,{id:"tdmTargetValue",value:g.tdmTargetValue,onChange:e=>x(t=>({...t,tdmTargetValue:e.target.value})),placeholder:"TDM 목표 선택 시 자동 입력, 수정 가능",required:!0,disabled:!g.tdmTarget})]})]}),e.jsx(se,{type:"submit",className:"w-full",children:"TDM 추가"})]})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(se,{variant:"outline",onClick:l,className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"환자 등록 및 선택"]}),d&&e.jsxs(se,{onClick:o,className:"flex items-center gap-2 w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center",children:["Lab",e.jsx(he,{className:"h-4 w-4"})]})]})]})]})}):e.jsx(Q,{children:e.jsx(re,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Please select a patient first"})]})})})},pn=({patients:t,bloodTests:n,selectedPatient:r,selectedPrescription:s,onAddBloodTest:i,onDeleteBloodTest:a,onUpdateBloodTest:o=()=>{},onNext:l,onPrev:d,isCompleted:c,prescriptions:u})=>{const[m,p]=y.useState({creatinine:"",date:"",formula:"cockcroft-gault",result:"",dialysis:"N",renalReplacement:"",isBlack:!1}),[f,h]=y.useState([]),[g,x]=y.useState(!1),v=(e,t,n,r=!1)=>{if(!e||e<=0)return"";switch(t){case"cockcroft-gault":return b(e,n.age,n.weight,n.height,n.gender);case"mdrd":return j(e,n.age,n.gender,r);case"ckd-epi":return N(e,n.age,n.gender,r);default:return""}},b=(e,t,n,r,s)=>{const i="여성"===s?.85:1,a=((e,t)=>"여성"===t?45.5+.9*(e-152):50+.9*(e-152))(r,s),o=n/Math.pow(r/100,2)>30||n>1.2*a,l=o?((e,t)=>t+.4*(e-t))(n,a):n,d=(140-t)*l*i/(72*e),c=o?` (조정체중: ${Math.round(10*l)/10}kg)`:"";return`CRCL = ${Math.round(10*d)/10} mL/min${c}`},j=(e,t,n,r)=>{const s="여성"===n?.742:1,i=r?1.212:1,a=175*Math.pow(e,-1.154)*Math.pow(t,-.203)*s*i;return`eGFR = ${Math.round(10*a)/10} mL/min/1.73m²`},N=(e,t,n,r)=>{const s=r?1.212:1;let i,a;"여성"===n?(i=-.329,a=.7):(i=-.411,a=.9);const o=Math.min(Math.max(e/a,1),999),l=141*Math.pow(o,i)*Math.pow(.993,t)*s;return`eGFR = ${Math.round(10*l)/10} mL/min/1.73m²`},w=s;y.useEffect(()=>{if(r&&w){x(!1);try{const e=window.localStorage.getItem(`tdmfriends:renal:${r.id}:${w.drugName}`);if(e){const t=JSON.parse(e);h(t)}else h([])}catch(e){}finally{x(!0)}}},[null==r?void 0:r.id,null==w?void 0:w.drugName]),y.useEffect(()=>{if(r&&w&&g)try{window.localStorage.setItem(`tdmfriends:renal:${r.id}:${w.drugName}`,JSON.stringify(f))}catch(e){}},[null==r?void 0:r.id,null==w?void 0:w.drugName,f,g]);const[D,C]=y.useState({testDate:"",testTime:"",concentration:"",unit:"ng/mL",measurementType:"Trough"}),[T,S]=y.useState(!1),k=r&&w?n.filter(e=>e.patientId===r.id&&e.drugName===w.drugName):[],I=Kt().format("YYYY-MM-DD");y.useEffect(()=>{const e="Vancomycin"===(null==w?void 0:w.drugName)?"mg/L":"ng/mL";C(t=>({...t,unit:e}))},[null==w?void 0:w.drugName]);return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsxs(ee,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"3단계: Lab",c&&e.jsx(fe,{className:"h-5 w-5 text-green-600"})]}),e.jsx(ne,{children:r?`${r.name} 환자의 신기능(혈청 크레아티닌)과 혈중 약물 농도 정보를 입력하세요.`:"신기능(혈청 크레아티닌)과 혈중 약물 농도 정보를 입력하세요."})]}),e.jsxs(re,{className:"space-y-6",children:[w&&r&&e.jsxs("div",{className:"py-3 px-4 rounded bg-muted dark:bg-slate-800 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-4 mb-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"나이:"})," ",r.age]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"성별:"})," ",r.gender]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"몸무게:"})," ",r.weight,"kg"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"키:"})," ",r.height,"cm"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"BMI:"})," ",(()=>{if(!(null==r?void 0:r.weight)||!(null==r?void 0:r.height))return"N/A";return(r.weight/Math.pow(r.height/100,2)).toFixed(1)})()]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"BSA:"})," ",(()=>{if(!(null==r?void 0:r.weight)||!(null==r?void 0:r.height))return"N/A";return Math.sqrt(r.height*r.weight/3600).toFixed(2)})()]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"약품명:"}),e.jsx("span",{className:"ml-2 font-semibold",children:w.drugName})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"적응증:"}),e.jsx("span",{className:"ml-2",children:w.indication})]})]})]}),e.jsxs(Q,{children:[e.jsxs(ee,{children:[e.jsxs(te,{children:["신기능 데이터 (",f.length,")"]}),e.jsx(ne,{children:"체크박스를 선택하면 해당 신기능 데이터가 시뮬레이션에 반영됩니다."})]}),e.jsxs(re,{className:"space-y-6",children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(kt,{children:[e.jsx(It,{children:e.jsxs(Rt,{children:[e.jsx(Pt,{className:"w-16",children:"분석사용"}),e.jsx(Pt,{children:"혈청 크레아티닌"}),e.jsx(Pt,{children:"검사일"}),e.jsx(Pt,{children:"계산식"}),e.jsx(Pt,{children:"결과"}),e.jsx(Pt,{children:"투석 여부"}),e.jsx(Pt,{children:"신 대체요법"}),e.jsx(Pt,{className:"w-16",children:"삭제"})]})}),e.jsxs(Mt,{children:[e.jsxs(Rt,{children:[e.jsx($t,{children:e.jsx(Le,{checked:f.every(e=>!e.isSelected),onCheckedChange:e=>{e&&h(f.map(e=>({...e,isSelected:!1})))}})}),e.jsx($t,{colSpan:6,className:"text-center text-muted-foreground",children:"해당 회차 TDM은 신기능 데이터를 사용하지 않습니다"}),e.jsx($t,{})]}),f.map(t=>e.jsxs(Rt,{children:[e.jsx($t,{children:e.jsx(Le,{checked:t.isSelected,onCheckedChange:e=>((e,t)=>{h(f.map(n=>({...n,isSelected:n.id===e&&t})))})(t.id,e)})}),e.jsxs($t,{children:[t.creatinine," mg/dL"]}),e.jsx($t,{children:t.date}),e.jsx($t,{children:t.formula}),e.jsx($t,{children:t.result||"-"}),e.jsx($t,{children:t.dialysis}),e.jsx($t,{children:"Y"===t.dialysis?t.renalReplacement||"-":"N"}),e.jsx($t,{children:e.jsx(se,{variant:"ghost",size:"icon",onClick:()=>{return e=t.id,void h(f.filter(t=>t.id!==e));var e},children:e.jsx(ae,{className:"h-4 w-4"})})})]},t.id))]})]})}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"신기능 데이터 추가"})]}),e.jsxs("form",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"creatinine",children:"혈청 크레아티닌 (mg/dL) *"}),e.jsx(ie,{id:"creatinine",type:"number",step:"0.01",value:m.creatinine,onChange:e=>p({...m,creatinine:e.target.value}),onBlur:()=>{if(m.creatinine&&r){const e=parseFloat(m.creatinine);if(!isNaN(e)){const t=v(e,m.formula,r,m.isBlack);p(e=>({...e,result:t}))}}},placeholder:"예: 1.2",required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"renalDate",children:"검사일 *"}),e.jsx(ie,{id:"renalDate",type:"date",value:m.date,max:I,onChange:e=>p({...m,date:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"renalFormula",children:"계산식 *"}),e.jsxs(A,{value:m.formula,onValueChange:e=>{p(t=>{const n={...t,formula:e};if(t.creatinine&&r){const s=parseFloat(t.creatinine);if(!isNaN(s)){const i=v(s,e,r,t.isBlack);n.result=i}}return n})},required:!0,children:[e.jsx(O,{children:e.jsx(F,{placeholder:"계산식 선택"})}),e.jsxs(L,{children:[e.jsx(V,{value:"cockcroft-gault",children:"Cockcroft-Gault"}),e.jsx(V,{value:"mdrd",children:"MDRD"}),e.jsx(V,{value:"ckd-epi",children:"CKD-EPI"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"result",children:"계산 결과"}),e.jsx(ie,{id:"result",value:m.result,onChange:e=>{if(m.result&&m.result.includes("=")&&e.target.value!==m.result){if(!window.confirm("자동계산된 데이터를 삭제하고 직접 입력하시겠습니까?"))return}p({...m,result:e.target.value})},placeholder:"자동계산"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"dialysis",children:"투석 여부 *"}),e.jsxs(A,{value:m.dialysis,onValueChange:e=>p({...m,dialysis:e}),required:!0,children:[e.jsx(O,{children:e.jsx(F,{placeholder:"선택"})}),e.jsxs(L,{children:[e.jsx(V,{value:"N",children:"N"}),e.jsx(V,{value:"Y",children:"Y"})]})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"renalReplacement",children:"신 대체요법"}),e.jsxs(A,{value:m.renalReplacement,onValueChange:e=>p({...m,renalReplacement:e}),disabled:"N"===m.dialysis,children:[e.jsx(O,{children:e.jsx(F,{placeholder:"신 대체요법 선택"})}),e.jsxs(L,{children:[e.jsx(V,{value:"HD",children:"HD"}),e.jsx(V,{value:"CRRT",children:"CRRT"}),e.jsx(V,{value:"PD",children:"PD"}),e.jsx(V,{value:"기타",children:"기타"})]})]})]})]}),e.jsx(se,{type:"button",onClick:()=>{if(!m.creatinine||!m.date||!m.formula)return void alert("신기능 데이터의 필수 항목을 모두 입력해주세요. (혈청 크레아티닌, 검사일, 투석여부)");if("Y"===m.dialysis&&!m.renalReplacement.trim())return void alert("신 대체요법을 입력해주세요.");"CRRT"===m.renalReplacement.toUpperCase()&&S(!0);const e={id:Date.now().toString(),...m,isSelected:!0},t=f.map(e=>({...e,isSelected:!1}));h([...t,e]),p({creatinine:"",date:"",formula:"cockcroft-gault",result:"",dialysis:"N",renalReplacement:"",isBlack:!1})},className:"w-full",children:"신기능 데이터 추가"})]})]})]})]}),e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsx(te,{children:"혈중 약물 농도"})}),e.jsxs(re,{children:[e.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!r)return;if(!D.testDate||!D.concentration)return;const t=D.testDate.trim().replace(/[-: ]/g,"");if(!/^\d{12}$/.test(t))return void alert("날짜와 시간 형식이 올바르지 않습니다. 예: 2025-09-01 14:00 또는 202509011400");const n=`${t.slice(0,4)}-${t.slice(4,6)}-${t.slice(6,8)}`,s=`${t.slice(8,10)}:${t.slice(10,12)}`;if(n>I)return void alert("날짜는 오늘 이후로 입력할 수 없습니다.");const a=Kt(`${n} ${s}`,"YYYY-MM-DD HH:mm").toDate(),o=f.find(e=>e.isSelected),l={id:Date.now().toString(),patientId:r.id,drugName:(null==w?void 0:w.drugName)||"",concentration:parseFloat(D.concentration),unit:D.unit,timeAfterDose:0,testDate:a,measurementType:D.measurementType,creatinine:(null==o?void 0:o.result)||void 0,dialysis:(null==o?void 0:o.dialysis)||void 0,renalReplacement:(null==o?void 0:o.renalReplacement)||void 0};i(l);const d="Vancomycin"===(null==w?void 0:w.drugName)?"mg/L":"ng/mL";C({testDate:"",testTime:"",concentration:"",unit:d,measurementType:"Trough"})},className:"flex flex-col md:flex-row gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"drugDateTime",children:"날짜/시간"}),e.jsx(ie,{id:"drugDateTime",type:"text",value:D.testDate,placeholder:"예: 2025-07-25 14:00 또는 202507251400",onChange:e=>C({...D,testDate:e.target.value}),max:I+" 23:59"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"concentration",children:"농도"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ie,{id:"concentration",type:"number",step:"0.01",value:D.concentration,onChange:e=>C({...D,concentration:e.target.value}),className:"flex-1"}),e.jsxs(A,{value:D.unit,onValueChange:e=>C({...D,unit:e}),children:[e.jsx(O,{className:"w-24",children:e.jsx(F,{})}),e.jsx(L,{children:"Vancomycin"===(null==w?void 0:w.drugName)?e.jsx(e.Fragment,{children:e.jsx(V,{value:"mg/L",children:"mg/L"})}):"Cyclosporin"===(null==w?void 0:w.drugName)?e.jsx(e.Fragment,{children:e.jsx(V,{value:"ng/mL",children:"ng/mL"})}):e.jsxs(e.Fragment,{children:[e.jsx(V,{value:"mg/L",children:"mg/L"}),e.jsx(V,{value:"ng/mL",children:"ng/mL"}),e.jsx(V,{value:"μg/L",children:"μg/L"})]})})]})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"measurementType",children:"측정 기준"}),e.jsxs(A,{value:D.measurementType,onValueChange:e=>C({...D,measurementType:e}),children:[e.jsx(O,{children:e.jsx(F,{placeholder:"측정 기준 선택"})}),e.jsxs(L,{children:[e.jsx(V,{value:"Trough",children:"Trough"}),e.jsx(V,{value:"Peak",children:"Peak"})]})]})]}),e.jsx(se,{type:"submit",children:"추가"})]}),k.length>0&&e.jsx("div",{className:"mt-4",children:e.jsxs(kt,{children:[e.jsx(It,{children:e.jsxs(Rt,{children:[e.jsx(Pt,{children:"날짜"}),e.jsx(Pt,{children:"시간"}),e.jsx(Pt,{children:"농도"}),e.jsx(Pt,{children:"측정 기준"}),e.jsx(Pt,{className:"w-16",children:"삭제"})]})}),e.jsx(Mt,{children:k.map(t=>e.jsxs(Rt,{children:[e.jsx($t,{children:t.testDate.toLocaleDateString()}),e.jsx($t,{children:t.testDate.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsxs($t,{children:[t.concentration," ",t.unit]}),e.jsx($t,{children:t.measurementType||"-"}),e.jsx($t,{children:e.jsx(se,{variant:"ghost",size:"icon",onClick:()=>a(t.id),children:e.jsx(ae,{className:"h-4 w-4"})})})]},t.id))})]})})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(se,{variant:"outline",onClick:d,className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"TDM 선택"]}),c&&e.jsxs(se,{onClick:()=>{if("Vancomycin"===(null==w?void 0:w.drugName)){if(!f.some(e=>e.isSelected))return void alert("신기능 데이터를 입력해주세요.")}l()},className:"flex items-center gap-2 w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center",children:["투약 기록",e.jsx(he,{className:"h-4 w-4"})]})]})]})]}),r&&e.jsx(H,{open:T,onOpenChange:S,children:e.jsxs(B,{className:"transform scale-[1.5]",children:[e.jsxs(K,{children:[e.jsx(z,{children:e.jsx("div",{className:"text-center",children:"혈중 약물 농도 측정 가이드"})}),e.jsx(U,{children:e.jsxs("div",{className:"text-center",children:[r.name," 환자는 고위험군 환자입니다.",e.jsx("br",{}),"가이드에 맞게 측정되었는지 확인 후 혈중 약물 농도를 입력해 주세요."]})})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-accent w-1/2",children:[e.jsx("h2",{className:"font-semibold text-lg text-center mb-2",children:"Check point"}),e.jsxs("ul",{className:"list-disc list-inside text-sm space-y-1",children:[e.jsx("li",{className:"text-gray-700",children:"투석 여부: Y"}),e.jsx("li",{className:"text-gray-700",children:"신 대체요법: CRRT"})]})]}),e.jsx(he,{className:"h-6 w-6 text-gray-500"}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-accent w-1/2",children:[e.jsx("h2",{className:"font-semibold text-lg text-center mb-2",children:"Guide"}),e.jsx("ul",{className:"text-sm space-y-1 text-center",children:e.jsx("li",{className:"text-gray-700",children:"투약 2시간 후 최고 흡수 농도 측정 권고(C2)"})})]})]}),e.jsx(G,{children:e.jsx("div",{className:"flex justify-center w-full",children:e.jsx(Y,{onClick:()=>S(!1),className:"w-[calc(100%)]",children:"확인"})})})]})})]}):e.jsx(Q,{children:e.jsx(re,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(be,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"환자를 먼저 선택해 주세요."})]})})})},fn=({simulationData:t,showSimulation:n,currentPatientName:r,selectedDrug:s,chartTitle:i="용법 조정 시뮬레이션",targetMin:a,targetMax:o,predictedAUC:l,predictedMax:d,predictedTrough:c,ipredSeries:u,predSeries:m,observedSeries:p,chartColor:f="pink",tdmIndication:h,tdmTarget:g,tdmTargetValue:x,latestAdministration:v,originalAdministration:b,drugAdministrations:j=[],currentMethodSeries:N=[],isEmptyChart:w=!1,selectedButton:D})=>{var C;const T=y.useMemo(()=>w?[]:(null==u?void 0:u.length)||(null==m?void 0:m.length)||(null==p?void 0:p.length)||(null==N?void 0:N.length)?ke(u,m,p,N):t,[u,m,p,N,t,w]),S=y.useMemo(()=>Ie(u,m,p,N),[u,m,p,N]),k=y.useMemo(()=>Me(j,s),[j,s]),I=y.useMemo(()=>Re(T),[T]),M=l??490,R=d??38,P=c??18,$=(null==v?void 0:v.intervalHours)??null,_=(null==v?void 0:v.dose)??null,E=(null==v?void 0:v.unit)||"mg";null==$||$.toLocaleString(),null==_||Number(_).toLocaleString();const A=y.useMemo(()=>Pe(g,M,R,P,s),[g,M,R,P,s]),O=y.useMemo(()=>$e(g,x,M,R,P,s),[g,x,M,R,P,s]),F={pink:"#ec4899",green:"#22c55e"}[f],L=y.useMemo(()=>{const e=[];return N&&N.length>0&&e.push({label:"현용법",dataKey:"currentMethod",borderColor:"#3b82f6",borderWidth:2}),e.push({label:"용법 조정 결과",dataKey:"predicted",borderColor:F,borderWidth:2,fill:"Vancomycin"===s&&((null==g?void 0:g.toLowerCase().includes("auc"))||!1)}),p&&p.length>0&&e.push({label:"실제 혈중 농도",dataKey:"observed",borderColor:"#ef4444",backgroundColor:"#ef4444",pointRadius:4,showLine:!1}),"Vancomycin"===s&&(null==g?void 0:g.toLowerCase().includes("auc"))||"number"!=typeof I||e.push({label:"평균 농도",dataKey:"averageLine",borderColor:"#6b7280",borderDash:[5,5],borderWidth:2}),e},[N,F,s,g,p,I]);return e.jsxs("div",{className:"w-full",children:[!w&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6 text-gray-800 dark:text-gray-100",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("span",{className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide mb-2",children:"투약 간격"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:null!=$?$.toLocaleString():"-"}),e.jsx("span",{className:"text-base font-semibold text-gray-700 dark:text-gray-300",children:"시간"})]})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("span",{className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide mb-2",children:"1회 투약 용량"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:null!=_?Number(_).toLocaleString():"-"}),e.jsx("span",{className:"text-base font-semibold text-gray-700 dark:text-gray-300",children:E})]})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("span",{className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide mb-2",children:"예측 결과"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[g&&e.jsx("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:(null==(C=g.split("(")[0])?void 0:C.trim())||""}),e.jsx("span",{className:"text-xl font-bold "+(O?"text-blue-700 dark:text-blue-200":"text-red-600 dark:text-red-300"),children:A.value})]}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:["목표 범위: ",x||"-"]})]})]}),e.jsxs("div",{className:"rounded-lg p-4 "+(void 0===O?"bg-gray-100 dark:bg-gray-800":O?"bg-blue-100 dark:bg-blue-900/40":"bg-red-100 dark:bg-red-900/40"),children:[e.jsx("span",{className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide mb-2",children:"적합 여부"}),e.jsx("div",{className:"text-2xl font-extrabold text-gray-900 dark:text-white",children:void 0===O?"-":O?"적합":"부적합"})]})]})}),!w&&e.jsxs("div",{className:"flex justify-center gap-6 mb-4",children:[N&&N.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[r||"환자","의 현용법"]})]}),u&&u.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5",style:{backgroundColor:F}}),e.jsx("span",{className:"text-sm text-gray-600",children:"용법 조정 결과"})]}),p&&p.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"실제 혈중 농도"})]}),!("Vancomycin"===s&&(null==g?void 0:g.toLowerCase().includes("auc")))&&"number"==typeof I&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 border-dashed border-t-2 border-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"평균 농도"})]}),null!==a&&null!==o&&o>a&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 bg-blue-500 bg-opacity-20"}),e.jsx("span",{className:"text-sm text-gray-600",children:"TDM 목표치"})]})]}),e.jsx(_e,{data:T,datasets:L,selectedDrug:s,targetMin:a,targetMax:o,dataTimeExtents:S,lastActualDoseTime:k,drugAdministrations:j,averageConcentration:I})]})},hn=(e,t)=>new Date(`${e}T${t}`),gn=(e,t)=>(e.getTime()-t.getTime())/36e5,xn=(e,t)=>{try{if(!e)return null;const n=t?`tdmfriends:renal:${e}:${t}`:`tdmfriends:renal:${e}`,r=window.localStorage.getItem(n);if(!r)return null;const s=JSON.parse(r);return s.find(e=>e.isSelected)||s[s.length-1]||null}catch{return null}},vn=(e,t)=>e&&t?Math.sqrt(t*e/3600):1.73,bn=e=>{if(!e)return e;return(e.charAt(0).toLowerCase()+e.slice(1)).replace(/-/g,"_")},jn={Vancomycin:{"Not specified/Korean":{default:"Vancomycin1-1",CRRT:"Vancomycin1-2"},"Neurosurgical patients/Korean":{default:"Vancomycin2-1",within72h:"Vancomycin2-2"}},Cyclosporin:{"Renal transplant recipients/Korean":{"POD ~2":"Cyclosporin1-1","POD 3~6":"Cyclosporin1-2","POD 7~":"Cyclosporin1-3",default:"Cyclosporin1-1"},"Allo-HSCT/Korean":"Cyclosporin2","Thoracic transplant recipients/European":"Cyclosporin3"}},Nn=e=>{if(!e||e.length<2)return;const t=[...e].sort((e,t)=>hn(e.date,e.time).getTime()-hn(t.date,t.time).getTime()),n=t[t.length-1],r=t[t.length-2],s=gn(hn(n.date,n.time),hn(r.date,r.time));return s>0?s:void 0},yn=e=>{if(!e)return 0;const{isIVInfusion:t,infusionTime:n,dose:r}=e;return t&&"number"==typeof n&&n>0?r/(n/60):0},wn=e=>{const{patients:t,prescriptions:n,bloodTests:r,drugAdministrations:s,selectedPatientId:i,selectedDrugName:a,overrides:o}=e,l=t.find(e=>e.id===i),d=n.find(e=>e.patientId===i&&(!a||e.drugName===a))||n.find(e=>e.patientId===i);if(!l||!d)return null;const c=l.weight,u=l.age,m="male"===l.gender?1:0,p=l.height,f=((e,t,n,r,s,i)=>{const a={crcl:void 0,egfr:void 0},o=xn(e,i);if(o){const e=(o.result||"").toString(),i=e.match(/(CRCL|eGFR)\s*=\s*([\d.]+)/i);if(i){const e=i[1].toLowerCase(),t=parseFloat(i[2]);if(!Number.isNaN(t)&&t>0)return a[e]=t,a}const l=parseFloat(e.replace(/[^0-9.-]/g,""));if(!Number.isNaN(l)&&l>0)return a.crcl=l,a;const d=parseFloat((o.creatinine||"").toString());if(!Number.isNaN(d)&&d>0){const e=0===r;if("cockcroft-gault"===o.formula){const r=(140-n)*t/(72*d);return a.crcl=e?.85*r:r,a}if("mdrd"===o.formula){const r=vn(s,t),i=175*Math.pow(d,-1.154)*Math.pow(n,-.203)*(e?.742:1);return a.egfr=i*(r/1.73),a}if("ckd-epi"===o.formula){const r=vn(s,t),i=e?.7:.9,o=e?-.329:-.411,l=Math.min(d/i,1),c=Math.max(d/i,1),u=141*Math.pow(l,o)*Math.pow(c,-1.209)*Math.pow(.993,n)*(e?1.018:1);return a.egfr=u*(r/1.73),a}const i=(140-n)*t/(72*d);return a.crcl=e?.85*i:i,a}}return a.crcl=90,a})(i,c,u,m,p,a),h=(s||[]).filter(e=>e.patientId===i),g=((e,t)=>{try{const n=`tdmfriends:prescription:${e}:${t}`,r=window.localStorage.getItem(n);return r?JSON.parse(r):null}catch{return null}})(i,a||d.drugName),x=h.length>0?[...h].sort((e,t)=>hn(e.date,e.time).getTime()-hn(t.date,t.time).getTime())[h.length-1]:void 0,v=(null==g?void 0:g.amount)??(x?x.dose:100),b=(null==g?void 0:g.tau)??Nn(h)??12,j=(null==g?void 0:g.cmt)??1,N=(null==o?void 0:o.amount)??v,y=(null==o?void 0:o.tau)??b,w=j,D="Vancomycin"===d.drugName&&"Neurosurgical patients/Korean"===d.indication&&d.additionalInfo&&!["복용 중인 약물 없음","기타"].includes(d.additionalInfo)?1:0,C=(null==x?void 0:x.infusionTime)??(null==g?void 0:g.infusionTime)??0,T=yn(x),S=C>0?N/(C/60):T,k=[],I=[...h].sort((e,t)=>hn(e.date,e.time).getTime()-hn(t.date,t.time).getTime()),M=I.length>0?hn(I[0].date,I[0].time):new Date;if(I.length>0)for(const $ of I){const e=$,t=Math.max(0,gn(hn($.date,$.time),M)),n=yn(e),r=e.route.includes("po")||e.route.includes("경구")?2:1;k.push({ID:i,TIME:t,DV:null,AMT:$.dose,RATE:n,CMT:r,WT:c,SEX:m,AGE:u,CRCL:f.crcl,EGFR:f.egfr,TOXI:D,EVID:1})}else void 0!==v&&k.push({ID:i,TIME:0,DV:null,AMT:v,RATE:0,CMT:j,WT:c,SEX:m,AGE:u,CRCL:f.crcl,EGFR:f.egfr,TOXI:D,EVID:1});const R=[...a?r.filter(e=>e.patientId===i&&e.drugName===a):r.filter(e=>e.patientId===i)].sort((e,t)=>e.testDate.getTime()-t.testDate.getTime());if(R.length>0)for(const $ of R){const e=gn($.testDate,M),t=$.concentration;k.push({ID:i,TIME:e,DV:t,AMT:0,RATE:0,CMT:1,WT:c,SEX:m,AGE:u,CRCL:f.crcl,EGFR:f.egfr,TOXI:D,EVID:0})}else k.push({ID:i,TIME:y??2,DV:null,AMT:0,RATE:0,CMT:1,WT:c,SEX:m,AGE:u,CRCL:f.crcl,EGFR:f.egfr,TOXI:D,EVID:0});const P=(e=>{const{patientId:t,drugName:n,indication:r,additionalInfo:s,lastDoseDate:i}=e;if(!n||!r)return;const a=jn[n];if(!a)return;const o=xn(t,n),l=/crrt/i.test((null==o?void 0:o.renalReplacement)||""),d=!!i&&((new Date).getTime()-i.getTime())/36e5<=72,c=a[r];if(c){if("string"==typeof c)return bn(c);if("Vancomycin"===n)return l&&c.CRRt?bn(c.CRRt):l&&c.CRRT?bn(c.CRRT):d&&c.within72h?bn(c.within72h):bn(c.default);if("Cyclosporin"===n){const e=null==s?void 0:s.trim(),t=e&&c[e]||c.default;return t?bn(t):void 0}return"string"==typeof c.default?bn(c.default):void 0}})({patientId:i,drugName:d.drugName,indication:d.indication,additionalInfo:d.additionalInfo,lastDoseDate:x?hn(x.date,x.time):void 0});return{input_WT:c,input_CRCL:f.crcl,input_EGFR:f.egfr,input_AGE:u,input_SEX:m,input_TOXI:D,input_tau_before:b,input_amount_before:v,input_rate_before:T,input_cmt_before:j,input_tau_after:y,input_amount_after:N,input_rate_after:S,input_cmt_after:w,model_name:P,dataset:k}},Dn=e=>{var t;const n=e.message.toLowerCase(),r=(null==(t=e.name)?void 0:t.toLowerCase())||"";return!!n.includes("503")||!!(n.includes("cors")||n.includes("failed to fetch")||n.includes("networkerror")||n.includes("network error")||"typeerror"===r||"networkerror"===r)},Cn=async e=>{const{body:t,persist:n,patientId:r,drugName:s,retries:i=3}=e;let a=null;for(let d=0;d<i;d++)try{const e=await fetch("https://b74ljng162.apigw.ntruss.com/tdm/prod/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(503===e.status&&d<i-1){const e=Math.min(1e3*Math.pow(2,d),5e3);await new Promise(t=>setTimeout(t,e));continue}if(!e.ok)throw new Error(`TDM API error: ${e.status}`);const a=await e.json();if(n&&r)try{if(window.localStorage.setItem(`tdmfriends:tdmResult:${r}`,JSON.stringify(a)),s){const e=`tdmfriends:tdmResults:${r}:${s}`,n=window.localStorage.getItem(e),i=n?JSON.parse(n):[],o=t,l={id:`${Date.now()}`,timestamp:(new Date).toISOString(),model_name:null==o?void 0:o.model_name,summary:a,dataset:(null==o?void 0:o.dataset)||[],data:a};i.push(l),window.localStorage.setItem(e,JSON.stringify(i)),window.localStorage.setItem(`tdmfriends:tdmResult:${r}:${s}`,JSON.stringify(a))}}catch(o){}return a}catch(l){if(a=l,!Dn(a))throw l;if(d<i-1){const e=Math.min(1e3*Math.pow(2,d),5e3);await new Promise(t=>setTimeout(t,e));continue}}throw a||new Error("TDM API failed after retries")},Tn=[{name:"Vancomycin",indications:["Not specified/Korean","Neurosurgical patients/Korean"],targets:[{type:"Trough Concentration",value:"10-20 mg/L"},{type:"Peak Concentration",value:"25-40 mg/L"},{type:"AUC",value:"400-600 mg·h/L"}],defaultTargets:{"Not specified/Korean":{type:"AUC",value:"400-600 mg·h/L"},"Neurosurgical patients/Korean":{type:"AUC",value:"400-600 mg·h/L"}}},{name:"Cyclosporin",indications:["Renal transplant recipients/Korean","Allo-HSCT/Korean","Thoracic transplant recipients/European"],targets:[{type:"Trough Concentration",value:"100-400 ng/mL"},{type:"Peak Concentration",value:"800-1200 ng/mL"},{type:"C2 Concentration",value:"1200-1700 ng/mL"}],defaultTargets:{"Allo-HSCT/Korean":{type:"Trough Concentration",value:"150-400 ng/mL"},"Thoracic transplant recipients/European":{type:"Trough Concentration",value:"170-230 ng/mL"},"Renal transplant recipients/Korean":{type:"Trough Concentration",value:"100-400 ng/mL"}}}],Sn=({patients:t,prescriptions:n,bloodTests:r,selectedPatient:s,selectedPrescription:i,drugAdministrations:a=[],onDownloadPDF:o})=>{const[l,d]=y.useState((null==s?void 0:s.id)||""),[c,u]=y.useState((null==i?void 0:i.drugName)||""),m=s&&i?a.filter(e=>e.patientId===s.id&&e.drugName===i.drugName):[],p=y.useMemo(()=>{if(0===m.length)return null;const e=[...m].sort((e,t)=>new Date(`${e.date}T${e.time}`).getTime()-new Date(`${t.date}T${t.time}`).getTime()),t=e[e.length-1];let n=t.intervalHours;if(!n){if(null==i?void 0:i.frequency){const e=i.frequency.match(/\d+/);e&&(n=parseInt(e[0],10))}!n&&m.length>=2&&(n=Nn(m))}return{dose:t.dose,unit:t.unit,intervalHours:n}},[m,i]),[f,h]=y.useState({dose:"",halfLife:"",clearance:"",volumeDistribution:""}),[g,x]=y.useState(!1);y.useRef(null),y.useState("250"),y.useState(""),y.useState("mg"),y.useState(""),y.useState("6"),y.useState("current");const[v,b]=y.useState(null),[j,N]=y.useState([]),[w,D]=y.useState([]),[C,T]=y.useState([]),[S,k]=y.useState(null);y.useState(null),y.useState(null);const[I,M]=y.useState(null),[R,P]=y.useState(null),[$,_]=y.useState([]),[E,A]=y.useState({}),[O,F]=y.useState({}),[L,V]=y.useState(!1),[J,q]=y.useState(null),[X,Z]=y.useState({}),[Q,ee]=y.useState({}),[te,ne]=y.useState({}),[re,ie]=y.useState({}),ae=y.useRef({}),oe=y.useRef(null),[le,de]=y.useState({}),[ce,ue]=y.useState({}),[me,pe]=y.useState({}),[fe,he]=y.useState({}),ge=t.find(e=>e.id===l),xe=y.useMemo(()=>l?n.filter(e=>e.patientId===l):[],[l,n]),ve=y.useMemo(()=>l&&i?r.filter(e=>e.patientId===l&&e.drugName===i.drugName):[],[l,i,r]),be=y.useCallback(e=>{var t,n,r,s,i,a,o,l,d;const c=xe.find(t=>t.drugName===e),u=Tn.find(t=>t.name===e);return{indication:(null==c?void 0:c.indication)||(null==(t=null==u?void 0:u.indications)?void 0:t[0])||"적응증",target:(null==c?void 0:c.tdmTarget)||(null==(r=null==(n=null==u?void 0:u.defaultTargets)?void 0:n[(null==c?void 0:c.indication)||""])?void 0:r.type)||(null==(i=null==(s=null==u?void 0:u.targets)?void 0:s[0])?void 0:i.type)||"목표 유형",targetValue:(null==c?void 0:c.tdmTargetValue)||(null==(o=null==(a=null==u?void 0:u.defaultTargets)?void 0:a[(null==c?void 0:c.indication)||""])?void 0:o.value)||(null==(d=null==(l=null==u?void 0:u.targets)?void 0:l[0])?void 0:d.value)||"목표값",dosage:(null==c?void 0:c.dosage)||0,unit:(null==c?void 0:c.unit)||"mg",frequency:(null==c?void 0:c.frequency)||"시간"}},[xe]),je=y.useMemo(()=>Array.from(new Set([...xe.map(e=>e.drugName),...ve.map(e=>e.drugName)])),[xe,ve]);y.useEffect(()=>{je.length>0&&!c&&u(je[0])},[je,c]);const Ne=y.useMemo(()=>c?ve.filter(e=>e.drugName===c):[],[c,ve]),ye=ve.length>0?[...ve].sort((e,t)=>new Date(t.testDate).getTime()-new Date(e.testDate).getTime())[0]:null;(()=>{var e;if(!f.dose||!f.halfLife)return[];const t=parseFloat(f.dose),n=.693/parseFloat(f.halfLife),r=[];for(let s=0;s<=24;s+=.5){const i=t*Math.exp(-n*s);r.push({time:s,predicted:i,observed:(null==(e=Ne.find(e=>Math.abs(e.timeAfterDose-s)<.5))?void 0:e.concentration)||null})}})();(()=>{var e;if(Ne.length<2)return null;const t=[...Ne].sort((e,t)=>e.timeAfterDose-t.timeAfterDose),n=t[0],r=t[t.length-1];if(n.timeAfterDose===r.timeAfterDose)return null;const s=Math.log(n.concentration/r.concentration)/(r.timeAfterDose-n.timeAfterDose),i=.693/s,a=Ne.reduce((e,t,n)=>{if(0===n)return 0;const r=Ne[n-1];return e+(t.concentration+r.concentration)*(t.timeAfterDose-r.timeAfterDose)/2},0);i.toFixed(2),s.toFixed(4),a.toFixed(2),Math.max(...Ne.map(e=>e.concentration)).toFixed(2),null==(e=Ne.find(e=>e.concentration===Math.max(...Ne.map(e=>e.concentration))))||e.timeAfterDose.toFixed(1)})();const we=(e,t)=>{var n,r;A(n=>({...n,[e]:t})),Z(t=>({...t,[e]:!0}));const s=parseFloat(t.replace(/[^0-9.]/g,"")),i=null==(n=null==le?void 0:le[e])?void 0:n[s];if(i&&i.data){ue(t=>({...t,[e]:i.data})),pe(t=>({...t,[e]:Te(i.data,i.dataset||[])}));const t=((null==(r=i.data)?void 0:r.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0&&e.time<=72);return void he(n=>{var r,s;return{...n,[e]:{ipredSeries:((null==(r=i.data)?void 0:r.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==(s=i.data)?void 0:s.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.PRED??e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(i.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:t}}})}Se(e,s)};oe.current=we;const De=(e,t)=>{F(n=>({...n,[e]:t})),Z(t=>({...t,[e]:!0}));try{const n=parseInt(t.replace(/[^0-9]/g,""),10);Number.isFinite(n)&&ke(e,n)}catch{}};y.useCallback(()=>{try{if(!l)return null;const e=window.localStorage.getItem(`tdmfriends:renal:${l}`);if(!e)return null;const t=JSON.parse(e);return t.find(e=>e.isSelected)||t[t.length-1]||null}catch{return null}},[l]);const Ce=(e,t)=>new Date(`${e}T${t}`),Te=y.useCallback((e,t)=>{try{const n=(null==e?void 0:e.IPRED_CONC)||[],r=(null==e?void 0:e.PRED_CONC)||[],s=new Map,i=e=>{const t=Number(e)||0,n=s.get(t);if(n)return n;const r={time:t,predicted:0,observed:null,controlGroup:0};return s.set(t,r),r};for(const e of n){const t=Number(e.time)||0,n=Number(e.IPRED??0)||0;i(t).predicted=n}for(const e of r){const t=Number(e.time)||0,n=Number(e.PRED??e.IPRED??0)||0;i(t).controlGroup=n}if(t&&t.length>0)for(const e of t)if(0===e.EVID&&null!=e.DV){const t=Number(e.TIME)||0,n=Number(e.DV);i(t).observed=n}return Array.from(s.values()).sort((e,t)=>e.time-t.time)}catch{return[]}},[]);y.useCallback(async e=>{try{if(!l||!c)return;x(!1);const s=wn({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:a,selectedPatientId:l,selectedDrugName:c,overrides:{amount:e}});if(!s)return;const i=await Cn({body:s,persist:!0,patientId:l,drugName:c});b(i),N(Te(i,s.dataset||[])),k({ipredSeries:((null==i?void 0:i.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==i?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(s.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==i?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)});try{const e=`tdmfriends:tdmExtraSeries:${l}:${c}`;window.localStorage.setItem(e,JSON.stringify({ipredSeries:(null==i?void 0:i.IPRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:(null==i?void 0:i.PRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(s.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:(null==i?void 0:i.PRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}))}catch{}x(!0)}catch(s){}},[t,n,r,a,l,c,Te]);const Se=y.useCallback(async(e,s)=>{try{if(!l||!c)return;const i=wn({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:a,selectedPatientId:l,selectedDrugName:c,overrides:{amount:s}});if(!i)return;const o=await Cn({body:i,persist:!1,patientId:l,drugName:c});ue(t=>({...t,[e]:o})),pe(t=>({...t,[e]:Te(o,i.dataset||[])}));const d=((null==o?void 0:o.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0&&e.time<=72);he(t=>({...t,[e]:{ipredSeries:((null==o?void 0:o.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==o?void 0:o.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.PRED??e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(i.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:d}}))}catch(i){}},[t,n,r,a,l,c,Te]);y.useCallback(async e=>{try{if(!l||!c)return;x(!1);const s=wn({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:a,selectedPatientId:l,selectedDrugName:c,overrides:{tau:e}});if(!s)return;const i=await Cn({body:s,persist:!0,patientId:l,drugName:c});b(i),N(Te(i,s.dataset||[])),k({ipredSeries:((null==i?void 0:i.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==i?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(s.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==i?void 0:i.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)});try{const e=`tdmfriends:tdmExtraSeries:${l}:${c}`;window.localStorage.setItem(e,JSON.stringify({ipredSeries:(null==i?void 0:i.IPRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:(null==i?void 0:i.PRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(s.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:(null==i?void 0:i.PRED_CONC).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}))}catch{}x(!0)}catch(s){}},[t,n,r,a,l,c,Te]);const ke=y.useCallback(async(e,s)=>{try{if(!l||!c)return;const i=wn({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:a,selectedPatientId:l,selectedDrugName:c,overrides:{tau:s}});if(!i)return;const o=await Cn({body:i,persist:!1,patientId:l,drugName:c});ue(t=>({...t,[e]:o})),pe(t=>({...t,[e]:Te(o,i.dataset||[])}));const d=((null==o?void 0:o.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0&&e.time<=72);he(t=>({...t,[e]:{ipredSeries:((null==o?void 0:o.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==o?void 0:o.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.PRED??e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(i.dataset||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:d}}))}catch(i){}},[t,n,r,a,l,c,Te]),Ie=y.useCallback(async e=>{try{ne(t=>({...t,[e]:!0})),ie(t=>({...t,[e]:!1}));const i=ge;if(!i)return;const o=xe.find(e=>e.drugName===c)||xe[0];if(!o)return;const l=(o.drugName||"").toLowerCase();let d=10;if("cyclosporin"===l||"cyclosporine"===l){let e=null;try{const t=i?`tdmfriends:conditions:${i.id}`:null;if(t){const n=window.localStorage.getItem(t);if(n){const t=JSON.parse(n).find(e=>"경구"===e.route||"oral"===e.route);e=(null==t?void 0:t.dosageForm)||null}}}catch(s){}d=e&&"capsule/tablet"===e.toLowerCase()?25:10}const u=(a||[]).filter(e=>e.patientId===i.id&&e.drugName===o.drugName),m=u.length>0?[...u].sort((e,t)=>Ce(e.date,e.time).getTime()-Ce(t.date,t.time).getTime())[u.length-1]:void 0,p=Number((null==m?void 0:m.dose)||o.dosage||100),f=(o.tdmTarget||"").toLowerCase(),h=(o.tdmTargetValue||"").match(/\d+\.?\d*/g)||[],g=h[0]?parseFloat(h[0]):void 0,x=h[1]?parseFloat(h[1]):void 0;if(!wn({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:a,selectedPatientId:i.id,selectedDrugName:o.drugName}))return;const b=(e,t,n)=>{if(!e)return Number.POSITIVE_INFINITY;const r=Number(((null==e?void 0:e.CTROUGH_after)??(null==e?void 0:e.CTROUGH_before))||0),s=Number(((null==e?void 0:e.AUC_24_after)??(null==e?void 0:e.AUC_24_before))||0);let i=0;if(f.includes("auc")&&(t||n)){const e=s||0,r=t??e,a=n??e;i=e<r?r-e:e>a?e-a:0}else if((f.includes("trough")||f.includes("cmax"))&&(t||n)){const e=r||0,s=t??e,a=n??e;i=e<s?s-e:e>a?e-a:0}else i=Math.abs((r||0)-((null==v?void 0:v.CTROUGH_before)||0));return i},j=e=>{if(!e)return null;return Pe(o.tdmTarget,e.AUC_24_after??e.AUC_24_before??null,e.CMAX_after??e.CMAX_before??null,e.CTROUGH_after??e.CTROUGH_before??null,o.drugName).numericValue},N=e=>!!e&&$e(o.tdmTarget,o.tdmTargetValue,e.AUC_24_after??e.AUC_24_before??null,e.CMAX_after??e.CMAX_before??null,e.CTROUGH_after??e.CTROUGH_before??null,o.drugName),y=e=>{if(!e||!g||!x)return Number.POSITIVE_INFINITY;const t=j(e);return null===t?Number.POSITIVE_INFINITY:t>=g&&t<=x?0:t<g?g-t:t-x},w=async(e,s=3)=>{const l=wn({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:a,selectedPatientId:i.id,selectedDrugName:o.drugName,overrides:{amount:e}});try{const t=await Cn({body:l,retries:s});return{amt:e,score:b(t,g,x),resp:t,dataset:(null==l?void 0:l.dataset)||[]}}catch(d){return{amt:e,score:Number.POSITIVE_INFINITY,resp:null,dataset:(null==l?void 0:l.dataset)||[]}}},D=5,[C,T]=await Promise.all([w(Math.max(1,p+d),D),w(Math.max(1,p-d),D)]);if(null===C.resp||null===T.resp)return ie(t=>({...t,[e]:!0})),void ne(t=>({...t,[e]:!1}));ie(t=>({...t,[e]:!1}));const S=p+d,k=p-d,I=j(C.resp),M=j(T.resp);let R=null;if(null!==I&&null!==M&&d>0){const e=S-k;0!==e&&(R=(I-M)/e)}let P=null,$=null;if(null!==R&&void 0!==g&&void 0!==x&&null!==M&&Math.abs(R)>1e-4){const e=(g-M)/R;P=Math.max(1,k+e);const t=(x-M)/R;$=Math.max(1,k+t),P=Math.round(P/d)*d,$=Math.round($/d)*d}let _=p,E=1;if(null!==P&&null!==$)_=Math.min(P,$),E=1;else{const e=y(C.resp),t=y(T.resp);E=e<t?1:-1}const O=[C,T],F=[];for(const e of O)N(e.resp)&&F.push(e);const L=Math.round((_-p)/d),V=new Set([1,-1]);let H=L;const B=3;let K=F.length>0,z=0;const U=20;for(;z++,!(z>U);){const t=[];for(let e=0;e<B;e++){const n=H+e*E;V.has(n)||t.push(n)}if(0===t.length){if(H+=B*E,Math.abs(H)>50)break;continue}const n=t.map(e=>Math.max(1,p+e*d)).filter(e=>e>0);if(0===n.length)break;const r=await Promise.all(n.map(e=>w(e))),s=[];for(let e=0;e<r.length;e++)null===r[e].resp&&s.push(w(r[e].amt).then(t=>{r[e]=t}));s.length>0&&await Promise.all(s);for(const e of t)V.add(e);O.push(...r);const i=[...r].sort((e,t)=>1===E?e.amt-t.amt:t.amt-e.amt);let a=!1,o=-1,l=-1;const c=[],u=[];for(let e=0;e<i.length;e++){const t=i[e],n=N(t.resp);c.push({amt:t.amt,inRange:n}),n&&(F.push(t),u.push(t),-1===o&&(o=e,K=!0),l=e,a=!0)}if(u.length>0&&(ee(t=>{const n=t[e]||[],r=u.map(e=>e.amt),s=[...new Set([...n,...r])].sort((e,t)=>e-t);return{...t,[e]:s}}),de(t=>{const n={...t||{}};n[e]=n[e]||{};for(const r of u)r&&r.resp&&(n[e][r.amt]={data:r.resp,dataset:r.dataset});return n}),F.length===u.length)){const t=u.sort((e,t)=>e.amt-t.amt)[0].amt;setTimeout(()=>{oe.current&&oe.current(e,`${t}mg`)},100)}if(u.length,K){if(!a)break;{const e=i[i.length-1];if(!N(e.resp))break;H+=B*E}}else H+=B*E}const G=F.length>0?F.sort((e,t)=>e.amt-t.amt):O.sort((e,t)=>e.score-t.score).slice(0,6),Y=G.map(e=>e.amt).sort((e,t)=>e-t);if(ee(t=>({...t,[e]:Y})),de(t=>{const n={...t||{}};n[e]=n[e]||{};for(const r of G)r&&r.resp&&(n[e][r.amt]={data:r.resp,dataset:r.dataset});return n}),Y.length>0){let t=!1;if(A(n=>{if(n[e])return n;t=!0;const r=Y[0];return{...n,[e]:`${r}mg`}}),t){const t=Y[0];setTimeout(()=>{oe.current&&oe.current(e,`${t}mg`)},100)}}}catch(s){}finally{ne(t=>({...t,[e]:!1}))}},[t,n,r,a,ge,c,xe,v,Te]),Me=y.useCallback(e=>{var t;try{(null==(t=ae.current)?void 0:t[e])&&window.clearTimeout(ae.current[e]);const n=window.setTimeout(()=>{Ie(e)},250);ae.current[e]=n}catch{Ie(e)}},[Ie]),Re=y.useCallback(e=>l?wn({patients:t,prescriptions:n,bloodTests:r,drugAdministrations:a,selectedPatientId:l,selectedDrugName:c,overrides:e}):null,[t,n,r,a,l,c]);y.useEffect(()=>{if(l){try{if(c){const e=`tdmfriends:tdmResults:${l}:${c}`,t=window.localStorage.getItem(e);if(t){const e=[...JSON.parse(t)].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())[0];if(e&&e.data){const t=e.data;b(t);const n=Re();return N(Te(t,(null==n?void 0:n.dataset)||[])),k({ipredSeries:((null==t?void 0:t.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==t?void 0:t.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:((null==n?void 0:n.dataset)||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==t?void 0:t.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}),void x(!0)}}}const e=window.localStorage.getItem(`tdmfriends:tdmResult:${l}`);if(e){const t=JSON.parse(e);b(t);const n=Re();N(Te(t,(null==n?void 0:n.dataset)||[])),k({ipredSeries:((null==t?void 0:t.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==t?void 0:t.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:((null==n?void 0:n.dataset)||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==t?void 0:t.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)}),x(!0)}else N([])}catch(e){}M(null),P(null),D([]),T([])}},[l,c,Te,Re]),y.useEffect(()=>{if(l)try{const e=window.localStorage.getItem(`tdmfriends:selectedDrug:${l}`);e&&u(e)}catch{}},[l]),y.useEffect(()=>{if(l&&c)try{window.localStorage.setItem(`tdmfriends:selectedDrug:${l}`,c)}catch{}},[l,c]);const[_e,Oe]=y.useState([]),[Fe,Le]=y.useState(!1),[Ve,He]=y.useState(""),Be=y.useCallback(e=>{var t;if(!(null==e?void 0:e.data))return;Le(!0);const n=e.data;b(n);const r=(null==e?void 0:e.dataset)||(null==(t=Re())?void 0:t.dataset)||[];N(Te(n,r)),k({ipredSeries:((null==n?void 0:n.IPRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),predSeries:((null==n?void 0:n.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0),observedSeries:(r||[]).filter(e=>0===e.EVID&&null!=e.DV).map(e=>({time:Number(e.TIME)||0,value:Number(e.DV)})).filter(e=>e.time>=0),currentMethodSeries:((null==n?void 0:n.PRED_CONC)||[]).map(e=>({time:Number(e.time)||0,value:Number(e.IPRED??0)||0})).filter(e=>e.time>=0)})},[Re,Te]),Ke=y.useCallback(()=>Le(!1),[]);y.useEffect(()=>{try{if(!l||!c)return void Oe([]);const e=`tdmfriends:tdmResults:${l}:${c}`,t=window.localStorage.getItem(e),n=[...t?JSON.parse(t):[]].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()).slice(0,5);Oe(n)}catch{Oe([])}},[l,c,v]);const ze=()=>{const e=xe.find(e=>e.drugName===c)||xe[0],t=((null==e?void 0:e.tdmTarget)||"").toLowerCase();if(!t||t.includes("auc"))return{};if(t.includes("trough")||t.includes("cmax")){const t=((null==e?void 0:e.tdmTargetValue)||"").match(/\d+\.?\d*/g)||[];return{min:t[0]?parseFloat(t[0]):void 0,max:t[1]?parseFloat(t[1]):void 0}}return{}};return l&&ge&&0!==je.length?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ee,{currentPatient:ge,selectedPrescription:i,latestBloodTest:ye,drugAdministrations:a}),e.jsxs("div",{className:"w-full",children:[_e.length>0&&e.jsxs("div",{className:"mb-4 text-xs text-muted-foreground",children:[e.jsx("div",{className:"font-semibold mb-1",children:"최근 TDM 히스토리 (최대 5개)"}),e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:_e.map(t=>{var n,r,s,i;return e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:[new Date(t.timestamp).toLocaleString()," — AUC24h(before/after): ",(null==(n=t.summary)?void 0:n.AUC24h_before)??"-"," /"," ",(null==(r=t.summary)?void 0:r.AUC24h_after)??"-",", Ctrough(before/after):"," ",(null==(s=t.summary)?void 0:s.CTROUGH_before)??"-"," /"," ",(null==(i=t.summary)?void 0:i.CTROUGH_after)??"-"]}),e.jsx("button",{className:"underline",onClick:()=>Be(t),children:"불러오기"}),o&&e.jsx("button",{className:"underline",onClick:()=>{Be(t),setTimeout(()=>{try{null==o||o()}catch{}},0)},children:"리포트"})]},t.id)})}),Fe&&e.jsxs("div",{className:"mt-2 text-[11px]",children:["완료 보기 모드: 용법 조정 UI가 숨겨집니다."," ",e.jsx("button",{className:"underline",onClick:Ke,children:"종료"})," ",o&&e.jsx("button",{className:"underline ml-2",onClick:()=>{try{null==o||o()}catch{}},children:"리포트 보기"})]})]}),e.jsx(Ae,{showSimulation:!0,currentPatientName:ge.name,selectedDrug:c,targetMin:ze().min,targetMax:ze().max,recentAUC:null==v?void 0:v.AUC_24_before,recentMax:null==v?void 0:v.CMAX_before,recentTrough:null==v?void 0:v.CTROUGH_before,predictedAUC:Fe?null:null==v?void 0:v.AUC_24_after,predictedMax:Fe?null:null==v?void 0:v.CMAX_after,predictedTrough:Fe?null:null==v?void 0:v.CTROUGH_after,ipredSeries:null==S?void 0:S.ipredSeries,predSeries:null==S?void 0:S.predSeries,observedSeries:null==S?void 0:S.observedSeries,tdmIndication:be(c).indication,tdmTarget:be(c).target,tdmTargetValue:be(c).targetValue,latestAdministration:p,drugAdministrations:a})]}),!Fe&&$.map(t=>{var n,r,s,i,o,l,d;return e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg p-6 mt-6 shadow-lg border-2 "+("dosage"===t.type?"border-pink-200 dark:border-pink-800":"border-green-200 dark:border-green-800"),children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["용법 조정 ",t.id]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"dosage"===t.type?"투약 용량을 조정하고 즉시 예측 결과를 확인해보세요":"투약 시간의 간격을 조정하고 즉시 예측 결과를 확인해보세요"})]}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl font-bold flex-shrink-0",onClick:()=>{return e=t.id,q(e),void V(!0);var e},children:"×"})]}),e.jsx("div",{className:"mb-6 px-4",children:"dosage"===t.type?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-center mb-4",children:[re[t.id]&&!te[t.id]&&e.jsxs("div",{className:"flex flex-col items-center gap-3 w-full",children:[e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:"제안 계산에 실패했습니다. 네트워크 상태를 확인하고 다시 시도해주세요."}),e.jsx(se,{variant:"outline",size:"default",onClick:()=>{ie(e=>({...e,[t.id]:!1})),Me(t.id)},className:"text-base px-6 py-3",children:"다시 시도"})]}),!re[t.id]&&(!Q[t.id]||0===Q[t.id].length||te[t.id])&&e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),"제안을 계산 중..."]})]}),(Q[t.id]||[]).length>0&&e.jsx("div",{className:"flex flex-wrap justify-center gap-4",children:(Q[t.id]||[]).map(n=>{const r=`${Number(n).toLocaleString()}mg`;return e.jsx(se,{variant:E[t.id]===r?"default":"outline",size:"default",onClick:()=>we(t.id,r),className:(E[t.id]===r?"bg-black text-white hover:bg-gray-800":"")+" text-base px-6 py-3 flex-shrink-0",children:r},`${t.id}-${n}`)})})]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{variant:"4시간"===O[t.id]?"default":"outline",size:"default",onClick:()=>De(t.id,"4시간"),className:("4시간"===O[t.id]?"bg-black text-white hover:bg-gray-800":"")+" text-base px-6 py-3",children:"4시간"}),e.jsx(se,{variant:"6시간"===O[t.id]?"default":"outline",size:"default",onClick:()=>De(t.id,"6시간"),className:("6시간"===O[t.id]?"bg-black text-white hover:bg-gray-800":"")+" text-base px-6 py-3",children:"6시간"}),e.jsx(se,{variant:"8시간"===O[t.id]?"default":"outline",size:"default",onClick:()=>De(t.id,"8시간"),className:("8시간"===O[t.id]?"bg-black text-white hover:bg-gray-800":"")+" text-base px-6 py-3",children:"8시간"}),e.jsx(se,{variant:"12시간"===O[t.id]?"default":"outline",size:"default",onClick:()=>De(t.id,"12시간"),className:("12시간"===O[t.id]?"bg-black text-white hover:bg-gray-800":"")+" text-base px-6 py-3",children:"12시간"})]})}),e.jsx("div",{className:"mb-8",children:e.jsx(fn,{simulationData:[],showSimulation:g,currentPatientName:null==ge?void 0:ge.name,selectedDrug:c,chartTitle:`용법 조정 ${t.id}`,targetMin:ze().min,targetMax:ze().max,drugAdministrations:a,recentAUC:null==v?void 0:v.AUC_24_before,recentMax:null==v?void 0:v.CMAX_before,recentTrough:null==v?void 0:v.CTROUGH_before,predictedAUC:null==(n=ce[t.id])?void 0:n.AUC_24_after,predictedMax:null==(r=ce[t.id])?void 0:r.CMAX_after,predictedTrough:null==(s=ce[t.id])?void 0:s.CTROUGH_after,ipredSeries:null==(i=fe[t.id])?void 0:i.ipredSeries,predSeries:null==(o=fe[t.id])?void 0:o.predSeries,observedSeries:null==(l=fe[t.id])?void 0:l.observedSeries,currentMethodSeries:null==(d=fe[t.id])?void 0:d.currentMethodSeries,chartColor:"dosage"===t.type?"pink":"green",tdmIndication:be(c).indication,tdmTarget:be(c).target,tdmTargetValue:be(c).targetValue,originalAdministration:p,latestAdministration:(()=>{if(!p)return null;if("dosage"===t.type&&E[t.id]){const e=parseFloat(E[t.id].replace(/[^0-9.]/g,""));if(!isNaN(e))return{...p,dose:e}}if("interval"===t.type&&O[t.id]){const e=parseInt(O[t.id].replace(/[^0-9]/g,""));if(!isNaN(e))return{...p,intervalHours:e}}return p})(),isEmptyChart:!X[t.id]||te[t.id]&&(!Q[t.id]||0===Q[t.id].length),selectedButton:"dosage"===t.type?E[t.id]:O[t.id]})})]},`adjustment-${t.id}`)}),!Fe&&e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-lg p-6 mt-6",children:e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"용법 조정 시뮬레이션을 진행하시겠습니까?"}),Ve&&e.jsx("div",{className:"text-sm text-red-600 mb-2",children:Ve}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(se,{onClick:()=>{Ve&&He("");const e=$.length+1;_(t=>[...t,{id:e,type:"dosage"}]),Z(t=>({...t,[e]:!1})),Me(e)},className:"w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center",children:"투약 용량 조정"}),e.jsx(se,{onClick:()=>{Ve&&He("");const e=$.length+1;_(t=>[...t,{id:e,type:"interval"}]),Z(t=>({...t,[e]:!1}))},className:"w-[300px] bg-black text-white font-bold text-lg py-3 px-6 justify-center",children:"투약 시간 조정"})]})]})}),e.jsx(H,{open:L,onOpenChange:V,children:e.jsxs(B,{children:[e.jsxs(K,{children:[e.jsx(z,{children:"용법 조정 카드 삭제"}),e.jsx(U,{children:"이 용법 조정 카드를 삭제하시겠습니까? 삭제된 카드의 설정은 복구할 수 없습니다."})]}),e.jsxs(G,{children:[e.jsx(W,{onClick:()=>{V(!1),q(null)},children:"취소"}),e.jsx(Y,{onClick:()=>{null!==J&&(_(e=>e.filter(e=>e.id!==J)),A(e=>{const t={...e};return delete t[J],t}),F(e=>{const t={...e};return delete t[J],t}),Z(e=>{const t={...e};return delete t[J],t}),ue(e=>{const t={...e};return delete t[J],t}),pe(e=>{const t={...e};return delete t[J],t}),he(e=>{const t={...e};return delete t[J],t}),ie(e=>{const t={...e};return delete t[J],t}),setTimeout(()=>{0===$.filter(e=>e.id!==J).length&&((e,t,n)=>{try{if(!e||!t)return;const r=`tdmfriends:activeTdm:${e}:${t}`;n||window.localStorage.removeItem(r)}catch{}})(l,c,!1)},0)),V(!1),q(null)},children:"삭제"})]})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-muted-foreground",children:[e.jsx("p",{className:"text-lg font-semibold",children:"환자와 약물을 먼저 선택해 주세요."}),e.jsx("p",{className:"text-sm mt-2",children:"이전 단계에서 환자, TDM 약물, 혈액검사 정보를 모두 입력해야 시뮬레이션이 가능합니다."})]})},kn=({patients:t,prescriptions:n,bloodTests:r,selectedPatient:s,selectedPrescription:i,drugAdministrations:a,onPrev:o})=>{const[l,d]=y.useState(null),[c,u]=y.useState(!1);y.useEffect(()=>{if(s)try{const e=window.localStorage.getItem(`tdmfriends:tdmResult:${s.id}`);d(e?JSON.parse(e):null)}catch{d(null)}else d(null)},[null==s?void 0:s.id]);if(!s)return e.jsx(Q,{children:e.jsx(re,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(je,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Please select a patient first"})]})})});n.filter(e=>e.patientId===s.id),!i||r.filter(e=>e.patientId===s.id&&e.drugName===i.drugName);const m=i?a.filter(e=>e.patientId===s.id&&e.drugName===i.drugName):[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsxs(ee,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"TDM Simulation",e.jsx(fe,{className:"h-5 w-5 text-green-600"})]}),e.jsxs(ne,{children:[s.name," 환자의 TDM 분석 결과를 확인하고 약물 요법을 직접 시뮬레이션 해보세요."]})]}),e.jsxs(re,{children:[e.jsx("div",{id:"pk-simulation-content",children:e.jsx(Sn,{patients:t,prescriptions:n,bloodTests:r,selectedPatient:s,selectedPrescription:i,drugAdministrations:m,onDownloadPDF:async()=>{const e=document.getElementById("pk-simulation-content");if(!e)return;const t=await Oe(e),n=t.toDataURL("image/png"),r=new Fe({orientation:"landscape",unit:"px",format:[t.width,t.height]});r.addImage(n,"PNG",0,0,t.width,t.height),r.save("PK_simulation_report.pdf")}})}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsxs(se,{variant:"outline",onClick:o,className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"투약 기록"]}),e.jsxs(se,{onClick:()=>{u(!0)},className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"TDM 분석 보고서 생성"]})]})]})]}),e.jsx(H,{open:c,onOpenChange:u,children:e.jsxs(B,{children:[e.jsxs(K,{children:[e.jsxs(z,{children:[s.name," 환자의 TDM 분석을 종료하시겠습니까?"]}),e.jsx(U,{children:"분석 종료 후 데이터 수정은 불가하며 새 탭에서 PDF 파일로 보고서를 다운로드할 수 있습니다."})]}),e.jsxs(G,{children:[e.jsx(W,{onClick:()=>{u(!1)},children:"취소"}),e.jsx(Y,{onClick:()=>{u(!1);const e=`${window.location.origin+window.location.pathname.split("/").slice(0,-1).join("/")}/report?patientId=${s.id}`;window.open(e,"_blank")},className:"bg-black text-white hover:bg-gray-800",children:"보고서 생성"})]})]})})]})},In=({row:t,onUpdate:n,isDarkMode:r})=>{const[s,i]=y.useState(t.injectionTime),[a,o]=y.useState(!1);y.useEffect(()=>{a||i(t.injectionTime)},[t.injectionTime,a]);return e.jsx("input",{type:"text",value:s,onChange:e=>{i(e.target.value)},onFocus:e=>{o(!0),e.target.setSelectionRange(e.target.value.length,e.target.value.length)},onBlur:e=>{o(!1),n(t.id,"injectionTime",e.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()},style:{border:"none",background:"transparent",textAlign:"center",width:"100%",color:r?"#e0e6f0":void 0}})},Mn=({row:t,onUpdate:n,isDarkMode:r})=>{const[s,i]=y.useState(t.timeStr),[a,o]=y.useState(!1);y.useEffect(()=>{a||i(t.timeStr)},[t.timeStr,a]);return e.jsx("input",{type:"text",value:s,onChange:e=>{i(e.target.value)},onFocus:e=>{o(!0),e.target.select()},onBlur:e=>{o(!1);let r=e.target.value.toString().replace(/undefined/g,"").trim();if(/^\d{12}$/.test(r)){const e=r.substring(0,4),t=r.substring(4,6),n=r.substring(6,8),s=r.substring(8,10),i=r.substring(10,12);r=`${e}-${t}-${n} ${s}:${i}`}else if(/^\d{11}$/.test(r)){const e=r.substring(0,4),t=r.substring(4,6),n=r.substring(6,8),s=r.substring(8,10),i=r.substring(10,11);r=`${e}-${t}-${n} ${s}:0${i}`}else if(/^\d{10}$/.test(r)){const e=r.substring(0,4),t=r.substring(4,6),n=r.substring(6,8),s=r.substring(8,10);r=`${e}-${t}-${n} ${s}:00`}else if(r.includes(" ")&&r.includes(":")&&!r.includes("-")){const e=r.split(" ");if(4===e.length){const[t,n,s,i]=e;r=`${t}-${n.padStart(2,"0")}-${s.padStart(2,"0")} ${i}`}}n(t.id,"timeStr",r)},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()},placeholder:"YYYY-MM-DD HH:MM",style:{border:"none",background:"transparent",textAlign:"center",width:"100%",color:r?"#e0e6f0":void 0}})};function Rn(t){var n;const[r,s]=y.useState({route:"",dosage:"",unit:"mg",intervalHours:"",injectionTime:"",dosageForm:"",firstDoseDate:"",firstDoseTime:"",totalDoses:""}),[i,a]=y.useState(t.initialConditions||[]),[o,l]=y.useState(t.initialTableData||[]),[d,c]=y.useState(t.initialIsTableGenerated||!1),[u,m]=y.useState(!0),[p,f]=y.useState(null),[h,g]=y.useState(new Set);y.useState(null);const[x,v]=y.useState(!1),[b,j]=y.useState(null);y.useState("table");const[N,w]=y.useState(""),[D,C]=y.useState(!1),T=y.useRef(!1),S=y.useRef(t.onRecordsChange);y.useEffect(()=>{S.current=t.onRecordsChange},[t.onRecordsChange]);const k=y.useRef(t.onConditionsChange);y.useEffect(()=>{k.current=t.onConditionsChange},[t.onConditionsChange]);const I=y.useRef(null);y.useEffect(()=>{const e=()=>C(document.documentElement.classList.contains("dark"));return e(),window.addEventListener("transitionend",e),window.addEventListener("click",e),window.addEventListener("keydown",e),()=>{window.removeEventListener("transitionend",e),window.removeEventListener("click",e),window.removeEventListener("keydown",e)}},[]),y.useEffect(()=>{const e=t.initialAdministrations||[];if(e&&0!==e.length)try{const t={id:"title",round:"회차",time:"투약 시간",amount:"투약용량",route:"투약경로",injectionTime:"주입시간",isTitle:!0},n=e.map((t,n)=>{const r=`${t.date} ${t.time}`,s=new Date(`${t.date}T${t.time}`);return{id:String(t.id||`${Date.now()}_${n}`),conditionId:null,doseIndex:n+1,totalDoses:e.length,time:s,timeStr:r,amount:`${t.dose} ${t.unit||"mg"}`,route:t.route,injectionTime:t.isIVInfusion?void 0!==t.infusionTime?String(t.infusionTime):"0":"-",isTitle:!1}}).sort((e,t)=>e.time-t.time);n.forEach((e,t)=>{e.round=`${t+1} 회차`}),T.current=!0,l([t,...n]),c(!0),setTimeout(()=>{T.current=!1},0)}catch{}},[t.initialAdministrations]),y.useEffect(()=>{if(!S.current)return;if(T.current)return void(T.current=!1);const e=o.filter(e=>!e.isTitle).map(e=>({timeStr:e.timeStr,amount:e.amount,route:e.route,injectionTime:e.injectionTime}));try{const t=JSON.stringify(e);if(I.current===t)return;I.current=t}catch{}S.current(e)},[o]),y.useEffect(()=>{k.current&&k.current(i)},[i]),y.useEffect(()=>{u&&m(!1)},[u]),y.useEffect(()=>{let e=!1;if(t.initialConditions&&(a(t.initialConditions),e=!0),t.initialTableData){T.current=!0;const n=t.initialTableData.map(e=>e.isTitle||"정맥"!==e.route||e.injectionTime&&"-"!==e.injectionTime?e.isTitle||"정맥"===e.route||"0"!==e.injectionTime?e:{...e,injectionTime:"-"}:{...e,injectionTime:"0"});l(n),e=!0}void 0!==t.initialIsTableGenerated&&(c(t.initialIsTableGenerated),e=!0),e&&setTimeout(()=>{T.current=!1},0)},[t.initialConditions,t.initialTableData,t.initialIsTableGenerated]);const M=[{value:"경구",label:"경구 (oral)"},{value:"정맥",label:"정맥 (IV)"},{value:"피하",label:"피하 (SC)"}],R=e=>{if(!e.firstDoseDate||!e.firstDoseTime)return"날짜와 시간을 입력해주세요";const t=e.unit?e.unit:"mg";return`${e.totalDoses}회 투약, ${e.intervalHours}시간 간격, ${e.firstDoseDate} ${e.firstDoseTime}, ${e.dosage} ${t}, ${e.route}${"정맥"===e.route&&e.injectionTime?` (${e.injectionTime})`:""}`},P=(e,n)=>{s(r=>{var s,i,a;const o={...r,[e]:n};if("route"===e&&(null==(s=t.tdmDrug)?void 0:s.drugName)){"cyclosporin"!==(null==(i=t.tdmDrug.drugName)?void 0:i.toLowerCase())&&"cyclosporine"!==(null==(a=t.tdmDrug.drugName)?void 0:a.toLowerCase())||"경구"!==n&&"oral"!==n?o.dosageForm="":o.dosageForm||(o.dosageForm="capsule/tablet");const e=((e,t)=>{if(!e||!t)return"mg";const n=e.toLowerCase(),r=t.toLowerCase();if("vancomycin"===n)return"mg";if("cyclosporin"===n){if("정맥"===r||"iv"===r)return"mg";if("경구"===r||"oral"===r)return"mg"}return"mg"})(t.tdmDrug.drugName,n);e&&(o.unit=e)}return o})},$=(e,t,n)=>{l(r=>r.map(r=>{if(r.id===e){const e={...r,[t]:n};if("timeStr"===t&&n){let t=n.toString().replace(/undefined/g,"").trim();if(/^\d{12}$/.test(t)){const e=t.substring(0,4),n=t.substring(4,6),r=t.substring(6,8),s=t.substring(8,10),i=t.substring(10,12);t=`${e}-${n}-${r} ${s}:${i}`}else if(/^\d{11}$/.test(t)){const e=t.substring(0,4),n=t.substring(4,6),r=t.substring(6,8),s=t.substring(8,10),i=t.substring(10,11);t=`${e}-${n}-${r} ${s}:0${i}`}else if(/^\d{10}$/.test(t)){const e=t.substring(0,4),n=t.substring(4,6),r=t.substring(6,8),s=t.substring(8,10);t=`${e}-${n}-${r} ${s}:00`}else if(t.includes(" ")&&t.includes(":")&&!t.includes("-")){const e=t.split(" ");if(4===e.length){const[n,r,s,i]=e;t=`${n}-${r.padStart(2,"0")}-${s.padStart(2,"0")} ${i}`}}if(t.includes(" ")&&t.includes("-")&&t.includes(":")){const n=t.split(" ");2===n.length&&(e.date=n[0],e.time=n[1])}else t.includes(":")&&(e.time=t,e.date||(e.date=(new Date).toISOString().split("T")[0]));e.timeStr=t}return"route"===t&&(e.injectionTime="정맥"===n?"0":"-"),e}return r}))},_=(e,t)=>{l(n=>n.map(n=>{if(n.id===e&&!n.isTitle){let e,r,s=n.timeStr||"";if(s=s.toString().replace(/undefined/g,"").trim(),s.includes(" ")&&s.includes("-")&&s.includes(":")){const t=s.split(" ");2===t.length&&(e=t[0],r=t[1])}else s.includes(":")?(r=s,e=n.date||(new Date).toISOString().split("T")[0]):(e=(new Date).toISOString().split("T")[0],r="09:00");const i=r.split(":");if(i.length>=2){parseInt(i[0],10),parseInt(i[1],10);const s=new Date(new Date(`${e}T${r}`));s.setMinutes(s.getMinutes()+("plus"===t?1:-1));const a=`${s.getFullYear()}-${(s.getMonth()+1).toString().padStart(2,"0")}-${s.getDate().toString().padStart(2,"0")}`,o=`${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`,l=`${a} ${o}`;return{...n,timeStr:l,date:a,time:o}}{const e=(new Date).toISOString().split("T")[0],t="09:00";return{...n,timeStr:`${e} ${t}`,date:e,time:t}}}return n}))},E=e=>{e.preventDefault()},A=(new Date).toISOString().slice(0,10);return e.jsxs("div",{style:{padding:"0",fontFamily:"Arial, sans-serif",background:D?"#181e29":"#f4f6fa",color:D?"#e0e6f0":"#333"},children:[e.jsx("div",{style:{width:"100%",margin:0,padding:"0 0 40px 0"},children:e.jsxs("div",{children:[e.jsxs("div",{style:{background:D?"#23293a":"#f8f9fa",padding:"20px",borderRadius:"8px",marginBottom:"30px",border:D?"1px solid #334155":"1px solid #dee2e6"},children:[e.jsx("h1",{style:{marginBottom:20,color:D?"#e0e6f0":"#495057"},children:"1단계: 처방 내역을 입력하세요"}),e.jsxs("div",{style:{marginBottom:20,color:D?"#9ca3af":"#6b7280",fontSize:"14px",lineHeight:"1.5"},children:[e.jsx("div",{style:{marginBottom:"8px"},children:"• 처방 내역을 입력한 후 [처방 내역 입력 완료] 버튼을 클릭하면 하단에 자동으로 ‘상세 투약 기록’ 테이블이 생성됩니다."}),e.jsx("div",{children:"• 처방 내역 변경이 있었다면 실제 처방에 일치하도록 새로운 처방 내역을 입력해야 합니다. (예: 1월 4일은 경구 투약, 1월 5일부터는 정맥 주입한 경우 처방 내역을 2개 등록)"})]}),e.jsxs("div",{style:{border:"2px solid #e0e7ff",padding:"20px",marginBottom:"20px",borderRadius:"8px",background:"white"},children:[e.jsxs("div",{style:{display:"flex",gap:"15px",marginBottom:"15px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"투약 경로"}),e.jsxs("select",{value:r.route,onChange:e=>P("route",e.target.value),style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"},children:[e.jsx("option",{value:"",children:"투약 경로를 선택해주세요"}),M.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),(null==(n=t.tdmDrug)?void 0:n.drugName)&&("cyclosporin"===t.tdmDrug.drugName.toLowerCase()||"cyclosporine"===t.tdmDrug.drugName.toLowerCase())&&("경구"===r.route||"oral"===r.route)&&e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"제형"}),e.jsxs("select",{value:r.dosageForm,onChange:e=>P("dosageForm",e.target.value),style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"},children:[e.jsx("option",{value:"",children:"제형을 선택해주세요"}),e.jsx("option",{value:"capsule/tablet",children:"캡슐/정제"}),e.jsx("option",{value:"oral liquid",children:"경구현탁/액제"})]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"투약 용량"}),e.jsx("input",{type:"number",value:r.dosage,onChange:e=>P("dosage",e.target.value),placeholder:"예: 500",style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"}})]}),e.jsxs("div",{style:{width:"5%"},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"단위"}),e.jsx("select",{value:r.unit,onChange:e=>P("unit",e.target.value),style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"},children:["mg","g","mcg"].map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"투약 간격(시간)"}),e.jsx("input",{type:"number",value:r.intervalHours,onChange:e=>P("intervalHours",e.target.value),placeholder:"예: 8",style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"주입시간 (분)"}),e.jsx("input",{type:"text",value:r.injectionTime,onChange:e=>P("injectionTime",e.target.value),placeholder:"bolus 투여 시 0 입력",disabled:"정맥"!==r.route,style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"정맥"!==r.route?"#f8f9fa":"#fff",height:"40px",boxSizing:"border-box",color:"#495057"}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"최초 투약 날짜/시간"}),e.jsx("input",{type:"text",value:r.firstDoseDate,onChange:e=>P("firstDoseDate",e.target.value),placeholder:"예: 202507251400",style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"},max:A+" 23:59"})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:"bold",color:"#495057",fontSize:"13px"},children:"총 투약 횟수"}),e.jsx("input",{type:"number",value:r.totalDoses,onChange:e=>P("totalDoses",e.target.value),placeholder:"예: 10",style:{width:"100%",padding:"8px 12px",border:"1px solid #ced4da",borderRadius:"6px",fontSize:"14px",backgroundColor:"#fff",height:"40px",boxSizing:"border-box",color:"#495057"}})]})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:24},children:e.jsxs("button",{onClick:()=>{if(!r.firstDoseDate)return void alert("날짜와 시간을 입력해주세요! (예: 202507251400)");let e="",n="",i=r.firstDoseDate.trim();if(!/^\d{8}\d{4}$/.test(i.replace(/[-: ]/g,"")))return void alert("날짜와 시간 형식이 올바르지 않습니다. 예: 202507251400");e=i.slice(0,8),n=i.slice(8,12),e=e.slice(0,4)+"-"+e.slice(4,6)+"-"+e.slice(6,8),n=n.slice(0,2)+":"+n.slice(2,4);if(e>(new Date).toISOString().slice(0,10))alert("투약 날짜는 오늘 이후로 입력할 수 없습니다.");else if(r.firstDoseDate=e,r.firstDoseTime=n,r.unit){if(x)a(e=>e.map(e=>e.id===b?{...r,id:b}:e)),v(!1),j(null);else{const e={id:Date.now(),...r};a(t=>[...t,e])}if(t.selectedPatient&&t.tdmDrug){const e="IV"===(o=r.route)?"정맥":"oral"===o?"경구":"subcutaneous"===o?"피하":"intramuscular"===o?"근육":o||"",n="정맥"===e?1:2;((e,t,n)=>{try{const r=`tdmfriends:prescription:${e}:${t}`,s={...n,timestamp:Date.now()};window.localStorage.setItem(r,JSON.stringify(s))}catch(r){}})(t.selectedPatient.id,t.tdmDrug.drugName,{amount:parseFloat(r.dosage)||0,tau:parseFloat(r.intervalHours)||12,cmt:n,route:e,infusionTime:parseFloat(r.injectionTime)||void 0})}var o;s({route:"",dosage:"",unit:"mg",intervalHours:"",injectionTime:"",firstDoseDate:"",firstDoseTime:"",totalDoses:""})}else alert("단위를 선택해주세요!")},style:{display:"flex",alignItems:"center",justifyContent:"center",background:"#eaf0fd",border:"none",color:"#1B44C8",fontWeight:600,fontSize:16,cursor:"pointer",padding:"8px 32px",margin:0,outline:"none",borderRadius:"12px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{e.target.style.backgroundColor="#dbeafe"},onMouseOut:e=>{e.target.style.backgroundColor="#eaf0fd"},children:[e.jsx("span",{style:{fontSize:20,marginRight:6,fontWeight:600,background:"transparent"},children:x?"✓":"+"}),x?"처방 내역 수정":"처방 내역 추가"]})})]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("h3",{style:{marginBottom:"10px",color:"#495057"},children:"처방 내역 summary"}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"8px",padding:"15px",background:"white",maxHeight:"200px",overflowY:"auto"},children:0===i.length?e.jsx("div",{style:{color:"#6c757d",fontStyle:"italic"},children:"처방 내역을 추가해주세요."}):i.map((t,n)=>e.jsxs("div",{style:{borderBottom:"1px dashed #eee",paddingBottom:"10px",marginBottom:"10px",fontSize:"13px",color:"#6c757d",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("span",{style:{fontWeight:"bold",color:"#007bff",marginRight:"10px"},children:["기록 ",n+1,":"]}),R(t)]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:()=>(e=>{const t=i.find(t=>t.id===e);if(t){const n=t.firstDoseDate.replace(/-/g,"")+t.firstDoseTime.replace(/:/g,"");s({route:t.route,dosage:t.dosage,unit:t.unit,intervalHours:t.intervalHours,injectionTime:t.injectionTime,firstDoseDate:n,firstDoseTime:t.firstDoseTime,totalDoses:t.totalDoses}),v(!0),j(e)}})(t.id),style:{padding:"4px 8px",backgroundColor:"#17a2b8",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:"수정"}),e.jsx("button",{onClick:()=>{return e=t.id,void a(t=>t.filter(t=>t.id!==e));var e},style:{padding:"4px 8px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:"삭제"})]})]},t.id))})]}),e.jsx("button",{onClick:()=>{if(0===i.length)return void alert("최소 1개의 조건을 추가해주세요!");for(let t of i)if(!(t.totalDoses&&t.intervalHours&&t.firstDoseDate&&t.firstDoseTime&&t.dosage&&t.route&&t.unit))return void alert("모든 필드를 입력해주세요!");const e=i.map(e=>{const t=parseInt(e.totalDoses),n=parseInt(e.intervalHours),r=`${e.firstDoseDate}T${e.firstDoseTime}`,s=new Date(r),i=new Date(s.getTime()+(t-1)*n*60*60*1e3);return{start:s,end:i}});for(let t=0;t<e.length;t++)for(let n=t+1;n<e.length;n++)if(e[t].start<=e[n].end&&e[n].start<=e[t].end)return void w("중복된 투약일정이 있습니다. 투약일시를 다시 확인해주세요.");let n=[];n.push({id:"title",round:"회차",time:"투약 시간",amount:"투약용량",route:"투약경로",injectionTime:"주입시간",isTitle:!0});let r=[];i.forEach(e=>{const t=parseInt(e.totalDoses),n=parseInt(e.intervalHours),s=e.unit,i=`${e.firstDoseDate}T${e.firstDoseTime}`,a=new Date(i),o=e.route,l=e.injectionTime;for(let d=0;d<t;d++){const i=new Date(a.getTime()+d*n*60*60*1e3);r.push({id:`${e.id}_${d+1}`,conditionId:e.id,doseIndex:d+1,totalDoses:t,time:i,timeStr:`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")} ${String(i.getHours()).padStart(2,"0")}:${String(i.getMinutes()).padStart(2,"0")}`,amount:`${e.dosage} ${s}`,route:o,injectionTime:"정맥"===o&&l?l:"-",isTitle:!1})}});const s=new Set;for(const t of r){if(s.has(t.timeStr))return void alert("중복된 투약일정이 있습니다. 투약일시를 다시 확인해주세요.");s.add(t.timeStr)}if(r.sort((e,t)=>e.time-t.time),r.forEach((e,t)=>{e.round=`${t+1} 회차`}),n=[n[0],...r],l(n),c(!0),t.onTableGenerated&&t.onTableGenerated(),g(new Set),t.onSaveRecords&&!u){const e=n.filter(e=>!e.isTitle).map(e=>({timeStr:e.timeStr,amount:e.amount,route:e.route,injectionTime:e.injectionTime}));t.onSaveRecords(e)}},disabled:0===i.length,style:{width:"100%",padding:"10px 0",backgroundColor:D?0===i.length?"#334155":"#1B44C8":"#fff",color:D?"#fff":"#1B44C8",border:"2px solid #1B44C8",borderRadius:"12px",fontSize:18,fontWeight:700,cursor:0===i.length?"not-allowed":"pointer",marginTop:"20px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{i.length>0&&(e.target.style.backgroundColor=D?"#274fcf":"#eaf0fd")},onMouseOut:e=>{i.length>0&&(e.target.style.backgroundColor=D?"#1B44C8":"#fff")},children:"처방 내역 입력 완료"})]}),e.jsxs("div",{style:{background:D?"#23293a":"white",padding:"20px",borderRadius:"8px",border:D?"1px solid #334155":"1px solid #dee2e6"},children:[e.jsx("h2",{style:{marginBottom:10,color:D?"#e0e6f0":"#495057"},children:"2단계: 투약 기록을 확인하세요"}),e.jsxs("div",{style:{marginBottom:20,color:D?"#9ca3af":"#6b7280",fontSize:"14px",lineHeight:"1.5"},children:[e.jsx("div",{style:{marginBottom:"8px"},children:"• 투약 기록 정보를 정확히 입력할 수록 분석의 정확도가 높아집니다."}),e.jsx("div",{children:"• 투약 시간을 선택해서 정확한 시간으로 수정할 수 있습니다."})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsx("table",{style:{width:"100%",borderCollapse:"collapse",border:D?"1px solid #334155":"1px solid #dee2e6",tableLayout:"fixed",background:D?"#23293a":"white"},children:e.jsx("tbody",{children:o.length>0?o.map(t=>e.jsxs("tr",{draggable:!t.isTitle,onDragStart:e=>{return!t.isTitle&&(n=t.id,void f(n));var n},onDragOver:E,onDrop:e=>!t.isTitle&&((e,t)=>{if(e.preventDefault(),p===t||"title"===p)return;const n=o.findIndex(e=>e.id===p),r=o.findIndex(e=>e.id===t);if(-1===n||-1===r)return;const s=[...o],i=s[n];s.splice(n,1),s.splice(r,0,i),s.forEach((e,t)=>{e.isTitle||(e.round=`${t+1}`)}),l(s),f(null)})(e,t.id),style:{backgroundColor:t.isTitle?D?"#2d3650":"#e9ecef":D?"#23293a":"white",fontWeight:t.isTitle?"bold":"normal",cursor:t.isTitle?"default":"grab",color:D?"#e0e6f0":void 0},children:[e.jsx("td",{style:{padding:"12px",border:D?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"12%",color:D?"#e0e6f0":void 0,background:D&&t.isTitle?"#2d3650":void 0},children:t.isTitle?t.round:e.jsx("input",{type:"text",value:t.round,onChange:e=>$(t.id,"round",e.target.value),style:{border:"none",background:"transparent",textAlign:"center",width:"100%",color:D?"#e0e6f0":void 0}})}),e.jsx("td",{style:{padding:"12px",border:D?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"25%",color:D?"#e0e6f0":void 0,background:D&&t.isTitle?"#2d3650":void 0},children:t.isTitle?t.time:e.jsxs("div",{style:{display:"flex",gap:"2px",alignItems:"center"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(Mn,{row:t,onUpdate:$,isDarkMode:D})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1px"},children:[e.jsx("button",{type:"button",onClick:()=>_(t.id,"plus"),style:{width:"20px",height:"14px",border:"1px solid #d1d5db",borderRadius:"2px 2px 0 0",background:D?"#374151":"#f9fafb",color:D?"#e0e6f0":"#374151",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"bold",padding:"0"},onMouseOver:e=>{e.target.style.background=D?"#4b5563":"#e5e7eb"},onMouseOut:e=>{e.target.style.background=D?"#374151":"#f9fafb"},children:"▲"}),e.jsx("button",{type:"button",onClick:()=>_(t.id,"minus"),style:{width:"20px",height:"14px",border:"1px solid #d1d5db",borderRadius:"0 0 2px 2px",background:D?"#374151":"#f9fafb",color:D?"#e0e6f0":"#374151",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"bold",padding:"0"},onMouseOver:e=>{e.target.style.background=D?"#4b5563":"#e5e7eb"},onMouseOut:e=>{e.target.style.background=D?"#374151":"#f9fafb"},children:"▼"})]})]})}),e.jsx("td",{style:{padding:"12px",border:D?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"18%",color:D?"#e0e6f0":void 0,background:D&&t.isTitle?"#2d3650":void 0},children:t.isTitle?t.amount:e.jsx("input",{type:"text",value:t.amount,onChange:e=>$(t.id,"amount",e.target.value),style:{border:"none",background:"transparent",textAlign:"center",width:"100%",color:D?"#e0e6f0":void 0}})}),e.jsx("td",{style:{padding:"12px",border:D?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"18%",color:D?"#e0e6f0":void 0,background:D&&t.isTitle?"#2d3650":void 0},children:t.isTitle?t.route:e.jsx("select",{value:t.route,onChange:e=>$(t.id,"route",e.target.value),style:{border:"none",background:"transparent",textAlign:"center",width:"100%",color:D?"#e0e6f0":void 0,backgroundColor:D?"#23293a":void 0},children:M.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})}),e.jsx("td",{style:{padding:"12px",border:D?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"18%",color:D?"#e0e6f0":void 0,background:D&&t.isTitle?"#2d3650":void 0},children:t.isTitle?t.injectionTime:e.jsx(In,{row:t,onUpdate:$,isDarkMode:D})}),e.jsx("td",{style:{padding:"12px",border:D?"1px solid #334155":"1px solid #dee2e6",textAlign:"center",width:"10%",color:D?"#e0e6f0":void 0,background:D&&t.isTitle?"#2d3650":void 0},children:t.isTitle?"삭제":e.jsx("input",{type:"checkbox",checked:h.has(t.id),onChange:()=>{return e=t.id,void g(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n});var e},style:{width:"16px",height:"16px",cursor:"pointer",accentColor:D?"#1B44C8":void 0}})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",style:{padding:"40px",textAlign:"center",color:"#6b7280",fontStyle:"italic"},children:'처방 내역을 입력하고 "처방 내역 입력 완료" 버튼을 클릭하여 테이블을 생성하세요.'})})})})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"15px"},children:[e.jsx("button",{onClick:()=>{window.confirm("투약 기록 테이블을 전체 삭제하시겠습니까? 처방 내역은 유지됩니다.")&&(l([]),c(!1),g(new Set),s({route:"",dosage:"",unit:"mg",intervalHours:"",injectionTime:"",firstDoseDate:"",firstDoseTime:"",totalDoses:""}),v(!1),j(null))},style:{padding:"8px 16px",backgroundColor:"#fff",color:"#dc2626",border:"1px solid #fecaca",borderRadius:"8px",cursor:"pointer",fontWeight:400,fontSize:"15px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{e.target.style.backgroundColor="#fef2f2"},onMouseOut:e=>{e.target.style.backgroundColor="#fff"},children:"🗑️ 전체 삭제"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>{const e=Math.max(0,...o.filter(e=>!e.isTitle).map(e=>parseInt(e.id)||0))+1,t=o.filter(e=>!e.isTitle&&e.timeStr).sort((e,t)=>{if(e.timeStr&&t.timeStr){const n=new Date(e.timeStr);return new Date(t.timeStr).getTime()-n.getTime()}return 0})[0];let n;if(t&&t.timeStr){const e=new Date(t.timeStr);n=new Date(e.getTime()+432e5)}else n=new Date,n.setHours(9,0,0,0);const r=n.toISOString().split("T")[0],s=n.toTimeString().slice(0,5),i=o.filter(e=>!e.isTitle&&e.amount&&"0"!==e.amount).map(e=>e.amount);let a="500 mg";if(i.length>0){const e={};i.forEach(t=>{e[t]=(e[t]||0)+1});a=Object.keys(e).reduce((t,n)=>e[t]>e[n]?t:n)}const d={id:String(e),round:`${e}회차`,date:r,time:s,timeStr:`${r} ${s}`,amount:a,route:"경구",injectionTime:"-",isTitle:!1};l(e=>[...e,d])},style:{padding:"8px 16px",backgroundColor:"#fff",color:"#222",border:"1px solid #dee2e6",borderRadius:"8px",cursor:"pointer",fontWeight:400,fontSize:"15px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{e.target.style.backgroundColor="#f4f6fa"},onMouseOut:e=>{e.target.style.backgroundColor="#fff"},children:"+ 행추가"}),e.jsx("button",{onClick:()=>{0!==h.size?window.confirm(`선택된 ${h.size}개 행을 삭제하시겠습니까?`)&&(l(e=>e.filter(e=>!h.has(e.id))),g(new Set)):alert("삭제할 행을 선택해주세요!")},style:{padding:"8px 16px",backgroundColor:"#fff",color:"#fb7185",border:"1px solid #ffe4e6",borderRadius:"8px",cursor:"pointer",fontWeight:400,fontSize:"15px",transition:"background 0.2s, color 0.2s"},onMouseOver:e=>{e.target.style.backgroundColor="#f4f6fa"},onMouseOut:e=>{e.target.style.backgroundColor="#fff"},children:"선택 삭제"})]})]})]})]})}),N&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.3)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px 32px",boxShadow:"0 4px 24px #0002",minWidth:"320px",textAlign:"center",border:"1.5px solid #222",color:"#222",fontWeight:600},children:[e.jsx("div",{style:{fontSize:"17px",marginBottom:"18px",whiteSpace:"pre-line"},children:"중복된 투약일정이 있습니다.\n투약일시를 다시 확인해주세요."}),e.jsx("button",{onClick:()=>w(""),style:{background:"#222",color:"white",border:"none",borderRadius:"6px",padding:"8px 28px",fontSize:"15px",fontWeight:600,cursor:"pointer"},children:"확인"})]})})]})}const Pn=({patients:t,prescriptions:n,selectedPatient:r,selectedPrescription:s,onAddDrugAdministration:i,setDrugAdministrations:a,drugAdministrations:o,bloodTests:l,onNext:d,onPrev:c,isCompleted:u})=>{const m=s;y.useState({drugName:(null==m?void 0:m.drugName)||"",route:"",date:"",time:"",dose:0,unit:"mg",infusionTime:void 0});const[p,f]=y.useState(!1),[h,g]=y.useState(!1),[x,v]=y.useState([]);Kt().format("YYYY-MM-DD");const b=r&&m?o.filter(e=>e.patientId===r.id&&e.drugName===m.drugName):[],j=y.useCallback(()=>r&&(null==m?void 0:m.drugName)?`tdmfriends:conditions:${r.id}:${m.drugName}`:null,[r,null==m?void 0:m.drugName]);return y.useEffect(()=>{if(!r)return;const e=j();if(e)try{const t=localStorage.getItem(e);if(t){const e=JSON.parse(t);v(e)}}catch(t){}},[r,null==m?void 0:m.drugName,j]),y.useEffect(()=>{if(!r)return;const e=j();if(e)try{localStorage.setItem(e,JSON.stringify(x))}catch(t){}},[x,r,null==m?void 0:m.drugName,j]),y.useEffect(()=>{},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsxs(ee,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"4단계: 투약기록",u&&e.jsx(fe,{className:"h-5 w-5 text-green-600"})]}),e.jsx(ne,{children:"2단계에서 입력한 TDM 약물에 대해 7반감기 이내의 투약력을 입력하세요."})]}),e.jsxs(re,{className:"space-y-6",children:[m&&r&&e.jsxs("div",{className:"py-3 px-4 rounded bg-muted dark:bg-slate-800 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"나이:"})," ",r.age]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"성별:"})," ",r.gender]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"몸무게:"})," ",r.weight,"kg"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"키:"})," ",r.height,"cm"]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"약품명:"}),e.jsx("span",{className:"ml-2 font-semibold",children:m.drugName})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"적응증:"}),e.jsx("span",{className:"ml-2",children:m.indication})]})]})]}),(!m||!r)&&e.jsx("div",{className:"py-2 px-3 rounded bg-muted dark:bg-slate-800 text-base font-semibold mb-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"TDM 내역:"})," ",(null==m?void 0:m.drugName)||"-",", ",(null==m?void 0:m.indication)||"-"]})})]})]}),e.jsxs(Q,{className:"bg-white dark:bg-slate-900 border dark:border-slate-700 text-slate-900 dark:text-slate-200",children:[e.jsx(ee,{children:e.jsx(te,{children:"투약 기록 입력"})}),e.jsxs(re,{children:[e.jsx(Rn,{selectedPatient:r,tdmDrug:m,onComplete:d,onTableGenerated:()=>f(!0),initialAdministrations:b,initialConditions:x,onConditionsChange:v,onSaveRecords:e=>{if(r&&m){const t=e.map((e,t)=>({id:`${Date.now()}_${t}`,patientId:r.id,drugName:m.drugName,route:e.route,date:e.timeStr.split(" ")[0],time:e.timeStr.split(" ")[1],dose:Number(e.amount.split(" ")[0]),unit:e.amount.split(" ")[1]||"mg",isIVInfusion:"정맥"===e.route,infusionTime:e.injectionTime&&"-"!==e.injectionTime?parseInt(String(e.injectionTime).replace(/[^0-9]/g,"")):void 0,administrationTime:void 0,intervalHours:x.length>0?Number(x[0].intervalHours):void 0})),n=[...o.filter(e=>!(e.patientId===r.id&&e.drugName===(null==m?void 0:m.drugName))),...t];a(n)}},onRecordsChange:e=>{if(r&&m){const t=e.map((e,t)=>({id:`${Date.now()}_${t}`,patientId:r.id,drugName:m.drugName,route:e.route,date:e.timeStr.split(" ")[0],time:e.timeStr.split(" ")[1],dose:Number(e.amount.split(" ")[0]),unit:e.amount.split(" ")[1]||"mg",isIVInfusion:"정맥"===e.route,infusionTime:e.injectionTime&&"-"!==e.injectionTime?parseInt(String(e.injectionTime).replace(/[^0-9]/g,"")):"정맥"===e.route?0:void 0,administrationTime:void 0,intervalHours:x.length>0?Number(x[0].intervalHours):void 0})),n=[...o.filter(e=>!(e.patientId===r.id&&e.drugName===(null==m?void 0:m.drugName))),...t];a(n)}}}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsxs(se,{variant:"outline",type:"button",onClick:c,className:"flex items-center gap-2 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-200",children:[e.jsx(ve,{className:"h-4 w-4"}),"Lab"]}),e.jsxs(se,{onClick:async()=>{if(r){g(!0);try{const e=wn({patients:t,prescriptions:n,bloodTests:l,drugAdministrations:o,selectedPatientId:r.id,selectedDrugName:null==m?void 0:m.drugName});e&&await Cn({body:e,persist:!0,patientId:r.id})}catch(e){}finally{g(!1),d()}}else d()},disabled:h,className:"flex items-center gap-2 w-[300px] bg-black dark:bg-blue-700 text-white font-bold text-lg py-3 px-6 justify-center dark:hover:bg-blue-800 disabled:opacity-60",children:[h?"처리 중...":"TDM Simulation",e.jsx(he,{className:"h-4 w-4"})]})]})]})]})]})},$n=({patients:t,prescriptions:n,bloodTests:r,selectedPatient:s,setSelectedPatient:i,onAddPatient:a,onUpdatePatient:o,onDeletePatient:l,onAddPrescription:d,setPrescriptions:c,onAddBloodTest:u,onDeleteBloodTest:m,setBloodTests:p,onAddDrugAdministration:f,drugAdministrations:h,setDrugAdministrations:g,onResetWorkflow:x})=>{const[v,b]=y.useState(null),[j,N]=y.useState(1);y.useEffect(()=>{if(s)try{const e=window.localStorage.getItem(`tdmfriends:prescription:${s.id}`);if(!e)return;const t=JSON.parse(e),r=t.selectedTdmId||t.newlyAddedTdmId;if(!r)return;const i=n.find(e=>e.id===r&&e.patientId===s.id)||null;i&&b(i)}catch(e){}else b(null)},[s,null==s?void 0:s.id,n]);const w=[{id:1,title:"환자 등록 및 선택",icon:pe,description:"환자를 선택하거나 신규 등록해주세요."},{id:2,title:"TDM 선택",icon:ge,description:"TDM 약물 정보를 입력합니다."},{id:3,title:"Lab",icon:be,description:"신기능 및 혈중 약물 농도 정보를 입력합니다."},{id:4,title:"투약 기록",icon:ye,description:"투약 기록을 입력합니다."},{id:5,title:"Let's TDM",icon:je,description:"정밀의료 시뮬레이션 결과를 확인해보세요."}],D=s?n.filter(e=>e.patientId===s.id):[],C=s?r.filter(e=>e.patientId===s.id):[],T=e=>{switch(e){case 1:return null!==s;case 2:return s&&D.length>0;case 3:return s&&C.length>0;case 4:return s&&h.length>0;case 5:return s&&C.length>0&&D.length>0&&h.length>0;default:return!1}},S=()=>{j<5&&N(j+1)},k=()=>{j>1&&N(j-1)},I=()=>{if(s){const e=r.filter(e=>e.patientId!==s.id);p(e);const t=h.filter(e=>e.patientId!==s.id);g(t)}},M=w.filter(e=>T(e.id)).length,R=M/w.length*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsxs(ee,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"TDM 분석 워크플로우"]}),e.jsxs(ne,{children:["각 단계를 순서대로 진행해 주세요",s&&` (${s.name} 환자)`]})]}),e.jsx(re,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["진행률: ",M," / ",w.length,"단계 완료"]}),e.jsxs("span",{children:[Math.round(R),"%"]})]}),e.jsx(dn,{value:R,className:"w-full"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:w.map(t=>{const n=t.icon,r=T(t.id),s=j===t.id,i=1===(a=t.id)||T(a-1);var a;return e.jsxs(se,{variant:s?"default":r?"secondary":"outline",className:"flex flex-col items-center gap-1 h-auto py-3 "+(i?"":"opacity-50 cursor-not-allowed"),disabled:!i,onClick:()=>{i&&N(t.id)},children:[e.jsx("div",{className:"flex items-center gap-1",children:r?e.jsx(fe,{className:"h-4 w-4"}):e.jsx(n,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-xs text-center leading-tight",children:t.title})]},t.id)})})]})})]}),e.jsxs("div",{className:"min-h-[600px]",children:[1===j&&e.jsx(cn,{patients:t,selectedPatient:s,setSelectedPatient:i,onAddPatient:a,onUpdatePatient:o,onDeletePatient:l,onNext:S,isCompleted:T(1)}),2===j&&e.jsx(mn,{patients:t,prescriptions:n,selectedPatient:s,selectedPrescription:v,setSelectedPrescription:b,onAddPrescription:(e,t)=>{e?(d(e),b(e)):c(t)},onNext:S,onPrev:k,isCompleted:T(2),bloodTests:r,setBloodTests:p,drugAdministrations:h,setDrugAdministrations:g,onClearLaterStepData:I,onResetWorkflow:()=>{I(),x()}}),3===j&&e.jsx(pn,{patients:t,bloodTests:r,selectedPatient:s,selectedPrescription:v,onAddBloodTest:u,onDeleteBloodTest:m,onNext:S,onPrev:k,isCompleted:T(3),prescriptions:n}),4===j&&e.jsx(Pn,{patients:t,prescriptions:n,selectedPatient:s,selectedPrescription:v,onAddDrugAdministration:f,setDrugAdministrations:g,drugAdministrations:h,bloodTests:r,onNext:S,onPrev:k,isCompleted:T(4)}),5===j&&e.jsx(kn,{patients:t,prescriptions:n,bloodTests:r,selectedPatient:s,selectedPrescription:v,drugAdministrations:h,onPrev:k})]})]})};var _n="Switch",[En,An]=o(_n),[On,Fn]=En(_n),Ln=y.forwardRef((t,s)=>{const{__scopeSwitch:o,name:l,checked:d,defaultChecked:c,required:u,disabled:m,value:p="on",onCheckedChange:f,form:h,...g}=t,[x,v]=y.useState(null),b=n(s,e=>v(e)),j=y.useRef(!1),N=!x||(h||!!x.closest("form")),[w=!1,D]=r({prop:d,defaultProp:c,onChange:f});return e.jsxs(On,{scope:o,checked:w,disabled:m,children:[e.jsx(i.button,{type:"button",role:"switch","aria-checked":w,"aria-required":u,"data-state":Kn(w),"data-disabled":m?"":void 0,disabled:m,value:p,...g,ref:b,onClick:a(t.onClick,e=>{D(e=>!e),N&&(j.current=e.isPropagationStopped(),j.current||e.stopPropagation())})}),N&&e.jsx(Bn,{control:x,bubbles:!j.current,name:l,value:p,checked:w,required:u,disabled:m,form:h,style:{transform:"translateX(-100%)"}})]})});Ln.displayName=_n;var Vn="SwitchThumb",Hn=y.forwardRef((t,n)=>{const{__scopeSwitch:r,...s}=t,a=Fn(Vn,r);return e.jsx(i.span,{"data-state":Kn(a.checked),"data-disabled":a.disabled?"":void 0,...s,ref:n})});Hn.displayName=Vn;var Bn=t=>{const{control:n,checked:r,bubbles:s=!0,...i}=t,a=y.useRef(null),o=Ve(r),l=c(n);return y.useEffect(()=>{const e=a.current,t=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(t,"checked").set;if(o!==r&&n){const t=new Event("click",{bubbles:s});n.call(e,r),e.dispatchEvent(t)}},[o,r,s]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...i,tabIndex:-1,ref:a,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Kn(e){return e?"checked":"unchecked"}var zn=Ln,Un=Hn;const Gn=y.forwardRef(({className:t,...n},r)=>e.jsx(zn,{className:d("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...n,ref:r,children:e.jsx(Un,{className:d("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Gn.displayName=zn.displayName;var Yn=["Enter"," "],Wn=["ArrowUp","PageDown","End"],Jn=["ArrowDown","PageUp","Home",...Wn],qn={ltr:[...Yn,"ArrowRight"],rtl:[...Yn,"ArrowLeft"]},Xn={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Zn="Menu",[Qn,er,tr]=t(Zn),[nr,rr]=o(Zn,[tr,u,Je]),sr=u(),ir=Je(),[ar,or]=nr(Zn),[lr,dr]=nr(Zn),cr=t=>{const{__scopeMenu:n,open:r=!1,children:i,dir:a,onOpenChange:o,modal:l=!0}=t,d=sr(n),[c,u]=y.useState(null),m=y.useRef(!1),p=s(o),f=C(a);return y.useEffect(()=>{const e=()=>{m.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>m.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),e.jsx(b,{...d,children:e.jsx(ar,{scope:n,open:r,onOpenChange:p,content:c,onContentChange:u,children:e.jsx(lr,{scope:n,onClose:y.useCallback(()=>p(!1),[p]),isUsingKeyboardRef:m,dir:f,modal:l,children:i})})})};cr.displayName=Zn;var ur=y.forwardRef((t,n)=>{const{__scopeMenu:r,...s}=t,i=sr(r);return e.jsx(m,{...i,...s,ref:n})});ur.displayName="MenuAnchor";var mr="MenuPortal",[pr,fr]=nr(mr,{forceMount:void 0}),hr=t=>{const{__scopeMenu:n,forceMount:r,children:s,container:i}=t,a=or(mr,n);return e.jsx(pr,{scope:n,forceMount:r,children:e.jsx(l,{present:r||a.open,children:e.jsx(j,{asChild:!0,container:i,children:s})})})};hr.displayName=mr;var gr="MenuContent",[xr,vr]=nr(gr),br=y.forwardRef((t,n)=>{const r=fr(gr,t.__scopeMenu),{forceMount:s=r.forceMount,...i}=t,a=or(gr,t.__scopeMenu),o=dr(gr,t.__scopeMenu);return e.jsx(Qn.Provider,{scope:t.__scopeMenu,children:e.jsx(l,{present:s||a.open,children:e.jsx(Qn.Slot,{scope:t.__scopeMenu,children:o.modal?e.jsx(jr,{...i,ref:n}):e.jsx(Nr,{...i,ref:n})})})})}),jr=y.forwardRef((t,r)=>{const s=or(gr,t.__scopeMenu),i=y.useRef(null),o=n(r,i);return y.useEffect(()=>{const e=i.current;if(e)return J(e)},[]),e.jsx(yr,{...t,ref:o,trapFocus:s.open,disableOutsidePointerEvents:s.open,disableOutsideScroll:!0,onFocusOutside:a(t.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>s.onOpenChange(!1)})}),Nr=y.forwardRef((t,n)=>{const r=or(gr,t.__scopeMenu);return e.jsx(yr,{...t,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),yr=y.forwardRef((t,r)=>{const{__scopeMenu:s,loop:i=!1,trapFocus:o,onOpenAutoFocus:l,onCloseAutoFocus:d,disableOutsidePointerEvents:c,onEntryFocus:u,onEscapeKeyDown:m,onPointerDownOutside:h,onFocusOutside:g,onInteractOutside:v,onDismiss:b,disableOutsideScroll:j,...N}=t,w=or(gr,s),D=dr(gr,s),C=sr(s),T=ir(s),S=er(s),[k,I]=y.useState(null),M=y.useRef(null),R=n(r,M,w.onContentChange),P=y.useRef(0),$=y.useRef(""),_=y.useRef(0),E=y.useRef(null),A=y.useRef("right"),O=y.useRef(0),F=j?Z:y.Fragment,L=j?{as:x,allowPinchZoom:!0}:void 0,V=e=>{var t,n;const r=$.current+e,s=S().filter(e=>!e.disabled),i=document.activeElement,a=null==(t=s.find(e=>e.ref.current===i))?void 0:t.textValue,o=function(e,t,n){const r=t.length>1&&Array.from(t).every(e=>e===t[0]),s=r?t[0]:t,i=n?e.indexOf(n):-1;let a=(o=e,l=Math.max(i,0),o.map((e,t)=>o[(l+t)%o.length]));var o,l;1===s.length&&(a=a.filter(e=>e!==n));const d=a.find(e=>e.toLowerCase().startsWith(s.toLowerCase()));return d!==n?d:void 0}(s.map(e=>e.textValue),r,a),l=null==(n=s.find(e=>e.textValue===o))?void 0:n.ref.current;!function e(t){$.current=t,window.clearTimeout(P.current),""!==t&&(P.current=window.setTimeout(()=>e(""),1e3))}(r),l&&setTimeout(()=>l.focus())};y.useEffect(()=>()=>window.clearTimeout(P.current),[]),q();const H=y.useCallback(e=>{var t,n;return A.current===(null==(t=E.current)?void 0:t.side)&&function(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return function(e,t){const{x:n,y:r}=e;let s=!1;for(let i=0,a=t.length-1;i<t.length;a=i++){const e=t[i].x,o=t[i].y,l=t[a].x,d=t[a].y;o>r!=d>r&&n<(l-e)*(r-o)/(d-o)+e&&(s=!s)}return s}(n,t)}(e,null==(n=E.current)?void 0:n.area)},[]);return e.jsx(xr,{scope:s,searchRef:$,onItemEnter:y.useCallback(e=>{H(e)&&e.preventDefault()},[H]),onItemLeave:y.useCallback(e=>{var t;H(e)||(null==(t=M.current)||t.focus(),I(null))},[H]),onTriggerLeave:y.useCallback(e=>{H(e)&&e.preventDefault()},[H]),pointerGraceTimerRef:_,onPointerGraceIntentChange:y.useCallback(e=>{E.current=e},[]),children:e.jsx(F,{...L,children:e.jsx(X,{asChild:!0,trapped:o,onMountAutoFocus:a(l,e=>{var t;e.preventDefault(),null==(t=M.current)||t.focus({preventScroll:!0})}),onUnmountAutoFocus:d,children:e.jsx(p,{asChild:!0,disableOutsidePointerEvents:c,onEscapeKeyDown:m,onPointerDownOutside:h,onFocusOutside:g,onInteractOutside:v,onDismiss:b,children:e.jsx(st,{asChild:!0,...T,dir:D.dir,orientation:"vertical",loop:i,currentTabStopId:k,onCurrentTabStopIdChange:I,onEntryFocus:a(u,e=>{D.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(f,{role:"menu","aria-orientation":"vertical","data-state":Wr(w.open),"data-radix-menu-content":"",dir:D.dir,...C,...N,ref:R,style:{outline:"none",...N.style},onKeyDown:a(N.onKeyDown,e=>{const t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,r=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&r&&V(e.key));const s=M.current;if(e.target!==s)return;if(!Jn.includes(e.key))return;e.preventDefault();const i=S().filter(e=>!e.disabled).map(e=>e.ref.current);Wn.includes(e.key)&&i.reverse(),function(e){const t=document.activeElement;for(const n of e){if(n===t)return;if(n.focus(),document.activeElement!==t)return}}(i)}),onBlur:a(t.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(P.current),$.current="")}),onPointerMove:a(t.onPointerMove,Xr(e=>{const t=e.target,n=O.current!==e.clientX;if(e.currentTarget.contains(t)&&n){const t=e.clientX>O.current?"right":"left";A.current=t,O.current=e.clientX}}))})})})})})})});br.displayName=gr;var wr=y.forwardRef((t,n)=>{const{__scopeMenu:r,...s}=t;return e.jsx(i.div,{role:"group",...s,ref:n})});wr.displayName="MenuGroup";var Dr=y.forwardRef((t,n)=>{const{__scopeMenu:r,...s}=t;return e.jsx(i.div,{...s,ref:n})});Dr.displayName="MenuLabel";var Cr="MenuItem",Tr="menu.itemSelect",Sr=y.forwardRef((t,r)=>{const{disabled:s=!1,onSelect:i,...o}=t,l=y.useRef(null),d=dr(Cr,t.__scopeMenu),c=vr(Cr,t.__scopeMenu),u=n(r,l),m=y.useRef(!1);return e.jsx(kr,{...o,ref:u,disabled:s,onClick:a(t.onClick,()=>{const e=l.current;if(!s&&e){const t=new CustomEvent(Tr,{bubbles:!0,cancelable:!0});e.addEventListener(Tr,e=>null==i?void 0:i(e),{once:!0}),v(e,t),t.defaultPrevented?m.current=!1:d.onClose()}}),onPointerDown:e=>{var n;null==(n=t.onPointerDown)||n.call(t,e),m.current=!0},onPointerUp:a(t.onPointerUp,e=>{var t;m.current||null==(t=e.currentTarget)||t.click()}),onKeyDown:a(t.onKeyDown,e=>{const t=""!==c.searchRef.current;s||t&&" "===e.key||Yn.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});Sr.displayName=Cr;var kr=y.forwardRef((t,r)=>{const{__scopeMenu:s,disabled:o=!1,textValue:l,...d}=t,c=vr(Cr,s),u=ir(s),m=y.useRef(null),p=n(r,m),[f,h]=y.useState(!1),[g,x]=y.useState("");return y.useEffect(()=>{const e=m.current;e&&x((e.textContent??"").trim())},[d.children]),e.jsx(Qn.ItemSlot,{scope:s,disabled:o,textValue:l??g,children:e.jsx(it,{asChild:!0,...u,focusable:!o,children:e.jsx(i.div,{role:"menuitem","data-highlighted":f?"":void 0,"aria-disabled":o||void 0,"data-disabled":o?"":void 0,...d,ref:p,onPointerMove:a(t.onPointerMove,Xr(e=>{if(o)c.onItemLeave(e);else if(c.onItemEnter(e),!e.defaultPrevented){e.currentTarget.focus({preventScroll:!0})}})),onPointerLeave:a(t.onPointerLeave,Xr(e=>c.onItemLeave(e))),onFocus:a(t.onFocus,()=>h(!0)),onBlur:a(t.onBlur,()=>h(!1))})})})}),Ir=y.forwardRef((t,n)=>{const{checked:r=!1,onCheckedChange:s,...i}=t;return e.jsx(Or,{scope:t.__scopeMenu,checked:r,children:e.jsx(Sr,{role:"menuitemcheckbox","aria-checked":Jr(r)?"mixed":r,...i,ref:n,"data-state":qr(r),onSelect:a(i.onSelect,()=>null==s?void 0:s(!!Jr(r)||!r),{checkForDefaultPrevented:!1})})})});Ir.displayName="MenuCheckboxItem";var Mr="MenuRadioGroup",[Rr,Pr]=nr(Mr,{value:void 0,onValueChange:()=>{}}),$r=y.forwardRef((t,n)=>{const{value:r,onValueChange:i,...a}=t,o=s(i);return e.jsx(Rr,{scope:t.__scopeMenu,value:r,onValueChange:o,children:e.jsx(wr,{...a,ref:n})})});$r.displayName=Mr;var _r="MenuRadioItem",Er=y.forwardRef((t,n)=>{const{value:r,...s}=t,i=Pr(_r,t.__scopeMenu),o=r===i.value;return e.jsx(Or,{scope:t.__scopeMenu,checked:o,children:e.jsx(Sr,{role:"menuitemradio","aria-checked":o,...s,ref:n,"data-state":qr(o),onSelect:a(s.onSelect,()=>{var e;return null==(e=i.onValueChange)?void 0:e.call(i,r)},{checkForDefaultPrevented:!1})})})});Er.displayName=_r;var Ar="MenuItemIndicator",[Or,Fr]=nr(Ar,{checked:!1}),Lr=y.forwardRef((t,n)=>{const{__scopeMenu:r,forceMount:s,...a}=t,o=Fr(Ar,r);return e.jsx(l,{present:s||Jr(o.checked)||!0===o.checked,children:e.jsx(i.span,{...a,ref:n,"data-state":qr(o.checked)})})});Lr.displayName=Ar;var Vr=y.forwardRef((t,n)=>{const{__scopeMenu:r,...s}=t;return e.jsx(i.div,{role:"separator","aria-orientation":"horizontal",...s,ref:n})});Vr.displayName="MenuSeparator";var Hr=y.forwardRef((t,n)=>{const{__scopeMenu:r,...s}=t,i=sr(r);return e.jsx(h,{...i,...s,ref:n})});Hr.displayName="MenuArrow";var[Br,Kr]=nr("MenuSub"),zr="MenuSubTrigger",Ur=y.forwardRef((t,n)=>{const r=or(zr,t.__scopeMenu),s=dr(zr,t.__scopeMenu),i=Kr(zr,t.__scopeMenu),o=vr(zr,t.__scopeMenu),l=y.useRef(null),{pointerGraceTimerRef:d,onPointerGraceIntentChange:c}=o,u={__scopeMenu:t.__scopeMenu},m=y.useCallback(()=>{l.current&&window.clearTimeout(l.current),l.current=null},[]);return y.useEffect(()=>m,[m]),y.useEffect(()=>{const e=d.current;return()=>{window.clearTimeout(e),c(null)}},[d,c]),e.jsx(ur,{asChild:!0,...u,children:e.jsx(kr,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":i.contentId,"data-state":Wr(r.open),...t,ref:g(n,i.onTriggerChange),onClick:e=>{var n;null==(n=t.onClick)||n.call(t,e),t.disabled||e.defaultPrevented||(e.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:a(t.onPointerMove,Xr(e=>{o.onItemEnter(e),e.defaultPrevented||t.disabled||r.open||l.current||(o.onPointerGraceIntentChange(null),l.current=window.setTimeout(()=>{r.onOpenChange(!0),m()},100))})),onPointerLeave:a(t.onPointerLeave,Xr(e=>{var t,n;m();const s=null==(t=r.content)?void 0:t.getBoundingClientRect();if(s){const t=null==(n=r.content)?void 0:n.dataset.side,i="right"===t,a=i?-5:5,l=s[i?"left":"right"],c=s[i?"right":"left"];o.onPointerGraceIntentChange({area:[{x:e.clientX+a,y:e.clientY},{x:l,y:s.top},{x:c,y:s.top},{x:c,y:s.bottom},{x:l,y:s.bottom}],side:t}),window.clearTimeout(d.current),d.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(e),e.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:a(t.onKeyDown,e=>{var n;const i=""!==o.searchRef.current;t.disabled||i&&" "===e.key||qn[s.dir].includes(e.key)&&(r.onOpenChange(!0),null==(n=r.content)||n.focus(),e.preventDefault())})})})});Ur.displayName=zr;var Gr="MenuSubContent",Yr=y.forwardRef((t,r)=>{const s=fr(gr,t.__scopeMenu),{forceMount:i=s.forceMount,...o}=t,d=or(gr,t.__scopeMenu),c=dr(gr,t.__scopeMenu),u=Kr(Gr,t.__scopeMenu),m=y.useRef(null),p=n(r,m);return e.jsx(Qn.Provider,{scope:t.__scopeMenu,children:e.jsx(l,{present:i||d.open,children:e.jsx(Qn.Slot,{scope:t.__scopeMenu,children:e.jsx(yr,{id:u.contentId,"aria-labelledby":u.triggerId,...o,ref:p,align:"start",side:"rtl"===c.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;c.isUsingKeyboardRef.current&&(null==(t=m.current)||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:a(t.onFocusOutside,e=>{e.target!==u.trigger&&d.onOpenChange(!1)}),onEscapeKeyDown:a(t.onEscapeKeyDown,e=>{c.onClose(),e.preventDefault()}),onKeyDown:a(t.onKeyDown,e=>{var t;const n=e.currentTarget.contains(e.target),r=Xn[c.dir].includes(e.key);n&&r&&(d.onOpenChange(!1),null==(t=u.trigger)||t.focus(),e.preventDefault())})})})})})});function Wr(e){return e?"open":"closed"}function Jr(e){return"indeterminate"===e}function qr(e){return Jr(e)?"indeterminate":e?"checked":"unchecked"}function Xr(e){return t=>"mouse"===t.pointerType?e(t):void 0}Yr.displayName=Gr;var Zr=cr,Qr=ur,es=hr,ts=br,ns=wr,rs=Dr,ss=Sr,is=Ir,as=$r,os=Er,ls=Lr,ds=Vr,cs=Hr,us=Ur,ms=Yr,ps="DropdownMenu",[fs,hs]=o(ps,[rr]),gs=rr(),[xs,vs]=fs(ps),bs=t=>{const{__scopeDropdownMenu:n,children:s,dir:i,open:a,defaultOpen:o,onOpenChange:l,modal:d=!0}=t,c=gs(n),u=y.useRef(null),[m=!1,p]=r({prop:a,defaultProp:o,onChange:l});return e.jsx(xs,{scope:n,triggerId:T(),triggerRef:u,contentId:T(),open:m,onOpenChange:p,onOpenToggle:y.useCallback(()=>p(e=>!e),[p]),modal:d,children:e.jsx(Zr,{...c,open:m,onOpenChange:p,dir:i,modal:d,children:s})})};bs.displayName=ps;var js="DropdownMenuTrigger",Ns=y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,disabled:s=!1,...o}=t,l=vs(js,r),d=gs(r);return e.jsx(Qr,{asChild:!0,...d,children:e.jsx(i.button,{type:"button",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":l.open?l.contentId:void 0,"data-state":l.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...o,ref:g(n,l.triggerRef),onPointerDown:a(t.onPointerDown,e=>{s||0!==e.button||!1!==e.ctrlKey||(l.onOpenToggle(),l.open||e.preventDefault())}),onKeyDown:a(t.onKeyDown,e=>{s||(["Enter"," "].includes(e.key)&&l.onOpenToggle(),"ArrowDown"===e.key&&l.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});Ns.displayName=js;var ys=t=>{const{__scopeDropdownMenu:n,...r}=t,s=gs(n);return e.jsx(es,{...s,...r})};ys.displayName="DropdownMenuPortal";var ws="DropdownMenuContent",Ds=y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,i=vs(ws,r),o=gs(r),l=y.useRef(!1);return e.jsx(ts,{id:i.contentId,"aria-labelledby":i.triggerId,...o,...s,ref:n,onCloseAutoFocus:a(t.onCloseAutoFocus,e=>{var t;l.current||null==(t=i.triggerRef.current)||t.focus(),l.current=!1,e.preventDefault()}),onInteractOutside:a(t.onInteractOutside,e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;i.modal&&!r||(l.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ds.displayName=ws;y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,i=gs(r);return e.jsx(ns,{...i,...s,ref:n})}).displayName="DropdownMenuGroup";var Cs=y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,i=gs(r);return e.jsx(rs,{...i,...s,ref:n})});Cs.displayName="DropdownMenuLabel";var Ts=y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,i=gs(r);return e.jsx(ss,{...i,...s,ref:n})});Ts.displayName="DropdownMenuItem";var Ss=y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,i=gs(r);return e.jsx(is,{...i,...s,ref:n})});Ss.displayName="DropdownMenuCheckboxItem";y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,i=gs(r);return e.jsx(as,{...i,...s,ref:n})}).displayName="DropdownMenuRadioGroup";var ks=y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,i=gs(r);return e.jsx(os,{...i,...s,ref:n})});ks.displayName="DropdownMenuRadioItem";var Is=y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,i=gs(r);return e.jsx(ls,{...i,...s,ref:n})});Is.displayName="DropdownMenuItemIndicator";var Ms=y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,i=gs(r);return e.jsx(ds,{...i,...s,ref:n})});Ms.displayName="DropdownMenuSeparator";y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,i=gs(r);return e.jsx(cs,{...i,...s,ref:n})}).displayName="DropdownMenuArrow";var Rs=y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,i=gs(r);return e.jsx(us,{...i,...s,ref:n})});Rs.displayName="DropdownMenuSubTrigger";var Ps=y.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,i=gs(r);return e.jsx(ms,{...i,...s,ref:n,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ps.displayName="DropdownMenuSubContent";var $s=ys,_s=Ds,Es=Cs,As=Ts,Os=Ss,Fs=ks,Ls=Is,Vs=Ms,Hs=Rs,Bs=Ps;const Ks=bs,zs=Ns;y.forwardRef(({className:t,inset:n,children:r,...s},i)=>e.jsxs(Hs,{ref:i,className:d("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",t),...s,children:[r,e.jsx(we,{className:"ml-auto h-4 w-4"})]})).displayName=Hs.displayName;y.forwardRef(({className:t,...n},r)=>e.jsx(Bs,{ref:r,className:d("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})).displayName=Bs.displayName;const Us=y.forwardRef(({className:t,sideOffset:n=4,...r},s)=>e.jsx($s,{children:e.jsx(_s,{ref:s,sideOffset:n,className:d("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));Us.displayName=_s.displayName;const Gs=y.forwardRef(({className:t,inset:n,...r},s)=>e.jsx(As,{ref:s,className:d("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",t),...r}));Gs.displayName=As.displayName;y.forwardRef(({className:t,children:n,checked:r,...s},i)=>e.jsxs(Os,{ref:i,className:d("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ls,{children:e.jsx(De,{className:"h-4 w-4"})})}),n]})).displayName=Os.displayName;y.forwardRef(({className:t,children:n,...r},s)=>e.jsxs(Fs,{ref:s,className:d("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ls,{children:e.jsx(Ce,{className:"h-2 w-2 fill-current"})})}),n]})).displayName=Fs.displayName;const Ys=y.forwardRef(({className:t,inset:n,...r},s)=>e.jsx(Es,{ref:s,className:d("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",t),...r}));Ys.displayName=Es.displayName;const Ws=y.forwardRef(({className:t,...n},r)=>e.jsx(Vs,{ref:r,className:d("-mx-1 my-1 h-px bg-muted",t),...n}));Ws.displayName=Vs.displayName;var Js="Avatar",[qs,Xs]=o(Js),[Zs,Qs]=qs(Js),ei=y.forwardRef((t,n)=>{const{__scopeAvatar:r,...s}=t,[a,o]=y.useState("idle");return e.jsx(Zs,{scope:r,imageLoadingStatus:a,onImageLoadingStatusChange:o,children:e.jsx(i.span,{...s,ref:n})})});ei.displayName=Js;var ti="AvatarImage",ni=y.forwardRef((t,n)=>{const{__scopeAvatar:r,src:a,onLoadingStatusChange:o=()=>{},...l}=t,d=Qs(ti,r),c=function(e,t){const[n,r]=y.useState("idle");return N(()=>{if(!e)return void r("error");let n=!0;const s=new window.Image,i=e=>()=>{n&&r(e)};return r("loading"),s.onload=i("loaded"),s.onerror=i("error"),s.src=e,t&&(s.referrerPolicy=t),()=>{n=!1}},[e,t]),n}(a,l.referrerPolicy),u=s(e=>{o(e),d.onImageLoadingStatusChange(e)});return N(()=>{"idle"!==c&&u(c)},[c,u]),"loaded"===c?e.jsx(i.img,{...l,ref:n,src:a}):null});ni.displayName=ti;var ri="AvatarFallback",si=y.forwardRef((t,n)=>{const{__scopeAvatar:r,delayMs:s,...a}=t,o=Qs(ri,r),[l,d]=y.useState(void 0===s);return y.useEffect(()=>{if(void 0!==s){const e=window.setTimeout(()=>d(!0),s);return()=>window.clearTimeout(e)}},[s]),l&&"loaded"!==o.imageLoadingStatus?e.jsx(i.span,{...a,ref:n}):null});si.displayName=ri;var ii=ei,ai=ni,oi=si;const li=y.forwardRef(({className:t,...n},r)=>e.jsx(ii,{ref:r,className:d("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...n}));li.displayName=ii.displayName;const di=y.forwardRef(({className:t,...n},r)=>e.jsx(ai,{ref:r,className:d("aspect-square h-full w-full",t),...n}));di.displayName=ai.displayName;const ci=y.forwardRef(({className:t,...n},r)=>e.jsx(oi,{ref:r,className:d("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...n}));ci.displayName=oi.displayName;const ui=({onLogout:t})=>{const[n,r]=y.useState([]),[s,i]=y.useState([]),[a,o]=y.useState([]),[l,d]=y.useState([]),[c,u]=y.useState(null),[m,p]=y.useState(!1),[f,h]=y.useState(!1);y.useEffect(()=>{const e=window.document.documentElement;m?e.classList.add("dark"):e.classList.remove("dark")},[m]),y.useEffect(()=>{const e=(Te.getJSON(Se.patients,[])||[]).map(e=>({...e,createdAt:e.createdAt?new Date(e.createdAt):new Date}));r(e);const t=(Te.getJSON(Se.prescriptions,[])||[]).map(e=>({...e,startDate:e.startDate?new Date(e.startDate):new Date,endDate:e.endDate?new Date(e.endDate):void 0}));i(t);const n=(Te.getJSON(Se.bloodTests,[])||[]).map(e=>({...e,testDate:e.testDate?new Date(e.testDate):new Date}));o(n);const s=Te.getJSON(Se.drugAdministrations,[]);d(s||[]);const a=Te.getJSON(Se.selectedPatientId,null);if(a){const t=e.find(e=>e.id===a)||null;u(t)}h(!0)},[]),y.useEffect(()=>{f&&Te.setJSON(Se.patients,n)},[f,n]),y.useEffect(()=>{f&&Te.setJSON(Se.prescriptions,s)},[f,s]),y.useEffect(()=>{f&&Te.setJSON(Se.bloodTests,a)},[f,a]),y.useEffect(()=>{f&&Te.setJSON(Se.drugAdministrations,l)},[f,l]),y.useEffect(()=>{f&&((null==c?void 0:c.id)?Te.setJSON(Se.selectedPatientId,c.id):Te.remove(Se.selectedPatientId))},[f,c]);const g=e=>{r([...n,e])};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950",children:[e.jsx("header",{className:"bg-white dark:bg-slate-900 shadow-sm border-b border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(je,{className:"h-8 w-8 text-blue-600 dark:text-blue-300"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"TDM Friends"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Precision Medicine의 시작"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:["등록된 환자 수: ",n.length]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:["선택된 환자: ",(null==c?void 0:c.name)||"None"]})]}),e.jsxs(Ks,{children:[e.jsx(zs,{asChild:!0,children:e.jsxs(se,{variant:"ghost",className:"flex items-center gap-2",children:[e.jsxs(li,{className:"h-9 w-9",children:[e.jsx(di,{src:"https://avatar.vercel.sh/user.png",alt:"User"}),e.jsx(ci,{children:"사용자"})]}),e.jsx("span",{className:"font-medium",children:"사용자"})]})}),e.jsxs(Us,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(Ys,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:"사용자"}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:"user@pk-friends.com"}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground pt-1",children:"소속: PK 프렌즈 대학병원"})]})}),e.jsx(Ws,{}),e.jsx(Gs,{onSelect:e=>e.preventDefault(),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:m?"다크 모드":"라이트 모드"}),e.jsx(Gn,{checked:m,onCheckedChange:p,className:"ml-4"})]})}),e.jsx(Gs,{children:"프로필 설정"}),e.jsx(Gs,{onClick:t,children:"로그아웃"})]})]})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(Dt,{defaultValue:"workflow",className:"space-y-6",children:[e.jsxs(Ct,{className:"grid w-full grid-cols-4 bg-white dark:bg-slate-800 border dark:border-slate-700 shadow-sm h-[52px]",children:[e.jsxs(Tt,{value:"workflow",className:"flex items-center justify-center col-span-3 rounded-l-xl px-6 h-[52px] min-h-[52px] max-h-[52px] text-slate-900 dark:text-slate-200 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white dark:data-[state=inactive]:bg-slate-800 dark:data-[state=inactive]:text-slate-400 dark:focus:bg-slate-700 dark:focus:text-white dark:hover:bg-slate-700 dark:hover:text-white border-r border-slate-200 dark:border-slate-700 leading-none",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Let's TDM"]}),e.jsxs(Tt,{value:"management",className:"flex items-center justify-center col-span-1 rounded-r-xl px-6 h-[52px] min-h-[52px] max-h-[52px] text-slate-900 dark:text-slate-200 dark:data-[state=active]:bg-slate-900 dark:data-[state=active]:text-white dark:data-[state=inactive]:bg-slate-800 dark:data-[state=inactive]:text-slate-400 dark:focus:bg-slate-700 dark:focus:text-white dark:hover:bg-slate-700 dark:hover:text-white border-l border-slate-200 dark:border-slate-700 leading-none",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"환자 관리"]})]}),e.jsx(St,{value:"workflow",children:e.jsx($n,{patients:n,prescriptions:s,bloodTests:a,selectedPatient:c,setSelectedPatient:u,onAddPatient:g,onAddPrescription:(e,t)=>{t?i(e?[...t,e]:t):e&&i([e,...s])},setPrescriptions:i,onAddBloodTest:e=>{o([...a,e])},onDeleteBloodTest:e=>{o(a.filter(t=>t.id!==e))},setBloodTests:o,onAddDrugAdministration:e=>{d([...l,e])},drugAdministrations:l,setDrugAdministrations:d,onUpdatePatient:e=>{r(n.map(t=>t.id===e.id?e:t))},onDeletePatient:e=>{r(n.filter(t=>t.id!==e))},onResetWorkflow:()=>{i([]),o([]),d([])}})}),e.jsx(St,{value:"management",children:e.jsxs(Q,{children:[e.jsxs(ee,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),"환자 관리"]}),e.jsx(ne,{children:"환자 관리 및 히스토리 조회"})]}),e.jsx(re,{children:e.jsx(Ut,{onAddPatient:g,onUpdatePatient:e=>r(t=>t.map(t=>t.id===e.id?e:t)),onDeletePatient:e=>r(t=>t.filter(t=>t.id!==e)),patients:n,selectedPatient:c,setSelectedPatient:u})})]})})]})})]})};export{ui as default};
